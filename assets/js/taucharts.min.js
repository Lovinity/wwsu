/*!
 * /*
 * taucharts@2.6.1 (2018-09-08)
 * Copyright 2018 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 *
 */
!(function (t, e) { typeof exports === 'object' && typeof module === 'object' ? module.exports = e(require('d3-selection'), require('d3-array'), require('d3-scale'), require('topojson-client'), require('d3-transition'), require('d3-format'), require('d3-time-format'), require('d3-brush'), require('d3-color'), require('d3-axis'), require('d3-geo'), require('d3-quadtree'), require('d3-shape'), require('d3-time')) : typeof define === 'function' && define.amd ? define(['d3-selection', 'd3-array', 'd3-scale', 'topojson-client', 'd3-transition', 'd3-format', 'd3-time-format', 'd3-brush', 'd3-color', 'd3-axis', 'd3-geo', 'd3-quadtree', 'd3-shape', 'd3-time'], e) : typeof exports === 'object' ? exports.Taucharts = e(require('d3-selection'), require('d3-array'), require('d3-scale'), require('topojson-client'), require('d3-transition'), require('d3-format'), require('d3-time-format'), require('d3-brush'), require('d3-color'), require('d3-axis'), require('d3-geo'), require('d3-quadtree'), require('d3-shape'), require('d3-time')) : t.Taucharts = e(t.d3, t.d3, t.d3, t.topojson, t.d3, t.d3, t.d3, t.d3, t.d3, t.d3, t.d3, t.d3, t.d3, t.d3) }(window, function (t, e, n, r, i, a, o, s, u, l, c, f, d, h) {
  return (function (t) { var e = {}; function n (r) { if (e[r]) return e[r].exports; var i = e[r] = { i: r, l: !1, exports: {} }; return t[r].call(i.exports, i, i.exports, n), i.l = !0, i.exports } return n.m = t, n.c = e, n.d = function (t, e, r) { n.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: r }) }, n.r = function (t) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: 'Module' }), Object.defineProperty(t, '__esModule', { value: !0 }) }, n.t = function (t, e) { if (1 & e && (t = n(t)), 8 & e) return t; if (4 & e && typeof t === 'object' && t && t.__esModule) return t; var r = Object.create(null); if (n.r(r), Object.defineProperty(r, 'default', { enumerable: !0, value: t }), 2 & e && typeof t !== 'string') for (var i in t)n.d(r, i, function (e) { return t[e] }.bind(null, i)); return r }, n.n = function (t) { var e = t && t.__esModule ? function () { return t.default } : function () { return t }; return n.d(e, 'a', e), e }, n.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, n.p = '', n(n.s = 21) }([function (e, n) { e.exports = t }, function (t, e, n) { 'use strict'; n.r(e); var r = {}; n.r(r), n.d(r, 'traverseJSON', function () { return gt }), n.d(r, 'traverseSpec', function () { return mt }), n.d(r, 'clone', function () { return Ct }), n.d(r, 'isDate', function () { return kt }), n.d(r, 'isObject', function () { return At }), n.d(r, 'niceZeroBased', function () { return Ot }), n.d(r, 'niceTimeDomain', function () { return Pt }), n.d(r, 'generateHash', function () { return Rt }), n.d(r, 'generateRatioFunction', function () { return Ft }), n.d(r, 'isSpecRectCoordsOnly', function () { return Dt }), n.d(r, 'throttleLastEvent', function () { return It }), n.d(r, 'splitEvenly', function () { return jt }), n.d(r, 'extRGBColor', function () { return zt }), n.d(r, 'extCSSClass', function () { return Bt }), n.d(r, 'toRadian', function () { return Vt }), n.d(r, 'normalizeAngle', function () { return Ht }), n.d(r, 'range', function () { return Wt }), n.d(r, 'hasXOverflow', function () { return Gt }), n.d(r, 'hasYOverflow', function () { return Ut }), n.d(r, 'flatten', function () { return Xt }), n.d(r, 'unique', function () { return qt }), n.d(r, 'groupBy', function () { return Yt }), n.d(r, 'union', function () { return $t }), n.d(r, 'intersection', function () { return Kt }), n.d(r, 'defaults', function () { return Jt }), n.d(r, 'omit', function () { return Qt }), n.d(r, 'memoize', function () { return Zt }), n.d(r, 'createMultiSorter', function () { return te }), n.d(r, 'pick', function () { return ee }), n.d(r, 'escape', function () { return ne }), n.d(r, 'template', function () { return re }), n.d(r, 'escapeHtml', function () { return ie }), n.d(r, 'xml', function () { return ue }), n.d(r, 'take', function () { return le }), n.d(r, 'isChartElement', function () { return fe }), n.d(r, 'isFacetUnit', function () { return de }); var i = {}; n.r(i), n.d(i, 'appendTo', function () { return ge }), n.d(i, 'getScrollbarSize', function () { return me }), n.d(i, 'setScrollPadding', function () { return ye }), n.d(i, 'getStyle', function () { return ve }), n.d(i, 'getStyleAsNum', function () { return be }), n.d(i, 'getContainerSize', function () { return xe }), n.d(i, 'getAxisTickLabelSize', function () { return _e }), n.d(i, 'getLabelSize', function () { return we }), n.d(i, 'getCharSize', function () { return Ee }), n.d(i, 'selectOrAppend', function () { return Se }), n.d(i, 'selectImmediate', function () { return Me }), n.d(i, 'selectAllImmediate', function () { return Te }), n.d(i, 'sortChildren', function () { return Ce }), n.d(i, 'classes', function () { return ke }), n.d(i, 'dispatchMouseEvent', function () { return Ae }); var a = {}; n.r(a), n.d(a, 'translate', function () { return Oe }), n.d(a, 'rotate', function () { return Pe }), n.d(a, 'getOrientation', function () { return Ne }), n.d(a, 'parseTransformTranslate', function () { return Le }), n.d(a, 'isIntersect', function () { return Re }), n.d(a, 'getDeepTransformTranslate', function () { return Fe }), n.d(a, 'raiseElements', function () { return De }); var o = n(0); var s = n(2); var u = n(3); var l = {}; var c = {}; function f (t) { var e = c[t]; return e || (e = function () { for (var e, n, r = this, i = 0, a = []; r = r.handler;) { if (typeof (n = r.callbacks[t]) === 'function') { if (!e) for (e = [this], i = 0; i < arguments.length; i++)e.push(arguments[i]); a.unshift({ fn: n, context: r.context, args: e }) } if (typeof (n = r.callbacks['*']) === 'function') { if (!e) for (e = [this], i = 0; i < arguments.length; i++)e.push(arguments[i]); a.unshift({ fn: n, context: r.context, args: [{ sender: this, type: t, args: e }] }) } }a.forEach(function (t) { return t.fn.apply(t.context, t.args) }) }, c[t] = e), e } var d = (function () { function t () { this.handler = null, this.emit_destroy = f('destroy') } return t.prototype.addHandler = function (t, e) { e = e || this, this.handler = { callbacks: t, context: e, handler: this.handler } }, t.prototype.on = function (t, e, n) { var r = {}; return r[t] = e, this.addHandler(r, n), r }, t.prototype.fire = function (t, e) { f.call(this, t).call(this, e) }, t.prototype.removeHandler = function (t, e) { var n; var r = this; for (e = e || this; n = r, r = r.handler;) if (r.callbacks === t && r.context === e) return r.callbacks = l, void (n.handler = r.handler) }, t.prototype.destroy = function () { this.emit_destroy(), this.handler = null }, t }()); var h = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var p = function () { return (p = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var g = (p({}, o), (function (t) { function e (e) { var n = t.call(this) || this; return n.screenModel = null, n._elementNameSpace = e.namespace || 'default', n._elementScalesHub = {}, n } return h(e, t), e.prototype.regScale = function (t, e) { return this._elementScalesHub[t] = e, this }, e.prototype.getScale = function (t) { return this._elementScalesHub[t] || null }, e.prototype.fireNameSpaceEvent = function (t, e) { var n = this._elementNameSpace; this.fire(t + '.' + n, e) }, e.prototype.subscribe = function (t, e, n) { void 0 === e && (e = function (t) { return t }), void 0 === n && (n = function (t) { return t }); var r = this; var i = {}; [{ event: 'mouseover', limit: 0 }, { event: 'mouseout', limit: 0 }, { event: 'click', limit: 0 }, { event: 'mousemove', limit: 'requestAnimationFrame' }].forEach(function (a) { var s = a.event; var u = a.limit; t.on(s, It(i, s, function (t) { var i = { data: e.call(this, t), event: n.call(this, o.event, t) }; r.fire(s, i), r.fireNameSpaceEvent(s, i) }, u)) }) }, e.prototype.allocateRect = function () { return { left: 0, top: 0, width: 0, height: 0 } }, e.prototype.defineGrammarModel = function (t) { return {} }, e.prototype.getGrammarRules = function () { return [] }, e.prototype.getAdjustScalesRules = function () { return [] }, e.prototype.createScreenModel = function (t) { return null }, e.prototype.getClosestElement = function (t, e) { return null }, e.prototype.addInteraction = function () {}, e.prototype.draw = function () { this.config.options.container = this.config.options.slot(this.config.uid), this.drawFrames(this.config.frames) }, e.prototype.data = function () { return this.config.frames.reduce(function (t, e) { return t.concat(e.part()) }, []) }, e.prototype.node = function () { return this }, e }(d))); var m = function (t) { return { day: { cast: function (e) { var n = new Date(e); return new Date(n[t.setHours](0, 0, 0, 0)) }, next: function (e) { var n = new Date(e); var r = new Date(n[t.setDate](n[t.getDate]() + 1)); return this.cast(r) } }, week: { cast: function (e) { var n = new Date(e); return n = new Date(n[t.setHours](0, 0, 0, 0)), new Date(n[t.setDate](n[t.getDate]() - n[t.getDay]())) }, next: function (e) { var n = new Date(e); var r = new Date(n[t.setDate](n[t.getDate]() + 7)); return this.cast(r) } }, month: { cast: function (e) { var n = new Date(e); return n = new Date(n[t.setHours](0, 0, 0, 0)), n = new Date(n[t.setDate](1)) }, next: function (e) { var n = new Date(e); var r = new Date(n[t.setMonth](n[t.getMonth]() + 1)); return this.cast(r) } }, quarter: { cast: function (e) { var n = new Date(e); n = new Date(n[t.setHours](0, 0, 0, 0)); var r = (n = new Date(n[t.setDate](1)))[t.getMonth](); var i = r - r % 3; return new Date(n[t.setMonth](i)) }, next: function (e) { var n = new Date(e); var r = new Date(n[t.setMonth](n[t.getMonth]() + 3)); return this.cast(r) } }, year: { cast: function (e) { var n = new Date(e); return n = new Date(n[t.setHours](0, 0, 0, 0)), n = new Date(n[t.setDate](1)), n = new Date(n[t.setMonth](0)) }, next: function (e) { var n = new Date(e); var r = new Date(n[t.setFullYear](n[t.getFullYear]() + 1)); return this.cast(r) } } } }; var y = m({ setHours: 'setHours', setDate: 'setDate', getDate: 'getDate', setMonth: 'setMonth', getDay: 'getDay', getMonth: 'getMonth', setFullYear: 'setFullYear', getFullYear: 'getFullYear' }); var v = m({ setHours: 'setUTCHours', setDate: 'setUTCDate', getDate: 'getUTCDate', setMonth: 'setUTCMonth', getDay: 'getUTCDay', getMonth: 'getUTCMonth', setFullYear: 'setUTCFullYear', getFullYear: 'getUTCFullYear' }); var b = { add: function (t, e, n) { return ((void 0 === n ? { utc: !1 } : n).utc ? v : y)[t.toLowerCase()] = e, this }, get: function (t, e) { return ((void 0 === e ? { utc: !1 } : e).utc ? v : y)[(t || '').toLowerCase()] || null }, generate: function (t, e, n, r) { var i = (void 0 === r ? { utc: !1 } : r).utc; var a = []; var o = b.get(n, { utc: i }); if (o) { var s = o.cast(new Date(e)); var u = o.cast(new Date(t)); for (a.push(u); (u = o.next(new Date(u))) <= s;)a.push(u) } return a } }; var x = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var _ = (function (t) { function e (e, n, r) { var i = t.call(this) || this; return i.name = 'TauChartError', i.message = e, i.errorCode = n, i.errorArgs = r, i } return x(e, t), e }(Error)); var w = { STACKED_FIELD_NOT_NUMBER: 'STACKED_FIELD_NOT_NUMBER', NO_DATA: 'NO_DATA', NOT_SUPPORTED_TYPE_CHART: 'NOT_SUPPORTED_TYPE_CHART', UNKNOWN_UNIT_TYPE: 'UNKNOWN_UNIT_TYPE', INVALID_LOG_DOMAIN: 'INVALID_LOG_DOMAIN' }; var E = {}; var S = { get: function (t) { return E[t] }, reg: function (t, e) { return E[t] = e, this } }; var M = 'taucharts_synthetic_record'; S.reg('identity', function () { return {} }).reg('flip', function (t) { var e = t.scaleY; var n = t.scaleX; var r = n.domain(); var i = n.discrete ? r[0] : Math.max(0, Math.min.apply(Math, r)); var a = n.value(i) + -0.5 * n.stepSize(i); return { flip: !0, scaleX: e, scaleY: n, xi: function (t) { return e.value(t[e.dim]) }, yi: function (t) { return n.value(t[n.dim]) }, y0: function () { return a } } }).reg('obsoleteVerticalStackOrder', function () { return { obsoleteVerticalStackOrder: !0 } }).reg('positioningByColor', function (t) { return (t.scaleX.discrete ? function (t) { var e = t.data().reduce(function (e, n) { var r = n[t.scaleX.dim]; var i = n[t.scaleColor.dim]; return e.hasOwnProperty(r) || (e[r] = []), e[r].indexOf(i) < 0 && e[r].push(i), e }, {}); var n = t.scaleX; var r = t.scaleColor; var i = r.discrete ? r.domain() : r.originalSeries().sort(function (t, e) { return t - e }); var a = i.length || 1; var o = i.reduce(function (t, e, n) { return t[e] = n, t }, {}); return Object.keys(e).forEach(function (t) { return e[t].sort(function (t, e) { return o[t] - o[e] }) }), { xi: function (r) { var i = r[t.scaleX.dim]; var o = e[i] || [r[t.scaleColor.dim]]; var s = o.length; var u = o.indexOf(r[t.scaleColor.dim]); var l = (function (t) { return n.stepSize(t[n.dim]) * (a / (1 + a)) }(r)) / (a + 1); return t.xi(r) - (s + 1) * l / 2 + (1 + u) * l } } } : function () { return {} })(t) }).reg('groupOrderByAvg', function (t) { var e = t.data().reduce(function (e, n) { var r = t.group(n); return e[r] = e[r] || [], e[r].push(n), e }, {}); var n = Object.keys(e).map(function (n) { return [n, (function (e) { return e.map(t.yi).reduce(function (t, e) { return t + e }, 0) / e.length }(e[n]))] }).sort(function (t, e) { return t[1] - e[1] }).map(function (t) { return t[0] }); return { order: function (t) { var e = n.indexOf(t); return e < 0 ? Number.MAX_VALUE : e } } }).reg('stack', function (t) { var e = t.data(); var n = t.scaleX; var r = t.scaleY; if (r.discrete || r.domain().some(function (t) { return typeof t !== 'number' })) throw new _('Stacked field [' + r.dim + '] should be a number', w.STACKED_FIELD_NOT_NUMBER, { field: r.dim }); var i = function (t) { return function (e) { var i = e[n.dim]; var a = e[r.dim]; var o = a >= 0 ? t.positive : t.negative; var s = o[i] || 0; var u = s + a; return o[i] = u, { nextStack: u, prevStack: s } } }; var a = i({ positive: {}, negative: {} }); var o = i({ positive: {}, negative: {} }); var s = function (e) { return Zt(e, t.id) }; var u = Number.MAX_VALUE; var l = Number.MIN_VALUE; var c = function (t) { return u = t < u ? t : u, l = t > l ? t : l, r.value(t) }; var f = s(function (t) { return c(a(t).nextStack) }); var d = s(function (t) { return c(o(t).prevStack) }); var h = function (e) { return t.group(e) + '/' + (e[r.dim] >= 0 ? 1 : -1) }; var p = Yt(e, h); var g = Object.keys(p).sort(t.flip || !t.flip && t.obsoleteVerticalStackOrder ? function (e, n) { return t.order(e) - t.order(n) } : function (e, n) { return t.order(n) - t.order(e) }).reduce(function (t, e) { return t.concat(p[e]) }, []); return g.forEach(function (t) { f(t), d(t) }), r.fixup(function (t) { var e = {}; return (!t.hasOwnProperty('max') || t.max < l) && (e.max = l), (!t.hasOwnProperty('min') || t.min > u) && (e.min = u), e }), { group: h, data: function () { return g }, yi: f, y0: d } }).reg('size_distribute_evenly', function (t, e) { var n = e.minLimit; var r = e.maxLimit; var i = e.defMin; var a = e.defMax; var o = t.data(); var s = function (t, e) { return t - e }; var u = t.scaleX.discrete ? t.scaleX.stepSize() / 2 : Number.MAX_VALUE; var l = o.map(function (e) { return t.xi(e) }).sort(s); var c = l[0]; var f = l.slice(1).map(function (t) { var e = t - c; return c = t, e }).filter(function (t) { return t > 0 }).sort(s).concat(Number.MAX_VALUE)[0]; var d = Math.min(f, u); var h = typeof n === 'number' ? n : i; var p = { minSize: h, maxSize: typeof r === 'number' ? r : Math.max(h, Math.min(a, d)) }; return t.scaleSize.fixup(function (t) { var e = {}; return t.fixed ? t.maxSize > p.maxSize && (e.maxSize = p.maxSize) : (e.fixed = !0, e.minSize = p.minSize, e.maxSize = p.maxSize), e }), {} }).reg('adjustStaticSizeScale', function (t, e) { var n = e.minLimit; var r = e.maxLimit; var i = e.defMin; var a = e.defMax; var o = { minSize: typeof n === 'number' ? n : i, maxSize: typeof r === 'number' ? r : a }; return t.scaleSize.fixup(function (t) { var e = {}; return t.fixed || (e.fixed = !0, e.minSize = o.minSize, e.maxSize = o.maxSize), e }), {} }).reg('adjustSigmaSizeScale', function (t, e) { var n = e.minLimit; var r = e.maxLimit; var i = e.defMin; var a = e.defMax; var o = function (t, e) { return t - e }; var s = t.data().map(function (e) { return t.xi(e) }).sort(o); var u = s[0]; var l = s.slice(1).map(function (t) { var e = t - u; return u = t, e }).filter(function (t) { return t > 0 }).sort(o).concat(Number.MAX_VALUE)[0]; var c = t.scaleX.discrete ? t.scaleX.stepSize() / 2 : Number.MAX_VALUE; var f = Math.min(l, c); var d = typeof n === 'number' ? n : i; var h = typeof r === 'number' ? r : a; var p = { minSize: d, maxSize: Math.max(d, Math.min(h, (function (t) { var e = (d + h) / 2; var n = h; var r = d; return Math.round(e + (n - e) / (1 + Math.exp(-(t - r) / 0.5))) }(f)))) }; return t.scaleSize.fixup(function (t) { var e = {}; return t.fixed ? t.maxSize > p.maxSize && (e.maxSize = p.maxSize) : (e.fixed = !0, e.minSize = p.minSize, e.maxSize = p.maxSize), e }), {} }).reg('avoidScalesOverflow', function (t, e) { var n; var r; var i = e.sizeDirection; var a = function (t, e) { return !t || t.discrete || t.scaleType === 'logarithmic' || i.indexOf(e) < 0 }; var o = a(t.scaleX, 'x'); var s = a(t.scaleY, 'y'); if (o && s) return {}; t.scaleSize.fixup(function (t) { return n = t.minSize, r = t.maxSize, t }); var u = t.data().reduce(function (e, i) { var a; var u; var l = t.size(i); var c = (l >= n ? l : n + l * (r - n)) / 2; return o || (a = t.xi(i), e.left = Math.min(e.left, a - c), e.right = Math.max(e.right, a + c)), s || (u = t.yi(i), e.top = Math.min(e.top, u - c), e.bottom = Math.max(e.bottom, u + c)), e }, { top: Number.MAX_VALUE, right: -Number.MAX_VALUE, bottom: -Number.MAX_VALUE, left: Number.MAX_VALUE }); var l = function (e, n, r, i) { var a = e.domain(); var o = Math.abs(e.value(a[1]) - e.value(a[0])); var s = (a[1] - a[0]) / o; if (o === 0) return 1; var u = Math.max(0, -n); var l = Math.max(0, r - o); var c = t.flip ? l : u; var f = t.flip ? u : l; var d = Number(a[0]) - (i ? f : c) * s; var h = Number(a[1]) + (i ? c : f) * s; return e.fixup(function (t) { var e = {}; if (t.fixedBorders) { var i = t.fixedBorders.slice(); var a = i[0]; var o = i[1]; (a > n || o < r) && (e.min = Math.min(t.min, d), e.max = Math.max(t.max, h), a = Math.min(n, a), o = Math.max(r, o)), e.fixedBorders = [a, o] } else e.fixed = !0, e.min = d, e.max = h, e.nice = !1, e.fixedBorders = [n, r]; return e }), o / (c + o + f) }; var c = o ? 1 : l(t.scaleX, u.left, u.right, !1); var f = s ? 1 : l(t.scaleY, u.top, u.bottom, !0); var d = Math.min(n * c, n * f); var h = Math.min(r * c, r * f); return t.scaleSize.fixup(function () { return { minSize: d, maxSize: h } }), {} }).reg('fillGaps', function (t, e) { var n = e.isStack; var r = e.xPeriod; var i = e.utc; var a = Yt(t.data(), t.group); var o = Object.keys(a).sort(function (e, n) { return t.order(e) - t.order(n) }).reduce(function (t, e) { return t.concat([a[e]]) }, []); var s = t.scaleX.dim; var u = t.scaleY.dim; var l = t.scaleColor.dim; var c = t.scaleSplit.dim; var f = function (t) { return t[u] >= 0 ? 1 : -1 }; var d = function (e, n, r) { var i = Yt(n, function (t) { return t[s] }); var a = n[0]; return e.reduce(function (e, n) { return e.concat(i[n] || (function (e, n, r) { var i; var a = [e, t.id(n), r].join(' '); return (i = {})[s] = e, i[u] = 1e-10 * r, i[c] = n[c], i[l] = n[l], i[M] = !0, i[M + 'id'] = a, i }(n, a, r))) }, []) }; var h = function (t, e) { return t - e }; var p = function () { return qt(o.reduce(function (t, e) { return t.concat(e.map(function (t) { return t[s] })) }, [])).sort(h) }; var g = r ? (function () { var e = p(); var n = Math.max.apply(Math, e.map(function (t) { return Number(t) })); var a = t.scaleX.domain(); var o = b.generate(a[0], a[1], r, { utc: i }).filter(function (t) { return t >= a[0] && t <= a[1] }); var s = 0; var u = []; var l = b.get(r, { utc: i }); return o.forEach(function (t) { var r = Number(t); if (!(r >= n)) { for (var i = s; i < e.length; i++) if (Number(l.cast(e[i])) === r) return void s++; u.push(t) } }), e.concat(u).sort(h) }()) : p(); var m = o.map(function (e) { return e.sort(function (e, n) { return t.xi(e) - t.xi(n) }) }).reduce(n ? function (t, e) { var n = Yt(e, function (t) { return String(f(t)) }); return Object.keys(n).reduce(function (t, e) { return t.concat(d(g, n[e], e)) }, t) } : function (t, e) { Yt(e, function (t) { return String(f(t)) }); var n = Math.max.apply(Math, e.map(function (t) { return t[s] })); return t.concat(d(g.filter(function (t) { return t <= n }), e, 0)) }, []); return { data: function () { return m }, size: function (e) { return e[M] ? t.scaleSize(0) : t.size(e) }, id: function (e) { return e[M] ? e[M + 'id'] : t.id(e) } } }); var T = n(5); function C (t) { for (var e = [], n = 1; n < arguments.length; n++)e[n - 1] = arguments[n]; return e.length === 2 ? e[0] * (1 - t) + e[1] * t : e.length === 3 ? e[0] * (1 - t) * (1 - t) + 2 * e[1] * (1 - t) * t + e[2] * t * t : e[0] * (1 - t) * (1 - t) * (1 - t) + 3 * e[1] * (1 - t) * (1 - t) * t + 3 * e[2] * (1 - t) * t * t + e[3] * t * t * t } function k (t) { for (var e = [], n = 1; n < arguments.length; n++)e[n - 1] = arguments[n]; var r = e.map(function (t) { return t.x }); var i = e.map(function (t) { return t.y }); return { x: C.apply(void 0, [t].concat(r)), y: C.apply(void 0, [t].concat(i)) } } function A (t, e, n, r, i) { var a = k(t, e, n); var o = k(t, e, n, r); var s = k(t, n, r, i); var u = k(t, r, i); return [e, a, o, k(t, o, s), s, u, i] } function O (t, e, n) { var r; return void 0 === n && (n = 'polyline'), function (i) { return i === 0 ? t : i === 1 ? e : (r || (r = (n === 'cubic' ? function (t, e) { for (var n = 2; n < t.length - 1; n += 3)t[n - 1].isCubicControl = !0, t[n].isCubicControl = !0; for (n = 2; n < e.length - 1; n += 3)e[n - 1].isCubicControl = !0, e[n].isCubicControl = !0; var r, i; for (t = t.filter(function (t) { return !t.isInterpolated }), n = t.length - 2; n >= 0; n--)i = t[n + 1], (r = t[n]).isCubicControl || i.isCubicControl || (t.splice(n + 1, 0, k(1 / 3, i, r), k(2 / 3, i, r)), t[n + 1].isCubicControl = !0, t[n + 2].isCubicControl = !0); var a = t.filter(function (t, e) { return e % 3 == 0 }); var o = e.filter(function (t, e) { return e % 3 == 0 }); var s = a.map(function (t) { return t.id }); var u = o.map(function (t) { return t.id }); var l = s.reduce(function (e, n) { return e[n] = t.findIndex(function (t) { return t.id === n }), e }, {}); var c = u.reduce(function (t, n) { return t[n] = e.findIndex(function (t) { return t.id === n }), t }, {}); var f = s.filter(function (t) { return u.indexOf(t) >= 0 }); var d = a.filter(function (t) { return !t.positionIsBeingChanged }); var h = o.filter(function (t) { return !t.positionIsBeingChanged }); var p = V(d, h); var g = V(h, d); var m = []; f.forEach(function (n, r) { var i = l[n]; var a = c[n]; if (r === 0 && (i > 0 || a > 0) && m.push(P({ polylineFrom: t.slice(0, i + 1), polylineTo: e.slice(0, a + 1), toOppositeScale: a === 0 ? p : g, isCubic: !0 })), r > 0) { var o = l[f[r - 1]]; var s = c[f[r - 1]]; i - o > 3 || a - s > 3 ? m.push(N({ polylineFrom: t.slice(o, i + 1), polylineTo: e.slice(s, a + 1), isCubic: !0 })) : m.push(function (t) { var e = t.polylineFrom; var n = t.polylineTo; return function (t) { return j(e.slice(1, 3), n.slice(1, 3), t) } }({ polylineFrom: t.slice(o, i + 1), polylineTo: e.slice(s, a + 1) })) }m.push(L({ pointFrom: t[i], pointTo: e[a] })), r === f.length - 1 && (t.length - i - 1 > 0 || e.length - a - 1 > 0) && m.push(P({ polylineFrom: t.slice(i), polylineTo: e.slice(a), toOppositeScale: e.length - a == 1 ? p : g, isCubic: !0 })) }), m.length === 0 && (e.length > 0 && f.length === 0 || t.length > 0 && f.length === 0) && m.push(R({ polylineFrom: t.slice(0), polylineTo: e.slice(0), isCubic: !0 })); return function (t) { var e = []; return m.forEach(function (n) { var r = n(t); F(e, r) }), e } } : function (t, e) { var n = (t = t.filter(function (t) { return !t.isInterpolated })).map(function (t) { return t.id }); var r = e.map(function (t) { return t.id }); var i = n.filter(function (t) { return r.indexOf(t) >= 0 }); var a = t.filter(function (t) { return !t.positionIsBeingChanged }); var o = e.filter(function (t) { return !t.positionIsBeingChanged }); var s = V(a, o); var u = V(o, a); var l = []; i.forEach(function (a, o) { var c = n.indexOf(a); var f = r.indexOf(a); if (o === 0 && (c > 0 || f > 0) && l.push(P({ isCubic: !1, polylineFrom: t.slice(0, c + 1), polylineTo: e.slice(0, f + 1), toOppositeScale: f === 0 ? s : u })), o > 0) { var d = n.indexOf(i[o - 1]); var h = r.indexOf(i[o - 1]); (c - d > 1 || f - h > 1) && l.push(N({ isCubic: !1, polylineFrom: t.slice(d, c + 1), polylineTo: e.slice(h, f + 1) })) }l.push(L({ pointFrom: t[c], pointTo: e[f] })), o === i.length - 1 && (t.length - c - 1 > 0 || e.length - f - 1 > 0) && l.push(P({ isCubic: !1, polylineFrom: t.slice(c), polylineTo: e.slice(f), toOppositeScale: e.length - f == 1 ? s : u })) }), l.length === 0 && (e.length > 0 && i.length === 0 || t.length > 0 && i.length === 0) && l.push(R({ isCubic: !1, polylineFrom: t.slice(0), polylineTo: e.slice(0) })); return function (t) { var e = []; return l.forEach(function (n) { var r = n(t); F(e, r) }), e } })(t, e)), r(i)) } } function P (t) { var e = t.polylineFrom; var n = t.polylineTo; var r = t.isCubic; var i = t.toOppositeScale; var a = e.length > n.length ? e : n; var o = n.length === 1; var s = e[0].id !== n[0].id; var u = Boolean(s !== o); return function (t) { var e = (r ? B : z)({ t: t, polyline: a, decreasing: o, rightToLeft: u }); o === u ? e.shift() : e.pop(); var n = j(e.map(i), e, o ? 1 - t : t); return n.forEach(function (t) { return t.positionIsBeingChanged = !0 }), n } } function N (t) { var e = t.polylineFrom; var n = t.polylineTo; var r = t.isCubic; var i = e.length; var a = n.length; if (a !== i) { var o = a < i; var s = o ? e : n; var u = (r ? function (t) { var e = t.smallerPolyline; var n = t.biggerPolyline; var r = t.decreasing; var i = (e.length - 1) / 3; var a = (n.length - 1) / 3; var o = Math.floor(a / i) + 1; var s = a % i; var u = Wt(i).map(function (t) { return o + Number(t < s) }); var l = [e[0]]; var c = 3; return u.forEach(function (t) { if (t > 2) { var i = (function (t, e) { for (var n, r, i = [e[0]], a = 0; a < t.length; a++)n = a === 0 ? t[0] : t[a] / (1 - t[a - 1]), r = W(n, e), F(i, r.slice(1, 4)), e = r.slice(3); return F(i, e.slice(1)), i }(Wt(1, t - 1).map(function (e) { return e / (t - 1) }), e.slice(c - 3, c + 1))); Wt(t - 2).forEach(function (t) { return i[3 * (t + 1)].id = n[l.length - 1 + 3 * t].id }), r && i.forEach(function (t, e) { e > 0 && e < i.length - 1 && (t.isInterpolated = !0) }), F(l, i.slice(1)) } else { var a = Object.assign({}, e[c - 2]); var o = Object.assign({}, e[c - 1]); var s = Object.assign({}, e[c]); r || (s.id = n[l.length + 2].id), l.push(a, o, s) }c += 3 }), l } : function (t) { var e = t.smallerPolyline; var n = t.biggerPolyline; var r = t.decreasing; var i = e.length - 1; var a = n.length - 1; var o = Math.floor(a / i) + 1; var s = a % i; var u = Wt(i).map(function (t) { return o + Number(t < s) }); var l = [e[0]]; var c = 1; return u.forEach(function (t) { Wt(1, t).forEach(function (i) { var a; i === t - 1 ? (a = Object.assign({}, e[c]), r || (a.id = n[l.length].id)) : ((a = I(e[c - 1], e[c], i / (t - 1))).id = n[l.length].id, r && (a.isInterpolated = !0)), l.push(a) }), c++ }), l })({ smallerPolyline: o ? n : e, biggerPolyline: s, decreasing: o }); var l = s.slice(1, s.length - 1); var c = u.slice(1, u.length - 1); return function (t) { var e = j(c, l, o ? 1 - t : t); return e.forEach(function (t) { return t.positionIsBeingChanged = !0 }), e } } var f = e.slice(1, e.length - 1); var d = n.slice(1, n.length - 1); return function (t) { var e = j(f, d, t); return e.forEach(function (t) { return t.positionIsBeingChanged = !0 }), e } } function L (t) { var e = t.pointFrom; var n = t.pointTo; return function (t) { return [I(e, n, t)] } } function R (t) { var e = t.polylineFrom; var n = t.polylineTo; var r = t.isCubic; var i = n.length === 0; var a = i; var o = i ? e : n; return function (t) { var e = (r ? B : z)({ t: t, polyline: o, decreasing: i, rightToLeft: a }); return e.forEach(function (t, e) { e > 0 && (t.positionIsBeingChanged = !0) }), e } } function F (t, e) { return Array.prototype.push.apply(t, e) } function D (t, e, n) { return void 0 === e ? t : typeof e === 'number' ? t + n * (e - t) : e } function I (t, e, n) { if (t === e) return e; var r = {}; return Object.keys(t).forEach(function (i) { return r[i] = D(t[i], e[i], n) }), void 0 !== e.id && (r.id = e.id), r } function j (t, e, n) { return t.map(function (t, r) { return I(t, e[r], n) }) } function z (t) { var e = t.t; var n = t.polyline; var r = t.decreasing; var i = t.rightToLeft; var a = Boolean(r) !== Boolean(i); var o = (function (t, e) { var n = 0; if (t > 0) { for (var r, i, a, o, s = [0], u = 0, l = 1; l < e.length; l++)a = e[l - 1].x, o = e[l - 1].y, r = e[l].x, i = e[l].y, u += Math.sqrt((r - a) * (r - a) + (i - o) * (i - o)), s.push(u); var c = t * u; for (l = 1; l < s.length; l++) if (c <= s[l]) { n = Math.min(1, (l - 1 + (c - s[l - 1]) / (s[l] - s[l - 1])) / (e.length - 1)); break } } var f = Math.floor((e.length - 1) * n) + 1; var d = e.length - f; var h = f; var p = e.slice(0, f); if (n < 1) { var g = n * (e.length - 1) % 1; var m = I(e[f - 1], e[f], g); F(p, Wt(d).map(function (t) { return Object.assign({}, m, { id: e[h + t].id, isInterpolated: !0 }) })) } return p }(r ? 1 - e : e, a ? n.slice(0).reverse() : n)); return a && o.reverse(), o } function B (t) { var e = t.t; var n = t.polyline; var r = t.decreasing; var i = t.rightToLeft; var a = Boolean(r) !== Boolean(i); var o = (function (t, e) { var n = (e.length - 1) / 3 + 1; var r = 0; if (t > 0) { for (var i, a, o, s, u, l, c, f, d = [0], h = 0, p = 1; p < n; p++)o = e[3 * p - 3].x, s = e[3 * p - 3].y, u = e[3 * p - 2].x, l = e[3 * p - 2].y, c = e[3 * p - 1].x, f = e[3 * p - 1].y, i = e[3 * p].x, a = e[3 * p].y, h += (H(o, s, u, l) + H(u, l, c, f) + H(c, f, i, a) + H(i, a, o, s)) / 2, d.push(h); var g = t * h; for (p = 1; p < d.length; p++) if (g <= d[p]) { r = Math.min(1, (p - 1 + (g - d[p - 1]) / (d[p] - d[p - 1])) / (n - 1)); break } } var m = Math.floor((n - 1) * r) + 1; var y = n - m; var v = 3 * m; var b = e.slice(0, 3 * (m - 1) + 1); if (r < 1) { var x = W(r * (n - 1) % 1, e.slice(3 * (m - 1), 3 * m + 1)).slice(1, 4); x.forEach(function (t) { return t.isInterpolated = !0 }), x[2].id = e[v].id, F(b, x), Wt(1, y).forEach(function (t) { F(b, [{ x: x[2].x, y: x[2].y, isCubicControl: !0, isInterpolated: !0 }, { x: x[2].x, y: x[2].y, isCubicControl: !0, isInterpolated: !0 }, Object.assign({}, x[2], { id: e[v + 3 * t].id, isInterpolated: !0 })]) }) } return b }(r ? 1 - e : e, a ? n.slice(0).reverse() : n)); return a && o.reverse(), o } function V (t, e) { var n; var r; var i; var a; var o = []; var s = []; var u = 0; var l = t.length; var c = e.length; for (n = 0; n < l; n++) for (i = t[n], r = u; r < c; r++) if (a = e[r], i.id === a.id) { u = r + 1, o.push(i), s.push(a); break } if (o.length < 1 || s.length < 1) return function (t) { return t }; var f = Object.keys(o[0]).filter(function (t) { return typeof o[0][t] === 'number' }).filter(function (t) { return t !== 'id' }); var d = {}; var h = function (t, e, n, r) { return function (i) { return r + (i - e) * (r - n) / (e - t) } }; return f.forEach(function (t) { for (var e, n, r = o[0][t], i = s[0][t], a = o.length - 1; a > 0; a--) if ((e = o[a][t]) !== r) return n = s[a][t], void (d[t] = h(r, e, i, n)); d[t] = (function (t, e) { return function (n) { return n - t + e } }(r, i)) }), function (t) { var e = Object.assign({}, t); return f.forEach(function (n) { e[n] = d[n](t[n]) }), e } } function H (t, e, n, r) { return Math.sqrt((n - t) * (n - t) + (r - e) * (r - e)) } function W (t, e) { var n = e[0]; var r = e[1]; var i = e[2]; var a = e[3]; var o = A(t, n, r, i, a); return [o[1], o[2], o[4], o[5]].forEach(function (t) { return t.isCubicControl = !0 }), Object.keys(a).forEach(function (e) { e !== 'x' && e !== 'y' && e !== 'id' && (o[3][e] = D(n[e], a[e], t)) }), o } function G (t, e) { if (t.length < 2) return t.slice(0); if (t.length === 2) return [t[0], { x: U(t[0].x, t[1].x, 1 / 3), y: U(t[0].y, t[1].y, 1 / 3) }, { x: U(t[0].x, t[1].x, 2 / 3), y: U(t[0].y, t[1].y, 2 / 3) }, t[1]]; for (var n, r, i, a, o, s, u, l, c, f, d, h, p, g, m = new Array(3 * (t.length - 1) + 1), y = m.length - 1, v = 0; v < t.length; v++)m[3 * v] = t[v], v > 0 && (m[3 * v - 2] = k(1 / 3, t[v - 1], t[v]), m[3 * v - 1] = k(2 / 3, t[v - 1], t[v])); for (var b = m.slice(0), x = 0; x < 3; x++) { for (m[1] = { x: U(m[0].x, m[3].x, 1 / 3), y: U(m[0].y, U(m[3].y, m[2].y, 1.5), 2 / 3) }, m[y - 1] = { x: U(m[y].x, m[y - 3].x, 1 / 3), y: U(m[y].y, U(m[y - 3].y, m[y - 2].y, 1.5), 2 / 3) }, e && ((m[1].y - m[0].y) * (m[3].y - m[2].y) < 0 && (m[1] = { x: m[1].x, y: m[0].y }), (m[y - 1].y - m[y].y) * (m[y - 3].y - m[y - 2].y) < 0 && (m[y - 1] = { x: m[y - 1].x, y: m[y].y })), v = 6; v < b.length; v += 3)n = b[v - 5], r = b[v - 3], i = b[v - 1], (r.x - n.x) * (i.x - r.x) * 1e12 < 1 ? (a = U(n.x, r.x, 0.5), s = U(r.x, i.x, 0.5), o = U(n.y, r.y, 0.5), u = U(r.y, i.y, 0.5)) : (f = (r.x - n.x) / (i.x - n.x), l = (r.x - n.x * (1 - f) * (1 - f) - i.x * f * f) / (2 * (1 - f) * f), c = (r.y - n.y * (1 - f) * (1 - f) - i.y * f * f) / (2 * (1 - f) * f), a = U(n.x, l, f), s = U(l, i.x, f), o = U(n.y, c, f), u = U(c, i.y, f), e && (h = r.x - a, p = s - r.x, d = (u - r.y) / p, (r.y - n.y) * (i.y - r.y) <= 0 ? d = 0 : (r.y > n.y == u > i.y && (p = U(p * (g = (i.y - r.y) / (u - r.y)), p, 1 / (1 + Math.abs(g))), d = (i.y - r.y) / p), r.y > n.y == o < n.y && (h = U(h * (g = (r.y - n.y) / (r.y - o)), h, 1 / (1 + Math.abs(g))), d = (r.y - n.y) / h)), a = r.x - h, s = r.x + p, o = r.y - d * h, u = r.y + d * p)), m[v - 4] = { x: a, y: o }, m[v - 2] = { x: s, y: u }; b = m.slice(0) } return b } function U (t, e, n) { return t + n * (e - t) } var X = { linear: function (t) { return t }, step: function (t) { for (var e, n, r, i, a = [], o = void 0 !== t[0].id, s = void 0 !== t[0].size, u = 1; u < t.length; u++)e = t[u - 1], n = t[u], r = { x: (e.x + n.x) / 2, y: e.y }, i = { x: (e.x + n.x) / 2, y: n.y }, o && (r.id = e.id + '-' + n.id + '-1', i.id = e.id + '-' + n.id + '-2'), s && (r.size = e.size, i.size = n.size), u === 1 && a.push(e), a.push(r, i, n); return a }, 'step-before': function (t) { for (var e, n, r, i = [], a = void 0 !== t[0].id, o = void 0 !== t[0].size, s = 1; s < t.length; s++)e = t[s - 1], n = t[s], r = { x: e.x, y: n.y }, a && (r.id = e.id + '-' + n.id), o && (r.size = n.size), s === 1 && i.push(e), i.push(r, n); return i }, 'step-after': function (t) { for (var e, n, r, i = [], a = void 0 !== t[0].id, o = void 0 !== t[0].size, s = 1; s < t.length; s++)e = t[s - 1], r = { x: (n = t[s]).x, y: e.y }, a && (r.id = e.id + '-' + n.id), o && (r.size = e.size), s === 1 && i.push(e), i.push(r, n); return i } }; var q = { smooth: function (t) { return G(t, !1) }, 'smooth-keep-extremum': function (t) { return G(t, !0) } }; function Y (t) { return X[t] || q[t] } function $ (t) { return void 0 !== q[t] ? 'cubic' : 'polyline' } var K = function () { return (K = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var J = K({}, o, T); var Q = function () { return Zt(function (t) { return t.node().getComputedTextLength() }, function (t) { return t.node().textContent.length }) }; var Z = function (t, e, n) { n = n || Q(), t.each(function () { var t = J.select(this.parentNode).data()[0]; var r = e(t); var i = J.select(this); var a = !1; var o = i.text().split(/\s+/).reduce(function (t, e, o) { if (a) return t; var s = o > 0 ? [t, e].join(' ') : e; var u = n(i.text(s)); if (u < r)t = s; else { var l = Math.floor(r / u * s.length); t = s.substr(0, l - 4) + '...', a = !0 } return t }, ''); i.text(o) }) }; var tt = function (t, e, n, r, i, a) { a = a || Q(); var o = function (t, e, n, r, i, a, o) { var s = o * n + a; return t.append('tspan').attr('x', r).attr('y', i).attr('dy', s + 'em').text(e) }; t.each(function () { var t = J.select(this.parentNode).data()[0]; var s = e(t); var u = J.select(this); var l = u.text().split(/\s+/); var c = u.attr('x'); var f = u.attr('y'); var d = parseFloat(u.attr('dy')); u.text(null); var h = o(u, null, 1.1, c, f, d, 0); var p = !1; var g = l.length - 1; var m = l.reduce(function (t, e, r) { if (p) return t; var i = t.length === n || r === g; var o = t[t.length - 1]; var u = o !== '' ? o + ' ' + e : e; var l = a(h.text(u)); var c = l > s; if (c && i) { var f = Math.floor(s / l * u.length); t[t.length - 1] = u.substr(0, f - 4) + '...', p = !0 } return c && !i && t.push(e), c || (t[t.length - 1] = u), t }, ['']).filter(function (t) { return t.length > 0 }); f = i ? -1 * (m.length - 1) * Math.floor(0.5 * r) : f, m.forEach(function (t, e) { return o(u, t, 1.1, c, f, d, e) }), h.remove() }) }; var et = function (t, e, n) { return e > 0 && !document.hidden && ((t = t.transition(n).duration(e)).attr = nt), t.onTransitionEnd = function (t) { return at(this, t), this }, t }; var nt = function (t, e) { var n; var r; var i = this; var a = J.transition.prototype.attr.apply(this, arguments); if (arguments.length === 0) throw new Error('Unexpected `transition().attr()` arguments.'); arguments.length === 1 ? r = t : arguments.length > 1 && ((n = {})[t] = e, r = n); var o = '__transitionAttrs__'; var s = '__lastTransitions__'; var u = it(); this.each(function () { var t = this; var e = {}; for (var n in r) typeof r[n] === 'function' ? e[n] = r[n].apply(this, arguments) : e[n] = r[n]; this[o] = Object.assign(this[o] || {}, e), this[o][s] || Object.defineProperty(this[o], s, { value: {} }), Object.keys(e).forEach(function (e) { return t[o][s][e] = u }) }); var l = function () { var t = this; this[o] && (Object.keys(r).filter(function (e) { return t[o][s][e] === u }).forEach(function (e) { return delete t[o][e] }), Object.keys(this[o]).length === 0 && delete this[o]) }; return this.on('interrupt.' + u, function () { return i.each(l) }), this.on('end.' + u, function () { return i.each(l) }), a }; var rt = 0; var it = function () { return ++rt }; var at = function (t, e) { if (J.transition.prototype.isPrototypeOf(t) && !t.empty()) { var n = function () { return e.call(null, t) }; return t.on('interrupt.d3_on_transition_end', n), t.on('end.d3_on_transition_end', n), t }e.call(null, t) }; var ot = function (t, e, n, r) { var i = r || function (t) { return t }; var a = function () { i(this) }; return function (r) { var i = r; return e && (i = i.call(lt(Jt(e, n)))), i = (i = et(i, t)).call(lt(n)), t > 0 ? i.on('end.d3_animationInterceptor', function () { return i.each(a) }) : i.each(a), i } }; var st = function (t, e) { var n = t.node(); return t.selectAll(e).filter(function () { return this.parentNode === n }) }; var ut = function (t, e, n, r, i) { void 0 === i && (i = 'linear'); var a = '__pathPoints__'; return function (t) { var o = this; this[a] || (this[a] = n.map(function () { return [] })); var s = n.map(function (e, n) { var s = qt(t, r).map(e); var u = (Y(i) || Y('linear'))(s); var l = o[a][n]; return { pointsFrom: l, pointsTo: u, interpolate: O(l, u, $(i)) } }); return function (t) { if (t === 0) { var n = s.map(function (t) { return t.pointsFrom }); return e.apply(void 0, n) } if (t === 1) { var r = s.map(function (t) { return t.pointsTo }); return o[a] = r, e.apply(void 0, r) } var i = s.map(function (e) { return e.interpolate(t) }); return o[a] = i, e.apply(void 0, i) } } }; var lt = function (t) { return function (e) { return Object.keys(t).forEach(function (n) { return e.attr(n, t[n]) }), e } }; var ct = function (t) { return function (e) { return Object.keys(t).forEach(function (n) { return e.classed(n, t[n]) }), e } }; var ft = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var dt = (function (t) { function e (e) { var n = t.call(this, e) || this; n.config = e, n.config.guide = Jt(n.config.guide || {}, { animationSpeed: 0, enableColorToBarPosition: !1 }), n.config.guide.size = n.config.guide.size || {}; var r = n.config.stack; var i = n.config.guide.enableColorToBarPosition; var a = [e.flip && S.get('flip'), r && S.get('stack'), i && S.get('positioningByColor')]; return n.decorators = (n.config.transformRules || a).concat(e.transformModel || []), n.adjusters = (n.config.adjustRules || []).concat(e.adjustScales || []), n } return ft(e, t), e.prototype.defineGrammarModel = function (t) { var e = this; var n = this.config; this.regScale('x', t('pos', n.x, [0, n.options.width])).regScale('y', t('pos', n.y, [n.options.height, 0])).regScale('y', t('pos', n.y, function (t) { return ['ordinal', 'period'].indexOf(t.type) >= 0 ? [0, n.options.height] : [n.options.height, 0] })).regScale('size', t('size', n.size, {})).regScale('color', t('color', n.color, {})).regScale('split', t('split', n.split, {})).regScale('label', t('label', n.label, {})).regScale('identity', t('identity', n.identity, {})); var r = this.getScale('x'); var i = this.getScale('y'); var a = this.getScale('size'); var o = this.getScale('label'); var s = this.getScale('color'); var u = this.getScale('split'); var l = this.getScale('identity'); var c = i.domain(); var f = i.discrete ? c[0] : Math.max(0, Math.min.apply(Math, c)); var d = i.value(f) + 0.5 * i.stepSize(f); var h = s.domain(); var p = { data: function () { return e.data() }, flip: !1, scaleX: r, scaleY: i, scaleSize: a, scaleLabel: o, scaleColor: s, scaleSplit: u, scaleIdentity: l, color: function (t) { return s.value(t[s.dim]) }, label: function (t) { return o.value(t[o.dim]) }, group: function (t) { return t[s.dim] + '(@taucharts@)' + t[u.dim] }, order: function (t) { var e = t.split('(@taucharts@)')[0]; var n = h.indexOf(e); return n < 0 ? Number.MAX_VALUE : n }, size: function (t) { return a.value(t[a.dim]) }, id: function (t) { return l.value(t[l.dim], t) }, xi: function (t) { return r.value(t[r.dim]) }, yi: function (t) { return i.value(t[i.dim]) }, y0: function () { return d } }; return p.data().forEach(function (t) { return p.id(t) }), p }, e.prototype.getGrammarRules = function () { return this.decorators.filter(function (t) { return t }) }, e.prototype.getAdjustScalesRules = function () { return (this.adjusters || []).filter(function (t) { return t }) }, e.prototype.createScreenModel = function (t) { var e = t.flip; var n = function (t, e, n) { return t ? e : n }; return { flip: e, id: t.id, x: n(e, t.yi, t.xi), y: n(e, t.xi, t.yi), x0: n(e, t.y0, t.xi), y0: n(e, t.xi, t.y0), size: t.size, group: t.group, order: t.order, label: t.label, color: function (e) { return t.scaleColor.toColor(t.color(e)) }, class: function (e) { return t.scaleColor.toClass(t.color(e)) }, model: t, toFibers: function () { var e = Yt(t.data(), t.group); return Object.keys(e).sort(function (e, n) { return t.order(e) - t.order(n) }).reduce(function (t, n) { return t.concat([e[n]]) }, []) } } }, e.prototype.drawFrames = function () { var t = this; var e = this.config.options; var n = function (e) { return (function (t, e) { var n = Math.pow(10, e); return Math.round(n * t) / n }(t.screenModel.size(e) / 2, 4)) }; var r = ot; var i = function (e, n, i) { var a = t.config.guide.animationSpeed; var s = e.selectAll('.' + n).data(function (t) { return [t] }, t.screenModel.id); s.exit().call(r(a, null, { width: 0 }, function (t) { return o.select(t).remove() })), s.call(r(a, null, i)), s.enter().append('rect').style('stroke-width', 0).call(r(a, { width: 0 }, i)) }; var a = this.config.flip; var s = a ? 'y' : 'x'; var u = a ? 'x' : 'y'; var l = a ? 'x0' : 'y0'; var c = a ? 'height' : 'width'; var f = a ? 'width' : 'height'; var d = function (e) { var r, a, o; i(e, 'lvl-top', ((r = {})[c] = function (t) { return n(t) }, r[f] = 1, r[s] = function (e) { return t.screenModel[s](e) - n(e) / 2 }, r[u] = function (e) { return t.screenModel[u](e) }, r.fill = function (e) { return t.screenModel.color(e) }, r.class = function (e) { return 'lvl-top ' + t.screenModel.class(e) }, r)), i(e, 'lvl-btm', ((a = {})[c] = function (t) { return n(t) }, a[f] = 1, a[s] = function (e) { return t.screenModel[s](e) - n(e) / 2 }, a[u] = function (e) { return t.screenModel[l](e) }, a.fill = function (e) { return t.screenModel.color(e) }, a.class = function (e) { return 'lvl-btm ' + t.screenModel.class(e) }, a)), i(e, 'lvl-link', ((o = {})[c] = 0.5, o[f] = function (e) { return Math.abs(t.screenModel[u](e) - t.screenModel[l](e)) }, o[s] = function (e) { return t.screenModel[s](e) - 0.25 }, o[u] = function (e) { return Math.min(t.screenModel[u](e), t.screenModel[l](e)) }, o.fill = function (e) { return t.screenModel.color(e) }, o.class = function (e) { return 'lvl-link ' + t.screenModel.class(e) }, o)) }; var h = function (e) { e.attr('class', 'frame-id-' + t.config.uid).call(function (e) { var n = e.selectAll('.generic').data(function (t) { return t }, t.screenModel.id); n.exit().remove(), n.call(d), n.enter().append('g').attr('class', 'generic').call(d) }) }; var p = Yt(this.data(), t.screenModel.group); var g = Object.keys(p).sort(function (e, n) { return t.screenModel.order(e) - t.screenModel.order(n) }).reduce(function (t, e) { return t.concat([p[e]]) }, []); var m = e.container.selectAll('.frame-id-' + t.config.uid).data(g); m.exit().remove(), m.call(h), m.enter().append('g').call(h) }, e }(g)); var ht = function () { return (ht = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var pt = ht({}, s, u); function gt (t, e, n, r) { var i = r(n(t), t); return (i[e] || []).forEach(function (t) { return gt(t, e, n, r) }), i } function mt (t, e, n, r) { void 0 === r && (r = 0), e(t, r) && (t.units || []).map(function (t) { return mt(t, e, n, r + 1) }), n(t, r) } var yt = (function () { var t = []; function e (t) { for (var e in t) this[e] = t[e] } function n () { this.copiedObjects = []; var t = this; this.recursiveDeepCopy = function (e) { return t.deepCopy(e) }, this.depth = 0 } function r (t, e) { var r = new n(); return e && (r.maxDepth = e), r.deepCopy(t) } return e.prototype = { constructor: e, canCopy: function (t) { return !1 }, create: function (t) {}, populate: function (t, e, n) {} }, n.prototype = { constructor: n, maxDepth: 256, cacheResult: function (t, e) { this.copiedObjects.push([t, e]) }, getCachedResult: function (t) { for (var e = this.copiedObjects, n = e.length, r = 0; r < n; r++) if (e[r][0] === t) return e[r][1] }, deepCopy: function (e) { if (e === null) return null; if (typeof e !== 'object') return e; var n = this.getCachedResult(e); if (n) return n; for (var r = 0; r < t.length; r++) { var i = t[r]; if (i.canCopy(e)) return this.applyDeepCopier(i, e) } throw new Error('no DeepCopier is able to copy ' + e) }, applyDeepCopier: function (t, e) { var n = t.create(e); if (this.cacheResult(e, n), this.depth++, this.depth > this.maxDepth) throw new Error('Exceeded max recursion depth in deep copy.'); return t.populate(this.recursiveDeepCopy, e, n), this.depth--, n } }, r.DeepCopier = e, r.deepCopiers = t, r.register = function (n) { n instanceof e || (n = new e(n)), t.unshift(n) }, r.register({ canCopy: function () { return !0 }, create: function (t) { return t instanceof t.constructor ? (function (t) { return typeof t === 'object' ? JSON.parse(JSON.stringify(t)) : t }(t.constructor.prototype)) : {} }, populate: function (t, e, n) { for (var r in e)e.hasOwnProperty(r) && (n[r] = t(e[r])); return n } }), r.register({ canCopy: function (t) { return t instanceof Array }, create: function (t) { return new t.constructor() }, populate: function (t, e, n) { for (var r = 0; r < e.length; r++)n.push(t(e[r])); return n } }), r.register({ canCopy: function (t) { return t instanceof Date }, create: function (t) { return new Date(t) } }), r }()); var vt = function (t) { return /^(#|rgb\(|rgba\()/.test(t) }; var bt = /(.)^/; var xt = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#x27;', '`': '&#x60;' }; var _t = { "'": "'", '\\': '\\', '\r': 'r', '\n': 'n', '\u2028': 'u2028', '\u2029': 'u2029' }; var wt = /\\|'|\r|\n|\u2028|\u2029/g; var Et = '(?:' + Object.keys(xt).join('|') + ')'; var St = RegExp(Et); var Mt = RegExp(Et, 'g'); var Tt = { evaluate: /<%([\s\S]+?)%>/g, interpolate: /<%=([\s\S]+?)%>/g, escape: /<%-([\s\S]+?)%>/g }; function Ct (t) { return yt(t) } function kt (t) { return t instanceof Date && !isNaN(Number(t)) } function At (t) { return t != null && typeof t === 'object' } function Ot (t) { var e = parseFloat(Math.min.apply(Math, t).toFixed(15)); var n = parseFloat(Math.max.apply(Math, t).toFixed(15)); e === n && (n -= (n >= 0 ? -1 : 1) * (n || 1) / 10); for (var r = [e = Math.min(0, e), n = Math.max(0, n)], i = r[1] - r[0], a = Math.pow(10, Math.floor(Math.log(i / 10) / Math.LN10)), o = 10 / i * a, s = [[0.15, 10], [0.35, 5], [0.75, 2], [1, 1], [2, 1]], u = -1; o > s[++u][0];);a *= s[u][1], r[0] = Math.floor(r[0] / a) * a, r[1] = Math.ceil(r[1] / a) * a; var l = e - r[0]; var c = r[1] - n; var f = a / 2; if (e < 0) { var d = l >= f ? -l : 0; r[0] = r[0] - d } if (n > 0) { var h = c >= f ? -c : 0; r[1] = r[1] + h } return [parseFloat(r[0].toFixed(15)), parseFloat(r[1].toFixed(15))] } function Pt (t, e, n) { var r = (void 0 === n ? { utc: !1 } : n).utc; var i = pt.extent(t); var a = i[0]; var o = i[1]; var s = +o - +a; var u = r ? pt.scaleUtc : pt.scaleTime; if (s === 0) { return a = new Date(a.getTime() - 864e5), o = new Date(o.getTime() + 864e5), u().domain([a, o]).nice(e).domain() } var l = u().domain([a, o]).nice(e); if (e) return l.domain(); var c = u().domain([a, o]).nice(e).domain(); var f = c[0]; var d = c[1]; var h = l.ticks(); var p = h.length - 1; return (+a - +f) / (+h[1] - +f) < 0.5 && (a = f), (+d - +o) / (+d - +h[p - 1]) < 0.5 && (o = d), [a, o] } var Nt = 0; var Lt = {}; function Rt (t) { var e = btoa(encodeURIComponent(t)).replace(/=/g, '_'); return Lt.hasOwnProperty(e) || (Lt[e] = 'H' + ++Nt), Lt[e] } function Ft (t, e, n) { var r = 0; var i = null; var a = Zt(function (t, e) { return qt(t.map(function (t) { return e.reduce(function (e, n) { return e.concat(function (t) { return kt(t) ? t.getTime() : t }(t[n])) }, []) }), function (t) { return JSON.stringify(t) }).reduce(function (t, e) { var n = e[0]; return t[n] = t[n] || 0, t[n] += 1, t }, {}) }, function (t, e) { var n = i === t ? r : ++r; return i = t, e.join('') + '-' + n }); return function (r, i, o) { var s = o.length; var u = n.getSpec(); var l = u.sources['/'].data; var c = u.unit.units[0].guide || {}; c.padding = c.padding || { l: 0, r: 0, t: 0, b: 0 }; var f = 0; t === 'x' ? f = c.padding.l + c.padding.r : t === 'y' && (f = c.padding.t + c.padding.b); var d = (i - s * f) / (function (t) { var e = a(l, t); return Object.keys(e).reduce(function (t, n) { return t + e[n] }, 0) }(e)); return ((function (t, e) { return a(l, t)[e] }(e, r)) * d + f) / i } } function Dt (t) { var e = !0; try { mt(t, function (t) { if (t.type.indexOf('COORDS.') === 0 && t.type !== 'COORDS.RECT') throw new Error('Not applicable') }, function (t) { return t }) } catch (t) { t.message === 'Not applicable' && (e = !1) } return e } function It (t, e, n, r) { if (void 0 === r && (r = 0), r === 'requestAnimationFrame') { var i = !1; return function () { for (var r = [], a = 0; a < arguments.length; a++)r[a] = arguments[a]; i || (requestAnimationFrame(function () { i = !1 }), n.apply(this, r), i = !0), t.e = e, t.ts = Date.now() } } return function () { for (var i = [], a = 0; a < arguments.length; a++)i[a] = arguments[a]; var o = { e: e, ts: Date.now() }; (t.e && t.e === o.e ? o.ts - t.ts : r) >= r && n.apply(this, i), t.e = o.e, t.ts = o.ts } } function jt (t, e) { var n = t[0]; var r = t[1]; var i = (r - n) / (e - 1); var a = e >= 2 ? Wt(e - 2).map(function (t) { return n + i * (t + 1) }) : []; return [n].concat(a, [r]) } function zt (t) { return vt(t) ? t : '' } function Bt (t) { return vt(t) ? '' : t } function Vt (t) { return t / 180 * Math.PI } function Ht (t) { return Math.abs(t) >= 360 && (t %= 360), t < 0 && (t = 360 + t), t } function Wt (t, e) { arguments.length === 1 && (e = t, t = 0); for (var n = [], r = t; r < e; r++)n.push(r); return n } function Gt (t, e, n, r) { return t + e * (n === 90 ? -1 : 1) - r > 100 } function Ut (t, e, n, r) { return t + e * (n === -90 ? -1 : 1) - r > 20 } function Xt (t) { return Array.isArray(t) ? [].concat.apply([], t.map(function (t) { return Xt(t) })) : t } function qt (t, e) { for (var n = {}, r = [], i = t.length, a = e || function (t) { return String(t) }, o = 0; o < i; ++o) { var s = t[o]; var u = a(s); n.hasOwnProperty(u) || (n[u] = !0, r.push(s)) } return r } function Yt (t, e) { return t.reduce(function (t, n) { var r = e(n); return t[r] = t[r] || [], t[r].push(n), t }, {}) } function $t (t, e) { return qt(t.concat(e)) } function Kt (t, e) { return t.filter(function (t) { return e.indexOf(t) !== -1 }) } function Jt (t) { for (var e = [], n = 1; n < arguments.length; n++)e[n - 1] = arguments[n]; var r = e.length; if (r === 0 || !t) return t; for (var i = 0; i < r; i++) for (var a = e[i], o = At(a) ? Object.keys(a) : [], s = o.length, u = 0; u < s; u++) { var l = o[u]; void 0 === t[l] && (t[l] = a[l]) } return t } function Qt (t) { for (var e = [], n = 1; n < arguments.length; n++)e[n - 1] = arguments[n]; var r = Object.assign({}, t); return e.forEach(function (t) { delete r[t] }), r } function Zt (t, e) { var n = function (r) { var i = n.cache; var a = String(e ? e.apply(this, arguments) : r); return i.hasOwnProperty(a) || (i[a] = t.apply(this, arguments)), i[a] }; return n.cache = {}, n } function te () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; return function (e, n) { var r = 0; return t.every(function (t) { return (r = t(e, n)) === 0 }), r } } function ee (t) { for (var e = [], n = 1; n < arguments.length; n++)e[n - 1] = arguments[n]; return t == null ? {} : e.reduce(function (e, n) { var r = t[n]; return r && (e[n] = r), e }, {}) } function ne (t) { return t = t == null ? '' : String(t), St.test(t) ? t.replace(Mt, function (t) { return xt[t] }) : t } function re (t, e, n) { !e && n && (e = n), e = Jt({}, e, Tt); var r = RegExp([(e.escape || bt).source, (e.interpolate || bt).source, (e.evaluate || bt).source].join('|') + '|$', 'g'); var i = 0; var a = "__p+='"; t.replace(r, function (e, n, r, o, s) { return a += t.slice(i, s).replace(wt, function (t) { return '\\' + _t[t] }), i = s + e.length, n ? a += "'+\n((__t=(" + n + "))==null?'':utils.escape(__t))+\n'" : r ? a += "'+\n((__t=(" + r + "))==null?'':__t)+\n'" : o && (a += "';\n" + o + "\n__p+='"), e }), a += "';\n", e.variable || (a = 'with(obj||{}){\n' + a + '}\n'), a = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + a + 'return __p;\n'; try { var o = new Function(e.variable || 'obj', a) } catch (t) { throw t.source = a, t } var s = function (t) { return o.call(this, t) }; var u = e.variable || 'obj'; return s.source = 'function(' + u + '){\n' + a + '}', s } function ie (t) { return String(t).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;') } var ae = '  '; var oe = 32; var se = ['img', 'input', 'br', 'embed', 'link', 'meta', 'area', 'base', 'basefont', 'bgsound', 'col', 'command', 'frame', 'hr', 'image', 'isindex', 'keygen', 'menuitem', 'nextid', 'param', 'source', 'track', 'wbr', 'circle', 'ellipse', 'line', 'path', 'polygon', 'rect'].reduce(function (t, e) { return t[e] = !0, t }, {}); function ue (t) { var e = 2; var n = arguments[1]; (typeof arguments[1] !== 'object' || Array.isArray(arguments[1])) && (e = 1, n = {}); var r = Xt(Array.prototype.slice.call(arguments, e)); var i = r.length === 1 && r[0].trim()[0] !== '<'; var a = se[t]; if (a && r.length > 0) throw new Error('Tag "' + t + '" is void but content is assigned to it'); var o = '<' + t; var s = Object.keys(n).map(function (t) { return ' ' + t + '="' + n[t] + '"' }).join(''); s.length > oe && (s = Object.keys(n).map(function (t) { return '\n' + ae + t + '="' + n[t] + '"' }).join('')); var u = i ? r[0] : '\n' + r.map(function (t) { return String(t).split('\n').map(function (t) { return '' + ae + t }).join('\n') }).join('\n') + '\n'; return '' + o + s + (a ? '/>' : '>' + u + '</' + t + '>') } function le (t) { var e = t; var n = { then: function (t) { return e = t(e), n }, result: function () { return e } }; return n } var ce = [dt]; function fe (t) { return ce.some(function (e) { return t instanceof e }) } function de (t) { return (t.units || []).some(function (t) { return t.hasOwnProperty('units') }) } var he = document.createElement('div'); var pe = new WeakMap(); function ge (t, e) { var n; return t instanceof Node ? n = t : (he.insertAdjacentHTML('afterbegin', t), n = he.childNodes[0]), e.appendChild(n), n } function me (t) { if (pe.has(t)) return pe.get(t); var e = t.style.overflow; t.style.overflow = 'scroll'; var n = { width: t.offsetWidth - t.clientWidth, height: t.offsetHeight - t.clientHeight }; return t.style.overflow = e, pe.set(t, n), n } function ye (t, e) { var n = (e = e || 'both') === 'horizontal' || e === 'both'; var r = e === 'vertical' || e === 'both'; var i = me(t); var a = r ? i.width + 'px' : '0'; var o = n ? i.height + 'px' : '0'; t.style.overflow = 'hidden', t.style.padding = '0 ' + a + ' ' + o + ' 0'; var s = t.scrollWidth > t.clientWidth; var u = t.scrollHeight > t.clientHeight; var l = r && !u ? i.width + 'px' : '0'; var c = n && !s ? i.height + 'px' : '0'; return t.style.padding = '0 ' + l + ' ' + c + ' 0', t.style.overflow = '', t.style.overflowX = s ? 'scroll' : 'hidden', t.style.overflowY = u ? 'scroll' : 'hidden', i } function ve (t, e) { return window.getComputedStyle(t).getPropertyValue(e) } function be (t, e) { return parseInt(ve(t, e) || '0', 10) } function xe (t) { var e = be(t, 'padding-left'); var n = be(t, 'padding-right'); var r = be(t, 'padding-bottom'); var i = be(t, 'padding-top'); var a = be(t, 'border-top-width') + be(t, 'border-left-width') + be(t, 'border-right-width') + be(t, 'border-bottom-width'); var o = t.getBoundingClientRect(); return { width: o.width - e - n - 2 * a, height: o.height - r - i - 2 * a } } function _e (t) { var e = document.createElement('div'); e.style.position = 'absolute', e.style.visibility = 'hidden', e.style.width = '100px', e.style.height = '100px', e.style.border = '1px solid green', e.style.top = '0', document.body.appendChild(e), e.innerHTML = '<svg class="tau-chart__svg">\n                <g class="tau-chart__cell cell">\n                <g class="x axis">\n                <g class="tick"><text>' + t + '</text></g>\n                </g>\n                </g>\n                </svg>'; var n = { width: 0, height: 0 }; var r = e.querySelector('.x.axis .tick text').getBoundingClientRect(); n.width = r.right - r.left, n.height = r.bottom - r.top; var i = t.length !== 0 ? n.width / t.length : 0; return n.width = n.width + 1.5 * i, document.body.removeChild(e), n } function we (t, e) { var n = e.fontSize; var r = e.fontFamily; var i = e.fontWeight; var a = typeof n === 'string' ? n : n + 'px'; var o = t.map(function (t) { for (var e = 0, n = 0; e <= t.length - 1; e++) { n += Ee(t.charAt(e), { fontSize: a, fontFamily: r, fontWeight: i }).width } return n }).sort(function (t, e) { return e - t })[0]; var s = t.length; var u = parseInt(a); return { width: o, height: u * s + 0.39 * u * s } } var Ee = Zt(function (t, e) { var n = e.fontSize; var r = e.fontFamily; var i = e.fontWeight; var a = document.createElement('div'); a.style.position = 'absolute', a.style.visibility = 'hidden', a.style.border = '0px', a.style.top = '0', a.style.fontSize = n, a.style.fontFamily = r, a.style.fontWeight = i, document.body.appendChild(a), a.innerHTML = t === ' ' ? '&nbsp;' : t; var o = { width: 0, height: 0 }; var s = a.getBoundingClientRect(); return o.width = s.right - s.left, o.height = s.bottom - s.top, document.body.removeChild(a), o }, function (t, e) { return t + '_' + JSON.stringify(e) }); function Se (t, e) { var n = { '.': function (t, e) { return e.classed(t, !0) }, '#': function (t, e) { return e.attr('id', t) } }; var r = Object.keys(n).join(''); if (e.indexOf(' ') >= 0) throw new Error('Selector should not contain whitespaces.'); if (r.indexOf(e[0]) >= 0) throw new Error('Selector must have tag at the beginning.'); var i; var a = t instanceof Element; var s = a ? o.select(t) : t; var u = function (t) { return a ? t.node() : t }; var l = s.selectAll(e).filter(function () { return this.parentNode === s.node() }).filter(function (t, e) { return e === 0 }); if (!l.empty()) return u(l); for (var c, f = -1, d = null, h = 1, p = e.length; h <= p; h++)(h == p || r.indexOf(e[h]) >= 0) && (c = e.substring(f + 1, h), f < 0 ? i = s.append(c) : n[d].call(null, c, i), d = e[h], f = h); return u(i) } function Me (t, e) { return Te(t, e)[0] || null } function Te (t, e) { for (var n = [], r = Element.prototype.matches || Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector, i = t.firstElementChild; i; i = i.nextElementSibling)r.call(i, e) && n.push(i); return n } function Ce (t, e) { if (t.childElementCount > 0) { var n; var r; var i = Array.prototype.filter.call(t.childNodes, function (t) { return t.nodeType === Node.ELEMENT_NODE }); var a = i.slice().sort(e); var o = i.reduce(function (t, e, n) { return t.set(e, n), t }, new Map()); var s = a.reduce(function (t, e, i) { var s = o.get(e); var u = i - s; return u !== r && (n && t.push(n), r = u, n = { from: s, to: i, elements: [] }), n.elements.push(e), i === a.length - 1 && t.push(n), t }, []); var u = s.slice().sort(function (t, e) { return t.from - e.from }); var l = u.reduce(function (t, e, n) { return t.set(e, n), t }, new Map()); var c = function (t) { for (var e, n, r, i = s.map(function (t, e) { return { elements: t.elements, from: l.get(t), to: e } }).sort(te(function (t, e) { return t.elements.length - e.elements.length }, t ? function (t, e) { return e.to - t.to } : function (t, e) { return t.to - e.to })), a = 0; a < i.length; a++) { if ((n = i[a]).from > n.to) for (e = a + 1; e < i.length; e++)(r = i[e]).from >= n.to && r.from < n.from && r.from++; if (n.from < n.to) for (e = a + 1; e < i.length; e++)(r = i[e]).from > n.from && r.from <= n.to && r.from-- } return i.filter(function (t) { return t.from !== t.to }) }; var f = c(!0); var d = c(!1); var h = f.length < d.length ? f : d; var p = u.map(function (t) { return t.elements }); h.forEach(function (e) { var n; var r = p.splice(e.from, 1)[0]; var i = p[e.to]; var a = i ? i[0] : null; e.elements.length === 1 ? n = r[0] : (n = document.createDocumentFragment(), r.forEach(function (t) { n.appendChild(t) })), t.insertBefore(n, a), p.splice(e.to, 0, r) }) } } function ke () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; var n = []; return t.filter(function (t) { return Boolean(t) }).forEach(function (t) { typeof t === 'string' ? n.push(t) : typeof t === 'object' && n.push.apply(n, Object.keys(t).filter(function (e) { return Boolean(t[e]) })) }), qt(n).join(' ').trim().replace(/\s{2,}/g, ' ') } function Ae (t, e) { for (var n, r = [], i = 2; i < arguments.length; i++)r[i - 2] = arguments[i]; var a = document.createEvent('MouseEvents'); var o = [!0, !0, window, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null]; var s = r.concat(o.slice(r.length)); (n = a).initMouseEvent.apply(n, [e].concat(s)), t.dispatchEvent(a) } function Oe (t, e) { return 'translate(' + t + ',' + e + ')' } function Pe (t) { return 'rotate(' + t + ')' } function Ne (t) { return ['bottom', 'top'].indexOf(t.toLowerCase()) >= 0 ? 'h' : 'v' } function Le (t) { var e = { x: 0, y: 0 }; var n = t.indexOf('translate('); if (n >= 0) { var r = t.indexOf(')', n + 10); var i = t.substring(n + 10, r).trim().replace(',', ' ').replace(/\s+/, ' ').split(' '); e.x = parseFloat(i[0]), i.length > 1 && (e.y = parseFloat(i[1])) } return e } function Re (t, e, n, r, i, a, o, s) { var u, l, c, f, d, h; return h = ((c = o - i) * (e - a) - (f = s - a) * (t - i)) / (-c * (l = r - e) + (u = n - t) * f), (d = (-l * (t - i) + u * (e - a)) / (-c * l + u * f)) >= 0 && d <= 1 && h >= 0 && h <= 1 } function Fe (t) { for (var e, n, r = { x: 0, y: 0 }, i = t; i && i.nodeName.toUpperCase() !== 'SVG';)(n = i.getAttribute('transform')) && (e = Le(n), r.x += e.x, r.y += e.y), i = i.parentNode; return r } function De (t, e, n) { var r = t.selectAll(e).filter(n); if (!r.empty()) { var i = o.select(r.node().parentNode).selectAll(e).filter(function (t) { return !n(t) }).nodes(); var a = i[i.length - 1]; if (a) { var s = Array.prototype.indexOf.call(a.parentNode.childNodes, a); var u = a.nextSibling; r.each(function () { Array.prototype.indexOf.call(this.parentNode.childNodes, this) > s || this.parentNode.insertBefore(this, u) }) } } } var Ie = function (t) { return kt(t) ? t.getTime() : t }; var je = { cross: function (t, e, n) { var r = t(); var i = qt(r.map(function (t) { return t[e] }), Ie); var a = qt(r.map(function (t) { return t[n] }), Ie); var o = i.length === 0 ? [null] : i; return (a.length === 0 ? [null] : a).reduce(function (t, r) { return t.concat(o.map(function (t) { var i = {}; return e && (i[e] = Ie(t)), n && (i[n] = Ie(r)), i })) }, []) }, cross_period: function (t, e, n, r, i, a) { var o = t(); var s = !!a && a.utcTime; var u = qt(o.map(function (t) { return t[e] }), Ie); var l = qt(o.map(function (t) { return t[n] }), Ie); var c = u.length === 0 ? [null] : u; var f = l.length === 0 ? [null] : l; return r && (c = b.generate(Math.min.apply(Math, u), Math.max.apply(Math, u), r, { utc: s })), i && (f = b.generate(Math.min.apply(Math, l), Math.max.apply(Math, l), i, { utc: s })), f.reduce(function (t, r) { return t.concat(c.map(function (t) { var i = {}; return e && (i[e] = Ie(t)), n && (i[n] = Ie(r)), i })) }, []) }, groupBy: function (t, e) { return qt(t().map(function (t) { return t[e] }), Ie).map(function (t) { var n; return (n = {})[e] = Ie(t), n }) }, none: function () { return [null] } }; var ze = (function () { function t (t, e, n) { var r = t.key; var i = t.pipe; var a = t.source; var o = t.units; void 0 === n && (n = {}), this.key = r, this.pipe = i || [], this.source = a, this.units = o, this._frame = { key: r, source: a, pipe: this.pipe }, this._data = e, this._pipeReducer = function (t, e) { return n[e.type](t, e.args) } } return t.prototype.hash = function () { return Rt([this._frame.pipe, this._frame.key, this._frame.source].map(function (t) { return JSON.stringify(t) }).join('')) }, t.prototype.full = function () { return this._data }, t.prototype.part = function (t) { return void 0 === t && (t = function (t) { return t }), this._frame.pipe.map(t).reduce(this._pipeReducer, this._data) }, t }()); var Be = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Ve = function (t) { return kt(t) ? t.getTime() : t }; var He = function (t) { var e = this; Object.keys(t).forEach(function (n) { return e[n] = t[n] }) }; var We = function (t, e, n) { return t.map(function (t) { return typeof t === 'string' ? n.get(t) : t }).filter(function (t) { return t }).reduce(function (t, e) { return (function (t, e) { return void 0 === e && (e = {}), Object.assign(new He(t), e) }(t, e(t, {}))) }, e) }; var Ge = (function (t) { function e (e, n, r, i) { var a = t.call(this) || this; return Jt(e.scales, { size_null: { type: 'size', source: '?' }, split_null: { type: 'value', source: '?' }, label_null: { type: 'value', source: '?' }, color_null: { type: 'color', source: '?' }, identity_null: { type: 'identity', source: '?' }, 'size:default': { type: 'size', source: '?' }, 'color:default': { type: 'color', source: '?' }, 'split:default': { type: 'value', source: '?' }, 'label:default': { type: 'value', source: '?' }, 'identity:default': { type: 'identity', source: '?' } }), e.settings = e.settings || {}, a.config = e, a.sources = e.sources, a.scales = e.scales, a.unitSet = r, a.grammarRules = i, a.scalesHub = n, a.transformations = Object.assign(e.transformations || {}, { where: function (t, e) { var n = Object.keys(e || {}).map(function (t) { return function (n) { return Ve(n[t]) === e[t] } }); return t.filter(function (t) { return n.every(function (e) { return e(t) }) }) } }), a } return Be(e, t), e.traverseSpec = function (t, e, n, r, i) { void 0 === r && (r = null), void 0 === i && (i = null); var a = []; var o = function (t, e, n, r, i) { a.push(function () { e(t, r, i) }), t.frames && t.frames.forEach(function (r) { (r.units || []).map(function (i) { return o(i, e, n, t, r) }) }), a.push(function () { return n(t, r, i) }) }; return o(t.unit, e, n, r, i), a }, e.prototype.unfoldStructure = function () { return this.root = this._expandUnitsStructure(this.config.unit), this.config }, e.prototype.getDrawScenarioQueue = function (t) { var e = this; var n = this.grammarRules; var r = this._flattenDrawScenario(t, function (t, r, i) { var a = !1 === r.expression.inherit ? null : i; var o = e._createFrameScalesFactoryMethod(a); var s = e.unitSet.create(r.type, Object.assign({}, r, { options: t.allocateRect(i.key) })); var u = new He(s.defineGrammarModel(o)); var l = We(s.getGrammarRules(), u, n); return We(s.getAdjustScalesRules(), l, n), s.node().screenModel = s.createScreenModel(l), s }); var i = this._flattenDrawScenario(t, function (t, r, i) { var a = !1 === r.expression.inherit ? null : i; var o = e._createFrameScalesFactoryMethod(a); var s = e.unitSet.create(r.type, Object.assign({}, r, { options: t.allocateRect(i.key) })); var u = new He(s.defineGrammarModel(o)); var l = We(s.getGrammarRules(), u, n); return s.node().screenModel = s.createScreenModel(l), s.parentUnit = t, s.addInteraction(), s }); return r.concat(function () { Object.keys(e.scales).forEach(function (t) { return e.scalesHub.createScaleInfo(e.scales[t]).commit() }) }).concat(i) }, e.prototype._flattenDrawScenario = function (t, n) { var r = {}; var i = []; var a = [t]; var o = e.traverseSpec({ unit: this.root }, function (t, e, o) { t.uid = (function () { var n = Rt((e ? e.uid + '/' : '') + JSON.stringify(Object.keys(t).filter(function (e) { return typeof t[e] === 'string' }).reduce(function (e, n) { return e[n] = t[n], e }, {})) + '-' + JSON.stringify(o.pipe)); return r.hasOwnProperty(n) ? n += '-' + ++r[n] : r[n] = 0, n }()), t.guide = Ct(t.guide); var s = n(a[0], t, o); i.push(s), t.type.indexOf('COORDS.') === 0 && (function (t) { a.unshift(t) }(s)) }, function (t) { t.type.indexOf('COORDS.') === 0 && a.shift() }, null, this._datify({ source: this.root.expression.source, pipe: [] })); return o.push(function () { return i }), o }, e.prototype._expandUnitsStructure = function (t, e) { var n = this; void 0 === e && (e = []); var r = this; if (!1 === t.expression.operator)t.frames = t.frames.map(function (t) { return r._datify(t) }); else { var i = this._parseExpression(t.expression, e, t.guide); t.transformation = t.transformation || [], t.frames = i.exec().map(function (n) { var a = (i.inherit ? e : []).concat([{ type: 'where', args: n }]).concat(t.transformation); return r._datify({ key: n, pipe: a, source: i.source, units: t.units ? t.units.map(function (t) { var e = Ct(t); return e.guide = t.guide, e }) : [] }) }) } return t.frames.forEach(function (t) { return t.units.forEach(function (e) { return n._expandUnitsStructure(e, t.pipe) }) }), t }, e.prototype._createFrameScalesFactoryMethod = function (t) { var e = this; return function (n, r, i) { var a = r || n + ':default'; return e.scalesHub.createScaleInfo(e.scales[a], t).create(typeof i === 'function' ? i(e.scales[a]) : i) } }, e.prototype._datify = function (t) { return new ze(t, this.sources[t.source].data, this.transformations) }, e.prototype._parseExpression = function (t, e, n) { var r = this; var i = t.operator || 'none'; var a = t.source; var o = !1 !== t.inherit; var s = t.params; var u = { source: a, pipe: o ? e : [] }; var l = je[i]; if (!l) throw new Error(i + ' operator is not supported'); return { source: a, inherit: o, func: l, args: s, exec: function () { return l.apply(void 0, [function () { return r._datify(u).part() }].concat(s || [], [n])) } } }, e }(d)); var Ue = 'tau-chart__'; var Xe = n(10); var qe = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); Xe.Tooltip.defaults.baseClass = Ue + 'tooltip'; var Ye = ['top', 'bottom']; var $e = (function (t) { function e () { return t !== null && t.apply(this, arguments) || this } return qe(e, t), e.prototype._pickPlace = function (t) { if (!this.options.auto) return this.options.place; var e = (function (t, e) { return { top: e.top + t, right: e.right - t, bottom: e.bottom - t, left: e.left + t, width: e.width - 2 * t, height: e.height - 2 * t } }(0 | this.options.winBound, (function () { var t = window; var e = document.documentElement; var n = (t.pageYOffset || e.scrollTop) - e.clientTop; var r = (t.pageXOffset || e.scrollLeft) - e.clientTop; var i = t.innerWidth || e.clientWidth; var a = t.innerHeight || e.clientHeight; return { top: n, right: r + i, bottom: n + a, left: r, width: i, height: a } }()))); var n = this.options.place.split('-'); var r = this.spacing; if (Ye.indexOf(n[0]) !== -1) switch (t.top - this.height - r <= e.top ? n[0] = 'bottom' : t.bottom + this.height + r >= e.bottom && (n[0] = 'top'), n[1]) { case 'left':t.right - this.width <= e.left && (n[1] = 'right'); break; case 'right':t.left + this.width >= e.right && (n[1] = 'left'); break; default:t.left + t.width / 2 + this.width / 2 >= e.right ? n[1] = 'left' : t.right - t.width / 2 - this.width / 2 <= e.left && (n[1] = 'right') } else switch (t.left - this.width - r <= e.left ? n[0] = 'right' : t.right + this.width + r >= e.right && (n[0] = 'left'), n[1]) { case 'top':t.bottom - this.height <= e.top && (n[1] = 'bottom'); break; case 'bottom':t.top + this.height >= e.bottom && (n[1] = 'top'); break; default:t.top + t.height / 2 + this.height / 2 >= e.bottom ? n[1] = 'top' : t.bottom - t.height / 2 - this.height / 2 <= e.top && (n[1] = 'bottom') } return n.join('-') }, e }(Xe.Tooltip)); var Ke = (function () { function t (t, e) { this.chart = e, this.handlers = new Map(), this.plugins = t.map(this.initPlugin, this) } return t.prototype.initPlugin = function (t) { var e = this; t.init && t.init(this.chart); var n = []; this.handlers.set(t, n); var r = function (r, i) { n.push(e.chart.on(r, i, t)) }; return t.destroy && r('destroy', t.destroy.bind(t)), Object.keys(t).forEach(function (e) { if (e.indexOf('on') === 0) { var n = e.substr(2).toLowerCase(); r(n, t[e].bind(t)) } }), t }, t.prototype.destroyPlugin = function (t) { var e = this; t.destroy && t.destroy(), this.handlers.get(t).forEach(function (n) { e.chart.removeHandler(n, t) }) }, t.prototype.destroy = function () { var t = this; this.plugins.forEach(function (e) { return t.destroyPlugin(e) }) }, t }()); var Je = {}; var Qe = {}; var Ze = { reg: function (t, e, n) { return n ? (Qe[t] = n, Je[t] = function (t, e) { this.___tauchartsseed___ = new e(this.init(t)) }, Je[t].prototype = Object.assign({ init: function (t) { return t }, defineGrammarModel: function (t) { return this.node().defineGrammarModel(t) }, getGrammarRules: function (t) { return this.node().getGrammarRules(t) }, getAdjustScalesRules: function (t) { return this.node().getAdjustScalesRules(t) }, createScreenModel: function (t) { return this.node().createScreenModel(t) }, addInteraction: function () { this.node().addInteraction() }, node: function () { return this.___tauchartsseed___ }, draw: function () { this.node().draw() } }, e)) : Je[t] = e, this }, get: function (t) { if (!Je.hasOwnProperty(t)) throw new _('Unknown unit type: ' + t, w.UNKNOWN_UNIT_TYPE); return Je[t] }, create: function (t, e) { var n; var r = this.get(t); Qe[t] ? n = new r(e, this.get(Qe[t])) : n = new r(e); return n } }; var tn = {}; var en = {}; var nn = { reg: function (t, e, n) { return void 0 === n && (n = function (t) { return t }), tn[t] = e, en[t] = n, nn }, get: function (t) { return tn[t] }, instance: function (t) { return void 0 === t && (t = {}), { create: function (e, n, r) { return new (nn.get(e))(n, (0, en[e])(r, t)) } } } }; var rn = (function () { function t (t, e, n) { this.registry = t, this.sources = e, this.scales = n } return t.prototype.createScaleInfo = function (t, e) { void 0 === e && (e = null); var n = t.dim; var r = t.source; var i = (this.sources[r].dims[n] || {}).type; var a = this.sources[r].data; var o = e || new ze({ source: r }, a); return t.dimType = i, this.registry.create(t.type, o, t) }, t.prototype.createScaleInfoByName = function (t, e) { return void 0 === e && (e = null), this.createScaleInfo(this.scales[t], e) }, t }()); var an = function (t, e, n) { var r = !0; var i = null; try { t.reduce(function (t, r) { var a = function (t, e) { var n = r[e]; var i = At(n) ? JSON.stringify(n) : n; return t.push(i), t }; var o = e.reduce(a, []).join('/'); var s = n.reduce(a, []).join('/'); if (t.hasOwnProperty(o)) { var u = t[o]; if (u !== s) throw i = { type: 'RelationIsNotAFunction', keyX: e.join('/'), keyY: n.join('/'), valX: o, errY: [u, s] }, new Error('RelationIsNotAFunction') } else t[o] = s; return t }, {}) } catch (t) { if (t.message !== 'RelationIsNotAFunction') throw t; r = !1 } return { result: r, error: i } }; var on = function (t, e) { var n = Object.keys(t).reduce(function (e, n) { var r = t[n]; return r.hasOwnProperty('hasNull') && !r.hasNull || r.type !== 'measure' && r.scale !== 'period' || e.push(n), e }, []); return function (t) { var r = !n.some(function (e) { return !t.hasOwnProperty(e) || t[e] === null }); return r || e(t), r } }; var sn = function (t) { var e = { category: 'ordinal', order: 'ordinal', measure: 'linear' }; var n = {}; return Object.keys(t).forEach(function (r) { var i = t[r]; var a = (i.type || 'category').toLowerCase(); n[r] = Object.assign({}, i, { type: a, scale: i.scale || e[a], value: i.value }) }), n }; var un = function (t) { var e = { type: 'category', scale: 'ordinal' }; return t.reduce(function (t, n) { return Object.keys(n).forEach(function (r) { var i = n.hasOwnProperty(r) ? n[r] : null; if (t[r] = t[r] || { type: null, hasNull: !1 }, i === null)t[r].hasNull = !0; else { var a = (function (t, e) { var n = e; return kt(t) ? (n.type = 'measure', n.scale = 'time') : At(t) ? (n.type = 'order', n.scale = 'ordinal') : Number.isFinite(t) && (n.type = 'measure', n.scale = 'linear'), n }(i, Ct(e))); var o = a.type; var s = a.scale; var u = t[r].type !== null && t[r].type !== o; t[r].type = u ? e.type : o, t[r].scale = u ? e.scale : s } }), t }, {}) }; var ln = function (t, e, n) { var r = t; var i = ['period', 'time'].indexOf(n.scale) >= 0 ? function (t) { return new Date(t) } : function (t) { return t }; var a = t.reduce(function (t, e, n) { return t.set(e, n), t }, new Map()); if (n.type === 'measure' || n.scale === 'period')r = t.slice().sort(te(function (t, n) { return i(t[e]) - i(n[e]) }, function (t, e) { return a.get(t) - a.get(e) })); else if (n.order) { var o = n.order.reduce(function (t, e, n) { return t[e] = n, t }, {}); var s = n.order.length; var u = '(___' + e + '___)'; r = t.map(function (t) { var n = o[t[e]]; return n = n >= 0 ? n : s, t[u] = n, t }).sort(te(function (t, e) { return t[u] - e[u] }, function (t, e) { return a.get(t) - a.get(e) })).map(function (t) { return delete t[u], t }) } return r }; var cn = function (t, e) { var n = document.createElement('div'); return n.classList.add(Ue + t), e && e.appendChild(n), n }; var fn = function () { var t = cn('layout'); var e = cn('layout__header', t); var n = cn('layout__container', t); var r = cn('layout__sidebar', n); var i = cn('layout__content', n); var a = cn('layout__content__wrap', i); var o = cn('layout__sidebar-right', n); return { layout: t, header: e, content: a, contentContainer: i, leftSidebar: r, rightSidebar: cn('layout__sidebar-right__wrap', o), rightSidebarContainer: o, footer: cn('layout__footer', t) } }; var dn = (function () { function t (t) { this.spec = t, this.dist = { sources: { '?': { dims: {}, data: [{}] }, '/': { dims: {}, data: [] } }, scales: { x_null: { type: 'ordinal', source: '?' }, y_null: { type: 'ordinal', source: '?' }, size_null: { type: 'size', source: '?' }, color_null: { type: 'color', source: '?' }, split_null: { type: 'value', source: '?' }, 'pos:default': { type: 'ordinal', source: '?' }, 'size:default': { type: 'size', source: '?' }, 'label:default': { type: 'value', source: '?' }, 'color:default': { type: 'color', source: '?' }, 'split:default': { type: 'value', source: '?' } }, settings: t.settings } } return t.prototype.convert = function () { var t = this.spec; var e = this.dist; return this.ruleAssignSourceDims(t, e), this.ruleAssignStructure(t, e), this.ruleAssignSourceData(t, e), this.ruleApplyDefaults(e), e }, t.prototype.ruleApplyDefaults = function (t) { var e = t.settings || {}; var n = function (t, e, r) { e(t, r), (t.units || []).map(function (r) { return n(r, e, t) }) }; n(t.unit, function (t, n) { if (t.namespace = 'chart', t.guide = Jt(t.guide || {}, { animationSpeed: e.animationSpeed || 0, utcTime: e.utcTime || !1 }), n && !t.hasOwnProperty('units')) { t = Jt(t, { x: n.x, y: n.y }); var r = Ct(n.guide) || {}; t.guide.x = Jt(t.guide.x || {}, r.x), t.guide.y = Jt(t.guide.y || {}, r.y), t.expression.inherit = n.expression.inherit } return !n || t.guide && t.guide.hasOwnProperty('obsoleteVerticalStackOrder') || (t.guide = Object.assign(t.guide || {}, { obsoleteVerticalStackOrder: (n.guide || {}).obsoleteVerticalStackOrder })), t }, null) }, t.prototype.ruleAssignSourceData = function (t, e) { var n = t.spec.dimensions || {}; var r = e.sources['/'].dims; var i = function (t, e) { var n = t[e]; return At(n) && !kt(n) && Object.keys(n).forEach(function (r) { return t[e + '.' + r] = n[r] }), t }; e.sources['/'].data = t.data.map(function (t) { var e = Object.keys(t).reduce(i, t); return Object.keys(r).reduce(function (t, e) { return t.hasOwnProperty(e) || (t[e] = null), t[e] !== null && n[e] && ['period', 'time'].indexOf(n[e].scale) >= 0 && (t[e] = new Date(t[e])), t }, e) }) }, t.prototype.ruleAssignSourceDims = function (t, e) { var n = t.spec.dimensions; e.sources['/'].dims = Object.keys(n).reduce(function (t, e) { return t[e] = { type: n[e].type }, t }, {}) }, t.prototype.ruleAssignStructure = function (t, e) { var n = this; var r = function (t) { var i = Ct(Qt(t, 'unit')); return n.ruleCreateScales(t, i, e.settings), i.expression = n.ruleInferExpression(t), t.unit && (i.units = t.unit.map(r)), i }; var i = r(t.spec.unit); i.expression.inherit = !1, e.unit = i }, t.prototype.ruleCreateScales = function (t, e, n) { var r = this; var i = t.guide || {}; ['identity', 'color', 'size', 'label', 'x', 'y', 'split'].forEach(function (a) { t.hasOwnProperty(a) && (e[a] = r.scalesPool(a, t[a], i[a] || {}, n)) }) }, t.prototype.ruleInferDim = function (t, e) { var n = t; var r = this.spec.spec.dimensions; if (!r.hasOwnProperty(n)) return n; e.hasOwnProperty('tickLabel') ? n = t + '.' + e.tickLabel : r[t].value && (n = t + '.' + r[t].value); var i = this.dist.sources['/'].dims; return i.hasOwnProperty(n) || (i[n] = { type: i[t].type }, delete i[t]), n }, t.prototype.scalesPool = function (t, e, n, r) { var i = t + '_' + e; if (this.dist.scales.hasOwnProperty(i)) return i; var a = this.spec.spec.dimensions; var o = {}; if (t === 'color' && e !== null && (o = { type: 'color', source: '/', dim: this.ruleInferDim(e, n) }, n.hasOwnProperty('brewer') && (o.brewer = n.brewer), a[e] && a[e].hasOwnProperty('order') && (o.order = a[e].order), n.hasOwnProperty('min') && (o.min = n.min), n.hasOwnProperty('max') && (o.max = n.max), n.hasOwnProperty('nice') && (o.nice = n.nice)), t === 'size' && e !== null && (o = { type: 'size', source: '/', dim: this.ruleInferDim(e, n) }, n.hasOwnProperty('func') && (o.func = n.func), n.hasOwnProperty('min') && (o.min = n.min), n.hasOwnProperty('max') && (o.max = n.max), n.hasOwnProperty('minSize') && (o.minSize = n.minSize), n.hasOwnProperty('maxSize') && (o.maxSize = n.maxSize)), t === 'label' && e !== null && (o = { type: 'value', source: '/', dim: this.ruleInferDim(e, n) }), t === 'split' && e !== null && (o = { type: 'value', source: '/', dim: this.ruleInferDim(e, n) }), t === 'identity' && e !== null && (o = { type: 'identity', source: '/', dim: this.ruleInferDim(e, n) }), a.hasOwnProperty(e) && (t === 'x' || t === 'y')) { if (o = { type: a[e].scale, source: '/', dim: this.ruleInferDim(e, n) }, a[e].hasOwnProperty('order') && (o.order = a[e].order), n.hasOwnProperty('min') && (o.min = n.min), n.hasOwnProperty('max') && (o.max = n.max), n.hasOwnProperty('autoScale') ? o.autoScale = n.autoScale : o.autoScale = !0, n.hasOwnProperty('nice') ? o.nice = n.nice : o.nice = o.autoScale, n.hasOwnProperty('niceInterval') ? o.niceInterval = n.niceInterval : o.niceInterval = null, n.hasOwnProperty('tickPeriod') && (o.period = n.tickPeriod, o.type = 'period'), n.hasOwnProperty('tickPeriod') && n.hasOwnProperty('timeInterval')) throw new Error('Use "tickPeriod" for period scale, "timeInterval" for time scale, but not both'); if (n.hasOwnProperty('timeInterval')) { o.period = n.timeInterval, o.type = 'time'; var s = b.get(o.period, { utc: r.utcTime }); n.hasOwnProperty('min') && (o.min = s.cast(new Date(n.min))), n.hasOwnProperty('max') && (o.max = s.cast(new Date(n.max))) }o.fitToFrameByDims = n.fitToFrameByDims, o.ratio = n.ratio } return this.dist.scales[i] = o, i }, t.prototype.getScaleConfig = function (t, e) { var n = t + '_' + e; return this.dist.scales[n] }, t.prototype.ruleInferExpression = function (t) { var e = { operator: 'none', params: [] }; var n = t.guide || {}; var r = n.x || {}; var i = n.y || {}; var a = this.getScaleConfig('x', t.x); var o = this.getScaleConfig('y', t.y); return t.type.indexOf('ELEMENT.') === 0 ? t.color && (e = { operator: 'groupBy', params: [this.ruleInferDim(t.color, n.color || {})] }) : t.type === 'COORDS.RECT' && t.unit.length === 1 && t.unit[0].type === 'COORDS.RECT' && (e = a.period || o.period ? { operator: 'cross_period', params: [this.ruleInferDim(t.x, r), this.ruleInferDim(t.y, i), a.period, o.period] } : { operator: 'cross', params: [this.ruleInferDim(t.x, r), this.ruleInferDim(t.y, i)] }), Object.assign({ inherit: !0, source: '/' }, e) }, t }()); var hn = n(6); var pn = n(7); var gn = function () { return (gn = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var mn = gn({}, hn, pn); var yn = mn.format('.4s'); var vn = mn.format('.2r'); var bn = mn.format('.1e'); var xn = (function () { var t = /\.0+([^\d].*)?$/; var e = /(\.\d+?)0+([^\d].*)?$/; return function (n) { return n.replace(t, '$1').replace(e, '$1$2') } }()); var _n = { _identity: function (t, e) { return String(t === null || void 0 === t ? e : t) }, 'x-num-auto': function (t) { if (isNaN(t)) return 'NaN'; var e = Math.abs(t); return xn(e < 1 ? e === 0 ? '0' : e < 1e-6 ? bn(t) : vn(t) : yn(t)) }, percent: function (t) { return parseFloat((100 * t).toFixed(2)).toString() + '%' }, day: mn.timeFormat('%d-%b-%Y'), 'day-utc': mn.utcFormat('%d-%b-%Y'), 'day-short': mn.timeFormat('%d-%b'), 'day-short-utc': mn.utcFormat('%d-%b'), week: mn.timeFormat('%d-%b-%Y'), 'week-utc': mn.utcFormat('%d-%b-%Y'), 'week-short': mn.timeFormat('%d-%b'), 'week-short-utc': mn.utcFormat('%d-%b'), month: function (t) { var e = new Date(t).getMonth() === 0 ? '%B, %Y' : '%B'; return mn.timeFormat(e)(t) }, 'month-utc': function (t) { var e = new Date(t).getUTCMonth() === 0 ? '%B, %Y' : '%B'; return mn.utcFormat(e)(t) }, 'month-short': function (t) { var e = new Date(t).getMonth() === 0 ? "%b '%y" : '%b'; return mn.timeFormat(e)(t) }, 'month-short-utc': function (t) { var e = new Date(t).getUTCMonth() === 0 ? "%b '%y" : '%b'; return mn.utcFormat(e)(t) }, 'month-year': mn.timeFormat('%B, %Y'), 'month-year-utc': mn.utcFormat('%B, %Y'), quarter: function (t) { var e = new Date(t); var n = e.getMonth(); return 'Q' + ((n - n % 3) / 3 + 1) + ' ' + e.getFullYear() }, 'quarter-utc': function (t) { var e = new Date(t); var n = e.getUTCMonth(); return 'Q' + ((n - n % 3) / 3 + 1) + ' ' + e.getUTCFullYear() }, year: mn.timeFormat('%Y'), 'year-utc': mn.utcFormat('%Y'), 'x-time-auto': null }; var wn = { get: function (t, e) { var n = _n._identity; var r = _n.hasOwnProperty(t); var i = r ? _n[t] : n; return r && (i = _n[t]), !r && t && (i = function (e) { return (kt(e) ? mn.timeFormat(t) : mn.format(t))(e) }), r || t || (i = n), i !== null ? function (t) { return i(t, e || '') } : null }, add: function (t, e) { _n[t] = e } }; var En = function (t) { return t.reduce(function (t, e) { return t + e }, 0) }; var Sn = function (t, e) { var n = e.guide || {}; var r = { x: ['label'], y: ['label'], size: ['label'], color: ['label'], padding: [] }; return Object.keys(r).forEach(function (e) { var i = r[e]; !(function (t, e, n, r) { var i = t.hasOwnProperty(n) ? t[n] : {}; i = i || {}, r.forEach(function (t) { Object.assign(e.guide[n][t], i[t]) }) }(n, t, e, i)) }), Object.assign(t.guide, Object.keys(n).reduce(function (t, e) { return r.hasOwnProperty(e) || (t[e] = n[e]), t }, {})), t }; var Mn = function (t, e, n) { return t[e] = Jt(t[e] || {}, { label: '' }), t[e].label = At(t[e].label) ? t[e].label : { text: t[e].label }, t[e].label = Jt(t[e].label, n || {}, { padding: 32, rotate: 0, textAnchor: 'middle', cssClass: 'label', dock: null }), t[e] }; var Tn = function (t, e, n) { return t[e] = Jt(t[e], n || {}, { padding: 0, density: 30, rotate: 0, tickPeriod: null, tickFormat: null, autoScale: !0 }), t[e].tickFormat = t[e].tickFormat || t[e].tickPeriod, t[e].nice = t[e].hasOwnProperty('nice') ? t[e].nice : t[e].autoScale, t[e] }; var Cn = function (t) { var e = t.units || []; var n = !t.hasOwnProperty('units'); var r = !e.some(function (t) { return t.hasOwnProperty('units') }); return { type: t.type, isLeaf: n, isLeafParent: !n && r } }; var kn = function (t, e, n, r) { if (t.length === 0) return { width: 0, height: 0 }; if (e === null) { var i = n('TauChart Library'); return i.width = 0.625 * r, i }t.every(function (t) { return typeof t === 'number' }) && (t = u.scaleLinear().domain(t).ticks()); var a = t.reduce(function (t, n) { var r = e(n).toString().length; return !t.computed || r > t.computed ? { value: n, computed: r } : t }, {}).value; return n(e(a)) }; var An = function (t, e) { var n = t.dimType; var r = t.scaleType; var i = [n, r, '*'].join(':'); var a = [n, r].join(':'); return e[i] || e[a] || e[n] || null }; var On = function (t, e, n) { return t.hasOwnProperty(e + ':' + n) ? t[e + ':' + n] : t['' + e] }; var Pn = function (t, e) { return ['day', 'week', 'month'].indexOf(t) >= 0 && (t += '-short' + (e ? '-utc' : '')), t }; var Nn = function (t, e) { var n = t.width; var r = t.height; var i = Math.abs(Vt(e)); return { width: Math.max(Math.cos(i) * n, r), height: Math.max(Math.sin(i) * n, r) } }; var Ln = function (t, e) { void 0 === e && (e = 'x'); var n = Ht(t); var r = e === 'x' ? [[0, 45, 'middle'], [45, 135, 'start'], [135, 225, 'middle'], [225, 315, 'end'], [315, 360, 'middle']] : [[0, 90, 'end'], [90, 135, 'middle'], [135, 225, 'start'], [225, 315, 'middle'], [315, 360, 'end']]; return r[r.findIndex(function (t) { return n >= t[0] && n < t[1] })][2] }; var Rn = function (t, e, n) { var r = Math.ceil(t.width / e); return { height: Math.min(r, n) * t.height, width: e } }; function Fn (t, e, n, r, i, a) { var o = n.values; var s = r.values; var u = n.isEmpty || t.x.hideTicks; var l = r.isEmpty || t.y.hideTicks; var c = kn(o, wn.get(t.x.tickFormat, t.x.tickFormatNullAlias), e.getAxisTickLabelSize, e.xAxisTickLabelLimit); var f = kn(s, wn.get(t.y.tickFormat, t.y.tickFormatNullAlias), e.getAxisTickLabelSize, e.yAxisTickLabelLimit); var d = c; var h = f; c.width > e.xAxisTickLabelLimit && (t.x.tickFormatWordWrap = !0, t.x.tickFormatWordWrapLines = e.xTickWordWrapLinesLimit, d = Rn(c, e.xAxisTickLabelLimit, e.xTickWordWrapLinesLimit)), f.width > e.yAxisTickLabelLimit && (t.y.tickFormatWordWrap = !0, t.y.tickFormatWordWrapLines = e.yTickWordWrapLinesLimit, h = Rn(f, e.yAxisTickLabelLimit, e.yTickWordWrapLinesLimit)), a && (t.y.tickFormatWordWrap = !1, t.y.tickFormatWordWrapLines = 1, (h = Rn(f, 2 * e.yAxisTickLabelLimit, 1)).width = 20); var p = u ? 0 : 1; var g = l ? 0 : 1; var m = t.x.label; var y = t.y.label; var v = m.text && !m.hide ? 1 : 0; var b = y.text && !y.hide ? 1 : 0; var x = Nn(d, t.x.rotate); var _ = Nn(h, t.y.rotate); i ? (m.padding = (-e.xAxisPadding - e.xFontLabelHeight) / 2 + e.xFontLabelHeight, m.paddingNoTicks = m.padding, y.padding = (-e.yAxisPadding - e.yFontLabelHeight) / 2, y.paddingNoTicks = y.padding, v = 0, b = 0) : (m.padding = En([p * (e.xTickWidth + x.height), v * (e.distToXAxisLabel + e.xFontLabelHeight)]), m.paddingNoTicks = v * (e.distToXAxisLabel + e.xFontLabelHeight), y.padding = En([g * (e.yTickWidth + _.width), b * e.distToYAxisLabel]), y.paddingNoTicks = b * e.distToYAxisLabel), a && (y.padding = 0, y.paddingNoTicks = 0); var w = e.xFontLabelDescenderLineHeight; return t.padding = Object.assign(t.padding, { b: t.x.hide ? 0 : En([t.x.padding, p * (e.xTickWidth + x.height), v * (e.distToXAxisLabel + e.xFontLabelHeight + w)]), l: t.y.hide ? 0 : En([t.y.padding, a ? 0 : g * (e.yTickWidth + _.width), b * (e.distToYAxisLabel + e.yFontLabelHeight)]) }), t.paddingNoTicks = Object.assign({}, t.paddingNoTicks, { b: t.x.hide ? 0 : En([t.x.padding, v * (e.distToXAxisLabel + e.xFontLabelHeight + w)]), l: t.y.hide ? 0 : En([t.y.padding, b * (e.distToYAxisLabel + e.yFontLabelHeight)]) }), t.x = Object.assign(t.x, { density: x.width + 2 * On(e, 'xDensityPadding', n.dimType), tickFontHeight: c.height, $minimalDomain: o.length, $maxTickTextW: d.width, $maxTickTextH: d.height, tickFormatWordWrapLimit: e.xAxisTickLabelLimit }), t.y = Object.assign(t.y, { density: _.height + 2 * On(e, 'yDensityPadding', r.dimType), tickFontHeight: f.height, $minimalDomain: s.length, $maxTickTextW: h.width, $maxTickTextH: h.height, tickFormatWordWrapLimit: e.yAxisTickLabelLimit }), t } var Dn = function (t) { var e = t.unit; var n = t.meta; var r = t.settings; var i = t.allowXVertical; var a = t.allowYVertical; var o = t.inlineLabels; var s = n.dimension(e.x); var u = n.dimension(e.y); var l = n.scaleMeta(e.x, e.guide.x); var c = n.scaleMeta(e.y, e.guide.y); var f = l.isEmpty; var d = c.isEmpty; e.guide.x.tickFormat = Pn(e.guide.x.tickFormat || An(s, r.defaultFormats), r.utcTime), e.guide.y.tickFormat = Pn(e.guide.y.tickFormat || An(u, r.defaultFormats), r.utcTime); var h = !!i && !(s.dimType === 'measure'); var p = !!a && !(u.dimType === 'measure'); if (e.guide.x.padding = f ? 0 : r.xAxisPadding, e.guide.x.paddingNoTicks = e.guide.x.padding, e.guide.y.padding = d ? 0 : r.yAxisPadding, e.guide.y.paddingNoTicks = e.guide.y.padding, e.guide.x.rotate = h ? -90 : 0, e.guide.x.textAnchor = Ln(e.guide.x.rotate, 'x'), e.guide.y.rotate = p ? -90 : 0, e.guide.y.textAnchor = Ln(e.guide.y.rotate, 'y'), e.guide = Fn(e.guide, r, l, c, o, de(e)), o) { var g = e.guide.x.label; var m = e.guide.y.label; g.cssClass += ' inline', g.dock = 'right', g.textAnchor = 'end', m.cssClass += ' inline', m.dock = 'right', m.textAnchor = 'end' } return e }; var In = { NONE: function (t, e, n) { var r = Ct(t); return jn(Ct(r.unit), r.unit, function (t, e) { return e.guide.x.tickFontHeight = n.getAxisTickLabelSize('X').height, e.guide.y.tickFontHeight = n.getAxisTickLabelSize('Y').height, e.guide.x.tickFormatWordWrapLimit = n.xAxisTickLabelLimit, e.guide.y.tickFormatWordWrapLimit = n.yAxisTickLabelLimit, e }), r }, 'BUILD-LABELS': function (t, e) { var n = Ct(t); var r = []; var i = []; var a = null; var o = null; gt(n.unit, 'units', Cn, function (t, n) { if (t.isLeaf) return n; !a && n.x && (a = n), !o && n.y && (o = n), n.guide = n.guide || {}, n.guide.x = n.guide.x || { label: { text: '' } }, n.guide.y = n.guide.y || { label: { text: '' } }, n.guide.x.label = At(n.guide.x.label) ? n.guide.x.label : { text: n.guide.x.label && n.guide.x.label.text ? n.guide.x.label.text : '' }, n.guide.y.label = At(n.guide.y.label) ? n.guide.y.label : { text: n.guide.y.label && n.guide.y.label.text ? n.guide.y.label.text : '' }, n.x && (n.guide.x.label.text = n.guide.x.label.text || e.dimension(n.x).dimName), n.y && (n.guide.y.label.text = n.guide.y.label.text || e.dimension(n.y).dimName); var s = n.guide.x.label.text; s && (r.push(s), n.guide.x.tickFormatNullAlias = n.guide.x.hasOwnProperty('tickFormatNullAlias') ? n.guide.x.tickFormatNullAlias : 'No ' + s, n.guide.x.label.text = '', n.guide.x.label._original_text = s); var u = n.guide.y.label.text; return u && (i.push(u), n.guide.y.tickFormatNullAlias = n.guide.y.hasOwnProperty('tickFormatNullAlias') ? n.guide.y.tickFormatNullAlias : 'No ' + u, n.guide.y.label.text = '', n.guide.y.label._original_text = u), n }); return a && (a.guide.x.label.text = a.guide.x.label.hide ? '' : r.join('  ')), o && (o.guide.y.label.text = o.guide.y.label.hide ? '' : i.join('  ')), n }, 'BUILD-GUIDE': function (t, e, n) { var r = Ct(t); return jn(Ct(r.unit), r.unit, function (t, r) { if (t.isLeaf) return r; var i = !t.isLeaf && !t.isLeafParent; var a = e.scaleMeta(r.x, r.guide.x); var o = e.scaleMeta(r.y, r.guide.y); var s = !i && Boolean(a.dimType) && a.dimType !== 'measure'; return r.guide.x.rotate = r.guide.x.rotate || (s ? -90 : 0), r.guide.x.textAnchor = Ln(r.guide.x.rotate), r.guide.x.tickFormat = r.guide.x.tickFormat || An(a, n.defaultFormats), r.guide.y.tickFormat = r.guide.y.tickFormat || An(o, n.defaultFormats), r.guide.x.padding = i ? 0 : n.xAxisPadding, r.guide.x.paddingNoTicks = r.guide.x.padding, r.guide.y.padding = i ? 0 : n.yAxisPadding, r.guide.y.paddingNoTicks = r.guide.y.padding, r.guide = Fn(r.guide, Jt({ distToXAxisLabel: a.isEmpty ? n.xTickWidth : n.distToXAxisLabel, distToYAxisLabel: o.isEmpty ? n.yTickWidth : n.distToYAxisLabel }, n), a, o, null, de(r)), r.guide.x = Object.assign(r.guide.x, { cssClass: i ? r.guide.x.cssClass + ' facet-axis' : r.guide.x.cssClass, avoidCollisions: !!i || r.guide.x.avoidCollisions }), r.guide.y = Object.assign(r.guide.y, { cssClass: i ? r.guide.y.cssClass + ' facet-axis' : r.guide.y.cssClass, avoidCollisions: !i && r.guide.y.avoidCollisions }), r.guide = Object.assign(r.guide, { showGridLines: r.guide.hasOwnProperty('showGridLines') ? r.guide.showGridLines : t.isLeafParent ? 'xy' : '' }), r }), r }, 'BUILD-COMPACT': function (t, e, n) { var r = Ct(t); return jn(Ct(r.unit), r.unit, function (t, r) { return t.isLeaf ? r : (r.guide.hasOwnProperty('showGridLines') || (r.guide.showGridLines = t.isLeafParent ? 'xy' : ''), t.isLeafParent ? Dn({ unit: r, meta: e, settings: Jt({ xTickWordWrapLinesLimit: 1, yTickWordWrapLinesLimit: 1 }, n), allowXVertical: !0, allowYVertical: !1, inlineLabels: !0 }) : (r.guide.x.cssClass += ' facet-axis compact', r.guide.x.avoidCollisions = !0, r.guide.y.cssClass += ' facet-axis compact', r.guide.y.avoidCollisions = !0, Dn({ unit: r, meta: e, settings: Jt({ xAxisPadding: 0, yAxisPadding: 0, distToXAxisLabel: 0, distToYAxisLabel: 0, xTickWordWrapLinesLimit: 1, yTickWordWrapLinesLimit: 1 }, n), allowXVertical: !1, allowYVertical: !0, inlineLabels: !1 }))) }), r }, AUTO: function (t, e, n) { return ['BUILD-LABELS', 'BUILD-GUIDE'].reduce(function (t, r) { return In[r](t, e, n) }, t) }, COMPACT: function (t, e, n) { return ['BUILD-LABELS', 'BUILD-COMPACT'].reduce(function (t, r) { return In[r](t, e, n) }, t) } }; var jn = function (t, e, n) { var r = (function (t) { return t.options = t.options || {}, t.guide = t.guide || {}, t.guide.padding = Jt(t.guide.padding || {}, { l: 0, b: 0, r: 0, t: 0 }), t.guide.x = Mn(t.guide, 'x'), t.guide.x = Tn(t.guide, 'x', { cssClass: 'x axis', scaleOrient: 'bottom', textAnchor: 'middle' }), t.guide.y = Mn(t.guide, 'y', { rotate: -90 }), t.guide.y = Tn(t.guide, 'y', { cssClass: 'y axis', scaleOrient: 'left', textAnchor: 'end' }), t.guide.size = Mn(t.guide, 'size'), t.guide.color = Mn(t.guide, 'color'), t }(e)); r = n(Cn(r), r); var i = Qt(r = Sn(r, t), 'units'); return (r.units || []).forEach(function (t) { return jn(Ct(t), (function (t, e) { return t.guide = t.guide || {}, t.guide.padding = t.guide.padding || { l: 0, t: 0, r: 0, b: 0 }, t.hasOwnProperty('units') || ((t = Jt(t, e)).guide = Jt(t.guide, Ct(e.guide)), t.guide.x = Jt(t.guide.x, Ct(e.guide.x)), t.guide.y = Jt(t.guide.y, Ct(e.guide.y))), t }(t, i)), n) }), r }; var zn = function (t, e, n, r) { var i = { dimension: function (t) { var e = n.scales[t]; var r = n.sources[e.source].dims[e.dim] || {}; return { dimName: e.dim, dimType: r.type, scaleType: e.type } }, scaleMeta: function (t) { var e = r('pos', t).domain(); var i = n.scales[t]; var a = n.sources[i.source].dims[i.dim] || {}; return { dimName: i.dim, dimType: a.type, scaleType: i.type, values: e, isEmpty: a.type == null } } }; var a = (In[t] || In.NONE)({ unit: Ct(n.unit) }, i, e); return n.unit = a.unit, n }; var Bn = (function () { function t (t) { this.spec = t, this.isApplicable = Dt(t.unit) } return t.prototype.transform = function (t) { var e = this.spec; if (!this.isApplicable) return e; var n = e.settings.size; var r = e.settings.specEngine.find(function (t) { return n.width <= t.width || n.height <= t.height }); return zn(r.name, e.settings, e, function (e, n) { return t.getScaleInfo(n || e + ':default') }) }, t }()); var Vn = (function () { function t () {} return t.optimizeXAxisLabel = function (t, e) { var n = e.xAxisTickLabelLimit; var r = function (t) { if (!t.guide.x.hide && !t.guide.x.hideTicks && t.guide.x.rotate !== 0) { t.guide.x.rotate = 0, t.guide.x.textAnchor = 'middle'; var e = 0 - Math.min(n, t.guide.x.$maxTickTextW) + t.guide.x.$maxTickTextH; i(t, e) }(t.units || []).filter(function (t) { return t.type === 'COORDS.RECT' }).forEach(function (t) { return r(t) }) }; var i = function (e, n) { t !== e && e.guide.autoLayout === 'extract-axes' ? (t.guide.x.padding += n, t.guide.padding.b += n) : (e.guide.x.label.padding += e.guide.x.label.padding > 0 ? n : 0, e.guide.padding.b += e.guide.padding.b > 0 ? n : 0) }; r(t) }, t.hideAxisTicks = function (t, e, n) { var r = function (t) { var e = n === 'x' ? 'b' : 'l'; var i = t.guide; if (!i[n].hide && !i[n].hideTicks) { de(t) && n === 'y' || (i[n].hideTicks = !0); var a = i[n].label.text && !i[n].label.hide; i.padding[e] = i.paddingNoTicks ? i.paddingNoTicks[e] : 0, i[n].padding = i[n].paddingNoTicks || 0, i[n].label.padding = a ? i[n].label.paddingNoTicks : 0 }(t.units || []).filter(function (t) { return t.type === 'COORDS.RECT' }).forEach(function (t) { return r(t) }) }; r(t) }, t.facetsLabelsAtTop = function (t, e) { var n = function (t) { var e = t.units || []; if (de(t)) { var r = t.guide; r.y.facetAxis = !0, r.y.rotate = 0, r.y.textAnchor = 'start', e.forEach(function (t) { t.guide.padding.t = 20 }) }e.filter(function (t) { return t.type === 'COORDS.RECT' }).forEach(function (t) { return n(t) }) }; n(t) }, t }()); var Hn = function (t) { return t.$maxTickTextW }; var Wn = function (t) { return t.rotate == 0 ? t.$maxTickTextW : t.$maxTickTextH }; var Gn = function (t) { return t.density }; var Un = function (t) { var e = []; var n = []; var r = function (t) { if (t.type === 'COORDS.RECT' && t.units && t.units[0] && t.units[0].type === 'COORDS.RECT') { var i = t.x.replace(/^x_/, ''); var a = t.y.replace(/^y_/, ''); i !== 'null' && e.push(i), a !== 'null' && n.push(a), t.units.forEach(r) } }; r(t.unit); var i = {}; var a = {}; var o = function (t) { t.type === 'COORDS.RECT' && t.frames.forEach(function (t) { t.key && (Object.keys(t.key).forEach(function (r) { e.indexOf(r) >= 0 && (i.hasOwnProperty(r) || (i[r] = []), i[r].indexOf(t.key[r]) < 0 && i[r].push(t.key[r])), n.indexOf(r) >= 0 && (a.hasOwnProperty(r) || (a[r] = []), a[r].indexOf(t.key[r]) < 0 && a[r].push(t.key[r])) }), t.units && t.units.forEach(o)) }) }; return o(t.unit), { xFacetCount: Object.keys(i).reduce(function (t, e) { return t * i[e].length }, 1), yFacetCount: Object.keys(a).reduce(function (t, e) { return t * a[e].length }, 1) } }; var Xn = { 'entire-view': function (t, e, n, r) { var i = n.unit.guide; var a = Un(n); var o = a.xFacetCount; var s = a.yFacetCount; s > 0 && Vn.facetsLabelsAtTop(n.unit, n.settings); var u = i.paddingNoTicks ? i.padding.l - i.paddingNoTicks.l : 0; var l = i.paddingNoTicks ? i.padding.b - i.paddingNoTicks.b : 0; var c = i.paddingNoTicks && t.height - l < n.settings.minChartHeight || s * n.settings.minFacetHeight + l > t.height || o * n.settings.minFacetWidth + u > t.width; var f = i.paddingNoTicks && t.width - u < n.settings.minChartWidth || s * n.settings.minFacetHeight + l > t.height || o * n.settings.minFacetWidth + u > t.width; c && Vn.hideAxisTicks(n.unit, n.settings, 'x'), f && Vn.hideAxisTicks(n.unit, n.settings, 'y'); var d = t.width; if (e('x', n.unit, Hn) <= t.width)r(n.unit, n.settings); else { var h = e('x', n.unit, Wn); if (h > t.width) { var p = Math.max(t.width, e('x', n.unit, Gn)); d = Math.min(h, p) } } var g = Math.max(t.height, e('y', n.unit, Gn)); return !c && d > t.width && Vn.hideAxisTicks(n.unit, n.settings, 'x'), !f && g > t.height && Vn.hideAxisTicks(n.unit, n.settings, 'y'), { newW: t.width, newH: t.height } }, minimal: function (t, e, n) { return { newW: e('x', n.unit, Gn), newH: e('y', n.unit, Gn) } }, normal: function (t, e, n, r) { Un(n).yFacetCount > 0 && Vn.facetsLabelsAtTop(n.unit, n.settings); var i = n.unit.guide; i.paddingNoTicks && (t.width - i.padding.l + i.paddingNoTicks.l < n.settings.minChartWidth && Vn.hideAxisTicks(n.unit, n.settings, 'y'), t.height - i.padding.b + i.paddingNoTicks.b < n.settings.minChartHeight && Vn.hideAxisTicks(n.unit, n.settings, 'x')); var a = t.width; if (e('x', n.unit, Hn) <= t.width)r(n.unit, n.settings); else { var o = e('x', n.unit, Wn); if (o > t.width) { var s = Math.max(t.width, e('x', n.unit, Gn)); a = Math.min(o, s) } } return { newW: a, newH: Math.max(t.height, e('y', n.unit, Gn)) } }, 'fit-width': function (t, e, n, r) { var i = n.unit.guide; var a = i.paddingNoTicks ? i.padding.l - i.paddingNoTicks.l : 0; return (i.paddingNoTicks && t.width - a < n.settings.minChartWidth || Un(n).xFacetCount * n.settings.minFacetWidth + a > t.width) && Vn.hideAxisTicks(n.unit, n.settings, 'y'), e('x', n.unit, Hn) <= t.width && r(n.unit, n.settings), { newW: t.width, newH: e('y', n.unit, Gn) } }, 'fit-height': function (t, e, n) { var r = n.unit.guide; var i = r.paddingNoTicks ? r.padding.b - r.paddingNoTicks.b : 0; return (r.paddingNoTicks && t.height - i < n.settings.minChartHeight || Un(n).yFacetCount * n.settings.minFacetHeight + i > t.height) && Vn.hideAxisTicks(n.unit, n.settings, 'x'), { newW: e('x', n.unit, Gn), newH: t.height } } }; var qn = (function () { function t (t) { this.spec = t, this.isApplicable = Dt(t.unit) } return t.prototype.transform = function (t) { var e = this.spec; if (!this.isApplicable) return e; var n = e.settings.fitModel; if (!n) return e; var r = e.scales; var i = function (t, e) { return t.discrete ? e * t.domain().length : 4 * e }; var a = function (e, n, o, s) { void 0 === s && (s = null); var u = e === 'x' ? n.x : n.y; var l = e === 'x' ? n.y : n.x; var c = n.guide; var f = o(e === 'x' ? c.x : c.y); var d = n.units[0]; var h = e === 'x' ? c.padding.l + c.padding.r : c.padding.b + c.padding.t; if (d.type === 'ELEMENT.INTERVAL' && e === 'y' === Boolean(d.flip) && d.label && !t.getScaleInfo(d.label, s).isEmpty()) { var p; var g = 2 * (c.label && c.label.fontSize ? c.label.fontSize : 10); var m = t.getScaleInfo(u, s); if (m.discrete && (d.guide.enableColorToBarPosition == null ? !d.stack : d.guide.enableColorToBarPosition)) { var y = d.color; if (y) { var v = t.getScaleInfo(y, s); if (v.discrete) { v.domain(); p = v } } } var b = n.frames.reduce(function (t, e) { return t + (function (t) { var e = t.part(); var n = qt(e.map(function (t) { return t[m.dim] })).length; var r = 1; if (p) { var i = e.reduce(function (t, e) { var n = e[m.dim]; var r = e[p.dim]; return t[n] = t[n] || {}, t[n][r] || (t[n][r] = !0), t }, {}); var a = Object.keys(i).map(function (t) { return Object.keys(i[t]).length }); r = Math.max.apply(Math, a) } return n * r * g }(e)) }, 0); var x = i(m, f); return h + Math.max(b, x) } if (d.type !== 'COORDS.RECT') { var _ = t.getScaleInfo(u, s); return h + i(_, f) } var w = (function (t, e) { return t.reduce(function (t, n) { var r = (n.key || {})[e]; return t[r] = t[r] || [], t[r].push(n), t }, {}) }(n.frames, r[l].dim)); var E = Object.keys(w).map(function (t) { return w[t].map(function (t) { return a(e, t.units[0], o, t) }).reduce(function (t, e) { return t + e }, 0) }); return h + Math.max.apply(Math, E) }; var o = e.settings.size; var s = o.width; var u = o.height; var l = Xn[n]; if (l) { var c = l(o, a, e, Vn.optimizeXAxisLabel); s = c.newW, u = c.newH } return e.settings.size = (function (n, r, i) { var a = e.settings.getScrollbarSize(t.getLayout().contentContainer); var o = r.width > n.width && r.width <= n.width * i ? n.width : r.width; var s = r.height > n.height && r.height <= n.height * i ? n.height : r.height; var u = n.width - o; var l = n.height - s >= 0 ? 0 : a.width; return { height: s - (u >= 0 ? 0 : a.height), width: o - l } }(o, { width: s, height: u }, e.settings.avoidScrollAtRatio)), e }, t }()); var Yn = (function () { function t (t) { this.spec = t, this.isApplicable = t.settings.autoRatio && Dt(t.unit) } return t.prototype.transform = function (t) { var e = this.spec; if (!this.isApplicable) return e; try { this.ruleApplyRatio(e, t) } catch (t) { if (t.message !== 'Not applicable') throw t } return e }, t.prototype.ruleApplyRatio = function (t, e) { var n = function (t) { return t.type === 'COORDS.RECT' || t.type === 'RECT' }; var r = function (t, e, n, i) { void 0 === i && (i = 0), e(t, i) && (t.units || []).map(function (t) { return r(t, e, n, i + 1) }), n(t, i) }; var i = []; var a = []; r(t.unit, function (t, e) { if (e > 1 || !n(t)) throw new Error('Not applicable'); return i.push(t.x), a.push(t.y), (t.units || []).map(function (t) { if (!n(t) && !(function (t) { return t.type.indexOf('ELEMENT.') === 0 }(t))) throw new Error('Not applicable'); return t }).filter(n).length === 1 }, function () { return 0 }); var o = function (e) { return t.scales[e] }; var s = function (t) { return t.source === '/' && !t.ratio && !t.fitToFrameByDims }; var u = function (t) { return t.type === 'ordinal' || t.type === 'period' && !t.period }; var l = i.map(o).filter(s); var c = a.map(o).filter(s); if ([l.length, c.length].some(function (t) { return t === 2 })) { var f = function (t) { return t.dim }; var d = function (t, e, n) { t.fitToFrameByDims = n.slice(0, e).map(f) }; var h = function (t, n) { n.filter(u).length === 2 && (n.forEach(d), n[0].ratio = Ft(t, n.map(f), e)) }; h('x', l), h('y', c) } }, t }()); var $n = (function () { function t (t) { this.spec = t, this.isApplicable = t.settings.layoutEngine === 'EXTRACT' && Dt(t.unit) } return t.prototype.transform = function () { var t = this.spec; if (!this.isApplicable) return t; try { this.ruleExtractAxes(t) } catch (t) { if (t.message !== 'Not applicable') throw t; console.log("[TauCharts]: can't extract axes for the given chart specification") } return t }, t.prototype.ruleExtractAxes = function (t) { var e = function (t) { return t.type === 'COORDS.RECT' || t.type === 'RECT' }; var n = function (t) { return t ? 10 : 0 }; var r = { l: 0, r: 10, t: 10, b: 0 }; var i = { l: 0, b: 0 }; var a = []; var o = []; mt(t.unit, function (t, n) { if (n > 1 || !e(t)) throw new Error('Not applicable'); t.guide = t.guide || {}; var s = t.guide; var u = s.padding || { l: 0, r: 0, t: 0, b: 0 }; var l = s.paddingNoTicks || { l: 0, b: 0 }; return r.l += u.l, r.r += u.r, r.t += u.t, r.b += u.b, i.l += l.l, i.b += l.b, a.push(Object.assign({}, r)), o.push(Object.assign({}, i)), (t.units || []).map(function (t) { if (!e(t) && !(function (t) { return t.type.indexOf('ELEMENT.') === 0 }(t))) throw new Error('Not applicable'); return t }).filter(e).length === 1 }, function (t) { var e = a.pop(); var s = o.pop(); var u = t.guide || {}; u.x = u.x || {}, u.x.padding = u.x.padding || 0, u.x.paddingNoTicks = u.x.paddingNoTicks || 0, u.y = u.y || {}, u.y.padding = u.y.padding || 0, u.y.paddingNoTicks = u.y.paddingNoTicks || 0, u.padding = { l: n(t.y), r: n(1), t: n(1), b: n(t.x) }, u.paddingNoTicks = { l: 0, b: 0 }, u.autoLayout = 'extract-axes', u.x.padding += r.b - e.b, u.y.padding += r.l - e.l, u.x.paddingNoTicks += i.b - s.b, u.y.paddingNoTicks += i.l - s.l }), t.unit.guide.padding = r, t.unit.guide.paddingNoTicks = i }, t }()); var Kn = (function () { function t (t) { var e = void 0 === t ? {} : t; var n = e.src; var r = void 0 === n ? null : n; var i = e.timeout; var a = void 0 === i ? Number.MAX_SAFE_INTEGER : i; var o = e.syncInterval; var s = void 0 === o ? Number.MAX_SAFE_INTEGER : o; var u = e.callbacks; var l = void 0 === u ? {} : u; var c = this; this.setTimeoutDuration(a), this.setSyncInterval(s), this.setCallbacks(l), this._running = !1, this._queue = [], this._result = r, this._syncDuration = 0, this._asyncDuration = 0, this._requestedFrameId = null, this._visibilityChangeHandler = function () { if (c._running && c._requestedFrameId) { var t = c._getCancelFrameFunction(); var e = c._getRequestFrameFunction(); t(c._requestedFrameId), c._requestedFrameId = e(c._requestedFrameCallback) } }, this._tasksCount = 0, this._finishedTasksCount = 0 } return t.prototype.setTimeoutDuration = function (e) { t.checkType(e, 'number', 'timeout'), this._timeout = e }, t.prototype.setSyncInterval = function (e) { t.checkType(e, 'number', 'syncInterval'), this._syncInterval = e }, t.prototype.setCallbacks = function (e) { t.checkType(e, 'object', 'callbacks'), this._callbacks = Object.assign(this._callbacks || {}, e) }, t.prototype.addTask = function (t) { return this._queue.push(t), this._tasksCount++, this }, t.prototype.run = function () { if (this._running) throw new Error('Task Runner is already running'); this._running = !0, t.runnersInProgress++, document.addEventListener('visibilitychange', this._visibilityChangeHandler), this._loopTasks() }, t.prototype.isRunning = function () { return this._running }, t.prototype._loopTasks = function () { for (var e, n, r, i, a = 0, o = this._syncInterval / t.runnersInProgress; this._running && !(r = this._asyncDuration > this._timeout) && !(i = a > o) && (e = this._queue.shift());) { if ((n = this._runTask(e)) === null) return; this._syncDuration += n, this._asyncDuration += n, a += n }r && this._queue.length > 0 && (this.stop(), this._callbacks.timeout && this._callbacks.timeout.call(null, this._asyncDuration, this)), !r && i && this._queue.length > 0 && this._requestFrame(), this._queue.length === 0 && (this.stop(), this._callbacks.done && this._callbacks.done.call(null, this._result, this)) }, t.prototype._runTask = function (t) { var e = performance.now(); if (this._callbacks.error) try { this._result = t.call(null, this._result, this) } catch (t) { return this.stop(), this._callbacks.error.call(null, t, this), null } else this._result = t.call(null, this._result, this); var n = performance.now() - e; return this._finishedTasksCount++, this._callbacks.progress && this._callbacks.progress.call(null, this._finishedTasksCount / this._tasksCount, this), n }, t.prototype._requestFrame = function () { var t = this; var e = performance.now(); var n = function () { t._requestedFrameId = null; var n = performance.now(); t._asyncDuration += n - e, t._loopTasks() }; var r = this._getRequestFrameFunction(); this._requestedFrameCallback = n, this._requestedFrameId = r(n) }, t.prototype._getRequestFrameFunction = function () { var t = this; return document.hidden ? function (e) { return t._requestedFrameType = 'idle', window.requestIdleCallback(e, { timeout: 17 }) } : function (e) { return t._requestedFrameType = 'animation', requestAnimationFrame(e) } }, t.prototype._getCancelFrameFunction = function () { switch (this._requestedFrameType) { case 'animation':return function (t) { return cancelAnimationFrame(t) }; case 'idle':return function (t) { return window.cancelIdleCallback(t) } } }, t.prototype.stop = function () { if (!this._running) throw new Error('Task Runner is already stopped'); (this._running = !1, t.runnersInProgress--, document.removeEventListener('visibilitychange', this._visibilityChangeHandler), this._requestedFrameId) && (this._getCancelFrameFunction()(this._requestedFrameId), this._requestedFrameId = null) }, t.checkType = function (t, e, n) { if (typeof t !== e) throw new Error('Task Runner "' + n + '" property is not "' + e + '"') }, t.runnersInProgress = 0, t }()); var Jn = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Qn = function () { return (Qn = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Zn = Qn({}, o); var tr = Se; var er = Me; var nr = (function (t) { function e (e) { var n = t.call(this) || this; return n._nodes = [], n._svg = null, n._filtersStore = { filters: {}, tick: 0 }, n._layout = fn(), n.transformers = [Yn, Bn], n.onUnitsStructureExpandedTransformers = [$n, qn], n._chartDataModel = function (t) { return t }, n._reportProgress = null, n._taskRunner = null, n._renderingPhase = null, n.applyConfig(e), n } return Jn(e, t), e.prototype.on = function (e, n, r) { return t.prototype.on.call(this, e, n, r) }, e.prototype.updateConfig = function (t) { this.applyConfig(t), this.refresh() }, e.prototype.applyConfig = function (t) { this._filtersStore.filters = {}, t = this.setupConfigSettings(t), this.configGPL = this.createGPLConfig(t), this._originData = Object.assign({}, this.configGPL.sources), this._liveSpec = this.configGPL, this._emptyContainer = t.emptyContainer || '', this.setupPlugins(t) }, e.prototype.createGPLConfig = function (t) { var n; return this.isGPLConfig(t) ? n = t : (t = this.setupConfig(t), n = new dn(t).convert()), n = e.setupPeriodData(n) }, e.prototype.isGPLConfig = function (t) { return ['sources', 'scales'].filter(function (e) { return t.hasOwnProperty(e) }).length === 2 }, e.prototype.setupPlugins = function (t) { var e = t.plugins || []; this._plugins && this._plugins.destroy(), this._plugins = new Ke(e, this) }, e.prototype.setupConfigSettings = function (t) { return this._dataRefs = this._dataRefs || (function () { var t = 0; return { references: new WeakMap(), refCounter: function () { return ++t } } }()), t.settings = e.setupSettings(Jt(t.settings || {}, this._dataRefs)), t }, e.prototype.destroy = function () { this.destroyNodes(), Zn.select(this._svg).remove(), Zn.select(this._layout.layout).remove(), this._cancelRendering(), t.prototype.destroy.call(this) }, e.prototype.setupChartSourceModel = function (t) { this._chartDataModel = t }, e.prototype.setupConfig = function (t) { if (!t.spec || !t.spec.unit) throw new Error('Provide spec for plot'); var n = Jt(t, { spec: {}, data: [], plugins: [], settings: {} }); n.spec.dimensions = e.setupMetaInfo(n.spec.dimensions, n.data); var r = n.settings.log; return n.settings.excludeNull && this.addFilter({ tag: 'default', src: '/', predicate: on(n.spec.dimensions, function (t) { return r([t, 'point was excluded, because it has undefined values.'], 'WARN') }) }), n }, e.setupPeriodData = function (t) { var n = e.__api__.tickPeriod; var r = t.settings.log; return Object.keys(t.scales).map(function (e) { return t.scales[e] }).filter(function (t) { return t.type === 'period' }).forEach(function (e) { n.get(e.period, { utc: t.settings.utcTime }) || (r(['Unknown period "' + e.period + '".', 'Docs: https://api.taucharts.com/plugins/customticks.html#how-to-add-custom-tick-period'], 'WARN'), e.period = null) }), t }, e.setupMetaInfo = function (t, e) { var n = t || un(e); return sn(n) }, e.setupSettings = function (t) { var n = e.globalSettings; var r = Object.keys(n).reduce(function (t, e) { return t[e] = typeof n[e] === 'function' ? n[e] : Ct(n[e]), t }, {}); var i = Jt(t || {}, r); return Array.isArray(i.specEngine) || (i.specEngine = [{ width: Number.MAX_VALUE, name: i.specEngine }]), i }, e.prototype.insertToLeftSidebar = function (t) { return ge(t, this._layout.leftSidebar) }, e.prototype.insertToRightSidebar = function (t) { return ge(t, this._layout.rightSidebar) }, e.prototype.insertToFooter = function (t) { return ge(t, this._layout.footer) }, e.prototype.insertToHeader = function (t) { return ge(t, this._layout.header) }, e.prototype.addBalloon = function (t) { return new $e('', t || {}) }, e.prototype.destroyNodes = function () { this._nodes.forEach(function (t) { return t.destroy() }), this._nodes = [], this._renderedItems = [] }, e.prototype.onUnitDraw = function (t) { var e = this; this._nodes.push(t), this.fire('unitdraw', t), ['click', 'mouseover', 'mouseout'].forEach(function (n) { return t.on(n, function (t, r) { e.fire('element' + n, { element: t, data: r.data, event: r.event }) }) }) }, e.prototype.onUnitsStructureExpanded = function (t) { var e = this; this.onUnitsStructureExpandedTransformers.forEach(function (n) { return new n(t).transform(e) }), this.fire('unitsstructureexpanded', t) }, e.prototype._getClosestElementPerUnit = function (t, e) { return this._renderedItems.filter(function (t) { return t.getClosestElement }).map(function (n) { var r = n.getClosestElement(t, e); return { unit: n.node(), closest: r } }) }, e.prototype.disablePointerEvents = function () { this._layout.layout.style.pointerEvents = 'none' }, e.prototype.enablePointerEvents = function () { this._layout.layout.style.pointerEvents = '' }, e.prototype._handlePointerEvent = function (t) { var e = this._svg.getBoundingClientRect(); var n = t.clientX - e.left; var r = t.clientY - e.top; var i = t.type === 'click' ? 'data-click' : 'data-hover'; var a = null; var o = null; var s = null; var u = this._getClosestElementPerUnit(n, r); var l = u.filter(function (t) { return t.closest }).sort(function (t, e) { return t.closest.distance === e.closest.distance ? t.closest.secondaryDistance - e.closest.secondaryDistance : t.closest.distance - e.closest.distance }); if (l.length > 0) { var c = l.findIndex(function (t) { return t.closest.distance !== l[0].closest.distance || t.closest.secondaryDistance !== l[0].closest.secondaryDistance }); var f = c < 0 ? l : l.slice(0, c); if (f.length === 1)a = f[0].closest.data, o = f[0].closest.node, s = f[0].unit; else { var d = f.reduce(function (t, e) { return t + e.closest.x }, 0) / f.length; var h = f.reduce(function (t, e) { return t + e.closest.y }, 0) / f.length; var p = Math.atan2(h - r, d - n) + Math.PI; var g = Math.round((f.length - 1) * p / 2 / Math.PI); var m = f[g].closest; a = m.data, o = m.node, s = f[g].unit } }u.forEach(function (e) { return e.unit.fire(i, { event: t, data: a, node: o, unit: s }) }) }, e.prototype._initPointerEvents = function () { var t = this; this._liveSpec.settings.syncPointerEvents || (this._pointerAnimationFrameId = null); var e = Zn.select(this._svg); var n = this._liveSpec.settings.syncPointerEvents ? function (t) { return function () { return t(o.event) } } : function (e) { return function () { var n = o.event; t._pointerAnimationFrameId && n.type !== 'mousemove' && t._cancelPointerAnimationFrame(), t._pointerAnimationFrameId || (t._pointerAnimationFrameId = requestAnimationFrame(function () { t._pointerAnimationFrameId = null, e(n) })) } }; var r = function (e) { return t._handlePointerEvent(e) }; e.on('mousemove', n(r)), e.on('click', n(r)), e.on('mouseleave', n(function (e) { window.getComputedStyle(t._svg).pointerEvents !== 'none' && t.select(function () { return !0 }).forEach(function (t) { return t.fire('data-hover', { event: e, data: null, node: null, unit: null }) }) })) }, e.prototype._cancelPointerAnimationFrame = function () { cancelAnimationFrame(this._pointerAnimationFrameId), this._pointerAnimationFrameId = null }, e.prototype._setupTaskRunner = function (t) { var e = this; return this._resetTaskRunner(), this._taskRunner = new Kn({ timeout: t.settings.renderingTimeout || Number.MAX_SAFE_INTEGER, syncInterval: t.settings.asyncRendering ? t.settings.syncRenderingInterval : Number.MAX_SAFE_INTEGER, callbacks: { done: function () { e._completeRendering(), e._renderingPhase = null }, timeout: function (t, n) { e._displayTimeoutWarning({ timeout: t, proceed: function () { e.disablePointerEvents(), n.setTimeoutDuration(Number.MAX_SAFE_INTEGER), n.run() }, cancel: function () { e._cancelRendering() } }), e.enablePointerEvents(), e.fire('renderingtimeout', t) }, progress: function (t) { var n = { spec: 0, draw: 1 }[e._renderingPhase] / 2 + t / 2; e._reportProgress(n) }, error: t.settings.handleRenderingErrors ? function (n) { e._cancelRendering(), e._displayRenderingError(n), e.fire('renderingerror', n), t.settings.log(['An error occured during chart rendering.', 'Set "handleRenderingErrors: false" in chart settings to debug.', 'Error message: ' + n.message].join(' '), 'ERROR') } : null } }), this._taskRunner }, e.prototype._resetTaskRunner = function () { this._taskRunner && this._taskRunner.isRunning() && (this._taskRunner.stop(), this._taskRunner = null) }, e.prototype.renderTo = function (t, e) { this._resetProgressLayout(), this.disablePointerEvents(), this._insertLayout(t, e); var n = this._createLiveSpec(); if (!n) return this._svg = null, this._layout.content.innerHTML = this._emptyContainer, void this.enablePointerEvents(); var r = this._createGPL(n); var i = this._setupTaskRunner(n); this._scheduleDrawScenario(i, r), this._scheduleDrawing(i, r), i.run() }, e.prototype._insertLayout = function (t, e) { this._target = t, this._defaultSize = Object.assign({}, e); var n = Zn.select(t).node(); if (n === null) throw new Error('Target element not found'); this._layout.layout.parentNode !== n && n.appendChild(this._layout.layout); var r = this._layout.content; var i = me(this._layout.contentContainer); this._layout.contentContainer.style.padding = '0 ' + i.width + 'px ' + i.height + 'px 0', ye(this._layout.rightSidebarContainer, 'vertical'); var a = Object.assign({}, e) || {}; if (!a.width || !a.height) { var o = r.parentElement; var s = o.scrollLeft; var u = o.scrollTop; r.style.display = 'none', a = Jt(a, xe(r.parentNode)), r.style.display = '', r.parentElement.scrollLeft = s, r.parentElement.scrollTop = u, a.height || (a.height = xe(this._layout.layout).height) } this.configGPL.settings.size = a }, e.prototype._createLiveSpec = function () { var t = this; return this._liveSpec = Ct(Qt(this.configGPL, 'plugins')), this._liveSpec.sources = this.getDataSources(), this._liveSpec.settings = this.configGPL.settings, this._experimentalSetupAnimationSpeed(this._liveSpec), this.isEmptySources(this._liveSpec.sources) ? null : (this._liveSpec = this.transformers.reduce(function (e, n) { return new n(e).transform(t) }, this._liveSpec), this.destroyNodes(), this.fire('specready', this._liveSpec), this._liveSpec) }, e.prototype._experimentalSetupAnimationSpeed = function (t) { t.settings.initialAnimationSpeed = t.settings.initialAnimationSpeed || t.settings.animationSpeed; var e = t.settings.experimentalShouldAnimate(t) ? t.settings.initialAnimationSpeed : 0; t.settings.animationSpeed = e; var n = function (t) { t.guide = t.guide || {}, t.guide.animationSpeed = e, t.units && t.units.forEach(n) }; n(t.unit) }, e.prototype._createGPL = function (t) { var e = new Ge(t, this.getScaleFactory(), Ze, S); var n = e.unfoldStructure(); return this.onUnitsStructureExpanded(n), e }, e.prototype._scheduleDrawScenario = function (t, e) { var n = this; var r = Zn.select(this._layout.content); var i = e.config.settings.size; t.addTask(function () { return n._renderingPhase = 'spec' }), e.getDrawScenarioQueue({ allocateRect: function () { return { slot: function (t) { return r.selectAll('.uid_' + t) }, frameId: 'root', left: 0, top: 0, width: i.width, containerWidth: i.width, height: i.height, containerHeight: i.height } } }).forEach(function (e) { return t.addTask(e) }) }, e.prototype._scheduleDrawing = function (t, e) { var n = this; var r = e.config.settings.size; t.addTask(function (t) { n._renderingPhase = 'draw', n._renderRoot({ scenario: t, newSize: r }), n._cancelPointerAnimationFrame(), n._scheduleRenderScenario(t) }) }, e.prototype._resetProgressLayout = function () { this._createProgressBar(), this._clearRenderingError(), this._clearTimeoutWarning() }, e.prototype._renderRoot = function (t) { var e = this; var n = t.scenario; var r = t.newSize; var i = Zn.select(this._layout.content); var a = n[0].config.uid; var o = tr(i, 'svg').attr('width', Math.floor(r.width)).attr('height', Math.floor(r.height)); o.attr('class') || o.attr('class', Ue + 'svg'), this._svg = o.node(), this._initPointerEvents(), this.fire('beforerender', this._svg); var s = o.selectAll('g.frame-root').data([a], function (t) { return t }); s.enter().append('g').classed(Ue + 'cell cell frame-root uid_' + a, !0).merge(s).call(function (t) { t.classed('tau-active', !0), et(t, e.configGPL.settings.animationSpeed, 'frameRootToggle').attr('opacity', 1) }), s.exit().call(function (t) { t.classed('tau-active', !1), et(t, e.configGPL.settings.animationSpeed, 'frameRootToggle').attr('opacity', 1e-6).remove() }) }, e.prototype._scheduleRenderScenario = function (t) { var e = this; t.forEach(function (t) { e._taskRunner.addTask(function () { t.draw(), e.onUnitDraw(t.node()), e._renderedItems.push(t) }) }) }, e.prototype._completeRendering = function () { ye(this._layout.contentContainer), this._layout.rightSidebar.style.maxHeight = this._liveSpec.settings.size.height + 'px', this.enablePointerEvents(), this._svg && this.fire('render', this._svg), ye(this._layout.rightSidebarContainer, 'vertical') }, e.prototype._cancelRendering = function () { this.enablePointerEvents(), this._resetTaskRunner(), this._cancelPointerAnimationFrame() }, e.prototype._createProgressBar = function () { var t = Zn.select(this._layout.header); var e = tr(t, 'div.' + Ue + 'progress'); e.select('div.' + Ue + 'progress__value').remove(); var n = e.append('div').classed(Ue + 'progress__value', !0).style('width', 0); this._reportProgress = function (t) { requestAnimationFrame(function () { e.classed(Ue + 'progress_active', t < 1), n.style('width', 100 * t + '%') }) } }, e.prototype._displayRenderingError = function (t) { this._layout.layout.classList.add(Ue + 'layout_rendering-error') }, e.prototype._clearRenderingError = function () { this._layout.layout.classList.remove(Ue + 'layout_rendering-error') }, e.prototype.getScaleFactory = function (t) { return void 0 === t && (t = null), new rn(nn.instance(this._liveSpec.settings), t || this._liveSpec.sources, this._liveSpec.scales) }, e.prototype.getScaleInfo = function (t, e) { return void 0 === e && (e = null), this.getScaleFactory().createScaleInfoByName(t, e) }, e.prototype.getSourceFiltersIterator = function (t) { var e = this; var n = Xt(Object.keys(this._filtersStore.filters).map(function (t) { return e._filtersStore.filters[t] })).filter(function (e) { return !t(e) }).map(function (t) { return t.predicate }); return function (t) { return n.reduce(function (e, n) { return e && n(t) }, !0) } }, e.prototype.getDataSources = function (t) { var e = this; void 0 === t && (t = {}); var n = this._chartDataModel(this._originData); return Object.keys(n).filter(function (t) { return t !== '?' }).reduce(function (r, i) { var a = n[i]; var o = e.getSourceFiltersIterator(function (e) { return function (n) { return t.excludeFilter && t.excludeFilter.indexOf(n.tag) !== -1 || n.src !== e } }(i)); return r[i] = { dims: a.dims, data: a.data.filter(o) }, r }, { '?': n['?'] }) }, e.prototype.isEmptySources = function (t) { return !Object.keys(t).filter(function (t) { return t !== '?' }).filter(function (e) { return t[e].data.length > 0 }).length }, e.prototype.getChartModelData = function (t, e) { return void 0 === t && (t = {}), void 0 === e && (e = '/'), this.getDataSources(t)[e].data }, e.prototype.getDataDims = function (t) { return void 0 === t && (t = '/'), this._originData[t].dims }, e.prototype.getData = function (t) { return void 0 === t && (t = '/'), this._originData[t].data }, e.prototype.setData = function (t, e) { void 0 === e && (e = '/'), this._originData[e].data = t, this.refresh() }, e.prototype.getSVG = function () { return this._svg }, e.prototype.addFilter = function (t) { t.src = t.src || '/'; var e = t.tag; var n = this._filtersStore.filters[e] = this._filtersStore.filters[e] || []; var r = this._filtersStore.tick++; return t.id = r, n.push(t), r }, e.prototype.removeFilter = function (t) { var e = this; return Object.keys(this._filtersStore.filters).map(function (n) { e._filtersStore.filters[n] = e._filtersStore.filters[n].filter(function (e) { return e.id !== t }) }), this }, e.prototype.refresh = function () { this._target && this.renderTo(this._target, this._defaultSize) }, e.prototype.resize = function (t) { void 0 === t && (t = {}), this.renderTo(this._target, t) }, e.prototype.select = function (t) { return this._nodes.filter(t) }, e.prototype.traverseSpec = function (t, e) { var n = function (t, e, r, i) { e(t, r, i), t.frames ? t.frames.forEach(function (r) { (r.units || []).map(function (i) { return n(i, e, t, r) }) }) : (t.units || []).map(function (r) { return n(r, e, t, null) }) }; n(t.unit, e, null, null) }, e.prototype.getSpec = function () { return this._liveSpec }, e.prototype.getLayout = function () { return this._layout }, e.prototype._displayTimeoutWarning = function (t) { var e = this; var n = t.proceed; var r = t.cancel; var i = t.timeout; var a = Math.round(100 / 3 / 1.5); var o = function (t) { return Math.round(100 / 3 / 1.5 * t) }; this._layout.content.style.height = '100%', this._layout.content.insertAdjacentHTML('beforeend', '\n            <div class="' + Ue + 'rendering-timeout-warning">\n            <svg\n                viewBox="0 0 200 100">\n                <text\n                    text-anchor="middle"\n                    font-size="' + a + '">\n                    <tspan x="100" y="' + o(1) + '">Rendering took more than ' + Math.round(i) / 1e3 + 's</tspan>\n                    <tspan x="100" y="' + o(2) + '">Would you like to continue?</tspan>\n                </text>\n                <text\n                    class="' + Ue + 'rendering-timeout-continue-btn"\n                    text-anchor="end"\n                    font-size="' + a + '"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="' + (100 - a / 3) + '"\n                    y="' + o(3) + '">\n                    Continue\n                </text>\n                <text\n                    class="' + Ue + 'rendering-timeout-cancel-btn"\n                    text-anchor="start"\n                    font-size="' + a + '"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="' + (100 + a / 3) + '"\n                    y="' + o(3) + '">\n                    Cancel\n                </text>\n            </svg>\n            </div>\n        '), this._layout.content.querySelector('.' + Ue + 'rendering-timeout-continue-btn').addEventListener('click', function () { e._clearTimeoutWarning(), n.call(e) }), this._layout.content.querySelector('.' + Ue + 'rendering-timeout-cancel-btn').addEventListener('click', function () { e._clearTimeoutWarning(), r.call(e) }) }, e.prototype._clearTimeoutWarning = function () { var t = er(this._layout.content, '.' + Ue + 'rendering-timeout-warning'); t && (this._layout.content.removeChild(t), this._layout.content.style.height = '') }, e }(d)); var rr = {}; var ir = {}; var ar = function (t) { var e = 'Chart type ' + t + ' is not supported.'; throw console.log(e), console.log('Use one of ' + Object.keys(rr).join(', ') + '.'), new _(e, w.NOT_SUPPORTED_TYPE_CHART) }; var or = { validate: function (t, e) { return ir.hasOwnProperty(t) || ar(t), ir[t].reduce(function (t, n) { return t.concat(n(e) || []) }, []) }, get: function (t) { var e = rr[t]; return typeof e !== 'function' && ar(t), e }, add: function (t, e, n) { return void 0 === n && (n = []), rr[t] = e, ir[t] = n, or }, getAllRegisteredTypes: function () { return rr } }; var sr = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var ur = (function (t) { function e (n) { var r = t.call(this, n) || this; return n.autoResize && e.winAware.push(r), r } return sr(e, t), e.prototype.applyConfig = function (e) { var n = or.validate(e.type, e); if (n.length > 0) throw new Error(n[0]); var r = or.get(e.type); (e = Jt(e, { autoResize: !0 })).settings = nr.setupSettings(e.settings), e.dimensions = nr.setupMetaInfo(e.dimensions, e.data), t.prototype.applyConfig.call(this, r(e)) }, e.prototype.destroy = function () { var n = e.winAware.indexOf(this); n !== -1 && e.winAware.splice(n, 1), t.prototype.destroy.call(this) }, e }(nr)); function lr (t) { return t }ur.winAware = [], ur.resizeOnWindowEvent = (function () { var t; function e () { t = 0; for (var e = 0, n = ur.winAware.length; e < n; e++)ur.winAware[e].resize() } return function () { !t && ur.winAware.length && (t = window.requestAnimationFrame(e)) } }()), window.addEventListener('resize', ur.resizeOnWindowEvent); var cr = 1e-6; function fr (t) { return 'translate(' + (t + 0.5) + ',0)' } function dr (t) { return 'translate(0,' + (t + 0.5) + ')' } var hr = { top: 1, right: 2, bottom: 3, left: 4 }; function pr (t) { var e = hr[t.scaleGuide.scaleOrient]; var n = t.scale; var r = t.scaleGuide; var i = r.label; var a = Jt(t, { tickSize: 6, tickPadding: 3, gridOnly: !1 }); var o = a.ticksCount; var s = a.tickFormat; var u = a.tickSize; var l = a.tickPadding; var c = a.gridOnly; var f = n.scaleType === 'linear'; var d = n.scaleType === 'ordinal' || n.scaleType === 'period'; var h = e === hr.top || e === hr.bottom; var p = e === hr.top || e === hr.left ? -1 : 1; var g = h ? 'x' : 'y'; var m = h ? 'y' : 'x'; var y = h ? fr : dr; var v = h ? 1 : -1; return function (a) { var b; if (n.ticks) { b = n.ticks(o); for (var x = Math.floor(1.25 * o); b.length > x && x > 2 && b.length > 2;)b = n.ticks(--x) } else b = n.domain(); r.hideTicks && (b = c ? b.filter(function (t) { return t == 0 }) : []); var _ = s == null ? n.tickFormat ? n.tickFormat(o) : lr : s; var w = Math.max(u, 0) + l; var E = n.range(); var S = E[0] + 0.5; var M = E[E.length - 1] + 0.5; var T = (n.bandwidth ? function (t) { var e = Math.max(0, t.bandwidth() - 1) / 2; return t.round() && (e = Math.round(e)), function (n) { return t(n) + e } } : lr)(n); if (r.facetAxis) { var C = T; T = function (t) { return C(t) - n.stepSize(t) / 2 } } var k = a.selection ? a : null; var A = k ? k.selection() : a; var O = (function (t) { for (var e = t.node(); e && e.tagName !== 'svg';)e = e.parentNode; return e }(A)).getBoundingClientRect(); function P (t) { var n = Ht(r.rotate); if (t.attr('transform', Pe(n)), Math.abs(n / 90) % 2 > 0) { var i = n < 180 ? 1 : -1; var a = h ? 0.5 : -2; var o = e === hr.top || e === hr.left ? -1 : 1; var s = a * (e === hr.top || e === hr.bottom ? o < 0 ? 0 : 0.71 : 0.32); t.attr('x', 9 * i).attr('y', 0).attr('dx', h ? null : s + 'em').attr('dy', s + 'em') } } function N (t, e) { void 0 === e && (e = 0); var i = function (t) { return Math.max(n.stepSize(t), r.tickFormatWordWrapLimit, e) }; r.tickFormatWordWrap ? tt(t, i, r.tickFormatWordWrapLines, r.tickFontHeight, !h) : Z(t, i) } function L (t) { !(function (t, e) { var n = e ? -10 : 20; var r = e ? 0 : 1; var i = e ? 1 : -1; var a = []; t.each(function () { var t = J.select(this); var e = t.attr('transform').replace('translate(', '').replace(' ', ',').split(',')[r]; var n = i * parseFloat(e); var o = t.select('text'); var s = o.node().getBBox().width / 2; var u = n - s; var l = n + s; a.push({ c: n, s: u, e: l, l: 0, textRef: o, tickRef: t }) }), (function (t, e) { t.map(function (t, n, r) { return e(r[n - 1] || { e: -1 / 0, s: -1 / 0, l: 0 }, t, r[n + 1] || { e: 1 / 0, s: 1 / 0, l: 0 }) }) }(a.sort(function (t, e) { return t.c - e.c }), function (t, r, i) { var a = t.e > r.s; var o = i.s < r.e; if (a || o) { r.l = (function (t, e) { var n = { '[T][1]': -1, '[T][-1]': 0, '[T][0]': 1, '[F][0]': -1 }; var r = '[' + e.toString().toUpperCase().charAt(0) + '][' + t + ']'; return n.hasOwnProperty(r) ? n[r] : 0 }(t.l, a)); var s = r.textRef.size(); var u = r.textRef.text(); s > 1 && (u = u.replace(/([\.]*$)/gi, '') + '...'); var l = 11 * r.l; var c = e ? parseFloat(r.textRef.attr('y')) + l : 0; var f = e ? 0 : l; var d = e ? l : 0; var h = (function (t) { var e = 0; if (!t) return e; var n = t.indexOf('rotate('); if (n >= 0) { var r = t.indexOf(')', n + 7); var i = t.substring(n + 7, r); e = parseFloat(i.trim()) } return e }(r.textRef.attr('transform'))); r.textRef.text(function (t, e) { return e === 0 ? u : '' }).attr('transform', 'translate(' + f + ',' + d + ') rotate(' + h + ')'); var p = { x1: 0, x2: 0, y1: c + (e ? -1 : 5), y2: n }; e || (p.transform = 'rotate(-90)'), Se(r.tickRef, 'line.label-ref').call(lt(p)) } else r.tickRef.selectAll('line.label-ref').remove(); return r })) }(t, h)) }A.attr('fill', 'none').attr('font-size', 10).attr('font-family', 'sans-serif').attr('text-anchor', e === hr.right ? 'start' : e === hr.left ? 'end' : 'middle'), c || (function () { var t = r.hideTicks || r.hide ? [] : [null]; le(A.selectAll('.domain').data(t)).then(function (t) { return k && t.exit().transition(k).attr('opacity', 0).remove(), t.merge(t.enter().insert('path', '.tick').attr('class', 'domain').attr('opacity', 1).attr('stroke', '#000')) }).then(function (t) { return k ? t.transition(k) : t }).then(function (t) { t.attr('d', e === hr.left || e == hr.right ? 'M' + p * u + ',' + S + 'H0.5V' + M + 'H' + p * u : 'M' + S + ',' + p * u + 'V0.5H' + M + 'V' + p * u) }) }()); var R = le(A.selectAll('.tick').data(b, function (t) { return String(n(t)) }).order()).then(function (t) { var e = t.exit(); var n = t.enter().append('g').attr('class', 'tick'); return { tickExit: e, tickEnter: n, tick: t.merge(n) } }).then(function (t) { if (f) { var e = n.ticks(); var r = n.domain(); var i = b.length - 1; var a = e.length > 1 && r[0] * r[1] < 0 && -r[0] > (e[1] - e[0]) / 2 && r[1] > (e[i] - e[i - 1]) / 2; t.tick.classed('zero-tick', function (t) { return t == 0 && a }) } return t }).result(); !(function (t) { le(t).then(function (t) { var e = t.tickEnter; var n = t.tickExit; var r = t.tick; return k ? (e.attr('opacity', cr).attr('transform', function (t) { var e = T(t); return y(e) }), { tick: r.transition(k), tickExit: n.transition(k).attr('opacity', cr).attr('transform', function (t) { var e = T(t); return isFinite(e) ? y(e) : this.getAttribute('transform') }) }) : { tick: r, tickExit: n } }).then(function (t) { var e = t.tick; t.tickExit.remove(), e.attr('opacity', 1).attr('transform', function (t) { return y(T(t)) }) }) }(R)), r.facetAxis || (function (t) { var e = p * u; var r = d ? function (t) { return v * n.stepSize(t) / 2 } : null; le(t).then(function (t) { var n = t.tick; var i = t.tickEnter; var a = n.select('line'); var o = i.append('line').attr('stroke', '#000').attr(m + '2', e); return d && o.attr(g + '1', r).attr(g + '2', r), a.merge(o) }).then(function (t) { return k ? t.transition(k) : t }).then(function (t) { t.attr(m + '2', e), d && t.attr(g + '1', r).attr(g + '2', r) }) }(R)), d && c && d && b && b.length && le(A.selectAll('.extra-tick-line').data([null])).then(function (t) { return t.merge(t.enter().insert('line', '.tick').attr('class', 'extra-tick-line').attr('stroke', '#000')) }).then(function (t) { return k ? t.transition(k) : t }).then(function (t) { t.attr(g + '1', S).attr(g + '2', S).attr(m + '1', 0).attr(m + '2', p * u) }), c || ((function (i) { var a = r.textAnchor; var o = p * w; var s = e === hr.top ? '0em' : e === hr.bottom ? '0.71em' : '0.32em'; function u (e) { if (r.facetAxis) return e.attr('dx', 18 - t.position[0]).attr('dy', 16) }le(i).then(function (t) { var e = t.tick; var n = t.tickEnter; var r = e.select('text'); var i = n.append('text').attr('fill', '#000').attr(m, o).attr('dy', s); return P(i), u(i), r.merge(i) }).then(function (t) { if (t.text(_).attr('text-anchor', a), !1 === h && !0 === r.facetAxis) { var e = Le(A.node().parentNode.getAttribute('transform')); N(t, O.width - Math.abs(e.x)) } else N(t); return h && n.scaleType === 'time' && (function (t) { if (!(b.length < 2)) { var e = 0; var n = -1; var r = t.nodes(); r.forEach(function (t, r) { var i = t.textContent || ''; var a = i.length; a > e && (e = a, n = r) }); var i = T(b[1]) - T(b[0]); var a = !1; if (n >= 0) { var o = r[n].getBoundingClientRect(); a = i - o.width < 8 }A.classed(Ue + 'time-axis-overflow', a) } }(t)), !h || n.scaleType !== 'time' && n.scaleType !== 'linear' || (function (t) { if (b.length !== 0) { var e = b[0]; var n = b[b.length - 1]; var r = A.append('line').attr('x1', T(e)).attr('x2', T(e)).attr('y1', 0).attr('y2', 1); var i = A.append('line').attr('x1', T(n)).attr('x2', T(n)).attr('y1', 0).attr('y2', 1); var a = { left: r.node().getBoundingClientRect().left - O.left, right: O.right - i.node().getBoundingClientRect().right }; r.remove(), i.remove(); var o = function (t, e, n) { var r = t.getBoundingClientRect(); var i = e > 0 ? 'right' : 'left'; var o = (T(n), a[i]); var s = Math.ceil(r.width / 2 - o + 1); t.setAttribute('dx', String(s > 0 ? -e * s : 0)) }; var s = t.filter(function (t) { return t === e }).node(); var u = t.filter(function (t) { return t === n }).node(); t.attr('dx', null), o(s, -1, e), o(u, 1, n) } }(t)), t }).then(function (t) { return k ? t.transition(k) : t }).then(function (t) { t.attr(m, o), P(t), u(t), d && r.avoidCollisions && !r.facetAxis && (k ? k.on('end.fixTickTextCollision', function () { return L(i.tick) }) : L(i.tick)) }) }(R)), i.hide || (function () { var t = i; var e = Se(A, 'text.label').attr('class', ke('label', t.cssClass)).attr('transform', Pe(t.rotate)).attr('text-anchor', t.textAnchor); le(e).then(function (t) { return k ? t.transition(k) : t }).then(function (e) { var n = v * t.padding; var r = Math.abs(M - S); var i = h ? r : 0; e.attr('x', i).attr('y', n).attr('text-anchor', 'end') }); for (var n = t.text.split('  '), r = n.length - 1; r > 0; r--)n.splice(r, 0, '  '); e.selectAll('tspan').data(n).enter().append('tspan').attr('class', function (t, e) { return e % 2 ? 'label-token-delimiter label-token-delimiter-' + e : 'label-token label-token-' + e }).text(function (t) { return t }).exit().remove() }())) } } function gr (t) { return pr({ scale: t.scale, scaleGuide: t.scaleGuide, ticksCount: t.ticksCount, tickSize: t.tickSize, gridOnly: !0, position: t.position }) } var mr = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var yr = Se; var vr = function (t) { var e = t <= 20 ? 1 : 0.75; return Math.max(2, Math.round(t * e)) }; var br = (function (t) { function e (e) { var n = t.call(this, e) || this; n.config = e, n.config.guide = Jt(n.config.guide || {}, { showGridLines: 'xy', padding: { l: 50, r: 0, t: 0, b: 50 } }), n.config.guide.x = n.config.guide.x || {}, n.config.guide.x = Jt(n.config.guide.x, { cssClass: 'x axis', textAnchor: 'middle', padding: 10, hide: !1, scaleOrient: 'bottom', rotate: 0, density: 20, label: {}, tickFormatWordWrapLimit: 100 }), typeof n.config.guide.x.label === 'string' && (n.config.guide.x.label = { text: n.config.guide.x.label }), n.config.guide.x.label = Jt(n.config.guide.x.label, { text: 'X', rotate: 0, padding: 40, textAnchor: 'middle' }), n.config.guide.y = n.config.guide.y || {}, n.config.guide.y = Jt(n.config.guide.y, { cssClass: 'y axis', textAnchor: 'start', padding: 10, hide: !1, scaleOrient: 'left', rotate: 0, density: 20, label: {}, tickFormatWordWrapLimit: 100 }), typeof n.config.guide.y.label === 'string' && (n.config.guide.y.label = { text: n.config.guide.y.label }), n.config.guide.y.label = Jt(n.config.guide.y.label, { text: 'Y', rotate: -90, padding: 20, textAnchor: 'middle' }); var r = n.config; var i = r.guide; if (i.autoLayout === 'extract-axes') { var a = r.options.containerHeight - (r.options.top + r.options.height); i.x.hide = i.x.hide || Math.floor(a) > 0, i.y.hide = i.y.hide || Math.floor(r.options.left) > 0 } var o = n.config.options; var s = n.config.guide.padding; return n.L = o.left + s.l, n.T = o.top + s.t, n.W = o.width - (s.l + s.r), n.H = o.height - (s.t + s.b), n } return mr(e, t), e.prototype.defineGrammarModel = function (t) { var e = this.W; var n = this.H; return this.xScale = t('pos', this.config.x, [0, e]), this.yScale = t('pos', this.config.y, function (t) { return ['ordinal', 'period'].indexOf(t.type) >= 0 ? [0, n] : [n, 0] }), this.regScale('x', this.xScale).regScale('y', this.yScale), { scaleX: this.xScale, scaleY: this.yScale, xi: function () { return e / 2 }, yi: function () { return n / 2 }, sizeX: function () { return e }, sizeY: function () { return n } } }, e.prototype.getGrammarRules = function () { return [function (t) { var e = t.scaleX; var n = t.scaleY; return { xi: function (n) { return n ? e(n[e.dim]) : t.xi(n) }, yi: function (e) { return e ? n(e[n.dim]) : t.yi(e) }, sizeX: function (n) { return n ? e.stepSize(n[e.dim]) : t.sizeX(n) }, sizeY: function (e) { return e ? n.stepSize(e[n.dim]) : t.sizeY(e) } } }] }, e.prototype.createScreenModel = function (t) { return t }, e.prototype.allocateRect = function (t) { var e = this; var n = this.screenModel; return { slot: function (t) { return e.config.options.container.selectAll('.uid_' + t) }, left: n.xi(t) - n.sizeX(t) / 2, top: n.yi(t) - n.sizeY(t) / 2, width: n.sizeX(t), height: n.sizeY(t), containerWidth: this.W, containerHeight: this.H } }, e.prototype.drawFrames = function (t) { var e = Object.assign({}, this.config); var n = e.options; var r = this.W; var i = this.H; if (e.x = this.xScale, e.y = this.yScale, e.x.scaleObj = this.xScale, e.y.scaleObj = this.yScale, e.x.guide = e.guide.x, e.y.guide = e.guide.y, e.x.guide.label.size = r, e.y.guide.label.size = i, (n.container.attr('transform') ? et(n.container, this.config.guide.animationSpeed, 'cartesianContainerTransform') : n.container).attr('transform', Oe(this.L, this.T)), e.x.guide.hide) this._removeDimAxis(n.container, e.x); else { var a = e.x.guide.scaleOrient === 'top' ? [0, 0 - e.guide.x.padding] : [0, i + e.guide.x.padding]; this._drawDimAxis(n.container, e.x, a, r) } if (e.y.guide.hide) this._removeDimAxis(n.container, e.y); else { var o = e.y.guide.scaleOrient === 'right' ? [r + e.guide.y.padding, 0] : [0 - e.guide.y.padding, 0]; this._drawDimAxis(n.container, e.y, o, i) } var s = t.reduce(function (t, e) { return t.concat((e.units || []).map(function (t) { return t.uid })) }, []); var u = this._drawGrid(n.container, e, r, i, n); var l = st(u, '.cell').data(s, function (t) { return t }); l.enter().append('g').attr('class', function (t) { return Ue + 'cell cell uid_' + t }).merge(l).classed('tau-active', !0), et(l, this.config.guide.animationSpeed).attr('opacity', 1), et(l.exit().classed('tau-active', !1), this.config.guide.animationSpeed).attr('opacity', 1e-6).remove() }, e.prototype._drawDimAxis = function (t, e, n, r) { var i = wn.get(e.guide.tickFormat, e.guide.tickFormatNullAlias); var o = (function (t) { return pr(t) }({ scale: e.scaleObj, scaleGuide: e.guide, ticksCount: i ? vr(r / e.guide.density) : null, tickFormat: i || null, position: n })); var s = this.config.guide.animationSpeed; yr(t, this._getAxisSelector(e)).classed('tau-active', !0).classed(e.guide.cssClass, !0).call(function (t) { var e = et(t, s, 'axisTransition'); var r = t.attr('transform'); Oe.apply(a, n) !== r && (r ? e : t).attr('transform', Oe.apply(a, n)), e.call(o), e.attr('opacity', 1) }) }, e.prototype._removeDimAxis = function (t, e) { var n = st(t, this._getAxisSelector(e)).classed('tau-active', !1); et(n, this.config.guide.animationSpeed, 'axisTransition').attr('opacity', 1e-6).remove() }, e.prototype._getAxisSelector = function (t) { return 'g.' + (Ne(t.guide.scaleOrient) === 'h' ? 'x' : 'y') + '.axis' }, e.prototype._drawGrid = function (t, e, n, r) { var i = this; return yr(t, 'g.grid').attr('transform', Oe(0, 0)).call(function (t) { var a = t; var o = i.config.guide.animationSpeed; var s = (e.guide.showGridLines || '').toLowerCase(); if (s.length > 0) { var u = yr(a, 'g.grid-lines'); if (s.indexOf('x') > -1) { var l = e.x; var c = wn.get(l.guide.tickFormat); var f = gr({ scale: l.scaleObj, scaleGuide: l.guide, tickSize: r, ticksCount: c ? vr(n / l.guide.density) : null }); var d = yr(u, 'g.grid-lines-x'); et(d, o).call(f) } if (s.indexOf('y') > -1) { var h = e.y; var p = (c = wn.get(h.guide.tickFormat), gr({ scale: h.scaleObj, scaleGuide: h.guide, tickSize: -n, ticksCount: c ? vr(r / h.guide.density) : null })); var g = yr(u, 'g.grid-lines-y'); et(g, o).call(p) } } }) }, e }(g)); var xr = n(11); var _r = n(8); var wr = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Er = function () { return (Er = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Sr = Er({}, xr, _r, o); var Mr = (function (t) { function e (e) { var n = t.call(this, e) || this; n.config = e, n.config.guide = Jt(n.config.guide || {}, { padding: { l: 50, r: 50, t: 50, b: 50 }, enableBrushing: !1 }), n.columnsBrushes = {}, n.columnsSelections = {}, n.on('force-brush', function (t, e) { return n._forceBrushing(e) }); var r = n.config.options; var i = n.config.guide.padding; return n.L = r.left + i.l, n.T = r.top + i.t, n.W = r.width - (i.l + i.r), n.H = r.height - (i.t + i.b), n } return wr(e, t), e.prototype.defineGrammarModel = function (t) { var e = this.config; var n = this.W; var r = this.H; this.columnsScalesMap = e.columns.reduce(function (e, n) { return e[n] = t('pos', n, [0, r]), e }, {}); var i = n / (e.columns.length - 1); var a = e.columns.reduce(function (t, e, n) { return t[e] = n * i, t }, {}); return this.xBase = function (t) { return a[t] }, this.regScale('columns', this.columnsScalesMap), {} }, e.prototype.allocateRect = function () { var t = this; return { slot: function (e) { return t.config.options.container.selectAll('.uid_' + e) }, left: 0, top: 0, width: this.W, height: this.H, containerWidth: this.W, containerHeight: this.H } }, e.prototype.drawFrames = function (t) { var e = this; var n = Object.assign({}, this.config); var r = n.options; var i = this._fnDrawGrid(r.container, n, r.frameId, Object.keys(this.columnsScalesMap).reduce(function (t, n) { return t.concat([e.columnsScalesMap[n].getHash()]) }, []).join('_')); var a = i.selectAll('.parent-frame-' + r.frameId).data(t, function (t) { return t.hash() }); a.exit().remove(), a.enter().append('g').attr('class', function (t) { return Ue + 'cell cell parent-frame-' + r.frameId + ' frame-' + t.hash() }).merge(a).each(function (t) { !(function (t, e, n) { var r = e.selectAll('.layer_' + t).data(n.units, function (t) { return t.uid }); r.exit().remove(), r.enter().append('g').attr('class', function (e) { return 'layer_' + t + ' uid_' + e.uid }) }(r.frameId, Sr.select(this), t)) }); var o = this._fnDrawColumns(i, n); n.guide.enableBrushing && this._enableBrushing(o) }, e.prototype._fnDrawGrid = function (t, e, n, r) { var i = t.selectAll('.grid_' + n).data([r], function (t) { return t }); return i.exit().remove(), i.enter().append('g').attr('class', 'grid grid_' + n).attr('transform', Oe(this.L, this.T)).merge(i) }, e.prototype._fnDrawColumns = function (t, e) { var n = e.guide.columns || {}; var r = this.xBase; var i = this.columnsScalesMap; var a = Sr.axisLeft(); var o = t.selectAll('.column').data(e.columns, function (t) { return t }); return o.exit().remove(), o.enter().append('g').attr('class', 'column').attr('transform', function (t) { return Oe(r(t), 0) }).call(function (t) { t.append('g').attr('class', 'y axis').each(function (t) { var e = i[t].dim; var r = a.scale(i[t]); var o = n[e] || {}; var s = wn.get(o.tickFormat, o.tickFormatNullAlias); s !== null && r.tickFormat(s), Sr.select(this).call(r) }).append('text').attr('class', 'label').attr('text-anchor', 'middle').attr('y', -9).text(function (t) { return ((n[t] || {}).label || {}).text || i[t].dim }) }).merge(o) }, e.prototype._enableBrushing = function (t) { var e = this; var n = this.columnsSelections; var r = this.columnsScalesMap; var i = this.columnsBrushes; var a = !0; var s = function (t) { return t }; var u = function (t) { return t }; var l = function () { var t = Object.keys(i).find(function (t) { return i[t] === o.event.target }); if (n[t] = o.event.selection, a) { var s = Object.keys(i).filter(function (t) { return n[t] }).map(function (t) { var e = []; if (r[t].discrete) { var i = n[t]; e = r[t].domain().filter(function (e) { var n = r[t](e); return i[0] <= n && i[1] >= n }) } else { var a = n[t].map(r[t].invert); e = [a[0], a[1]] } return { dim: r[t].dim, func: r[t].discrete ? 'inset' : 'between', args: e } }); e.fire('brush', s) } }; return t.selectAll('.brush').remove(), t.append('g').attr('class', 'brush').each(function (t) { var e = r[t].range(); i[t] = Sr.brushY().extent([[0, e[0]], [16, e[1]]]).on('start', s).on('brush', l).on('end', u), Sr.select(this).classed('brush-' + Rt(t), !0).call(i[t]), a = !1, i[t].move(Sr.select(this), e), a = !0 }).selectAll('rect').attr('transform', 'translate(-8,0)').attr('width', 16), t }, e.prototype._forceBrushing = function (t) { void 0 === t && (t = {}); var e = this.columnsBrushes; var n = this.columnsScalesMap; this.columnsSelections; Object.keys(t).filter(function (r) { return e[r] && n[r] && t[r] }).forEach(function (r) { var i = t[r]; var a = []; if (n[r].discrete) { var o = i.map(n[r]).filter(function (t) { return t >= 0 }); var s = n[r].stepSize() / 2; a = [Math.min.apply(Math, o) - s, Math.max.apply(Math, o) + s] } else a = [i[0], i[1]]; var u = Rt(r); e[r](Sr.select('.brush-' + u)), e[r].move(Sr.select('.brush-' + u), a.map(n[r])) }) }, e }(g)); var Tr = n(12); var Cr = n(4); var kr = function () { var t; var e = []; var n = []; var r = 1; var i = 1; var a = {}; var o = !1; var s = function (t) { var r = e.length; var i = 0; var a = e[t].x - n[t].x; var o = n[t].y - e[t].y; var s = Math.sqrt(a * a + o * o); s > 0 && (i += 0.2 * s), o /= s, i += (a /= s) > 0 && o > 0 ? 0 : a < 0 && o > 0 ? 3 : a < 0 && o < 0 ? 6 : 9; for (var u, l, f, d, h = e[t].x, p = e[t].y - e[t].height + 2, g = e[t].x + e[t].width, m = e[t].y + 2, y = 0; y < r; y++)y != t && (c(n[t].x, e[t].x, n[y].x, e[y].x, n[t].y, e[t].y, n[y].y, e[y].y) && (i += 1), u = e[y].x, f = e[y].y - e[y].height + 2, l = e[y].x + e[y].width, d = e[y].y + 2, i += 30 * (Math.max(0, Math.min(l, g) - Math.max(u, h)) * Math.max(0, Math.min(d, m) - Math.max(f, p)))), u = n[y].x - n[y].r, f = n[y].y - n[y].r, l = n[y].x + n[y].r, d = n[y].y + n[y].r, i += 30 * (Math.max(0, Math.min(l, g) - Math.max(u, h)) * Math.max(0, Math.min(d, m) - Math.max(f, p))); return i }; var u = function (a) { var u; var l = Math.floor(Math.random() * e.length); var c = e[l].x; var f = e[l].y; u = o ? t(l, e, n) : s(l), e[l].x += 5 * (Math.random() - 0.5), e[l].y += 5 * (Math.random() - 0.5), e[l].x > r && (e[l].x = c), e[l].x < 0 && (e[l].x = c), e[l].y > i && (e[l].y = f), e[l].y < 0 && (e[l].y = f); var d = (o ? t(l, e, n) : s(l)) - u; Math.random() < Math.exp(-d / a) ? 1 : (e[l].x = c, e[l].y = f, 1) }; var l = function (a) { var u; var l = Math.floor(Math.random() * e.length); var c = e[l].x; var f = e[l].y; u = o ? t(l, e, n) : s(l); var d = 0.5 * (Math.random() - 0.5); var h = Math.sin(d); var p = Math.cos(d); e[l].x -= n[l].x, e[l].y -= n[l].y; var g = e[l].x * p - e[l].y * h; var m = e[l].x * h + e[l].y * p; e[l].x = g + n[l].x, e[l].y = m + n[l].y, e[l].x > r && (e[l].x = c), e[l].x < 0 && (e[l].x = c), e[l].y > i && (e[l].y = f), e[l].y < 0 && (e[l].y = f); var y = (o ? t(l, e, n) : s(l)) - u; Math.random() < Math.exp(-y / a) ? 1 : (e[l].x = c, e[l].y = f, 1) }; var c = function (t, e, n, r, i, a, o, s) { var u, l, c; return l = ((e - t) * (i - o) - (a - i) * (t - n)) / (c = (s - o) * (e - t) - (r - n) * (a - i)), !((u = ((r - n) * (i - o) - (s - o) * (t - n)) / c) < 0 || u > 1 || l < 0 || l > 1) }; var f = function (t, e, n) { return t - e / n }; return a.start = function (t) { for (var n = e.length, r = 1, i = 0; i < t; i++) { for (var a = 0; a < n; a++)Math.random() < 0.5 ? u(r) : l(r); r = f(r, 1, t) } }, a.width = function (t) { return arguments.length ? (r = t, a) : r }, a.height = function (t) { return arguments.length ? (i = t, a) : i }, a.label = function (t) { return arguments.length ? (e = t, a) : e }, a.anchor = function (t) { return arguments.length ? (n = t, a) : n }, a.alt_energy = function (e) { return arguments.length ? (t = e, o = !0, a) : s }, a.alt_schedule = function () { return arguments.length ? a : f }, a }; var Ar = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Or = function () { return (Or = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Pr = Or({}, s, Tr, o); var Nr = ['land', 'continents', 'georegions', 'countries', 'regions', 'subunits', 'states', 'counties']; var Lr = (function (t) { function e (e) { var n = t.call(this, e) || this; return n.config = e, n.config.guide = Jt(n.config.guide || {}, { defaultFill: 'rgba(128,128,128,0.25)', padding: { l: 0, r: 0, t: 0, b: 0 }, showNames: !0 }), n.contourToFill = null, n.on('highlight-area', function (t, e) { return n._highlightArea(e) }), n.on('highlight-point', function (t, e) { return n._highlightPoint(e) }), n.on('highlight', function (t, e) { return n._highlightPoint(e) }), n } return Ar(e, t), e.prototype.defineGrammarModel = function (t) { var e = this.config; var n = e.options; var r = e.guide.padding; var i = n.width - (r.l + r.r); var a = n.height - (r.t + r.b); return this.latScale = t('pos', e.latitude, [0, a]), this.lonScale = t('pos', e.longitude, [i, 0]), this.sizeScale = t('size', e.size), this.colorScale = t('color', e.color), this.codeScale = t('value', e.code), this.fillScale = t('fill', e.fill), this.W = i, this.H = a, this.regScale('latitude', this.latScale).regScale('longitude', this.lonScale).regScale('size', this.sizeScale).regScale('color', this.colorScale).regScale('code', this.codeScale).regScale('fill', this.fillScale), {} }, e.prototype.drawFrames = function (t) { var e = this; var n = this.config.guide; typeof n.sourcemap === 'string' ? (function (t, e) { var n = new XMLHttpRequest(); n.onload = function () { if (n.status >= 200 && n.status < 300) { var t = n.responseText; try { e(null, JSON.parse(t)) } catch (t) { e(t, null) } } else e(new Error(n.status + ': ' + n.statusText), null) }, n.onerror = function (t) { e(t.error, null) }, n.open('GET', t, !0), n.send(null) }(n.sourcemap, function (n, r) { if (n) throw n; e._drawMap(t, r) })) : this._drawMap(t, n.sourcemap) }, e.prototype._calcLabels = function (t, e, n) { var r = this.W; var i = this.H; var a = {}; return e.forEach(function (e) { var o = (Cr.feature(t, t.objects[e]).features || []).map(function (t) { var i = t.properties || {}; var a = n.centroid(t); var o = n.bounds(t); var s = a[0]; var u = a[1]; var l = o[1][0] - o[0][0]; var c = i.name || ''; var f = i.abbr || c; var d = l < 5.5 * c.length ? f : c; var h = l < 13.75; var p = h ? r - s - 16.5 : 0; return { id: e + '-' + t.id, sx: s, sy: u, x: s + p, y: u, width: 5.5 * d.length, height: 10, name: d, r: p, isRef: h } }).filter(function (t) { return !Number.isNaN(t.x) && !Number.isNaN(t.y) }); var s = o.map(function (t) { return { x: t.sx, y: t.sy, r: t.r } }); kr().label(o).anchor(s).width(r).height(i).start(10), o.filter(function (t) { return !t.isRef }).map(function (t) { return t.x = t.sx, t.y = t.sy, t }).reduce(function (t, e) { return t[e.id] = e, t }, a); var u = o.filter(function (t) { return t.isRef }); u.length < 6 && u.reduce(function (t, e) { return t[e.id] = e, t }, a) }), a }, e.prototype._drawMap = function (t, e) { var n; var r; var i = this; var a = this; var s = this.config.guide; var u = this.config.options; var l = this.config.options.container; var c = this.latScale; var f = this.lonScale; var d = this.sizeScale; var h = this.colorScale; var p = this.codeScale; var g = this.fillScale; var m = this.W; var y = this.H; var v = Nr.filter(function (t) { return (e.objects || {}).hasOwnProperty(t) }); if (v.length === 0) throw new Error('Invalid map: should contain some contours'); if (g.dim) { if (!p.georole) throw console.log('Specify [georole] for code scale'), new Error('[georole] is missing'); if (v.indexOf(p.georole) === -1) throw console.log('There is no contour for georole "' + p.georole + '"'), console.log('Available contours are: ' + v.join(' | ')), new Error('Invalid [georole]'); n = p.georole } else n = v[v.length - 1]; if (this.contourToFill = n, c.dim && f.dim) { var b = Pr.extent(c.domain()); var x = Pr.extent(f.domain()); r = [(x[1] + x[0]) / 2, (b[1] + b[0]) / 2] } var _ = this._createProjection(e, v[0], r); var w = Pr.geoPath().projection(_); var E = l.selectAll('.map-container').data(['' + m + y + r + v.join('-')], function (t) { return t }); E.exit().remove(); var S = E.enter().append('g').call(function (t) { var n = t; n.attr('class', 'map-container'); var r = {}; var i = v.reduceRight(function (t, e) { return t.concat(e) }, []); if (s.showNames && (r = a._calcLabels(e, i, w)), i.forEach(function (t, i) { var a = function (e) { return r[t + '-' + e.id] }; n.selectAll('.map-contour-' + t).data(Cr.feature(e, e.objects[t]).features || []).enter().append('g').call(function (e) { var n = e; n.attr('class', 'map-contour-' + t + ' map-contour-level map-contour-level-' + i).attr('fill', 'none'), n.append('title').text(function (t) { return (t.properties || {}).name }), n.append('path').attr('d', w), n.append('text').attr('class', 'place-label-' + t).attr('transform', function (t) { var e = a(t); return e ? 'translate(' + [e.x, e.y] + ')' : '' }).text(function (t) { var e = a(t); return e ? e.name : '' }), n.append('line').attr('class', 'place-label-link-' + t).attr('stroke', 'gray').attr('stroke-width', 0.25).attr('x1', function (t) { var e = a(t); return e && e.isRef ? e.sx : 0 }).attr('y1', function (t) { var e = a(t); return e && e.isRef ? e.sy : 0 }).attr('x2', function (t) { var e = a(t); return e && e.isRef ? e.x - 0.6 * e.name.length * 5.5 : 0 }).attr('y2', function (t) { var e = a(t); return e && e.isRef ? e.y - 3.5 : 0 }) }) }), e.objects.hasOwnProperty('places')) { var o = Cr.feature(e, e.objects.places); var u = o.features.map(function (t) { var e = _(t.geometry.coordinates); return { x: e[0] + 3.5, y: e[1] + 3.5, width: 5.5 * t.properties.name.length, height: 12, name: t.properties.name } }); var l = o.features.map(function (t) { var e = _(t.geometry.coordinates); return { x: e[0], y: e[1], r: 2.5 } }); kr().label(u).anchor(l).width(m).height(y).start(100), n.selectAll('.place').data(l).enter().append('circle').attr('class', 'place').attr('transform', function (t) { return 'translate(' + t.x + ',' + t.y + ')' }).attr('r', function (t) { return t.r + 'px' }), n.selectAll('.place-label').data(u).enter().append('text').attr('class', 'place-label').attr('transform', function (t) { return 'translate(' + t.x + ',' + t.y + ')' }).text(function (t) { return t.name }) } }).merge(E); this.groupByCode = t.reduce(function (t, e) { return e.part().reduce(function (t, e) { return t[(e[p.dim] || '').toLowerCase()] = e, t }, t) }, {}); var M = this._resolveFeature.bind(this); if (S.selectAll('.map-contour-' + n).data(Cr.feature(e, e.objects[n]).features).call(function (t) { t.classed('map-contour', !0).attr('fill', function (t) { var e = M(t); return e === null ? s.defaultFill : g(e[g.dim]) }) }).on('mouseover', function (t) { return i.fire('area-mouseover', { data: M(t), event: o.event }) }).on('mouseout', function (t) { return i.fire('area-mouseout', { data: M(t), event: o.event }) }).on('click', function (t) { return i.fire('area-click', { data: M(t), event: o.event }) }), !c.dim || !f.dim) return []; var T = function (t) { return t.attr('r', function (t) { return d(t[d.dim]) }).attr('transform', function (t) { var e = t.data; return 'translate(' + _([e[f.dim], e[c.dim]]) + ')' }).attr('class', function (t) { var e = t.data; return h(e[h.dim]) }).attr('opacity', 0.5).on('mouseover', function (t) { var e = t.data; return a.fire('point-mouseover', { data: e, event: o.event }) }).on('mouseout', function (t) { var e = t.data; return a.fire('point-mouseout', { data: e, event: o.event }) }).on('click', function (t) { var e = t.data; return a.fire('point-click', { data: e, event: o.event }) }) }; var C = S.selectAll('.frame').data(t.map(function (t) { return { tags: t.key || {}, hash: t.hash(), data: t.part() } }), function (t) { return t.hash }); return C.exit().remove(), C.enter().append('g').merge(C).call(function (t) { t.attr('class', function (t) { return 'frame frame-' + t.hash }).call(function (t) { var e = t.selectAll('circle').data(function (t) { return t.data.map(function (t) { return { data: t, uid: u.uid } }) }); e.exit().remove(), e.call(T), e.enter().append('circle').call(T) }) }), [] }, e.prototype._resolveFeature = function (t) { var e; var n = this.groupByCode; var r = t.properties; var i = ['c1', 'c2', 'c3', 'abbr', 'name'].filter(function (t) { return r.hasOwnProperty(t) && r[t] && n.hasOwnProperty(r[t].toLowerCase()) }); if (i.length === 0)e = null; else if (i.length > 0) { var a = r[i[0]].toLowerCase(); e = n[a] } return e }, e.prototype._highlightArea = function (t) { var e = this; var n = this.config.options.container; var r = this.contourToFill; n.selectAll('.map-contour-' + r).classed('map-contour-highlighted', function (n) { return t(e._resolveFeature(n)) }) }, e.prototype._highlightPoint = function (t) { this.config.options.container.selectAll('circle').classed('map-point-highlighted', function (e) { var n = e.data; return t(n) }).attr('opacity', function (e) { var n = e.data; return t(n) ? 0.5 : 0.1 }) }, e.prototype._createProjection = function (t, e, n) { var r = this.W; var i = this.H; var a = this.config.guide; var o = 100; var s = [r / 2, i / 2]; var u = n || t.center; var l = a.projection || t.projection || 'mercator'; var c = this._createD3Projection(l, u, o, s); var f = Pr.geoPath().projection(c).bounds(Cr.feature(t, t.objects[e])); var d = o * r / (f[1][0] - f[0][0]); var h = o * i / (f[1][1] - f[0][1]); return o = d < h ? d : h, s = [r - (f[0][0] + f[1][0]) / 2, i - (f[0][1] + f[1][1]) / 2], this._createD3Projection(l, u, o, s) }, e.prototype._createD3Projection = function (t, e, n, r) { var i = 'geo' + t.substring(0, 1).toUpperCase() + t.substring(1); var a = Pr[i]; if (!a) throw console.log('Unknown projection "' + t + '"'), console.log('See available projection types here: https://github.com/mbostock/d3/wiki/Geo-Projections'), new Error('Invalid map: unknown projection "' + t + '"'); var o = a(); return [{ method: 'scale', args: n }, { method: 'center', args: e }, { method: 'translate', args: r }].filter(function (t) { return t.args }).reduce(function (t, e) { return t[e.method] && (t = t[e.method](e.args)), t }, o) }, e }(g)); var Rr = function (t) { return function () { return t } }; var Fr = (function () { function t (t) { this.model = t.model, this.x = t.x || Rr(0), this.y = t.y || Rr(0), this.dx = t.dx || Rr(0), this.dy = t.dy || Rr(0), this.w = t.w || Rr(0), this.h = t.h || Rr(0), this.hide = t.hide || Rr(!1), this.label = t.label || Rr(''), this.color = t.color || Rr(''), this.angle = t.angle || Rr(0), this.labelLinesAndSeparator = t.labelLinesAndSeparator || Rr({ lines: [], linesWidths: [], separator: '' }) } return t.seed = function (e, n) { var r = n.fontColor; var i = n.flip; var a = n.formatter; var o = n.labelRectSize; var s = n.paddingKoeff; var u = void 0 === s ? 0.5 : s; var l = n.lineBreakAvailable; var c = n.lineBreakSeparator; var f = i ? e.yi : e.xi; var d = i ? e.xi : e.yi; var h = function (t) { return a(e.label(t)) }; var p = function (t) { var e = l ? h(t).split(c) : [h(t)]; return { lines: e, linesWidths: e.map(function (t) { return o([t]).width }), separator: c } }; return new t({ model: e, x: function (t) { return f(t) }, y: function (t) { return d(t) }, dy: function (t) { return o(p(t).lines).height * u }, w: function (t) { return o(p(t).lines).width }, h: function (t) { return o(p(t).lines).height }, label: h, labelLinesAndSeparator: p, color: function () { return r }, angle: function () { return 0 } }) }, t.compose = function (e, n) { return void 0 === n && (n = {}), Object.keys(n).reduce(function (t, e) { return t[e] = n[e], t }, new t(e)) }, t }()); var Dr = {}; var Ir = (function () { function t () {} return t.regRule = function (t, e) { return Dr[t] = e, this }, t.getRule = function (t) { return Dr[t] }, t }()); var jr = function (t, e) { var n = t.lines; var r = t.linesWidths; var i = t.separator; return n.map(function (t, n) { var i = (function (t, e, n) { return n < e ? Math.max(1, Math.floor(n * t.length / e)) - 1 : t.length }(t, r[n], e)); return i < t.length ? (function (t, e) { return e === 0 ? '' : t.slice(0, e).replace(/\.+$/g, '') + '' }(t, i)) : t }).join(i) }; var zr = function (t, e) { var n = 5 - (t.labelLinesAndSeparator(e).lines.length - 1); return n < 1 ? 1 : n }; var Br = function (t, e) { return t.discrete || !t.discrete && e[t.dim] >= 0 }; var Vr = function (t, e) { return !t.discrete && e[t.dim] < 0 }; var Hr = function (t, e) { return t.w(e) / 2 + Math.floor(t.model.size(e) / zr(t, e)) }; var Wr = function (t, e) { return t.h(e) / 2 + Math.floor(t.model.size(e) / zr(t, e)) }; var Gr = function (t) { return function (e) { return { dx: function (n) { var r = e.model.scaleY; if (t[2] === '+' && !Br(r, n)) return e.dx(n); if (t[2] === '-' && !Vr(r, n)) return e.dx(n); var i = t[1]; var a = t[0] === t[0].toUpperCase() ? 1 : 0; return e.dx(n) + i * a * e.model.size(n) / 2 + i * Hr(e, n) } } } }; var Ur = function (t) { return function (e) { return { dy: function (n) { var r = e.model.scaleY; if (t[2] === '+' && !Br(r, n)) return e.dy(n); if (t[2] === '-' && !Vr(r, n)) return e.dy(n); var i = t[1]; var a = t[0] === t[0].toUpperCase() ? 1 : 0; return e.dy(n) + i * a * e.model.size(n) / 2 + i * Wr(e, n) } } } }; Ir.regRule('l', Gr(['l', -1, null])).regRule('L', Gr(['L', -1, null])).regRule('l+', Gr(['l', -1, '+'])).regRule('l-', Gr(['l', -1, '-'])).regRule('L+', Gr(['L', -1, '+'])).regRule('L-', Gr(['L', -1, '-'])).regRule('r', Gr(['r', 1, null])).regRule('R', Gr(['R', 1, null])).regRule('r+', Gr(['r', 1, '+'])).regRule('r-', Gr(['r', 1, '-'])).regRule('R+', Gr(['R', 1, '+'])).regRule('R-', Gr(['R', 1, '-'])).regRule('t', Ur(['t', -1, null])).regRule('T', Ur(['T', -1, null])).regRule('t+', Ur(['t', -1, '+'])).regRule('t-', Ur(['t', -1, '-'])).regRule('T+', Ur(['T', -1, '+'])).regRule('T-', Ur(['T', -1, '-'])).regRule('b', Ur(['b', 1, null])).regRule('B', Ur(['B', 1, null])).regRule('b+', Ur(['b', 1, '+'])).regRule('b-', Ur(['b', 1, '-'])).regRule('B+', Ur(['B', 1, '+'])).regRule('B-', Ur(['B', 1, '-'])).regRule('rotate-on-size-overflow', function (t, e) { var n = e.data; var r = e.lineBreakAvailable; var i = {}; if (n.reduce(function (e, n) { return e + ((function (e) { return t.model.size(e) < t.w(e) }(n)) ? 1 : 0) }, 0) / n.length > 0.5) { var a = r ? -0.5 : 0.5; i = { angle: function () { return -90 }, w: function (e) { return t.h(e) }, h: function (e) { return t.w(e) }, dx: function (e) { return t.h(e) * a - 2 }, dy: function () { return 0 } } } return i }).regRule('hide-by-label-height-vertical', function (t) { return { hide: function (e) { var n, r; return t.angle(e) === 0 ? (r = t.h(e), n = Math.abs(t.model.y0(e) - t.model.yi(e))) : (r = t.w(e), n = t.model.size(e)), r > n || t.hide(e) } } }).regRule('cut-label-vertical', function (t) { return { h: function (e) { var n = t.h(e); if (Math.abs(t.angle(e)) > 0) { var r = Math.abs(t.model.y0(e) - t.model.yi(e)); return r < n ? r : n } return n }, w: function (e) { var n = t.w(e); if (t.angle(e) === 0) { var r = t.model.size(e); return r < n ? r : n } return n }, label: function (e) { var n; return n = t.angle(e) === 0 ? t.model.size(e) : Math.abs(t.model.y0(e) - t.model.yi(e)), jr(t.labelLinesAndSeparator(e), n) }, dy: function (e) { var n = t.dy(e); if (t.angle(e) !== 0) { var r = t.h(e); var i = Math.abs(t.model.y0(e) - t.model.yi(e)); return i < r ? i * n / r : n } return n } } }).regRule('cut-outer-label-vertical', function (t) { return { h: function (e, n) { var r = t.h(e); if (Math.abs(t.angle(e)) > 0) { var i = t.model.y0(e) < t.model.yi(e) ? n.maxHeight - t.model.yi(e) : t.model.yi(e); return i < r ? i : r } return r }, w: function (e) { var n = t.w(e); if (t.angle(e) === 0) { var r = t.model.size(e); return r < n ? r : n } return n }, label: function (e, n) { var r; return r = t.angle(e) === 0 ? t.model.size(e) : t.model.y0(e) < t.model.yi(e) ? n.maxHeight - t.model.yi(e) : t.model.yi(e), jr(t.labelLinesAndSeparator(e), r) }, dy: function (e, n) { var r = t.dy(e); if (t.angle(e) !== 0) { var i = t.h(e); var a = t.model.y0(e) < t.model.yi(e) ? n.maxHeight - t.model.yi(e) : t.model.yi(e); return a < i ? a * r / i : r } return r } } }).regRule('from-beginning', function (t) { var e = function (e) { return t.model.y0(e) }; return t.model.flip ? { x: e } : { y: e } }).regRule('to-end', function (t) { var e = function (e) { return t.model.yi(e) }; return t.model.flip ? { x: e } : { y: e } }).regRule('towards', function (t) { var e = t.model.flip ? Hr : Wr; var n = function (n) { return (function (t, e) { return t.model.yi(e) - t.model.y0(e) >= 0 ? 1 : -1 }(t, n)) * e(t, n) }; return t.model.flip ? { dx: n } : { dy: n } }).regRule('inside-start-then-outside-end-horizontal', function (t, e) { var n = [Ir.getRule('from-beginning'), Ir.getRule('towards'), Ir.getRule('cut-label-horizontal')].reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); var r = [Ir.getRule('to-end'), Ir.getRule('towards'), Ir.getRule('cut-outer-label-horizontal')].reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); return Object.assign({}, n, ['x', 'dx', 'hide', 'label'].reduce(function (t, e) { return t[e] = function (t) { return ((function (t) { return n.label(t).length >= r.label(t).length }(t)) ? n : r)[e](t) }, t }, {})) }).regRule('inside-start-then-outside-end-vertical', function (t, e) { var n = [Ir.getRule('from-beginning'), Ir.getRule('towards'), Ir.getRule('cut-label-vertical')].reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); var r = [Ir.getRule('to-end'), Ir.getRule('towards'), Ir.getRule('cut-outer-label-vertical')].reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); return Object.assign({}, n, ['y', 'dy', 'hide', 'label'].reduce(function (t, e) { return t[e] = function (t) { return ((function (t) { return n.label(t).length >= r.label(t).length }(t)) ? n : r)[e](t) }, t }, {})) }).regRule('outside-then-inside-horizontal', function (t, e) { var n = ['r+', 'l-', 'cut-outer-label-horizontal'].map(Ir.getRule).reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); var r = ['r-', 'l+', 'hide-by-label-height-horizontal', 'cut-label-horizontal'].map(Ir.getRule).reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); return Object.assign({}, n, ['x', 'dx', 'hide', 'label'].reduce(function (t, e) { return t[e] = function (t) { return ((function (t) { return r.label(t).length > n.label(t).length }(t)) ? r : n)[e](t) }, t }, {})) }).regRule('outside-then-inside-vertical', function (t, e) { var n = ['t+', 'b-', 'cut-outer-label-vertical'].map(Ir.getRule).reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); var r = ['t-', 'b+', 'hide-by-label-height-vertical', 'cut-label-vertical'].map(Ir.getRule).reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, t); return Object.assign({}, n, ['y', 'dy', 'hide', 'label'].reduce(function (t, i) { return t[i] = function (t) { return ((function (t) { var r = n.y(t, e) + n.dy(t, e); return r <= 0 || r >= e.maxHeight }(t)) ? r : n)[i](t, e) }, t }, {})) }).regRule('hide-by-label-height-horizontal', function (t) { return { hide: function (e) { return t.model.size(e) < t.h(e) || t.hide(e) } } }).regRule('cut-label-horizontal', function (t) { return { dx: function (e) { var n = t.w(e); var r = Math.abs(t.model.y0(e) - t.model.yi(e)); var i = t.dx(e); return r < n ? r * i / n : i }, w: function (e) { var n = t.w(e); var r = Math.abs(t.model.y0(e) - t.model.yi(e)); return r < n ? r : n }, label: function (e) { var n = Math.abs(t.model.y0(e) - t.model.yi(e)); return jr(t.labelLinesAndSeparator(e), n) } } }).regRule('cut-outer-label-horizontal', function (t, e) { return { dx: function (n) { var r = t.w(n); var i = t.model.y0(n) < t.model.yi(n) ? e.maxWidth - t.model.yi(n) : t.model.yi(n); var a = t.dx(n); return i < r ? i * a / r : a }, w: function (n) { var r = t.w(n); var i = t.model.y0(n) < t.model.yi(n) ? e.maxWidth - t.model.yi(n) : t.model.yi(n); return i < r ? i : r }, label: function (n) { var r = t.model.y0(n) < t.model.yi(n) ? e.maxWidth - t.model.yi(n) : t.model.yi(n); return jr(t.labelLinesAndSeparator(n), r) } } }).regRule('keep-within-diameter-or-top', function (t) { return { dy: function (e) { return t.model.size(e) / t.w(e) < 1 ? t.dy(e) - t.h(e) / 2 - t.model.size(e) / 2 : t.dy(e) } } }).regRule('keep-in-box', function (t, e) { var n = e.maxWidth; var r = e.maxHeight; return { dx: function (e) { var r = t.dx(e); var i = t.x(e) + r; var a = t.w(e); var o = i + a / 2; var s = 0 - (i - a / 2); if (s > 0) return r + s; var u = o - n; return u > 0 ? r - u : r }, dy: function (e) { var n = t.dy(e); var i = t.y(e) + n; var a = t.h(e); var o = i + a / 2; if (0 - (i - a / 2) > 0) return 0; var s = o - r; return s > 0 ? n - s : n } } }).regRule('multiline-label-left-align', function (t) { return { dy: function (e) { var n = t.dy(e); return t.angle(e) === -90 ? n + t.h(e) / 2 : n } } }).regRule('multiline-label-vertical-center-align', function (t) { return { dy: function (e) { return t.dy(e) - t.h(e) / 2 } } }).regRule('multiline-hide-on-container-overflow', function (t, e) { var n = e.maxWidth; var r = e.maxHeight; return { hide: function (e) { var i = t.angle(e); var a = t.x(e) + t.dx(e); var o = t.y(e) + t.dy(e); return !(!Gt(a, t.w(e), i, n) && !Ut(o, t.h(e), i, r)) || t.hide(e) } } }); var Xr = (function () { function t (t) { this.minError = Number.MAX_VALUE, this.items = t.items, this.revision = this.items.map(function (t) { return { i: t.i, x: t.x, y: t.y } }), this.penalties = t.penalties, this.transactor = t.transactor, this.cooling_schedule = t.cooling_schedule || function (t, e, n) { return t - e / n } } return t.prototype.energy = function (t) { return this.penalties.reduce(function (e, n) { return e + n(t) }, 0) }, t.prototype.move = function (t) { var e = Math.floor(Math.random() * this.items.length); var n = this.transactor(this.items[e]); var r = this.energy(e); this.items[e] = n.modify(); var i = this.energy(e); var a = i - r; var o = a < 0 ? 1 : Math.exp(-a / t); Math.random() >= o ? this.items[e] = n.revert() : i < this.minError && (this.minError = i, this.revision = this.items.map(function (t) { return { i: t.i, x: t.x, y: t.y } })) }, t.prototype.start = function (t) { var e = 1; var n = this.items.length; t:for (var r = 0; r < t; r++) { for (var i = 0; i < n; i++) if (this.move(e), this.minError <= 10) break t; e = this.cooling_schedule(e, 1, t) } return this.revision }, t }()); var qr = function (t, e, n, r, i, a, o, s) { return Re(t, i, e, a, n, o, r, s) }; var Yr = {}; var $r = (function () { function t () {} return t.reg = function (t, e) { return Yr[t] = e, this }, t.get = function (t) { return Yr[t] }, t }()); $r.reg('auto:avoid-label-label-overlap', function (t, e, n) { return void 0 === n && (n = 1), function (e) { var r = t[e].x; var i = t[e].y - t[e].h + 2; var a = t[e].x + t[e].w; var o = t[e].y + 2; return t.reduce(function (t, s, u) { var l = Number(u !== e); var c = s.x; var f = s.y - s.h + 2; var d = s.x + s.w; var h = s.y + 2; return t + l * (Math.max(0, Math.min(d, a) - Math.max(c, r)) * Math.max(0, Math.min(h, o) - Math.max(f, i)) * n) }, 0) } }).reg('auto:avoid-label-anchor-overlap', function (t, e, n) { return void 0 === n && (n = 1), function (e) { var r = t[e]; var i = r.x - r.w / 2; var a = r.x + r.w / 2; var o = r.y - r.h / 2 + 2; var s = r.y + r.h / 2 + 2; return t.reduce(function (t, e) { var r = e.x0 - e.size / 2; var u = e.x0 + e.size / 2; var l = e.y0 - e.size / 2; var c = e.y0 + e.size / 2; return t + Math.max(0, Math.min(u, a) - Math.max(r, i)) * Math.max(0, Math.min(c, s) - Math.max(l, o)) * n }, 0) } }).reg('auto:avoid-label-edges-overlap', function (t, e, n) { return void 0 === n && (n = 1), function (r) { var i = t[r]; var a = i.x - i.w / 2; var o = i.x + i.w / 2; var s = i.y - i.h / 2; var u = i.y + i.h / 2; return e.reduce(function (t, e) { var r = qr(a, o, e.x0, e.x1, s, u, e.y0, e.y1); var i = qr(a, o, e.x0, e.x1, u, s, e.y0, e.y1); return t + (Number(r) + Number(i)) * n }, 0) } }); var Kr = function (t, e, n, r, i, a, o, s) { return Re(t, i, e, a, n, o, r, s) }; var Jr = (function () { function t (t, e, n, r) { var i = r.width; var a = r.height; var o = r.container; this.container = o, this.model = t, this.flip = e, this.w = i, this.h = a, this.guide = Jt(n || {}, { fontFamily: 'Helvetica Neue, Segoe UI, Open Sans, Ubuntu, sans-serif', fontWeight: 'normal', fontSize: 10, fontColor: '#000', hideEqualLabels: !1, lineBreak: !1, lineBreakSeparator: '', position: [], tickFormat: null, tickFormatNullAlias: '' }) } return t.prototype.draw = function (t) { var e = this; var n = this.model; var r = this.guide; var i = r.lineBreak; var a = r.lineBreakSeparator; var s = Fr.seed(n, { fontColor: r.fontColor, flip: e.flip, formatter: wn.get(r.tickFormat, r.tickFormatNullAlias), labelRectSize: function (t) { return we(t, r) }, lineBreakAvailable: i, lineBreakSeparator: a, paddingKoeff: i ? 0 : 0.5 }); var u = { lineBreakAvailable: i, maxWidth: e.w, maxHeight: e.h, data: t.reduce(function (t, e) { return t.concat(e) }, []) }; var l = this.applyFixedPositionRules(r, u, s, i, this.flip); var c = t.reduce(function (t, e) { var n = e.map(function (t) { return { data: t, x: l.x(t) + l.dx(t), y: l.y(t) + l.dy(t), w: l.w(t), h: l.h(t, u), hide: l.hide(t), extr: null, size: l.model.size(t), angle: l.angle(t), label: l.label(t), labelLinesAndSeparator: l.labelLinesAndSeparator(t), color: l.color(t) } }); return t.text = t.text.concat(n), t.edges = t.edges.concat(function (t, e) { for (var n = t.length - 1, r = [], i = 0; i <= n; i++) { var a = i === 0 ? i : i - 1; var o = i; var s = i === n ? i : i + 1; r.push(e(t[a], t[o], t[s])) } return r }(n, function (t, e, n) { return e.y === Math.max(e.y, t.y, n.y) ? e.extr = 'min' : e.y === Math.min(e.y, t.y, n.y) ? e.extr = 'max' : e.extr = 'norm', { x0: t.x, x1: e.x, y0: t.y, y1: e.y } })), t }, { text: [], edges: [] }); c.text = c.text.filter(function (t) { return t.label }).map(function (t, e) { return Object.assign(t, { i: e }) }); var f = i ? ['auto:hide-on-label-label-overlap', 'auto:adjust-on-multiline-label-overflow'] : this.guide.position; var d = f.filter(function (t) { return t.indexOf('auto:avoid') === 0 }); c = c.text.length > 0 && d.length > 0 ? this.autoPosition(c, d) : c; var h = f.reduce(function (t, e) { var n; return Object.assign(t, ((n = {})[e] = !0, n)) }, {}); c.text = c.text = h['auto:adjust-on-label-overflow'] ? this.adjustOnOverflow(c.text, u) : c.text, c.text = c.text = h['auto:adjust-on-multiline-label-overflow'] ? this.adjustOnMultilineOverflow(c.text, u) : c.text, c.text = h['auto:hide-on-label-edges-overlap'] ? this.hideOnLabelEdgesOverlap(c.text, c.edges) : c.text, c.text = h['auto:hide-on-label-label-overlap'] ? this.hideOnLabelLabelOverlap(c.text) : c.text, c.text = h['auto:hide-on-label-anchor-overlap'] ? this.hideOnLabelAnchorOverlap(c.text) : c.text; var p = c.text; var g = function (t) { return function (e, n) { return p[n][t] } }; var m = g('x'); var y = g('y'); var v = g('angle'); var b = g('color'); var x = g('label'); var _ = function (t) { if (t.style('fill', b).style('font-size', e.guide.fontSize + 'px').style('display', function (t, e) { return p[e].hide ? 'none' : null }).attr('class', 'i-role-label').attr('text-anchor', 'middle').attr('transform', function (t, e) { return 'translate(' + m(t, e) + ',' + y(t, e) + ') rotate(' + v(t, e) + ')' }), i) { t.each(function (t, e) { var n = o.select(this); var r = v(t, e); n.text(null), x(t, e).split(a).forEach(function (t, e) { n.append('tspan').attr('text-anchor', r !== 0 ? 'start' : 'middle').attr('x', 0).attr('y', 0).attr('dy', 1.2 * (e + 1) + 'em').text(t) }) }) } else t.text(x) }; r.hideEqualLabels && p.filter(function (t) { return !t.hide }).filter(function (t, e, n) { return e < n.length - 1 && t.label === n[e + 1].label }).forEach(function (t) { return t.hide = !0 }); var w = this.container.selectAll('.i-role-label').data(p.map(function (t) { return t.data })); return w.exit().remove(), w.call(_), w.enter().append('text').call(_), w }, t.prototype.applyFixedPositionRules = function (t, e, n, r, i) { var a = t.position.filter(function (t) { return t.indexOf('auto:') === -1 }); return r && (i && a.push('multiline-label-vertical-center-align'), a.push('multiline-label-left-align', 'multiline-hide-on-container-overflow')), a.map(Ir.getRule).reduce(function (t, n) { return Fr.compose(t, n(t, e)) }, n) }, t.prototype.autoPosition = function (t, e) { var n = function (t, e) { var n = 4 + (t.size + t.w) / 2; var r = 2 + (t.size + t.h) / 2; return { x: n * Math.cos(e), y: r * Math.sin(e) } }; var r = t.edges; var i = t.text.map(function (t) { var e = { max: -Math.PI / 2, min: Math.PI / 2, norm: Math.random() * Math.PI * 2 }; var r = n(t, e[t.extr]); return { i: t.i, x0: t.x, y0: t.y, x: t.x + r.x, y: t.y + r.y, w: t.w, h: t.h, size: t.size, hide: t.hide, extr: t.extr } }).filter(function (t) { return !t.hide }); var a = new Xr({ items: i, transactor: function (t) { var e = t.x; var r = t.y; return { modify: function () { var e = { max: -Math.PI, min: Math.PI, norm: 2 * Math.PI }[t.extr]; var r = e / 4 + Math.random() * (2 * e) / 4; var i = n(t, r); return t.x = t.x0 + i.x, t.y = t.y0 + i.y, t }, revert: function () { return t.x = e, t.y = r, t } } }, penalties: e.map(function (t) { return $r.get(t) }).filter(function (t) { return t }).map(function (t) { return t(i, r) }) }).start(5); return t.text = a.reduce(function (t, e) { var n = t[e.i]; return n.x = e.x, n.y = e.y, t }, t.text), t }, t.prototype.hideOnLabelEdgesOverlap = function (t, e) { var n = this; return t.filter(function (t) { return !t.hide }).forEach(function (t) { (function (t, e) { var r = n.getLabelRect(t); return e.reduce(function (t, e) { var n = Kr(r.x0, r.x1, e.x0, e.x1, r.y0, r.y1, e.y0, e.y1); var i = Kr(r.x0, r.x1, e.x0, e.x1, r.y1, r.y0, e.y0, e.y1); return t + 2 * (Number(n) + Number(i)) }, 0) })(t, e) > 0 && (t.hide = !0) }), t }, t.prototype.hideOnLabelLabelOverlap = function (t) { var e = this; var n = { min: 0, max: 1, norm: 2 }; var r = { 'min/min': function (t, e) { return e.y - t.y }, 'max/max': function (t, e) { return t.y - e.y }, 'min/max': function () { return -1 }, 'min/norm': function () { return -1 }, 'max/norm': function () { return -1 }, 'norm/norm': function (t, e) { return t.y - e.y } }; return t.filter(function (t) { return !t.hide }).sort(function (t, e) { return n[t.extr] - n[e.extr] }).forEach(function (i) { t.forEach(function (t) { i.i !== t.i && (function (t, i) { var a = e.getLabelRect(t); var o = e.getLabelRect(i); var s = Number(!t.hide && !i.hide); if (s * Math.max(0, Math.min(o.x1, a.x1) - Math.max(a.x0, o.x0)) * (s * Math.max(0, Math.min(o.y1, a.y1) - Math.max(a.y0, o.y0))) > 0) { var u = [t, i]; u.sort(function (t, e) { return n[t.extr] - n[e.extr] }), (r[u[0].extr + '/' + u[1].extr](u[0], u[1]) < 0 ? u[0] : u[1]).hide = !0 } }(i, t)) }) }), t }, t.prototype.getLabelRect = function (t, e) { return void 0 === e && (e = 0), { x0: t.x - t.w / 2 - e, x1: t.x + t.w / 2 + e, y0: t.y - t.h / 2 - e, y1: t.y + t.h / 2 + e } }, t.prototype.getPointRect = function (t, e) { return void 0 === e && (e = 0), { x0: t.x - t.size / 2 - e, x1: t.x + t.size / 2 + e, y0: t.y - t.size / 2 - e, y1: t.y + t.size / 2 + e } }, t.prototype.hideOnLabelAnchorOverlap = function (t) { var e = this; var n = function (t, n) { var r = e.getLabelRect(t, 2); var i = e.getPointRect(n, 2); return Math.max(0, Math.min(i.x1, r.x1) - Math.max(i.x0, r.x0)) * Math.max(0, Math.min(i.y1, r.y1) - Math.max(i.y0, r.y0)) > 0.001 }; return t.filter(function (t) { return !t.hide }).forEach(function (e) { for (var r = t.length, i = 0; i < r; i++) { var a = t[i]; if (e.i !== a.i && n(e, a)) { e.hide = !0; break } } }), t }, t.prototype.adjustOnOverflow = function (t, e) { var n = e.maxWidth; var r = e.maxHeight; return t.map(function (t) { return t.hide || (t.x = Math.min(Math.max(t.x, t.w / 2), n - t.w / 2), t.y = Math.max(Math.min(t.y, r - t.h / 2), t.h / 2)), t }) }, t.prototype.adjustOnMultilineOverflow = function (t, e) { var n = e.maxWidth; return t.map(function (t) { return t.hide || t.angle !== 0 || (t.x = Math.min(Math.max(t.x, t.w / 2), n - t.w / 2)), t }) }, t }()); var Qr = n(13); var Zr = function () { return (Zr = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var ti = Zr({}, Qr, o); var ei = { init: function (t) { var e = Object.assign({}, t); e.guide = Jt(e.guide || {}, { animationSpeed: 0, avoidScalesOverflow: !0, enableColorToBarPosition: !1, maxHighlightDistance: 32 }), e.guide.size = e.guide.size || {}, e.guide.label = Jt(e.guide.label || {}, { position: ['auto:avoid-label-label-overlap', 'auto:avoid-label-anchor-overlap', 'auto:adjust-on-label-overflow', 'auto:hide-on-label-label-overlap', 'auto:hide-on-label-anchor-overlap'] }); var n = e.guide.avoidScalesOverflow; var r = e.guide.enableColorToBarPosition; return e.transformRules = [function (t) { var e = [t.scaleX, t.scaleY].sort(function (t, e) { var n = t.discrete ? 1 : 0; return (e.discrete ? 1 : 0) * e.domain().length - n * t.domain().length })[0]; return t.scaleY === e ? S.get('flip')(t) : S.get('identity')(t) }, e.stack && S.get('stack'), r && S.get('positioningByColor')].filter(function (t) { return t }), e.adjustRules = [e.stack && S.get('adjustYScale'), function (t, n) { var r = t.scaleSize.isEmptyScale(); var i = Jt(e.guide.size, { defMinSize: 10, defMaxSize: r ? 10 : 40, enableDistributeEvenly: !r }); var a = Object.assign({}, n, { defMin: i.defMinSize, defMax: i.defMaxSize, minLimit: i.minSize, maxLimit: i.maxSize }); return (i.enableDistributeEvenly ? S.get('adjustSigmaSizeScale') : S.get('adjustStaticSizeScale'))(t, a) }, n && function (t, e) { var n = Object.assign({}, e, { sizeDirection: 'xy' }); return S.get('avoidScalesOverflow')(t, n) }].filter(function (t) { return t }), e }, addInteraction: function () { var t = this; var e = this.node(); e.on('highlight', function (e, n) { return t.highlight(n) }), e.on('data-hover', function (e, n) { return t.highlight(function (t, e) { return function (n) { return n === t || e } }(n.data, null)) }) }, draw: function () { var t = this.node(); var e = t.config; var n = e.options; n.container = n.slot(e.uid); var r = function (t) { return et(t, e.guide.animationSpeed) }; var i = Ue + 'dot dot i-role-element i-role-datum'; var a = t.screenModel; var o = { fill: function (t) { return a.color(t) }, class: function (t) { return i + ' ' + a.class(t) } }; var s = { r: function (t) { return Math.round(1e4 * a.size(t) / 2) / 1e4 }, cx: function (t) { return a.x(t) }, cy: function (t) { return a.y(t) } }; var u = []; var l = a.toFibers(); this._getGroupOrder = (function () { var t = l.reduce(function (t, e, n) { return t.set(e, n), t }, new Map()); return function (e) { return t.get(e) } }()); var c = n.container.selectAll('.frame').data(l, function (t) { return a.group(t[0]) }); c.enter().append('g').attr('opacity', 0).merge(c).call(function (e) { e.attr('class', 'frame').call(function (e) { var n = e.selectAll('circle').data(function (t) { return t }, a.id); var i = n.enter().append('circle').call(lt(s)).merge(n).call(lt(o)); r(i).call(lt(s)), r(n.exit()).attr('r', 0).remove(), u.push.apply(u, i.nodes()), t.subscribe(i) }), r(e).attr('opacity', 1) }); this._boundsInfo = this._getBoundsInfo(u), r(c.exit()).attr('opacity', 0).remove().selectAll('circle').attr('r', 0), t.subscribe(new Jr(a.model, a.flip, e.guide.label, n).draw(l)) }, _getBoundsInfo: function (t) { if (t.length === 0) return null; var e = this.node().screenModel; var n = t.map(function (t) { var n = ti.select(t).data()[0]; return { node: t, data: n, x: e.x(n), y: e.y(n), r: e.size(n) / 2 } }).filter(function (t) { return !isNaN(t.x) && !isNaN(t.y) }); var r = n.reduce(function (t, e) { var n = e.x; var r = e.y; return t.left = Math.min(n, t.left), t.right = Math.max(n, t.right), t.top = Math.min(r, t.top), t.bottom = Math.max(r, t.bottom), t }, { left: Number.MAX_VALUE, right: Number.MIN_VALUE, top: Number.MAX_VALUE, bottom: Number.MIN_VALUE }); var i = n.reduce(function (t, e) { var n = e.x + ',' + e.y; return t[n] || (t[n] = []), t[n].push(e), t }, {}); return { bounds: r, tree: ti.quadtree().x(function (t) { return t[0].x }).y(function (t) { return t[0].y }).addAll(Object.keys(i).map(function (t) { return i[t] })) } }, getClosestElement: function (t, e) { if (!this._boundsInfo) return null; var n = this._boundsInfo; var r = n.bounds; var i = n.tree; var a = Fe(this.node().config.options.container.node()); var o = t - a.x; var s = e - a.y; var u = this.node().config.guide.maxHighlightDistance; if (o < r.left - u || o > r.right + u || s < r.top - u || s > r.bottom + u) return null; var l = (i.find(o, s) || []).map(function (t) { var e = Math.sqrt(Math.pow(o - t.x, 2) + Math.pow(s - t.y, 2)); if (e > u) return null; var n = e < t.r ? t.r - e : e; return { node: t.node, data: t.data, x: t.x, y: t.y, distance: e, secondaryDistance: n } }).filter(function (t) { return t }).sort(function (t, e) { return t.secondaryDistance - e.secondaryDistance }); var c = l.findIndex(function (t) { return t.distance !== l[0].distance || t.secondaryDistance !== l[0].secondaryDistance }); var f = c < 0 ? l : l.slice(0, c); if (f.length === 1) return f[0]; var d = f.reduce(function (t, e) { return t + e.x }, 0) / f.length; var h = f.reduce(function (t, e) { return t + e.y }, 0) / f.length; var p = Math.atan2(h - s, d - o) + Math.PI; return f[Math.round((f.length - 1) * p / 2 / Math.PI)] }, highlight: function (t) { var e; var n = this.node().config.options.container; var r = ((e = {})['tau-chart__highlighted'] = function (e) { return !0 === t(e) }, e['tau-chart__dimmed'] = function (e) { return !1 === t(e) }, e); n.selectAll('.dot').call(ct(r)), n.selectAll('.i-role-label').call(ct(r)), this._sortElements(t) }, _sortElements: function (t) { var e = this; var n = this.node().config.options.container; var r = new Map(); var i = new Map(); n.selectAll('.frame').each(function (e) { r.set(this, e.some(t)), i.set(this, e) }); var a = te(function (t, e) { return r.get(t) - r.get(e) }, function (t, n) { return e._getGroupOrder(i.get(t)) - e._getGroupOrder(i.get(n)) }); Ce(n.node(), function (t, e) { return t.tagName === 'g' && e.tagName === 'g' ? a(t, e) : t.tagName.localeCompare(e.tagName) }), De(n, '.dot', t) } }; var ni = n(9); var ri = 'taucharts_synthetic_record'; function ii (t) { return !0 !== t[ri] } function ai (t) { return function (e) { var n = t.stack; var r = e.scaleX.period; var i = e.scaleY.scaleType === 'linear'; var a = !t.guide.x || t.guide.x.fillGaps == null; return !a && t.guide.x.fillGaps || a && (n || r && i) ? S.get('fillGaps')(e, { isStack: n, xPeriod: r, utc: t.guide.utcTime }) : {} } } function oi (t) { if (t.length === 0) return ''; if (t.length === 1) return ui(t[0]); for (var e = [], n = 1; n < t.length; n++)e.push(li(t[n - 1], t[n])); return e.join(' ') } function si (t) { if (t.length === 0) return ''; if (t.length === 1) return ui(t[0]); for (var e = [], n = 3; n < t.length; n += 3)e.push(ci(t[n - 3], t[n - 2], t[n - 1], t[n])); return e.join(' ') } function ui (t) { var e = t.size / 2; return ['M' + t.x + ',' + (t.y - e), 'A' + e + ',' + e + ' 0 0 1', t.x + ',' + (t.y + e), 'A' + e + ',' + e + ' 0 0 1', t.x + ',' + (t.y - e), 'Z'].join(' ') } function li (t, e) { var n = yi(t, e); return n ? ['M' + n.left[0].x + ',' + n.left[0].y, 'L' + n.left[1].x + ',' + n.left[1].y, 'A' + e.size / 2 + ',' + e.size / 2 + ' 0 ' + Number(t.size < e.size) + ' 1', n.right[1].x + ',' + n.right[1].y, 'L' + n.right[0].x + ',' + n.right[0].y, 'A' + t.size / 2 + ',' + t.size / 2 + ' 0 ' + Number(t.size > e.size) + ' 1', n.left[0].x + ',' + n.left[0].y, 'Z'].join(' ') : ui(t.size > e.size ? t : e) } function ci (t, e, n, r) { var i = (function (t, e, n, r) { var i = hi(t, r); if (i === 0 || i + t.size / 2 <= r.size / 2 || i + r.size / 2 <= t.size / 2) return null; var a = function (i) { var a = i ? [r, n, e, t] : [t, e, n, r]; var o = gi.apply(void 0, [1 / 12 * 2].concat(a)); var s = gi.apply(void 0, [0.5].concat(o.slice(0, 4))); var u = s[3]; var l = s[6]; var c = yi(a[0], u); var f = yi(u, l); var d = [c.left[0], k(0.5, c.left[1], f.left[0]), f.left[1]]; var h = [c.right[0], k(0.5, c.right[1], f.right[0]), f.right[1]]; var p = mi.apply(void 0, d)[1]; var g = mi.apply(void 0, h)[1]; var m = k(4, c.left[0], p); var y = k(4, c.right[0], g); return { left: i ? [y, h[0]] : [d[0], m], right: i ? [m, d[0]] : [h[0], y] } }; var o = a(!1); var s = a(!0); return { left: o.left.concat(s.left), right: o.right.concat(s.right) } }(t, e, n, r)); if (!i) return li(t, r); var a = di(fi(t, i.right[0]), fi(t, i.left[0])); var o = di(fi(r, i.right[1]), fi(r, i.left[1])); return ['M' + i.left[0].x + ',' + i.left[0].y, 'C' + i.left[1].x + ',' + i.left[1].y, i.left[2].x + ',' + i.left[2].y, i.left[3].x + ',' + i.left[3].y, 'A' + r.size / 2 + ',' + r.size / 2 + ' 0 ' + Number(a > Math.PI) + ' 1', i.right[3].x + ',' + i.right[3].y, 'C' + i.right[2].x + ',' + i.right[2].y, i.right[1].x + ',' + i.right[1].y, i.right[0].x + ',' + i.right[0].y, 'A' + t.size / 2 + ',' + t.size / 2 + ' 0 ' + Number(o > Math.PI) + ' 1', i.left[0].x + ',' + i.left[0].y, 'Z'].join(' ') } function fi (t, e) { return Math.atan2(e.y - t.y, e.x - t.x) } function di (t, e) { return e < t && (e += 2 * Math.PI), e - t } function hi () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; for (var n = 0, r = 1; r < t.length; r++)n += Math.sqrt((t[r].x - t[r - 1].x) * (t[r].x - t[r - 1].x) + (t[r].y - t[r - 1].y) * (t[r].y - t[r - 1].y)); return n } function pi (t, e, n) { return { x: t.x + e * Math.cos(n), y: t.y + e * Math.sin(n) } } function gi (t, e, n, r, i) { var a = A(t, e, n, r, i); var o = 1 / (1 + hi(a[3], a[4], a[5], a[6], a[3]) / hi(a[0], a[1], a[2], a[3], a[0])); return a[3].size = e.size * (1 - o) + i.size * o, a } function mi (t, e, n) { return [t, k(2, k(hi(t, e) / hi(t, e, n), t, n), e), n] } function yi (t, e) { var n = hi(t, e); if (n === 0 || n + t.size / 2 <= e.size / 2 || n + e.size / 2 <= t.size / 2) return null; var r = fi(t, e); var i = Math.asin((t.size - e.size) / n / 2); var a = r - Math.PI / 2 + i; var o = r + Math.PI / 2 - i; return { left: [pi(t, t.size / 2, a), pi(e, e.size / 2, a)], right: [pi(t, t.size / 2, o), pi(e, e.size / 2, o)] } } var vi = function () { return (vi = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var bi = { circle: { element: 'circle', getInitialAttrs: function (t, e) { var n = t.config.guide; var r = t.screenModel; return { r: n.showAnchors === 'hover' ? 0 : function (t) { return r.size(t) / 2 }, cx: function (t) { return e.x(t) }, cy: function (t) { return e.y(t) } } }, getHighlightAttrs: function (t, e, n) { t.config.guide; var r = t.screenModel; return { r: t.config.guide.showAnchors === 'hover' ? function (t) { return n(t) ? Math.max(4, r.size(t) / 2) : 0 } : function (t) { var e = r.size(t) / 2; return n(t) && (e = Math.max(4, Math.ceil(1.25 * e))), e } } } }, 'vertical-stick': { element: 'path', getInitialAttrs: function (t, e) { var n = t.config.guide; var r = t.screenModel; return { 'shape-rendering': 'crispEdges', d: function (t) { var i = e.x(t); var a = e.y(t); var o = e.x0(t); var s = e.y0(t); var u = n.showAnchors === 'hover' ? 0 : r.size(t) / 2; return oi([{ x: i, y: a, size: u }, { x: o, y: s, size: u }]) } } }, getHighlightAttrs: function (t, e, n) { t.config.guide; var r = t.screenModel; var i = t.config.guide.showAnchors === 'hover'; return { d: function (t) { var a = e.x(t); var o = e.y(t); var s = e.x0(t); var u = e.y0(t); var l = i ? n(t) ? Math.max(4, r.size(t) / 2) : 0 : n(t) ? Math.max(4, Math.ceil(r.size(t) / 2 * 1.25)) : r.size(t) / 2; return oi([{ x: a, y: o, size: l }, { x: s, y: u, size: l }]) } } } } }; function xi (t, e, n) { var r = n.sort(function (t, e) { return t.distance === e.distance ? t.secondaryDistance - e.secondaryDistance : t.distance - e.distance }); var i = r.findIndex(function (t) { return t.distance !== r[0].distance || t.secondaryDistance !== r[0].secondaryDistance }); var a = i < 0 ? r : r.slice(0, i); if (a.length === 1) return a[0]; var o = a.reduce(function (t, e) { return t + e.x }, 0) / a.length; var s = a.reduce(function (t, e) { return t + e.y }, 0) / a.length; var u = Math.atan2(s - e, o - t) + Math.PI; return a[Math.round((a.length - 1) * u / 2 / Math.PI)] } var _i = Ue + 'dot-line dot-line i-role-dot i-role-datum ' + Ue + 'dot'; var wi = { init: function (t) { var e = t; return e.guide = Jt(e.guide || {}, { animationSpeed: 0, cssClass: '', maxHighlightDistance: 32, widthCssClass: '', color: {}, label: {} }), e.guide.label = Jt(e.guide.label, { fontSize: 11, hideEqualLabels: !0, position: ['auto:avoid-label-label-overlap', 'auto:avoid-label-anchor-overlap', 'auto:avoid-label-edges-overlap', 'auto:adjust-on-label-overflow', 'auto:hide-on-label-label-overlap', 'auto:hide-on-label-edges-overlap'] }), e.guide.color = Jt(e.guide.color || {}, { fill: null }), ['never', 'hover', 'always'].indexOf(e.guide.showAnchors) < 0 && (e.guide.showAnchors = 'hover'), e.transformRules = [], e.adjustRules = [], e }, baseModel: function (t) { var e = { gog: t.model, x: t.x, y: t.y, x0: t.x0, y0: t.y0, size: t.size, group: t.group, order: t.order, color: t.color, class: t.class, groupAttributes: {}, pathAttributesUpdateInit: {}, pathAttributesUpdateDone: {}, pathAttributesEnterInit: {}, pathAttributesEnterDone: {}, pathElement: null, dotAttributes: { r: function (t) { return Math.round(1e4 * e.size(t) / 2) / 1e4 }, cx: function (t) { return e.x(t) }, cy: function (t) { return e.y(t) }, fill: function (t) { return e.color(t) }, class: function (t) { return _i + ' ' + e.class(t) } }, dotAttributesDefault: { r: 0, cy: function (t) { return e.y0(t) } } }; return e }, addInteraction: function () { var t = this; var e = this.node(); var n = this.node().config; e.on('highlight', function (e, n) { return t.highlight(n) }), e.on('highlight-data-points', function (e, n) { return t.highlightDataPoints(n) }), n.guide.showAnchors !== 'never' && e.on('data-hover', function (e, n) { return t.highlightDataPoints(function (t, e) { return function (n) { return n === t || e } }(n.data, null)) }) }, draw: function () { var t = this.node(); var e = t.config; var n = e.guide; var r = e.options; r.container = r.slot(e.uid); var i = t.screenModel; var a = this.buildModel(i); this.domElementModel = a; var s = ot; var u = function (r) { r.call(lt(a.groupAttributes)); var u = r.selectAll(function (t) { return t.split(/\s+/g).map(function (t) { return '.' + t }).join('') }(_i)).data(function (t) { return t.length <= 1 ? t : [] }, i.id); u.exit().call(s(n.animationSpeed, null, { r: 0 }, function (t) { return o.select(t).remove() })), u.call(s(n.animationSpeed, null, a.dotAttributes)); var l = u.enter().append('circle').call(s(n.animationSpeed, a.dotAttributesDefault, a.dotAttributes)).merge(u); t.subscribe(l); var c = r.selectAll(a.pathElement + ':not(.i-data-anchor)').data(function (t) { return t.length > 1 ? [t] : [] }, d); c.exit().remove(), c.call(s(n.animationSpeed, a.pathAttributesUpdateInit, a.pathAttributesUpdateDone, a.afterPathUpdate)); c.enter().append(a.pathElement).call(s(n.animationSpeed, a.pathAttributesEnterInit, a.pathAttributesEnterDone, a.afterPathUpdate)).merge(c).call(function (t) { e.guide.animationSpeed > 0 && !document.hidden ? (t.attr(a.pathTween.attr, function (t) { return a.pathTween.fn.call(this, t)(0) }), et(t, e.guide.animationSpeed, 'pathTransition').attrTween(a.pathTween.attr, a.pathTween.fn)) : t.attr(a.pathTween.attr, function (t) { return a.pathTween.fn.call(this, t)(1) }) }); if (t.subscribe(l), n.showAnchors !== 'never') { var f = (function (t, e, n) { var r = e.anchorShape; var i = t.config.guide; var a = t.screenModel; var o = vi({}, bi[r].getInitialAttrs(t, e), { opacity: i.showAnchors === 'hover' ? 0 : 1, fill: function (t) { return a.color(t) }, class: 'i-data-anchor' }); var s = n.selectAll('.i-data-anchor').data(function (t) { return t.filter(ii) }, a.id); return s.exit().remove(), s.call(ot(i.animationSpeed, null, o)), s.enter().append(bi[e.anchorShape].element).call(ot(i.animationSpeed, { r: 0 }, o)).merge(s) }(t, a, r)); t.subscribe(f) } }; var l = i.toFibers(); var c = l.map(function (t) { return t.filter(ii) }); var f = r.container.selectAll('.frame'); var d = (function () { var t = f.empty() ? [] : f.data(); var e = new Map(); f.each(function (t) { e.set(t, Number(this.getAttribute('data-id'))) }); var n = t.reduce(function (t, e) { return t.set(e, e.map(i.id)), t }, new Map()); var r = new Map(); var a = Math.max.apply(Math, [0].concat(Array.from(e.values()))); return function (t) { if (r.has(t)) return r.get(t); var o; var s = t.map(function (t) { return i.id(t) }); var u = (Array.from(n.entries()).find(function (t) { var e = t[1]; return s.some(function (t) { return e.some(function (e) { return e === t }) }) }) || [null])[0]; return o = u ? e.get(u) : ++a, r.set(t, o), o } }()); this._getDataSetId = d; var h = f.data(l, d); h.exit().remove(), h.call(u), h.enter().append('g').attr('data-id', d).call(u), h.order(), this._boundsInfo = this._getBoundsInfo(r.container.selectAll('.i-data-anchor').nodes()), t.subscribe(new Jr(i.model, e.flip, e.guide.label, r).draw(c)) }, _getBoundsInfo: function (t) { if (t.length === 0) return null; var e = this.node().screenModel; var n = this.node().config.flip; var r = t.map(function (t) { var n = o.select(t).data()[0]; return { node: t, data: n, x: e.x(n), y: e.y(n) } }).filter(function (t) { return !isNaN(t.x) && !isNaN(t.y) }); var i = r.reduce(function (t, e) { var n = e.x; var r = e.y; return t.left = Math.min(n, t.left), t.right = Math.max(n, t.right), t.top = Math.min(r, t.top), t.bottom = Math.max(r, t.bottom), t }, { left: Number.MAX_VALUE, right: Number.MIN_VALUE, top: Number.MAX_VALUE, bottom: Number.MIN_VALUE }); var a = qt(r.map(n ? function (t) { return t.y } : function (t) { return t.x })).sort(function (t, e) { return t - e }); var s = a.reduce(function (t, e) { return t[e] = [], t }, {}); r.forEach(function (t) { var e = a.find(n ? function (e) { return t.y === e } : function (e) { return t.x === e }); s[e].push(t) }); var u = function (t) { if (t.length === 1) return s[t[0]]; var e = Math.ceil(t.length / 2); return { middle: (t[e - 1] + t[e]) / 2, lower: u(t.slice(0, e)), greater: u(t.slice(e)) } }; return { bounds: i, tree: u(a) } }, getClosestElement: function (t, e) { if (!this._boundsInfo) return null; var n = this._boundsInfo; var r = n.bounds; var i = n.tree; var a = this.node().config.options.container; var o = this.node().config.flip; var s = Fe(a.node()); var u = this.node().config.guide.maxHighlightDistance; if (t < r.left + s.x - u || t > r.right + s.x + u || e < r.top + s.y - u || e > r.bottom + s.y + u) return null; var l = o ? e - s.y : t - s.x; var c = (function t (e) { return Array.isArray(e) ? e : t(l > e.middle ? e.greater : e.lower) }(i)).map(function (n) { var r = n.x + s.x; var i = n.y + s.y; var a = Math.abs(o ? e - i : t - r); var u = Math.abs(o ? t - r : e - i); return { node: n.node, data: n.data, distance: a, secondaryDistance: u, x: r, y: i } }); return xi(t, e, c) }, highlight: function (t) { var e; var n; var r = this.node().config.options.container; var i = 'tau-chart__highlighted'; var a = 'tau-chart__dimmed'; var o = r.selectAll('.i-role-path'); var s = o.data().filter(function (e) { return e.filter(ii).some(t) }); var u = s.length > 0; o.call(ct(((e = {})[i] = function (t) { return u && s.indexOf(t) >= 0 }, e[a] = function (t) { return u && s.indexOf(t) < 0 }, e))); var l = ((n = {})[i] = function (e) { return !0 === t(e) }, n[a] = function (e) { return !1 === t(e) }, n); r.selectAll('.i-role-dot').call(ct(l)), r.selectAll('.i-role-label').call(ct(l)), this._sortElements(t) }, highlightDataPoints: function (t) { var e = this.node(); var n = (function (t, e, n) { var r = e.anchorShape; var i = t.screenModel; var a = t.config.guide.showAnchors === 'hover'; return t.config.options.container.selectAll('.i-data-anchor').call(lt(bi[r].getHighlightAttrs(t, e, n))).attr('opacity', a ? function (t) { return n(t) ? 1 : 0 } : function () { return 1 }).attr('fill', function (t) { return i.color(t) }).attr('class', function (t) { return ke('i-data-anchor', i.class(t)) }).classed(Ue + 'highlighted', n) }(e, this.domElementModel, t)); var r = e.config.options.container; var i = e.config.flip; var a = n.filter(t); var o = r.select('.cursor-line'); if (a.empty())o.remove(); else { o.empty() && (o = r.append('line')); var s = e.screenModel.model; var u = s.xi(a.data()[0]); var l = s.xi(a.data()[0]); var c = s.scaleY.domain(); var f = s.scaleY(c[0]); var d = s.scaleY(c[1]); o.attr('class', 'cursor-line').attr('x1', i ? f : u).attr('y1', i ? u : f).attr('x2', i ? d : l).attr('y2', i ? l : d) } this._sortElements(t) }, _sortElements: function (t) { var e = this.node().config.options.container; var n = new Map(); var r = new Map(); var i = this._getDataSetId; e.selectAll('.i-role-path').each(function (e) { n.set(this, i(e)), r.set(this, e.filter(ii).some(t)) }); var a = te(function (t, e) { return r.get(t) - r.get(e) }, function (t, e) { return n.get(t) - n.get(e) }); var o = { line: 0, g: 1, text: 2 }; Ce(e.node(), function (t, e) { return t.tagName === 'g' && e.tagName === 'g' ? a(t, e) : o[t.tagName] - o[e.tagName] }) } }; var Ei = [1, 2, 3, 4, 5]; var Si = Ei.map(function (t) { return Ue + 'line-opacity-' + t }); var Mi = Ei.map(function (t) { return Ue + 'line-width-' + t }); function Ti (t) { return Si[t - 1] || Si[4] } function Ci (t, e) { return t.length < 2 ? '' : String.prototype.concat.apply('', t.concat(e.slice().reverse()).map(function (t, e) { return (e === 0 ? '' : ' ') + t.x + ',' + t.y })) } function ki (t, e) { if (t.length < 2) return ''; var n = function (t) { var e = t.map(function (t, e) { return '' + ((e - 1) % 3 == 0 ? 'C' : '') + t.x + ',' + t.y + ' ' }); return String.prototype.concat.apply('', e) }; return 'M' + n(t) + 'L' + n(e.slice().reverse()) + 'Z' } var Ai = function () { return (Ai = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Oi = Ai({}, ni, o); var Pi = { draw: wi.draw, highlight: wi.highlight, highlightDataPoints: wi.highlightDataPoints, addInteraction: wi.addInteraction, _sortElements: wi._sortElements, init: function (t) { var e = wi.init(t); var n = e.stack; return e.transformRules = [e.flip && S.get('flip'), e.guide.obsoleteVerticalStackOrder && S.get('obsoleteVerticalStackOrder'), !n && S.get('groupOrderByAvg'), ai(e), n && S.get('stack')], e.adjustRules = [function (t, n) { var r = t.scaleSize.isEmptyScale(); var i = Jt(e.guide.size || {}, { defMinSize: 2, defMaxSize: r ? 6 : 40 }); var a = Object.assign({}, n, { defMin: i.defMinSize, defMax: i.defMaxSize, minLimit: i.minSize, maxLimit: i.maxSize }); return S.get('adjustStaticSizeScale')(t, a) }], e }, buildModel: function (t) { var e = wi.baseModel(t); var n = this.node().config.guide; var r = Ti(t.model.scaleColor.domain().length); var i = Ue + 'area area i-role-path ' + r + ' ' + n.cssClass + ' '; e.groupAttributes = { class: function (t) { return i + ' ' + e.class(t[0]) + ' frame' } }; var a = { fill: function (t) { return e.color(t[0]) }, stroke: function (t) { var n = e.color(t[0]); return n.length > 0 && (n = Oi.rgb(n).darker(1)), n } }; e.pathAttributesEnterInit = a, e.pathAttributesUpdateDone = a; var o = $(n.interpolate) === 'polyline'; return e.pathElement = o ? 'polygon' : 'path', e.anchorShape = 'vertical-stick', e.pathTween = { attr: o ? 'points' : 'd', fn: ut(0, o ? Ci : ki, [function (n) { return { id: t.id(n), x: e.x(n), y: e.y(n) } }, function (n) { return { id: t.id(n), x: e.x0(n), y: e.y0(n) } }], t.id, n.interpolate) }, e }, _getBoundsInfo: function (t) { if (t.length === 0) return null; var e = this.node().screenModel; var n = this.node().config.flip; var r = t.map(function (t) { var n = Oi.select(t).data()[0]; return { node: t, data: n, x: e.x(n), y: e.y(n), y0: e.y0(n), group: e.group(n) } }); var i = r.reduce(function (t, e) { var n = e.x; var r = e.y; var i = e.y0; return t.left = Math.min(n, t.left), t.right = Math.max(n, t.right), t.top = Math.min(r, i, t.top), t.bottom = Math.max(r, i, t.bottom), t }, { left: Number.MAX_VALUE, right: Number.MIN_VALUE, top: Number.MAX_VALUE, bottom: Number.MIN_VALUE }); var a = qt(r.map(n ? function (t) { return t.y } : function (t) { return t.x })).sort(function (t, e) { return t - e }); var o = a.reduce(function (t, e) { return t[e] = [], t }, {}); if (r.forEach(function (t) { var e = a.find(n ? function (e) { return t.y === e } : function (e) { return t.x === e }); o[e].push(t) }), (function () { var t = Object.keys(r.reduce(function (t, e) { return t[e.group] = !0, t }, {})); var e = t.reduce(function (t, e, n) { return t[e] = n, t }, {}); a.forEach(function (n) { var r = o[n]; if (r.sort(function (t, n) { return e[t.group] - e[n.group] }), r.length < t.length) for (var i = 0; i < t.length; i++) { var a = !1; var s = void 0; var u = void 0; if (i === r.length ? (s = u = i === 0 ? 0 : r[i - 1].y, a = !0) : r[i].group !== t[i] && (s = u = r[i].y0, a = !0), a) { var l = { x: n, y: s, y0: u, data: null, node: null, group: t[i] }; r.splice(i, 0, l) } } }) }()), a.length === 1) return { bounds: i, tree: { start: a[0], end: a[0], isLeaf: !0, items: { start: o[a[0]], end: o[a[0]] } } }; var s = function (t) { if (t.length === 2) { var e = t[0]; var n = t[1]; return { start: e, end: n, isLeaf: !0, items: { start: o[e], end: o[n] } } } var r = t.length % 2 == 0 ? t.length / 2 : (t.length - 1) / 2; t[r]; return { start: t[0], end: t[t.length - 1], isLeaf: !1, left: s(t.slice(0, r + 1)), right: s(t.slice(r)) } }; return { bounds: i, tree: s(a) } }, getClosestElement: function (t, e) { if (!this._boundsInfo) return null; var n = this._boundsInfo; var r = n.bounds; var i = n.tree; var a = this.node().config.options.container; var o = this.node().config.flip; var s = Fe(a.node()); var u = this.node().config.guide.maxHighlightDistance; if (t < r.left + s.x - u || t > r.right + s.x + u || e < r.top + s.y - u || e > r.bottom + s.y + u) return null; var l = o ? e - s.y : t - s.x; var c = (function t (e) { if (e.isLeaf) return e; var n = e.left.end; return t(l < n ? e.left : e.right) }(i)); var f = c.end === c.start ? 0 : (l - c.start) / (c.end - c.start); f < 0 && (f = 0), f > 1 && (f = 1); var d = (function () { var t = c.items.start.reduce(function (t, e) { return t[e.group] = { start: e, end: null, y: null, y0: null }, t }, {}); return c.items.end.forEach(function (e) { void 0 !== t[e.group] ? t[e.group].end = e : delete t[e.group] }), Object.keys(t).forEach(function (e) { var n = t[e]; n.end ? (n.y = n.start.y + f * (n.end.y - n.start.y), n.y0 = n.start.y0 + f * (n.end.y0 - n.start.y0)) : delete t[e] }), Object.keys(t).map(function (e) { return t[e] }).map(function (t) { return { y: t.y, y0: t.y0, el: f < 0.5 ? t.start : t.end } }).filter(function (t) { return t.el.data != null }) }()); var h = e - s.y; var p = d.filter(function (t) { return h >= t.y && h <= t.y0 }); var g = (p.length > 0 ? p : d).map(function (t) { return t.el }).map(function (n) { var r = n.x + s.x; var i = n.y + s.y; var a = Math.abs(o ? e - i : t - r); var u = Math.abs(o ? t - r : e - i); return { node: n.node, data: n.data, distance: a, secondaryDistance: u, x: r, y: i } }); return xi(t, e, g) } }; var Ni = { draw: wi.draw, getClosestElement: wi.getClosestElement, highlight: wi.highlight, highlightDataPoints: wi.highlightDataPoints, addInteraction: wi.addInteraction, _getBoundsInfo: wi._getBoundsInfo, _sortElements: wi._sortElements, init: function (t) { var e = wi.init(t); return e.transformRules = [e.flip && S.get('flip')], e.adjustRules = [function (t, n) { var r = t.scaleSize.isEmptyScale(); var i = Jt(e.guide.size || {}, { defMinSize: 2, defMaxSize: r ? 6 : 40 }); var a = Object.assign({}, n, { defMin: i.defMinSize, defMax: i.defMaxSize, minLimit: i.minSize, maxLimit: i.maxSize }); return S.get('adjustStaticSizeScale')(t, a) }], e }, buildModel: function (t) { var e = wi.baseModel(t); var n = this.node().config.guide; var r = Ti(t.model.scaleColor.domain().length); var i = Ue + 'area area i-role-path ' + r + ' ' + n.cssClass + ' '; e.groupAttributes = { class: function (t) { return i + ' ' + e.class(t[0]) + ' frame' } }; var a = { fill: function (t) { return e.color(t[0]) }, stroke: function (t) { return e.color(t[0]) } }; return e.pathAttributesEnterInit = a, e.pathAttributesUpdateDone = a, e.pathElement = 'polygon', e.anchorShape = 'circle', e.pathTween = { attr: 'points', fn: ut(0, (function (t, e) { return function (n) { return n.map(function (n) { return [t(n), e(n)].join(',') }).join(' ') } }(function (t) { return t.x }, function (t) { return t.y })), [function (n) { return { id: t.id(n), x: e.x(n), y: e.y(n) } }], t.id) }, e } }; function Li (t) { if (t.length < 2) return ''; for (var e = '', n = 0; n < t.length; n++)e += (n === 0 ? 'M' : ' L') + t[n].x + ',' + t[n].y; return e } function Ri (t) { if (t.length < 4) return ''; for (var e = 'M' + t[0].x + ',' + t[0].y, n = 3; n < t.length; n += 3)e += ' C' + t[n - 2].x + ',' + t[n - 2].y + ' ' + t[n - 1].x + ',' + t[n - 1].y + ' ' + t[n].x + ',' + t[n].y; return e } var Fi = { draw: wi.draw, getClosestElement: wi.getClosestElement, highlight: wi.highlight, highlightDataPoints: wi.highlightDataPoints, addInteraction: wi.addInteraction, _getBoundsInfo: wi._getBoundsInfo, _sortElements: wi._sortElements, init: function (t) { var e = wi.init(t); var n = e.stack; e.guide = Jt(e.guide || {}, { avoidScalesOverflow: !0, interpolate: 'linear' }), e.transformRules = [e.flip && S.get('flip'), !n && S.get('groupOrderByAvg'), ai(e), n && S.get('stack')]; var r = e.guide.avoidScalesOverflow; var i = function (t) { return t.scaleSize.isEmptyScale() }; return e.adjustRules = [function (t, n) { var r = Jt(e.guide.size || {}, { defMinSize: 2, defMaxSize: i(t) ? 6 : 40 }); var a = Object.assign({}, n, { defMin: r.defMinSize, defMax: r.defMaxSize, minLimit: r.minSize, maxLimit: r.maxSize }); return S.get('adjustStaticSizeScale')(t, a) }, r && function (t, e) { if (i(t)) return function () { return {} }; var n = Object.assign({}, e, { sizeDirection: 'xy' }); return S.get('avoidScalesOverflow')(t, n) }].filter(function (t) { return t }), e }, buildModel: function (t) { var e = this.node().config; var n = e.guide; var r = e.options; var i = !t.model.scaleSize.dim; var a = i ? n.widthCssClass || (function (t) { var e = 0; return t >= 160 && t < 320 ? e = 1 : t >= 320 && t < 480 ? e = 2 : t >= 480 && t < 640 ? e = 3 : t >= 640 && (e = 4), Mi[e] }(r.width)) : ''; var o = Ti(t.model.scaleColor.domain().length); var s = i ? 'line' : 'area'; var u = '' + Ue + s + ' ' + s + ' i-role-path ' + a + ' ' + o + ' ' + n.cssClass + ' '; var l = i ? { stroke: function (t) { return f.color(t[0]) }, class: 'i-role-datum' } : { fill: function (t) { return f.color(t[0]) } }; var c = $(n.interpolate) === 'cubic' ? i ? Ri : si : i ? Li : oi; var f = wi.baseModel(t); var d = i ? function (e) { return { id: t.id(e), x: f.x(e), y: f.y(e) } } : function (e) { return { id: t.id(e), x: f.x(e), y: f.y(e), size: f.size(e) } }; return f.groupAttributes = { class: function (t) { return u + ' ' + f.class(t[0]) + ' frame' } }, f.pathElement = 'path', f.anchorShape = 'circle', f.pathAttributesEnterInit = l, f.pathAttributesUpdateDone = l, f.pathTween = { attr: 'd', fn: ut(0, c, [d], t.id, n.interpolate) }, f } }; var Di = function (t) { return o.select(t).data()[0] }; var Ii = { init: function (t) { var e = Object.assign({}, t); e.guide = e.guide || {}, e.guide = Jt(e.guide, { animationSpeed: 0, avoidScalesOverflow: !0, maxHighlightDistance: 32, prettify: !0, sortByBarHeight: !0, enableColorToBarPosition: e.guide.enableColorToBarPosition != null ? e.guide.enableColorToBarPosition : !e.stack }), e.guide.size = Jt(e.guide.size || {}, { enableDistributeEvenly: !0 }), e.guide.label = Jt(e.guide.label || {}, { position: e.flip ? e.stack ? ['r-', 'l+', 'hide-by-label-height-horizontal', 'cut-label-horizontal'] : ['outside-then-inside-horizontal', 'auto:hide-on-label-label-overlap'] : e.stack ? ['rotate-on-size-overflow', 't-', 'b+', 'hide-by-label-height-vertical', 'cut-label-vertical', 'auto:hide-on-label-label-overlap'] : ['rotate-on-size-overflow', 'outside-then-inside-vertical', 'auto:hide-on-label-label-overlap'] }); var n = e.guide.avoidScalesOverflow; var r = e.guide.enableColorToBarPosition; var i = e.guide.size.enableDistributeEvenly; return e.transformRules = [e.flip && S.get('flip'), e.guide.obsoleteVerticalStackOrder && S.get('obsoleteVerticalStackOrder'), e.stack && S.get('stack'), r && S.get('positioningByColor')].filter(function (t) { return t }), e.adjustRules = [i && function (t, n) { var r = Jt(e.guide.size || {}, { defMinSize: e.guide.prettify ? 3 : 0, defMaxSize: e.guide.prettify ? 40 : Number.MAX_VALUE }); var i = Object.assign({}, n, { defMin: r.defMinSize, defMax: r.defMaxSize, minLimit: r.minSize, maxLimit: r.maxSize }); return S.get('size_distribute_evenly')(t, i) }, n && i && function (t, e) { var n = Object.assign({}, e, { sizeDirection: 'x' }); return S.get('avoidScalesOverflow')(t, n) }, e.stack && S.get('adjustYScale')].filter(function (t) { return t }), e }, addInteraction: function () { var t = this; var e = this.node(); e.on('highlight', function (e, n) { return t.highlight(n) }), e.on('data-hover', function (e, n) { return t.highlight(function (t, e) { return function (n) { return n === t || e } }(n.data, null)) }) }, draw: function () { var t; var e; var n = this.node(); var r = n.config; var i = r.options; i.container = i.slot(r.uid); var a = r.guide.prettify; var s = 'i-role-element i-role-datum bar ' + Ue + 'bar'; var u = n.screenModel; var l = this.buildModel(u, { prettify: a, minBarH: 1, minBarW: 1, baseCssClass: s }); var c = ot; var f = r.flip ? 'y' : 'x'; var d = r.flip ? 'x' : 'y'; var h = r.flip ? 'width' : 'height'; var p = r.flip ? 'height' : 'width'; var g = u.toFibers(); var m = g.reduce(function (t, e) { return t.concat(e) }, []); var y = l.class; var v = Qt(l, 'class'); var b = i.container.selectAll('.bar').data(m, u.id); b.exit().classed('tau-removing', !0).call(c(r.guide.animationSpeed, null, ((t = {})[f] = function () { var t = o.select(this); return t.attr(f) - 0 + (t.attr(p) - 0) / 2 }, t[d] = function () { return this.getAttribute('data-zero') }, t[p] = 0, t[h] = 0, t), function (t) { var e = o.select(t); e.classed('tau-removing') && e.remove() })), b.call(c(r.guide.animationSpeed, null, v)); var x = b.enter().append('rect').call(c(r.guide.animationSpeed, (e = {}, e[d] = u[d + '0'], e[h] = 0, e), v)).merge(b).attr('class', y).attr('data-zero', u[d + '0']); n.subscribe(new Jr(u.model, u.model.flip, r.guide.label, i).draw(g)); var _ = (function () { var t = m.reduce(function (t, e, n) { return t.set(e, n + 1), t }, new Map()); return function (e, n) { return (t.get(Di(e)) || -1) - (t.get(Di(n)) || -1) } }()); this._barsSorter = r.guide.sortByBarHeight ? r.flip ? function (t, e) { var n = Di(t); var r = Di(e); var i = l.width(n); var a = l.width(r); if (i === a) { var o = l.y(n); var s = l.y(r); return o === s ? _(t, e) : o - s } return a - i } : function (t, e) { var n = Di(t); var r = Di(e); var i = l.height(n); var a = l.height(r); if (i === a) { var o = l.x(n); var s = l.x(r); return o === s ? _(t, e) : o - s } return a - i } : _; var w = { rect: 0, text: 1 }; this._typeSorter = function (t, e) { return w[t.tagName] - w[e.tagName] }, this._sortElements(this._typeSorter, this._barsSorter), n.subscribe(x), this._boundsInfo = this._getBoundsInfo(x.nodes()) }, buildModel: function (t, e) { var n; var r = e.prettify; var i = e.minBarH; var a = e.minBarW; var o = e.baseCssClass; var s = function (e) { var n = t.size(e); return r && (n = Math.max(a, n)), n }; var u = function (e) { return e[t.model.scaleY.dim] }; if (t.flip) { var l = function (e) { return Math.abs(t.x(e) - t.x0(e)) }; n = { y: function (e) { return t.y(e) - 0.5 * s(e) }, x: function (e) { var n = Math.min(t.x0(e), t.x(e)); if (r) { var a = l(e); var o = u(e); var s = 0; return o === 0 && (s = 0), o > 0 && (s = a), o < 0 && (s = 0 - i), a < i ? n + s : n } return n }, height: function (t) { return s(t) }, width: function (t) { var e = l(t); return r ? u(t) === 0 ? e : Math.max(i, e) : e } } } else { var c = function (e) { return Math.abs(t.y(e) - t.y0(e)) }; n = { x: function (e) { return t.x(e) - 0.5 * s(e) }, y: function (e) { var n = Math.min(t.y0(e), t.y(e)); r && (n = c(e) < i && u(e) > 0 ? n - i : n); return n }, width: function (t) { return s(t) }, height: function (t) { var e = c(t); return r && (e = u(t) === 0 ? e : Math.max(i, e)), e } } } return Object.assign(n, { class: function (e) { return o + ' ' + t.class(e) }, fill: function (e) { return t.color(e) } }) }, _sortElements: function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; Ce(this.node().config.options.container.node(), te.apply(r, t)) }, _getBoundsInfo: function (t) { if (t.length === 0) return null; var e = this.node().screenModel; var n = this.node().config.flip; var r = t.map(function (t) { var n = o.select(t).data()[0]; var r = e.x(n); var i = e.x0(n); var a = e.y(n); var s = e.y0(n); var u = Math.abs(r - i); var l = Math.abs(a - s); var c = (r + i) / 2; var f = (a + s) / 2; return { node: t, data: n, cx: c, cy: f, box: { top: f - l / 2, right: c + u / 2, bottom: f + l / 2, left: c - u / 2 }, invert: a > s } }); var i = r.reduce(function (t, e) { var n = e.box; return t.left = Math.min(n.left, t.left), t.right = Math.max(n.right, t.right), t.top = Math.min(n.top, t.top), t.bottom = Math.max(n.bottom, t.bottom), t }, { left: Number.MAX_VALUE, right: Number.MIN_VALUE, top: Number.MAX_VALUE, bottom: Number.MIN_VALUE }); var a = qt(r.map(n ? function (t) { return t.cy } : function (t) { return t.cx })).sort(function (t, e) { return t - e }); var s = a.reduce(function (t, e) { return t[e] = [], t }, {}); r.forEach(function (t) { var e = a.find(n ? function (e) { return t.cy === e } : function (e) { return t.cx === e }); s[e].push(t) }); var u = function (t) { if (t.length === 1) return s[t]; var e = Math.ceil(t.length / 2); return { middle: (t[e - 1] + t[e]) / 2, lower: u(t.slice(0, e)), greater: u(t.slice(e)) } }; return { bounds: i, tree: u(a) } }, getClosestElement: function (t, e) { if (!this._boundsInfo) return null; var n = this._boundsInfo; var r = n.bounds; var i = n.tree; var a = this.node().config.options.container; var o = this.node().config.flip; var s = Fe(a.node()); var u = t - s.x; var l = e - s.y; var c = this.node().config.guide.maxHighlightDistance; if (u < r.left - c || u > r.right + c || l < r.top - c || l > r.bottom + c) return null; var f = o ? l : u; var d = o ? u : l; return (function t (e) { return Array.isArray(e) ? e : t(f > e.middle ? e.greater : e.lower) }(i)).map(function (t) { var e = o ? t.box.left : t.box.top; var n = o ? t.box.right : t.box.bottom; var r = (function (t, e, n) { return t >= e && t <= n }(d, e, n)); if (!r && Math.abs(d - e) > c && Math.abs(d - n) > c) return null; var i = Math.abs(d - (t.invert !== o ? n : e)); return Object.assign(t, { distToValue: i, cursorInside: r }) }).filter(function (t) { return t }).sort(function (t, e) { return t.cursorInside !== e.cursorInside ? e.cursorInside - t.cursorInside : Math.abs(t.distToValue) - Math.abs(e.distToValue) }).map(function (t) { var e = t.cx; var n = t.cy; var r = Math.abs(o ? l - n : u - e); var i = Math.abs(o ? u - e : l - n); return { node: t.node, data: t.data, distance: r, secondaryDistance: i, x: e, y: n } })[0] || null }, highlight: function (t) { var e; var n = this.node().config.options.container; var r = ((e = {})['tau-chart__highlighted'] = function (e) { return !0 === t(e) }, e['tau-chart__dimmed'] = function (e) { return !1 === t(e) }, e); n.selectAll('.bar').call(ct(r)), n.selectAll('.i-role-label').call(ct(r)), this._sortElements(function (e, n) { return t(Di(e)) - t(Di(n)) }, this._typeSorter, this._barsSorter) } }; var ji = n(14); var zi = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Bi = (function (t) { function e (e) { var n = t.call(this, e) || this; return n.config = e, n.config.guide = Jt(n.config.guide || {}, {}), n.on('highlight', function (t, e) { return n.highlight(e) }), n } return zi(e, t), e.prototype.defineGrammarModel = function (t) { var e = this.config; var n = e.options; this.color = t('color', e.color, {}), this.scalesMap = e.columns.reduce(function (e, r) { return e[r] = t('pos', r, [0, n.height]), e }, {}); var r = n.width / (e.columns.length - 1); var i = e.columns.reduce(function (t, e, n) { return t[e] = n * r, t }, {}); return this.xBase = function (t) { return i[t] }, this.regScale('columns', this.scalesMap).regScale('color', this.color), {} }, e.prototype.drawFrames = function (t) { var e = this.config; var n = this.config.options; var r = this.scalesMap; var i = this.xBase; var a = this.color; var o = ji.line(); var s = function (t) { t.attr('d', function (t) { return o(e.columns.map(function (e) { return [i(e), r[e](t[r[e].dim])] })) }) }; var u = function (t) { t.attr('stroke', function (t) { return a.toColor(a(t[a.dim])) }), t.attr('class', function (t) { return Ue + '__line line ' + a.toClass(a(t[a.dim])) + ' foreground' }) }; var l = function (t) { var e = t.selectAll('.background').data(function (t) { return t.part() }); e.exit().remove(), e.call(s), e.enter().append('path').attr('class', 'background line').call(s); var n = t.selectAll('.foreground').data(function (t) { return t.part() }); n.exit().remove(), n.call(function (t) { s(t), u(t) }), n.enter().append('path').call(function (t) { s(t), u(t) }) }; var c = n.container.selectAll('.lines-frame').data(t, function (t) { return t.hash() }); c.exit().remove(), c.call(l), c.enter().append('g').attr('class', 'lines-frame').call(l), this.subscribe(n.container.selectAll('.lines-frame .foreground')) }, e.prototype.highlight = function (t) { this.config.options.container.selectAll('.lines-frame .foreground').style('visibility', function (e) { return t(e) ? '' : 'hidden' }) }, e }(g)); var Vi = (function () { function t (t, e) { var n; var r = this; if (this._fields = {}, Array.isArray(e.fitToFrameByDims) && e.fitToFrameByDims.length) { n = t.part(function (t) { var n = {}; return t.type === 'where' && t.args ? (n.type = t.type, n.args = e.fitToFrameByDims.reduce(function (e, n) { return t.args.hasOwnProperty(n) && (e[n] = t.args[n]), e }, {})) : n = t, n }) } else n = t.full(); var i = this.getVarSet(n, e); e.order && (i = $t(Kt(e.order, i), i)), this.vars = i; var a = i.map(function (t) { return t }); this.scaleConfig = e, this.scaleConfig.nice = this.scaleConfig.hasOwnProperty('nice') ? this.scaleConfig.nice : this.scaleConfig.autoScale, this.addField('dim', this.scaleConfig.dim).addField('scaleDim', this.scaleConfig.dim).addField('scaleType', this.scaleConfig.type).addField('source', this.scaleConfig.source).addField('domain', function () { return r.vars }).addField('isInteger', a.every(Number.isInteger)).addField('originalSeries', function () { return a }).addField('isContains', function (t) { return r.isInDomain(t) }).addField('isEmptyScale', function () { return r.isEmpty() }).addField('fixup', function (t) { var e = r.scaleConfig; e.__fixup__ = e.__fixup__ || {}, e.__fixup__ = Object.assign(e.__fixup__, t(Object.assign({}, e, e.__fixup__))) }).addField('commit', function () { r.scaleConfig = Object.assign(r.scaleConfig, r.scaleConfig.__fixup__), delete r.scaleConfig.__fixup__ }) } return t.prototype.isInDomain = function (t) { return this.domain().indexOf(t) >= 0 }, t.prototype.addField = function (t, e) { return this._fields[t] = e, this[t] = e, this }, t.prototype.getField = function (t) { return this._fields[t] }, t.prototype.isEmpty = function () { return !this._fields.dim }, t.prototype.toBaseScale = function (t, e) { var n = this; void 0 === e && (e = null); var r = Object.keys(this._fields).reduce(function (t, e) { return t[e] = n._fields[e], t }, t); return r.getHash = function () { return (function (t, e) { return Rt([t, e].map(function (t) { return JSON.stringify }).join('')) }(n.vars, e)) }, r.value = r, r }, t.prototype.getVarSet = function (t, e) { return qt(e.hasOwnProperty('series') ? e.series : t.map(function (t) { return t[e.dim] }), (function (t) { return t === 'date' ? function (t) { return new Date(t).getTime() } : function (t) { return t } }(e.dimType))) }, t }()); var Hi = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Wi = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; return r._references = n.references, r._refCounter = n.refCounter, r.addField('scaleType', 'identity'), r } return Hi(e, t), e.prototype.create = function () { var t = this._references; var e = this._refCounter; return this.toBaseScale(function (n, r) { if (n == null) { var i = t.get(r); i == null && (i = e(), t.set(r, i)) } else i = n; return i }) }, e }(Vi)); var Gi = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Ui = function () { return (Ui = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Xi = Ui({}, s, u); var qi = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = n.dimType !== 'measure'; var a = r.scaleConfig.brewer || (i ? Wt(20).map(function (t) { return 'color20-' + (1 + t) }) : ['#eee', '#000']); var o = r.scaleConfig; if (!i) { var s = Xi.extent(r.vars); var u = function (t) { return Number.isFinite(t) || kt(t) }; var l = u(o.min) ? o.min : s[0]; var c = u(o.max) ? o.max : s[1]; var f = [l, s[0]].filter(u); var d = [c, s[1]].filter(u); if (s = [f.sort(function (t, e) { return t - e })[0], d.sort(function (t, e) { return e - t })[0]], o.nice && s[0] < 0 && s[1] > 0) { var h = Math.max.apply(Math, s.map(Math.abs)); s = [-h, h] }r.vars = s } return r.addField('scaleType', 'color').addField('discrete', i).addField('brewer', a).addField('toColor', zt).addField('toClass', Bt), r } return Gi(e, t), e.prototype.create = function () { var t = this.discrete; var e = this.vars; var n = this.getField('brewer'); var r = t ? this.createDiscreteScale(e, n) : this.createContinuesScale(e, n); return this.toBaseScale(r) }, e.prototype.createDiscreteScale = function (t, e) { var n; var r = function (t, e) { var n = t.map(function (t) { return String(t).toString() }); return Xi.scaleOrdinal().range(e).domain(n) }; var i = function (t) { return function (e) { return t(String(e).toString()) } }; if (Array.isArray(e))n = i(r(t, e)); else if (typeof e === 'function')n = function (n) { return e(n, i(r(t, Wt(20).map(function (t) { return 'color20-' + (1 + t) })))) }; else { if (!At(e)) throw new Error('This brewer is not supported'); n = (function (t, e) { var n = Object.keys(t); var r = n.map(function (e) { return t[e] }); var i = Xi.scaleOrdinal().range(r).domain(n); return function (n) { return t.hasOwnProperty(n) ? i(String(n)) : e(n) } }(e, function () { return 'color-default' })) } return n }, e.prototype.createContinuesScale = function (t, e) { if (!Array.isArray(e)) throw new Error('This brewer is not supported'); return Xi.scaleLinear().domain(jt(t.map(function (t) { return t - 0 }), e.length)).range(e) }, e }(Vi)); var Yi = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var $i = { sqrt: function (t) { return Math.sqrt(t) }, linear: function (t) { return t } }; var Ki = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = r.scaleConfig; var a = s.extent(r.vars); var o = Number.isFinite(i.min) ? i.min : a[0]; var u = Number.isFinite(i.max) ? i.max : a[1]; return r.vars = [Math.min.apply(Math, [o, a[0]].filter(Number.isFinite)), Math.max.apply(Math, [u, a[1]].filter(Number.isFinite))], r.addField('scaleType', 'size'), r.addField('funcType', n.func || 'sqrt'), r } return Yi(e, t), e.prototype.isInDomain = function (t) { var e = this.domain().sort(); var n = e[0]; var r = e[e.length - 1]; return !Number.isNaN(n) && !Number.isNaN(r) && t <= r && t >= n }, e.prototype.create = function () { var t; var e = this.scaleConfig; var n = this.vars; var r = Jt({}, e, { func: 'sqrt', minSize: 0, maxSize: 1 }); var i = r.func; var a = r.minSize; var o = r.maxSize; var s = $i[i]; var u = n.filter(function (t) { return Number.isFinite(Number(t)) }); if (u.length === 0)t = function () { return o }; else { var l; var c; var f = Math.min.apply(Math, u); var d = Math.max.apply(Math, u); var h = s(Math.max(Math.abs(f), Math.abs(d), d - f)); c = f < 0 ? f : 0, l = h === 0 ? 1 : (o - a) / h, t = function (t) { var e = t !== null ? parseFloat(t) : 0; return Number.isFinite(e) ? a + s(e - c) * l : o } } return this.toBaseScale(t) }, e }(Vi)); var Ji = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Qi = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; return r.addField('scaleType', 'ordinal').addField('discrete', !0), r } return Ji(e, t), e.prototype.create = function (t) { var e = this.scaleConfig; var n = this.vars; var r = u.scalePoint().domain(n).range(t).padding(0.5); var i = Math.max.apply(Math, t); var a = function (t) { return typeof e.ratio === 'function' ? e.ratio(t, i, n) : typeof e.ratio === 'object' ? e.ratio[t] : 1 / n.length }; var o = function (t) { return e.ratio ? i - n.slice(n.indexOf(t) + 1).reduce(function (t, e) { return t + i * a(e) }, i * a(t) * 0.5) : r(t) }; return Object.keys(r).forEach(function (t) { return o[t] = r[t] }), o.stepSize = function (t) { return a(t) * i }, this.toBaseScale(o, t) }, e }(Vi)); var Zi = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var ta = function () { return (ta = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var ea = ta({}, s, u); var na = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = r.scaleConfig; var a = r.vars; var o = ea.extent(a); var s = i.min === null || void 0 === i.min ? o[0] : new Date(i.min).getTime(); var u = i.max === null || void 0 === i.max ? o[1] : new Date(i.max).getTime(); var l = [new Date(Math.min(s, o[0])), new Date(Math.max(u, o[1]))]; var c = b.get(i.period, { utc: i.utcTime }); return i.fitToFrameByDims || c === null ? r.vars = qt(a.map(function (t) { return new Date(t) }), function (t) { return t.getTime() }).sort(function (t, e) { return Number(e) - Number(t) }) : r.vars = b.generate(l[0], l[1], i.period, { utc: i.utcTime }), r.periodGenerator = c, r.addField('scaleType', 'period').addField('utcTime', r.scaleConfig.utcTime).addField('period', r.scaleConfig.period).addField('discrete', !0), r } return Zi(e, t), e.prototype.isInDomain = function (t) { var e = this.periodGenerator; var n = new Date(t); var r = (e ? e.cast(n) : n).getTime(); return this.domain().map(function (t) { return t.getTime() }).indexOf(r) >= 0 }, e.prototype.create = function (t) { var e = this.periodGenerator; var n = this.vars; var r = this.vars.map(function (t) { return t.getTime() }); var i = this.scaleConfig; var a = ea.scalePoint().domain(n).range(t).padding(0.5); var o = ea.scalePoint().domain(r.map(String)).range(t).padding(0.5); var s = Math.max.apply(Math, t); var u = function (t) { var e = new Date(t).getTime(); return typeof i.ratio === 'function' ? i.ratio(e, s, r) : typeof i.ratio === 'object' ? i.ratio[e] : 1 / n.length }; var l = function (t) { var n = new Date(t); var a = (e ? e.cast(n) : n).getTime(); return i.ratio ? s - r.slice(r.indexOf(a) + 1).reduce(function (t, e) { return t + s * u(e) }, s * u(t) * 0.5) : o(String(a)) }; return Object.keys(a).forEach(function (t) { return l[t] = a[t] }), l.stepSize = function (t) { return u(t) * s }, this.toBaseScale(l, t) }, e }(Vi)); var ra = n(15); var ia = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var aa = function () { return (aa = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var oa = aa({}, s, u, ra); var sa = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = r.scaleConfig; var a = r.vars; var o = i.period ? b.get(r.scaleConfig.period, { utc: i.utcTime }) : null; var s = oa.extent(a).map(o ? function (t) { return o.cast(new Date(t)) } : function (t) { return new Date(t) }); var u = i.min == null ? s[0] : new Date(i.min).getTime(); var l = i.max == null ? s[1] : new Date(i.max).getTime(); if (a = [new Date(Math.min(u, Number(s[0]))), new Date(Math.max(l, Number(s[1])))], r.niceIntervalFn = null, i.nice && !o) { var c = i.niceInterval; var f = c && ua(c) ? i.utcTime ? (function (t) { return oa['utc' + t[0].toUpperCase() + t.slice(1)] }(c)) : ua(c) : null; r.niceIntervalFn = f || null, r.vars = Pt(a, r.niceIntervalFn, { utc: i.utcTime }) } else r.vars = a; if (o && Number(r.vars[0]) === Number(r.vars[1])) { var d = r.vars[0]; r.vars[0] = o.cast(new Date(Number(d) - 1)), r.vars[1] = o.next(d) } return r.periodGenerator = o, r.addField('scaleType', 'time').addField('utcTime', r.scaleConfig.utcTime).addField('period', r.scaleConfig.period), r } return ia(e, t), e.prototype.isInDomain = function (t) { var e = new Date(t); this.scaleConfig.period && (e = this.periodGenerator.cast(e)); var n = this.domain(); var r = n[0]; var i = n[n.length - 1]; return !Number.isNaN(r) && !Number.isNaN(i) && e <= i && e >= r }, e.prototype.create = function (t) { var e = this; var n = this.vars; var r = this.scaleConfig.utcTime; var i = this.periodGenerator; var a = (r ? oa.scaleUtc : oa.scaleTime)().domain(n).range(t); var o = function (t) { var e = n[0]; var r = n[1]; return t > r && (t = r), t < e && (t = e), a(new Date(t)) }; if (this.scaleConfig.period) { var s = n[0]; var u = n[1]; a.ticks; a.ticks = function (t) { return typeof t !== 'number' && (t = 10), (function (t, e, n, r) { void 0 === r && (r = 10); var i = t[0]; var a = t[1]; var o = b.get(e, { utc: n }); var s = Number(i); var u = Number(a); var l = Number(o.next(o.cast(i))) - Number(o.cast(i)); if ((u - s) / l <= r) return b.generate(i, a, e, { utc: n }).filter(function (t) { return t >= i && t <= a }); return (function (t, e, n) { void 0 === n && (n = 10); var r; var i; var a = Number(t[0]); var o = Number(t[1]); var s = Math.abs(o - a) / n; var u = oa.bisector(function (t) { return t.duration }).right(ca, s); if (u === ca.length)r = e ? oa.utcYear : oa.timeYear, i = oa.tickStep(a / la.year.duration, o / la.year.duration, n); else if (u) { var l = s / ca[u - 1].duration; var c = ca[u].duration / s; var f = ca[l < c ? u - 1 : u]; r = e ? f.time.utc : f.time.interval, i = f.step } else r = e ? oa.utcMillisecond : oa.timeMillisecond, i = oa.tickStep(a, o, n); return r.every(i).range(new Date(a), new Date(o + 1)) }(t, n, r)) }([s, u], e.scaleConfig.period, r, t)) }; for (var l = i.cast(s); l < s;)l = i.next(l); var c = i.cast(u); o = function (t) { var e = i.cast(t); return e < l && (e = l), e > c && (e = c), a(e) } } return Object.keys(a).forEach(function (t) { return o[t] = a[t] }), o.stepSize = function () { return 0 }, this.toBaseScale(o, t) }, e }(Vi)); function ua (t) { return oa['time' + t[0].toUpperCase() + t.slice(1)] } var la = { second: { duration: 1e3, interval: oa.timeSecond, utc: oa.utcSecond }, minute: { duration: 6e4, interval: oa.timeMinute, utc: oa.utcMinute }, hour: { duration: 36e5, interval: oa.timeHour, utc: oa.utcHour }, day: { duration: 864e5, interval: oa.timeDay, utc: oa.utcDay }, week: { duration: 6048e5, interval: oa.timeWeek, utc: oa.utcWeek }, month: { duration: 2592e6, interval: oa.timeMonth, utc: oa.utcMonth }, year: { duration: 31536e6, interval: oa.timeYear, utc: oa.utcYear } }; var ca = (function () { var t = function (t, e) { return { time: t, step: e, duration: e * t.duration } }; return [t(la.second, 1), t(la.second, 5), t(la.second, 15), t(la.second, 30), t(la.minute, 1), t(la.minute, 5), t(la.minute, 15), t(la.minute, 30), t(la.hour, 1), t(la.hour, 3), t(la.hour, 6), t(la.hour, 12), t(la.day, 1), t(la.day, 2), t(la.week, 1), t(la.month, 1), t(la.month, 3), t(la.year, 1)] }()); var fa = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var da = function () { return (da = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var ha = da({}, s, u); var pa = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = r.scaleConfig; var a = ha.extent(r.vars); var o = Number.isFinite(i.min) ? i.min : a[0]; var s = Number.isFinite(i.max) ? i.max : a[1]; if (a = [Math.min.apply(Math, [o, a[0]].filter(Number.isFinite)), Math.max.apply(Math, [s, a[1]].filter(Number.isFinite))], r.vars = i.nice ? Ot(a) : ha.extent(a), r.vars[0] === r.vars[1]) { var u = Math.pow(10, Math.floor(Math.log(r.vars[0]) / Math.LN10)); r.vars[0] -= u, r.vars[1] += u || 10 } return r.addField('scaleType', 'linear').addField('discrete', !1), r } return fa(e, t), e.prototype.isInDomain = function (t) { var e = this.domain(); var n = e[0]; var r = e[e.length - 1]; return !Number.isNaN(n) && !Number.isNaN(r) && t <= r && t >= n }, e.prototype.create = function (t) { var e = this.vars; var n = this.extendScale(ha.scaleLinear()); return n.domain(e).range(t).clamp(!0), this.toBaseScale(n, t) }, e.prototype.extendScale = function (t) { var e = this; var n = t.copy; var r = t.ticks; return Object.assign(t, { stepSize: function () { return 0 }, copy: function () { return e.extendScale(n.call(t)) }, ticks: this.getField('isInteger') ? function (e) { return r.call(t, e).filter(Number.isInteger) } : t.ticks }), t }, e }(Vi)); var ga = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var ma = function () { return (ma = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var ya = ma({}, s, u); var va = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = r.scaleConfig; var a = ya.extent(r.vars); var o = Number.isFinite(i.min) ? i.min : a[0]; var s = Number.isFinite(i.max) ? i.max : a[1]; return xa(a = [Math.min.apply(Math, [o, a[0]].filter(Number.isFinite)), Math.max.apply(Math, [s, a[1]].filter(Number.isFinite))]), i.nice && (a = (function (t) { var e = t[0] > 0; var n = t.map(function (t) { return Math.abs(t) }); var r = Math.max.apply(Math, n); var i = Math.min.apply(Math, n).toExponential().split('e'); var a = r.toExponential().split('e'); var o = parseFloat(Math.floor(Number(i[0])) + 'e' + i[1]); var s = parseFloat(Math.ceil(Number(a[0])) + 'e' + a[1]); return e ? [o, s] : [-s, -o] }(a))), r.vars = a, r.addField('scaleType', 'logarithmic').addField('discrete', !1), r } return ga(e, t), e.prototype.isInDomain = function (t) { var e = this.domain(); var n = e[0]; var r = e[e.length - 1]; return !Number.isNaN(n) && !Number.isNaN(r) && t <= r && t >= n }, e.prototype.create = function (t) { var e = this.vars; xa(e); var n = (function t (e) { var n = e.copy; e.ticks = function (t) { for (var n = [], r = ya.extent(e.domain()), i = Math.floor(ba(r[0])), a = Math.ceil(ba(r[1])), o = Math.ceil(10 * (a - i) / (10 * Math.ceil(t / 10))), s = i; s <= a; s += o) for (var u = 1; u <= 10; u++) { var l = Math.pow(u, o) * Math.pow(10, s); (l = parseFloat(l.toExponential(0))) >= r[0] && l <= r[1] && n.push(l) } return n }; e.copy = function () { var r = n.call(e); return t(r), r }; return e }(ya.scaleLog())).domain(e).range(t); return n.stepSize = function () { return 0 }, this.toBaseScale(n, t) }, e }(Vi)); function ba (t) { return Math.log(t) / Math.LN10 } function xa (t) { if (t[0] * t[1] <= 0) throw new _('Logarithmic scale domain cannot cross zero.', w.INVALID_LOG_DOMAIN) } var _a; var wa = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Ea = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; return r.addField('scaleType', 'value').addField('georole', n.georole), r } return wa(e, t), e.prototype.create = function () { return this.toBaseScale(function (t) { return t }) }, e }(Vi)); var Sa = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Ma = function () { return (Ma = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Ta = Ma({}, s, u); var Ca = (function (t) { function e (e, n) { var r = t.call(this, e, n) || this; var i = r.scaleConfig; var a = Ta.extent(r.vars); var o = Number.isFinite(i.min) ? i.min : a[0]; var s = Number.isFinite(i.max) ? i.max : a[1]; a = [Math.min(o, a[0]), Math.max(s, a[1])], r.vars = i.nice ? Ot(a) : Ta.extent(a); var u = Wt(10).map(function (t) { return 'rgba(90,180,90,' + (0.2 + t * (0.8 / 9)).toFixed(2) + ')' }); var l = i.brewer || u; return r.addField('scaleType', 'fill').addField('brewer', l), r } return Sa(e, t), e.prototype.isInDomain = function (t) { var e = this.domain(); var n = e[0]; var r = e[e.length - 1]; return !Number.isNaN(n) && !Number.isNaN(r) && t <= r && t >= n }, e.prototype.create = function () { var t = this.vars; var e = this.getField('brewer'); if (!Array.isArray(e)) throw new Error('This brewer is not supported'); var n = e.length; var r = (t[1] - t[0]) / n; var i = Wt(n - 1).map(function (t) { return t + 1 }).reduce(function (e, n) { return e.concat([t[0] + n * r]) }, []); var a = Ta.scaleThreshold().domain(i).range(e); return this.toBaseScale(a) }, e }(Vi)); var ka = function (t) { return t || null }; var Aa = function (t, e) { return void 0 === e && (e = null), Array.isArray(t) ? t.length === 0 ? [e] : t : [t] }; var Oa = function (t, e) { return { type: t, x: e.x, y: e.y, identity: e.identity, size: e.size, color: e.color, split: e.split, label: e.label, guide: { color: e.colorGuide, obsoleteVerticalStackOrder: e.obsoleteVerticalStackOrder, size: e.sizeGuide }, flip: e.flip, stack: e.stack } }; var Pa = { SUCCESS: 'SUCCESS', WARNING: 'WARNING', FAIL: 'FAIL' }; var Na = ((_a = {})[Pa.SUCCESS] = function (t) { return t }, _a[Pa.FAIL] = function (t, e) { throw new Error((e.messages || []).join('\n') || ['This configuration is not supported,', 'See https://api.taucharts.com/basic/facet.html#easy-approach-for-creating-facet-chart'].join(' ')) }, _a[Pa.WARNING] = function (t, e, n) { var r = e.axis; var i = e.indexMeasureAxis[0]; var a = t[i]; var o = t.filter(function (t) { return t !== a }); o.push(a); var s = n[i][r] || {}; var u = n[n.length - 1][r] || {}; return n[n.length - 1][r] = s, n[i][r] = u, o }, _a); function La (t, e, n) { return e.reduce(function (e, r, i) { var a = t[r]; return a ? e.status != Pa.FAIL && (a.type === 'measure' && (e.countMeasureAxis++, e.indexMeasureAxis.push(i)), a.type !== 'measure' && e.countMeasureAxis === 1 ? e.status = Pa.WARNING : e.countMeasureAxis > 1 && (e.status = Pa.FAIL, e.messages.push('There is more than one measure dimension for "' + n + '" axis'))) : (e.status = Pa.FAIL, r ? e.messages.push('"' + r + '" dimension is undefined for "' + n + '" axis') : e.messages.push('"' + n + '" axis should be specified')), e }, { status: Pa.SUCCESS, countMeasureAxis: 0, indexMeasureAxis: [], messages: [], axis: n }) } function Ra (t) { for (var e = Aa(t.x), n = Aa(t.y), r = Math.max(e.length, n.length), i = Aa(t.guide || {}, {}), a = r - i.length, o = 0; o < a; o++)i.push({}); i = i.slice(0, r); var s = La(t.dimensions, e, 'x'); var u = La(t.dimensions, n, 'y'); e = Na[s.status](e, s, i), n = Na[u.status](n, u, i); var l = ['identity', 'color', 'size', 'label', 'split'].reduce(function (e, n) { var r = t[n]; var i = (function (t, e, n) { return e == null ? e : String(e) }(t.dimensions, r)); return i != null && (e[n] = i), e }, {}); return Object.assign({}, t, { x: e, y: n, guide: i }, l) } function Fa (t, e) { for (var n = e.x, r = e.y, i = e.guide, a = Math.max(n.length, r.length), o = { type: 'COORDS.RECT', unit: [] }, s = [].concat(n), u = [].concat(r), l = [].concat(i), c = a; c > 0; c--) { var f = s.pop(); var d = u.pop(); var h = l.pop() || {}; c === a ? (o.x = f, o.y = d, o.unit.push(Oa(t, { x: ka(f), y: ka(d), identity: e.identity, split: e.split, color: e.color, label: e.label, size: e.size, flip: e.flip, stack: e.stack, colorGuide: h.color, obsoleteVerticalStackOrder: h.obsoleteVerticalStackOrder, sizeGuide: h.size })), o.guide = Jt(h, { x: { label: f }, y: { label: d } })) : o = { type: 'COORDS.RECT', x: ka(f), y: ka(d), unit: [o], guide: Jt(h, { x: { label: f }, y: { label: d } }) } } return e.spec = { dimensions: e.dimensions, unit: o }, e } var Da = function (t) { var e = Ra(t); return Fa('ELEMENT.INTERVAL', e = (function (t) { var e = (t.flip ? t.y : t.x).indexOf(t.color) >= 0; var n = t.guide[t.guide.length - 1]; return e && !n.hasOwnProperty('enableColorToBarPosition') && (n.enableColorToBarPosition = !1), t }(e))) }; var Ia = function (t) { var e = Ra(t); var n = e.data; var r = e.settings.log; var i = (0, { horizontal: function (t) { return { prop: t.x[t.x.length - 1], flip: !1 } }, vertical: function (t) { return { prop: t.y[t.y.length - 1], flip: !0 } }, auto: function (t) { var e; var i = t.x; var a = t.y; var o = i[i.length - 1]; var s = i.slice(0, i.length - 1); var u = a[a.length - 1]; var l = a.slice(0, a.length - 1); var c = t.color; var f = s.concat(l).concat([c]).filter(function (t) { return t !== null }); var d = -1; var h = [[[o].concat(f), u], [[u].concat(f), o]]; var p = null; return h.some(function (t, e) { var i = t[0]; var a = t[1]; var o = an(n, i, [a]); return o.result ? d = e : r(['Attempt to find a functional relation between', t[0] + ' and ' + t[1] + ' is failed.', 'There are several ' + o.error.keyY + ' values (e.g. ' + o.error.errY.join(',') + ')', 'for (' + o.error.keyX + ' = ' + o.error.valX + ').'].join(' ')), o.result }) ? (e = h[d][0][0], p = d !== 0) : (r('All attempts are failed. Gonna transform AREA to general PATH.'), e = null), { prop: e, flip: p } } }[typeof e.flip !== 'boolean' ? 'auto' : e.flip ? 'vertical' : 'horizontal'])(e); return i.prop !== null && (e.data = ln(n, i.prop, e.dimensions[i.prop]), e.flip = i.flip), Fa('ELEMENT.AREA', e) }; var ja = (function () { function t (t) { this.unitRef = t } return t.prototype.value = function () { return this.unitRef }, t.prototype.clone = function () { return JSON.parse(JSON.stringify(this.unitRef)) }, t.prototype.traverse = function (t) { var e = function (t, n, r) { n(t, r), (t.units || []).map(function (r) { return e(r, n, t) }) }; return e(this.unitRef, t, null), this }, t.prototype.reduce = function (t, e) { var n = e; return this.traverse(function (e, r) { return n = t(n, e, r) }), n }, t.prototype.addFrame = function (t) { return this.unitRef.frames = this.unitRef.frames || [], t.key.__layerid__ = ['L', (new Date()).getTime(), this.unitRef.frames.length].join(''), t.source = t.hasOwnProperty('source') ? t.source : this.unitRef.expression.source, t.pipe = t.pipe || [], this.unitRef.frames.push(t), this }, t.prototype.addTransformation = function (t, e) { return this.unitRef.transformation = this.unitRef.transformation || [], this.unitRef.transformation.push({ type: t, args: e }), this }, t.prototype.isCoordinates = function () { return (this.unitRef.type || '').toUpperCase().indexOf('COORDS.') === 0 }, t.prototype.isElementOf = function (t) { if (this.isCoordinates()) return !1; var e = (this.unitRef.type || '').split('/'); return e.length === 1 && e.unshift('RECT'), e[0].toUpperCase() === t.toUpperCase() }, t }()); var za = (function () { function t (t) { this.specRef = t } return t.prototype.value = function () { return this.specRef }, t.prototype.unit = function (t) { return t && (this.specRef.unit = t), new ja(this.specRef.unit) }, t.prototype.addTransformation = function (t, e) { return this.specRef.transformations = this.specRef.transformations || {}, this.specRef.transformations[t] = e, this }, t.prototype.getSettings = function (t) { return this.specRef.settings[t] }, t.prototype.setSettings = function (t, e) { return this.specRef.settings = this.specRef.settings || {}, this.specRef.settings[t] = e, this }, t.prototype.getScale = function (t) { return this.specRef.scales[t] }, t.prototype.addScale = function (t, e) { return this.specRef.scales[t] = e, this }, t.prototype.regSource = function (t, e) { return this.specRef.sources[t] = e, this }, t.prototype.getSourceData = function (t) { return (this.specRef.sources[t] || { data: [] }).data }, t.prototype.getSourceDim = function (t, e) { return (this.specRef.sources[t] || { dims: {} }).dims[e] || {} }, t }()); var Ba = {}; var Va = (function () { function t () {} return t.unit = function (t) { return new ja(t) }, t.spec = function (t) { return new za(t) }, t.cloneObject = function (t) { return JSON.parse(JSON.stringify(t)) }, t.depthFirstSearch = function (e, n) { if (n(e)) return e; for (var r = e.hasOwnProperty('frames') ? e.frames : [{ units: e.units }], i = 0; i < r.length; i++) for (var a = r[i].units || [], o = 0; o < a.length; o++) { var s = t.depthFirstSearch(a[o], n); if (s) return s } }, t.traverseSpec = function (t, e) { var n = function (t, e, r) { e(t, r), (t.units || []).map(function (r) { return n(r, e, t) }) }; n(t.unit, e, null) }, t.extractFieldsFormatInfo = function (e) { var n = e.scales; var r = function (t) { return !n[t].dim }; var i = function (t, e, r) { var i = e.guide || {}; var a = n[e[r]]; var o = i[r] || {}; t[a.dim] = t[a.dim] || { label: [], format: [], nullAlias: [], tickLabel: [] }; var s = o.label; var u = o.label || {}; t[a.dim].label.push(typeof s === 'string' ? s : u._original_text || u.text); var l = o.tickFormat || o.tickPeriod; t[a.dim].format.push(l), t[a.dim].nullAlias.push(o.tickFormatNullAlias), t[a.dim].tickLabel.push(o.tickLabel) }; var a = []; t.traverseSpec(e, function (t) { a.push(t) }); var o = a.reduce(function (t, e) { return e.type === 'COORDS.RECT' && e.hasOwnProperty('x') && !r(e.x) && i(t, e, 'x'), e.type === 'COORDS.RECT' && e.hasOwnProperty('y') && !r(e.y) && i(t, e, 'y'), e.hasOwnProperty('color') && !r(e.color) && i(t, e, 'color'), e.hasOwnProperty('size') && !r(e.size) && i(t, e, 'size'), e.hasOwnProperty('label') && !r(e.label) && i(t, e, 'label'), t }, {}); var s = function (t, e) { return t.filter(function (t) { return t })[0] || e }; return Object.keys(o).reduce(function (t, n) { t[n] = {}, t[n].label = s(o[n].label, n); var r = s(o[n].format, null); t[n].nullAlias = s(o[n].nullAlias, 'No ' + t[n].label), t[n].tickLabel = s(o[n].tickLabel, null); var i = r === 'x-time-auto' ? e.settings.utcTime ? 'day-utc' : 'day' : r; var a = t[n].nullAlias; var u = i ? wn.get(i, a) : function (t) { return t == null ? a : String(t) }; if (t[n].format = u, t[n].tickLabel) { var l = n.replace('.' + t[n].tickLabel, ''); t[l] = { label: t[n].label, nullAlias: t[n].nullAlias, tickLabel: t[n].tickLabel, format: function (e) { return u(e && e[t[l].tickLabel]) }, isComplexField: !0 }, t[n].parentField = l } return t }, {}) }, t.getFieldFormatters = function (e, n) { var r = t.extractFieldsFormatInfo(e); Object.keys(r).forEach(function (t) { r[t].parentField && delete r[t] }); return Object.keys(n).forEach(function (t) { var e = (function (t) { var e = {}; return typeof t === 'function' || typeof t === 'string' ? e = { format: t } : At(t) && (e = ee(t, 'label', 'format', 'nullAlias')), e }(n[t])); r[t] = Object.assign({ label: t, nullAlias: 'No ' + t }, r[t] || {}, ee(e, 'label', 'nullAlias')), e.hasOwnProperty('format') ? r[t].format = typeof e.format === 'function' ? e.format : wn.get(e.format, r[t].nullAlias) : r[t].format = r[t].hasOwnProperty('format') ? r[t].format : wn.get(null, r[t].nullAlias) }), Object.keys(r).reduce(function (t, e) { var n = r[e]; return t[e] = { label: n.label, format: n.format }, t }, {}) }, t.tokens = function () { return { reg: function (t, e) { return Ba[t] = e, this }, get: function (t) { return Ba[t] || t } } }, t.getParentUnit = function (t, e) { var n = null; var r = function (t, i) { return t.uid === e.uid ? (n = i, !0) : (t.frames ? t.frames.some(function (e) { return (e.units || []).some(function (e) { return r(e, t) }) }) : (t.units || []).some(function (e) { return r(e, t) }), !1) }; return r(t.unit, null), n }, t }()); n(16); n.d(e, 'api', function () { return Ga }), n.d(e, 'version', function () { return Xa }), n.d(e, 'GPL', function () { return Ge }), n.d(e, 'Plot', function () { return nr }), n.d(e, 'Chart', function () { return ur }); var Ha = {}; var Wa = {}; var Ga = { errorCodes: w, unitsRegistry: Ze, scalesRegistry: nn, grammarRegistry: S, tickFormat: wn, isChartElement: fe, utils: r, svgUtils: a, domUtils: i, tickPeriod: b, colorBrewers: { add: function (t, e) { Ha.hasOwnProperty(t) || (Ha[t] = e) }, get: function (t) { return Ha[t] } }, d3_animationInterceptor: ot, pluginsSDK: Va, plugins: { add: function (t, e) { if (Wa.hasOwnProperty(t)) throw new Error('Plugin is already registered.'); Wa[t] = e }, get: function (t) { return Wa[t] || function (e) { throw new Error('"' + t + '" plugin is not defined') } } }, chartTypesRegistry: or, globalSettings: { animationSpeed: 750, renderingTimeout: 1e4, asyncRendering: !0, syncRenderingInterval: 50, syncPointerEvents: !1, handleRenderingErrors: !1, experimentalShouldAnimate: function (t) { var e = function (t, e) { var n = document.createElementNS('http://www.w3.org/2000/svg', t); return Object.keys(e).forEach(function (t) { return n.setAttribute(t, String(e[t])) }), n }; var n = document.createElement('div'); n.style.position = 'absolute', n.style.visibility = 'hidden', document.body.appendChild(n); var r = e('svg', { width: 100, height: 100 }); n.appendChild(r); var i; var a; var o; var s = performance.now(); for (i = 0; i < 10; i++) for (a = 0; a < 10; a++)o = e('circle', { fill: 'black', r: 5, cx: 10 * i, cy: 10 * a }), r.appendChild(o); var u = performance.now() - s; return document.body.removeChild(n), t.sources['/'].data.length * u < 500 }, defaultNiceColor: !0, defaultColorBrewer: ['#fde725', '#fbe723', '#f8e621', '#f6e620', '#f4e61e', '#f1e51d', '#efe51c', '#ece51b', '#eae51a', '#e7e419', '#e5e419', '#e2e418', '#dfe318', '#dde318', '#dae319', '#d8e219', '#d5e21a', '#d2e21b', '#d0e11c', '#cde11d', '#cae11f', '#c8e020', '#c5e021', '#c2df23', '#c0df25', '#bddf26', '#bade28', '#b8de29', '#b5de2b', '#b2dd2d', '#b0dd2f', '#addc30', '#aadc32', '#a8db34', '#a5db36', '#a2da37', '#a0da39', '#9dd93b', '#9bd93c', '#98d83e', '#95d840', '#93d741', '#90d743', '#8ed645', '#8bd646', '#89d548', '#86d549', '#84d44b', '#81d34d', '#7fd34e', '#7cd250', '#7ad151', '#77d153', '#75d054', '#73d056', '#70cf57', '#6ece58', '#6ccd5a', '#69cd5b', '#67cc5c', '#65cb5e', '#63cb5f', '#60ca60', '#5ec962', '#5cc863', '#5ac864', '#58c765', '#56c667', '#54c568', '#52c569', '#50c46a', '#4ec36b', '#4cc26c', '#4ac16d', '#48c16e', '#46c06f', '#44bf70', '#42be71', '#40bd72', '#3fbc73', '#3dbc74', '#3bbb75', '#3aba76', '#38b977', '#37b878', '#35b779', '#34b679', '#32b67a', '#31b57b', '#2fb47c', '#2eb37c', '#2db27d', '#2cb17e', '#2ab07f', '#29af7f', '#28ae80', '#27ad81', '#26ad81', '#25ac82', '#25ab82', '#24aa83', '#23a983', '#22a884', '#22a785', '#21a685', '#21a585', '#20a486', '#20a386', '#1fa287', '#1fa187', '#1fa188', '#1fa088', '#1f9f88', '#1f9e89', '#1e9d89', '#1e9c89', '#1e9b8a', '#1f9a8a', '#1f998a', '#1f988b', '#1f978b', '#1f968b', '#1f958b', '#1f948c', '#20938c', '#20928c', '#20928c', '#21918c', '#21908d', '#218f8d', '#218e8d', '#228d8d', '#228c8d', '#228b8d', '#238a8d', '#23898e', '#23888e', '#24878e', '#24868e', '#25858e', '#25848e', '#25838e', '#26828e', '#26828e', '#26818e', '#27808e', '#277f8e', '#277e8e', '#287d8e', '#287c8e', '#297b8e', '#297a8e', '#29798e', '#2a788e', '#2a778e', '#2a768e', '#2b758e', '#2b748e', '#2c738e', '#2c728e', '#2c718e', '#2d718e', '#2d708e', '#2e6f8e', '#2e6e8e', '#2e6d8e', '#2f6c8e', '#2f6b8e', '#306a8e', '#30698e', '#31688e', '#31678e', '#31668e', '#32658e', '#32648e', '#33638d', '#33628d', '#34618d', '#34608d', '#355f8d', '#355e8d', '#365d8d', '#365c8d', '#375b8d', '#375a8c', '#38598c', '#38588c', '#39568c', '#39558c', '#3a548c', '#3a538b', '#3b528b', '#3b518b', '#3c508b', '#3c4f8a', '#3d4e8a', '#3d4d8a', '#3e4c8a', '#3e4a89', '#3e4989', '#3f4889', '#3f4788', '#404688', '#404588', '#414487', '#414287', '#424186', '#424086', '#423f85', '#433e85', '#433d84', '#443b84', '#443a83', '#443983', '#453882', '#453781', '#453581', '#463480', '#46337f', '#46327e', '#46307e', '#472f7d', '#472e7c', '#472d7b', '#472c7a', '#472a7a', '#482979', '#482878', '#482677', '#482576', '#482475', '#482374', '#482173', '#482071', '#481f70', '#481d6f', '#481c6e', '#481b6d', '#481a6c', '#48186a', '#481769', '#481668', '#481467', '#471365', '#471164', '#471063', '#470e61', '#470d60', '#460b5e', '#460a5d', '#46085c', '#46075a', '#450559', '#450457', '#440256', '#440154'], defaultClassBrewer: Wt(20).map(function (t) { return 'color20-' + (1 + t) }), log: function (t, e) { e = e || 'INFO', Array.isArray(t) || (t = [t]), console[e.toLowerCase()].apply(console, t) }, facetLabelDelimiter: '  ', excludeNull: !0, minChartWidth: 300, minChartHeight: 200, minFacetWidth: 150, minFacetHeight: 100, specEngine: [{ name: 'COMPACT', width: 600, height: 400 }, { name: 'AUTO', width: Number.MAX_VALUE, height: Number.MAX_VALUE }], fitModel: 'normal', layoutEngine: 'EXTRACT', autoRatio: !0, defaultSourceMap: ['https://raw.githubusercontent.com', 'TargetProcess/tauCharts/master/src/addons', 'world-countries.json'].join('/'), getAxisTickLabelSize: Zt(_e, function (t) { return String(String(t).length) }), getScrollbarSize: me, avoidScrollAtRatio: 1.5, xAxisTickLabelLimit: 150, yAxisTickLabelLimit: 150, xTickWordWrapLinesLimit: 2, yTickWordWrapLinesLimit: 2, xTickWidth: 9, yTickWidth: 9, distToXAxisLabel: 10, distToYAxisLabel: 10, xAxisPadding: 20, yAxisPadding: 20, xFontLabelDescenderLineHeight: 4, xFontLabelHeight: 10, yFontLabelHeight: 10, xDensityPadding: 2, yDensityPadding: 2, 'xDensityPadding:measure': 8, 'yDensityPadding:measure': 8, utcTime: !1, defaultFormats: { measure: 'x-num-auto', 'measure:time': 'x-time-auto' } } }; nr.__api__ = Ga, nr.globalSettings = Ga.globalSettings, Ga.unitsRegistry.reg('COORDS.RECT', br).reg('COORDS.MAP', Lr).reg('COORDS.PARALLEL', Mr).reg('ELEMENT.GENERIC.CARTESIAN', dt).reg('ELEMENT.POINT', ei, 'ELEMENT.GENERIC.CARTESIAN').reg('ELEMENT.LINE', Fi, 'ELEMENT.GENERIC.CARTESIAN').reg('ELEMENT.PATH', Ni, 'ELEMENT.GENERIC.CARTESIAN').reg('ELEMENT.AREA', Pi, 'ELEMENT.GENERIC.CARTESIAN').reg('ELEMENT.INTERVAL', Ii, 'ELEMENT.GENERIC.CARTESIAN').reg('ELEMENT.INTERVAL.STACKED', Ii, 'ELEMENT.GENERIC.CARTESIAN').reg('ELEMENT.INTERVAL.STACKED', Ii, 'ELEMENT.GENERIC.CARTESIAN').reg('PARALLEL/ELEMENT.LINE', Bi), Ga.scalesRegistry.reg('identity', Wi, function (t, e) { return Jt(t, { references: e.references, refCounter: e.refCounter }) }).reg('color', qi, function (t, e) { return Jt(t, { nice: e.defaultNiceColor, brewer: t.dimType === 'measure' ? e.defaultColorBrewer : e.defaultClassBrewer }) }).reg('fill', Ca).reg('size', Ki).reg('ordinal', Qi).reg('period', na, function (t, e) { return Jt(t, { utcTime: e.utcTime }) }).reg('time', sa, function (t, e) { return Jt(t, { utcTime: e.utcTime }) }).reg('linear', pa).reg('logarithmic', va).reg('value', Ea); var Ua = [function (t) { return t.data ? [] : ['[data] must be specified'] }]; Ga.chartTypesRegistry.add('scatterplot', function (t) { return Fa('ELEMENT.POINT', Ra(t)) }, Ua).add('line', function (t) { var e = Ra(t); var n = e.data; var r = e.settings.log; var i = { none: function () { return null }, horizontal: function (t) { return t.x[t.x.length - 1] }, vertical: function (t) { return t.y[t.y.length - 1] }, auto: function (t) { var e; var i = t.x; var a = t.y; var o = i[i.length - 1]; var s = i.slice(0, i.length - 1); var u = a[a.length - 1]; var l = a.slice(0, a.length - 1); var c = t.color; var f = s.concat(l).concat([c]).filter(function (t) { return t !== null }); var d = -1; var h = [[[o].concat(f), u], [[u].concat(f), o]]; return h.some(function (t, e) { var i = t[0]; var a = t[1]; var o = an(n, i, [a]); return o.result ? d = e : r(['Attempt to find a functional relation between', t[0] + ' and ' + t[1] + ' is failed.', 'There are several ' + o.error.keyY + ' values (e.g. ' + o.error.errY.join(',') + ')', 'for (' + o.error.keyX + ' = ' + o.error.valX + ').'].join(' ')), o.result }) ? e = h[d][0][0] : (r(['All attempts are failed.', 'Will orient line horizontally by default.', 'NOTE: the [scatterplot] chart is more convenient for that data.'].join(' ')), e = o), e } }; var a = (e.lineOrientation || '').toLowerCase(); var o = (i.hasOwnProperty(a) ? i[a] : i.auto)(e); return o !== null && (e.data = ln(n, o, e.dimensions[o])), Fa('ELEMENT.LINE', e) }, Ua).add('area', Ia, Ua).add('stacked-area', function (t) { return Ia(Jt(t, { stack: !0 })) }, Ua).add('bar', function (t) { return Da(Jt(t, { flip: !1 })) }, Ua).add('horizontalBar', function (t) { return Da(Jt({ flip: !0 }, t)) }, Ua).add('horizontal-bar', function (t) { return Da(Jt({ flip: !0 }, t)) }, Ua).add('stacked-bar', function (t) { return Da(Jt({ flip: !1, stack: !0 }, t)) }, Ua).add('horizontal-stacked-bar', function (t) { return Da(Jt({ flip: !0, stack: !0 }, t)) }, Ua).add('map', function (t) { var e = Object.assign({ sourcemap: t.settings.defaultSourceMap }, t.guide || {}); e.size = Jt(e.size || {}, { min: 1, max: 10 }), e.code = Jt(e.code || {}, { georole: 'countries' }); var n = {}; var r = function (t, e, r) { var i; void 0 === r && (r = {}); var a; var o = e; return e ? (i = t + '_' + e, a = '/') : (i = t + ':default', a = '?'), n.hasOwnProperty(i) || (n[i] = Object.assign({ type: t, source: a, dim: o }, r)), i }; return { sources: { '?': { dims: {}, data: [{}] }, '/': { dims: Object.keys(t.dimensions).reduce(function (e, n) { return e[n] = { type: t.dimensions[n].type }, e }, {}), data: t.data } }, scales: n, unit: { type: 'COORDS.MAP', expression: { operator: 'none', source: '/' }, code: r('value', t.code, e.code), fill: r('fill', t.fill, e.fill), size: r('size', t.size, e.size), color: r('color', t.color, e.color), latitude: r('linear', t.latitude, { nice: !1 }), longitude: r('linear', t.longitude, { nice: !1 }), guide: e }, plugins: t.plugins || [] } }, Ua.concat([function (t) { var e = t.fill && t.code; if (t.fill && !e) return '[code] must be specified when using [fill]' }, function (t) { var e = t.latitude && t.longitude; if ((t.latitude || t.longitude) && !e) return '[latitude] and [longitude] both must be specified' }])).add('parallel', function (t) { var e = Object.assign({ columns: {} }, t.guide || {}); var n = {}; var r = function (t, e, r) { var i; void 0 === r && (r = {}); var a; var o = e; return e ? (i = t + '_' + e, a = '/') : (i = t + ':default', a = '?'), n.hasOwnProperty(i) || (n[i] = Object.assign({ type: t, source: a, dim: o }, r)), i }; var i = t.columns.map(function (n) { return r(t.dimensions[n].scale, n, e.columns[n]) }); return { sources: { '?': { dims: {}, data: [{}] }, '/': { dims: Object.keys(t.dimensions).reduce(function (e, n) { return e[n] = { type: t.dimensions[n].type }, e }, {}), data: t.data } }, scales: n, unit: { type: 'COORDS.PARALLEL', expression: { operator: 'none', source: '/' }, columns: i, guide: e, units: [{ type: 'PARALLEL/ELEMENT.LINE', color: r('color', t.color, e.color), columns: i, expression: { operator: 'none', source: '/' } }] }, plugins: t.plugins || [] } }, Ua.concat([function (t) { if (!(t.columns && t.columns.length > 1)) return '[columns] property must contain at least 2 dimensions' }])); var Xa = '2.6.1'; e.default = { GPL: Ge, Plot: nr, Chart: ur, api: Ga, version: '2.6.1' } }, function (t, n) { t.exports = e }, function (t, e) { t.exports = n }, function (t, e) { t.exports = r }, function (t, e) { t.exports = i }, function (t, e) { t.exports = a }, function (t, e) { t.exports = o }, function (t, e) { t.exports = s }, function (t, e) { t.exports = u }, function (t, e, n) { var r, i, a; !(function (n, o) { i = [], void 0 === (a = typeof (r = o) === 'function' ? r.apply(e, i) : r) || (t.exports = a) }(0, function () { return (function (t) { var e = {}; function n (r) { if (e[r]) return e[r].exports; var i = e[r] = { exports: {}, id: r, loaded: !1 }; return t[r].call(i.exports, i, i.exports, n), i.loaded = !0, i.exports } return n.m = t, n.c = e, n.p = '', n(0) }([function (t, e) { 'use strict'; Object.defineProperty(e, '__esModule', { value: !0 }); var n = function (t, e) { return t.indexOf(e) }; var r = window; var i = r.document; var a = i.documentElement; var o = ['top', 'bottom']; function s (t, e) { for (var n in e)t[n] = e[n]; return t } function u (t) { var e = r.pageYOffset || a.scrollTop; var n = r.pageXOffset || a.scrollLeft; var i = { left: 0, right: 0, top: 0, bottom: 0, width: 0, height: 0 }; if (function (t) { return t && t.setInterval != null }(t))i.width = r.innerWidth || a.clientWidth, i.height = r.innerHeight || a.clientHeight; else { if (!a.contains(t) || t.getBoundingClientRect == null) return i; s(i, t.getBoundingClientRect()), i.width = i.right - i.left, i.height = i.bottom - i.top } return i.top = i.top + e - a.clientTop, i.left = i.left + n - a.clientLeft, i.right = i.left + i.width, i.bottom = i.top + i.height, i } var l = function (t, e) { return r.getComputedStyle(t)[e] }; function c (t) { var e = String(l(t, c.propName)); var n = e.match(/([0-9.]+)([ms]{1,2})/); return n && (e = Number(n[1]), n[2] === 's' && (e *= 1e3)), 0 | e }c.propName = (function () { for (var t = i.createElement('div'), e = ['transitionDuration', 'webkitTransitionDuration'], n = 0; n < e.length; n++) if (t.style[e[n]] = '1s', t.style[e[n]] === '1s') return e[n] }()); var f = Object.create; function d (t, e) { if (!(this instanceof d)) return new d(t, e); this.hidden = 1, this.options = s(f(d.defaults), e), this._createElement(), t && this.content(t) }d.prototype._createElement = function () { var t; this.element = i.createElement('div'), this.classes = (function (t) { return { add: function (e) { t.classList.add(e) }, remove: function (e) { t.classList.remove(e) } } }(this.element)), this.classes.add(this.options.baseClass); for (var e = 0; e < d.classTypes.length; e++)t = d.classTypes[e] + 'Class', this.options[t] && this.classes.add(this.options[t]) }, d.prototype.type = function (t) { return this.changeClassType('type', t) }, d.prototype.effect = function (t) { return this.changeClassType('effect', t) }, d.prototype.changeClassType = function (t, e) { return t += 'Class', this.options[t] && this.classes.remove(this.options[t]), this.options[t] = e, e && this.classes.add(e), this }, d.prototype.updateSize = function () { return this.hidden && (this.element.style.visibility = 'hidden', i.body.appendChild(this.element)), this.width = this.element.offsetWidth, this.height = this.element.offsetHeight, this.spacing == null && (this.spacing = this.options.spacing != null ? this.options.spacing : (function (t) { return 0 | Math.round(String(t).replace(/[^\-0-9.]/g, '')) }(l(this.element, 'top')))), this.hidden ? (i.body.removeChild(this.element), this.element.style.visibility = '') : this.position(), this }, d.prototype.content = function (t) { return typeof t === 'object' ? (this.element.innerHTML = '', this.element.appendChild(t)) : this.element.innerHTML = t, this.updateSize(), this }, d.prototype.place = function (t) { return this.options.place = t, this.hidden || this.position(), this }, d.prototype.attach = function (t) { return this.attachedTo = t, this.hidden || this.position(), this }, d.prototype.detach = function () { return this.hide(), this.attachedTo = null, this }, d.prototype._pickPlace = function (t) { if (!this.options.auto) return this.options.place; var e = u(r); var i = this.options.place.split('-'); var a = this.spacing; if (n(o, i[0]) !== -1) switch (t.top - this.height - a <= e.top ? i[0] = 'bottom' : t.bottom + this.height + a >= e.bottom && (i[0] = 'top'), i[1]) { case 'left':t.right - this.width <= e.left && (i[1] = 'right'); break; case 'right':t.left + this.width >= e.right && (i[1] = 'left'); break; default:t.left + t.width / 2 + this.width / 2 >= e.right ? i[1] = 'left' : t.right - t.width / 2 - this.width / 2 <= e.left && (i[1] = 'right') } else switch (t.left - this.width - a <= e.left ? i[0] = 'right' : t.right + this.width + a >= e.right && (i[0] = 'left'), i[1]) { case 'top':t.bottom - this.height <= e.top && (i[1] = 'bottom'); break; case 'bottom':t.top + this.height >= e.bottom && (i[1] = 'top'); break; default:t.top + t.height / 2 + this.height / 2 >= e.bottom ? i[1] = 'top' : t.bottom - t.height / 2 - this.height / 2 <= e.top && (i[1] = 'bottom') } return i.join('-') }, d.prototype.position = function (t, e) { this.attachedTo && (t = this.attachedTo), t == null && this._p ? (t = this._p[0], e = this._p[1]) : this._p = arguments; var n; var r; var i = typeof t === 'number' ? { left: 0 | t, right: 0 | t, top: 0 | e, bottom: 0 | e, width: 0, height: 0 } : u(t); var a = this.spacing; var o = this._pickPlace(i); switch (o !== this.curPlace && (this.curPlace && this.classes.remove(this.curPlace), this.classes.add(o), this.curPlace = o), this.curPlace) { case 'top':n = i.top - this.height - a, r = i.left + i.width / 2 - this.width / 2; break; case 'top-left':n = i.top - this.height - a, r = i.right - this.width; break; case 'top-right':n = i.top - this.height - a, r = i.left; break; case 'bottom':n = i.bottom + a, r = i.left + i.width / 2 - this.width / 2; break; case 'bottom-left':n = i.bottom + a, r = i.right - this.width; break; case 'bottom-right':n = i.bottom + a, r = i.left; break; case 'left':n = i.top + i.height / 2 - this.height / 2, r = i.left - this.width - a; break; case 'left-top':n = i.bottom - this.height, r = i.left - this.width - a; break; case 'left-bottom':n = i.top, r = i.left - this.width - a; break; case 'right':n = i.top + i.height / 2 - this.height / 2, r = i.right + a; break; case 'right-top':n = i.bottom - this.height, r = i.right + a; break; case 'right-bottom':n = i.top, r = i.right + a } return this.element.style.top = Math.round(n) + 'px', this.element.style.left = Math.round(r) + 'px', this }, d.prototype.show = function (t, e) { return t = this.attachedTo ? this.attachedTo : t, clearTimeout(this.aIndex), t != null && this.position(t, e), this.hidden && (this.hidden = 0, i.body.appendChild(this.element)), this.attachedTo && this._aware(), this.options.inClass && (this.options.effectClass && this.element.clientHeight, this.classes.add(this.options.inClass)), this }, d.prototype.getElement = function () { return this.element }, d.prototype.hide = function () { if (!this.hidden) { var t = this; var e = 0; return this.options.inClass && (this.classes.remove(this.options.inClass), this.options.effectClass && (e = c(this.element))), this.attachedTo && this._unaware(), clearTimeout(this.aIndex), this.aIndex = setTimeout(function () { t.aIndex = 0, i.body.removeChild(t.element), t.hidden = 1 }, e), this } }, d.prototype.toggle = function (t, e) { return this[this.hidden ? 'show' : 'hide'](t, e) }, d.prototype.destroy = function () { clearTimeout(this.aIndex), this._unaware(), this.hidden || i.body.removeChild(this.element), this.element = this.options = null }, d.prototype._aware = function () { n(d.winAware, this) === -1 && d.winAware.push(this) }, d.prototype._unaware = function () { var t = n(d.winAware, this); t !== -1 && d.winAware.splice(t, 1) }, d.reposition = (function () { var t; var e = window.requestAnimationFrame || window.webkitRequestAnimationFrame || function (t) { return setTimeout(t, 17) }; function n () { t = 0; for (var e = 0, n = d.winAware.length; e < n; e++)d.winAware[e].position() } return function () { !t && d.winAware.length && (t = e(n)) } }()), d.winAware = [], window.addEventListener('resize', d.reposition), window.addEventListener('scroll', d.reposition), d.classTypes = ['type', 'effect'], d.defaults = { baseClass: 'tooltip', typeClass: null, effectClass: null, inClass: 'in', place: 'top', spacing: null, auto: 0 }, e.Tooltip = d }])) })) }, function (t, e) { t.exports = l }, function (t, e) { t.exports = c }, function (t, e) { t.exports = f }, function (t, e) { t.exports = d }, function (t, e) { t.exports = h }, function (t, e, n) { 'use strict'; if (window.requestAnimationFrame || (function () { var t = 0; window.requestAnimationFrame = function (e) { var n = Date.now(); var r = Math.max(0, 16 - n + t); return t = n + r, setTimeout(function () { e.call(null, n + r) }, r) }, window.cancelAnimationFrame = function (t) { clearTimeout(t) } }()), window.requestIdleCallback || (window.requestIdleCallback = function (t, e) { return setTimeout(t, e && e.timeout ? e.timeout : 0) }, window.cancelIdleCallback = function (t) { clearTimeout(t) }), Number.isFinite || Object.defineProperty(Number, 'isFinite', { value: function (t) { return typeof t === 'number' && isFinite(t) }, configurable: !0, enumerable: !1, writable: !0 }), Number.isNaN || Object.defineProperty(Number, 'isNaN', { value: function (t) { return typeof t === 'number' && isNaN(t) }, configurable: !0, enumerable: !1, writable: !0 }), Number.isInteger || Object.defineProperty(Number, 'isInteger', { value: function (t) { return typeof t === 'number' && isFinite(t) && Math.floor(t) === t }, configurable: !0, enumerable: !1, writable: !0 }), Number.MAX_SAFE_INTEGER || Object.defineProperty(Number, 'MAX_SAFE_INTEGER', { value: 9007199254740991, configurable: !1, enumerable: !1, writable: !1 }), Math.sign || (Math.sign = function (t) { return (t > 0) - (t < 0) || Number(t) }), Array.prototype.find || Object.defineProperty(Array.prototype, 'find', { value: function (t) { if (this == null) throw new TypeError('Array.prototype.find called on null or undefined'); if (typeof t !== 'function') throw new TypeError('predicate must be a function'); for (var e, n = Object(this), r = n.length >>> 0, i = arguments[1], a = 0; a < r; a++) if (e = n[a], t.call(i, e, a, n)) return e }, configurable: !0, enumerable: !1, writable: !0 }), Array.prototype.findIndex || Object.defineProperty(Array.prototype, 'findIndex', { value: function (t) { if (this == null) throw new TypeError('Array.prototype.findIndex called on null or undefined'); if (typeof t !== 'function') throw new TypeError('predicate must be a function'); for (var e, n = Object(this), r = n.length >>> 0, i = arguments[1], a = 0; a < r; a++) if (e = n[a], t.call(i, e, a, n)) return a; return -1 }, configurable: !0, enumerable: !1, writable: !0 }), !Array.from) { Object.defineProperty(Array, 'from', { value: (function () { var t = Object.prototype.toString; var e = function (e) { return typeof e === 'function' || t.call(e) === '[object Function]' }; var n = Math.pow(2, 53) - 1; var r = function (t) { var e = (function (t) { var e = Number(t); return isNaN(e) ? 0 : e !== 0 && isFinite(e) ? (e > 0 ? 1 : -1) * Math.floor(Math.abs(e)) : e }(t)); return Math.min(Math.max(e, 0), n) }; return function (t) { var n = Object(t); if (t == null) throw new TypeError('Array.from requires an array-like object - not null or undefined'); var i; var a = arguments.length > 1 ? arguments[1] : void 0; if (void 0 !== a) { if (!e(a)) throw new TypeError('Array.from: when provided, the second argument must be a function'); arguments.length > 2 && (i = arguments[2]) } for (var o, s = r(n.length), u = e(this) ? Object(new this(s)) : new Array(s), l = 0; l < s;)o = n[l], u[l] = a ? void 0 === i ? a(o, l) : a.call(i, o, l) : o, l += 1; return u.length = s, u } }()), configurable: !0, enumerable: !1, writable: !0 }); var r = Map.prototype.set; Object.defineProperty(Map.prototype, 'set', { value: function () { return r.apply(this, arguments), this }, configurable: !0, enumerable: !1, writable: !0 }), Object.defineProperty(Map.prototype, 'values', { value: function () { var t = {}; var e = 0; return this.forEach(function (n) { return t[String(e++)] = n }), t.length = e, t }, configurable: !0, enumerable: !1, writable: !0 }), Object.defineProperty(Map.prototype, 'entries', { value: function () { var t = {}; var e = 0; return this.forEach(function (n, r) { return t[String(e++)] = [r, n] }), t.length = e, t }, configurable: !0, enumerable: !1, writable: !0 }) }Object.assign || Object.defineProperty(Object, 'assign', { value: function (t) { if (void 0 === t || t === null) throw new TypeError('Cannot convert undefined or null to object'); for (var e = Object(t), n = 1; n < arguments.length; n++) { var r = arguments[n]; if (void 0 !== r && r !== null) for (var i in r)r.hasOwnProperty(i) && (e[i] = r[i]) } return e }, configurable: !0, enumerable: !1, writable: !0 }), Element.prototype.matches || Object.defineProperty(Element.prototype, 'matches', { value: Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector, configurable: !0, enumerable: !0, writable: !0 }) }, function (t, e, n) { t.exports = (function (t, e) { 'use strict'; var n; return t = t && t.hasOwnProperty('default') ? t.default : t, e = e && e.hasOwnProperty('default') ? e.default : e, (function (n) { var r; function i () { return document.createElement('canvas') }n.exports, (r = window).DOMParser = window.DOMParser; var a; var o = function (n, s, u) { if (n != null || s != null || u != null) { var l = (function (n) { var o = { opts: n, FRAMERATE: 30, MAX_VIRTUAL_PIXELS: 3e4, log: function (t) {} }; o.opts.log == 1 && typeof console !== 'undefined' && (o.log = function (t) { console.log(t) }), o.init = function (t) { var e = 0; o.UniqueId = function () { return 'canvg' + ++e }, o.Definitions = {}, o.Styles = {}, o.StylesSpecificity = {}, o.Animations = [], o.Images = [], o.ctx = t, o.ViewPort = new function () { this.viewPorts = [], this.Clear = function () { this.viewPorts = [] }, this.SetCurrent = function (t, e) { this.viewPorts.push({ width: t, height: e }) }, this.RemoveCurrent = function () { this.viewPorts.pop() }, this.Current = function () { return this.viewPorts[this.viewPorts.length - 1] }, this.width = function () { return this.Current().width }, this.height = function () { return this.Current().height }, this.ComputeSize = function (t) { return t != null && typeof t === 'number' ? t : t == 'x' ? this.width() : t == 'y' ? this.height() : Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2) } }() }, o.init(), o.ImagesLoaded = function () { for (var t = 0; t < o.Images.length; t++) if (!o.Images[t].loaded) return !1; return !0 }, o.trim = function (t) { return t.replace(/^\s+|\s+$/g, '') }, o.compressSpaces = function (t) { return t.replace(/[\s\r\t\n]+/gm, ' ') }, o.ajax = function (t) { var e; return (e = r.XMLHttpRequest ? new r.XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP')) ? (e.open('GET', t, !1), e.send(null), e.responseText) : null }, o.parseXml = function (t) { if (typeof Windows !== 'undefined' && void 0 !== Windows.Data && void 0 !== Windows.Data.Xml) { var e = new Windows.Data.Xml.Dom.XmlDocument(); var i = new Windows.Data.Xml.Dom.XmlLoadSettings(); return i.prohibitDtd = !1, e.loadXml(t, i), e } if (!r.DOMParser) { t = t.replace(/<!DOCTYPE svg[^>]*>/, ''); var e = new ActiveXObject('Microsoft.XMLDOM'); return e.async = 'false', e.loadXML(t), e } try { var a = new r.DOMParser(n.xmldom || {}); return a.parseFromString(t, 'image/svg+xml') } catch (e) { return (a = new r.DOMParser(n.xmldom || {})).parseFromString(t, 'text/xml') } }, o.Property = function (t, e) { this.name = t, this.value = e }, o.Property.prototype.getValue = function () { return this.value }, o.Property.prototype.hasValue = function () { return this.value != null && this.value !== '' }, o.Property.prototype.numValue = function () { if (!this.hasValue()) return 0; var t = parseFloat(this.value); return (this.value + '').match(/%$/) && (t /= 100), t }, o.Property.prototype.valueOrDefault = function (t) { return this.hasValue() ? this.value : t }, o.Property.prototype.numValueOrDefault = function (t) { return this.hasValue() ? this.numValue() : t }, o.Property.prototype.addOpacity = function (e) { var n = this.value; if (e.value != null && e.value != '' && typeof this.value === 'string') { var r = new t(this.value); r.ok && (n = 'rgba(' + r.r + ', ' + r.g + ', ' + r.b + ', ' + e.numValue() + ')') } return new o.Property(this.name, n) }, o.Property.prototype.getDefinition = function () { var t = this.value.match(/#([^\)'"]+)/); return t && (t = t[1]), t || (t = this.value), o.Definitions[t] }, o.Property.prototype.isUrlDefinition = function () { return this.value.indexOf('url(') == 0 }, o.Property.prototype.getFillStyleDefinition = function (t, e) { var n = this.getDefinition(); if (n != null && n.createGradient) return n.createGradient(o.ctx, t, e); if (n != null && n.createPattern) { if (n.getHrefAttribute().hasValue()) { var r = n.attribute('patternTransform'); n = n.getHrefAttribute().getDefinition(), r.hasValue() && (n.attribute('patternTransform', !0).value = r.value) } return n.createPattern(o.ctx, t) } return null }, o.Property.prototype.getDPI = function (t) { return 96 }, o.Property.prototype.getEM = function (t) { var e = 12; var n = new o.Property('fontSize', o.Font.Parse(o.ctx.font).fontSize); return n.hasValue() && (e = n.toPixels(t)), e }, o.Property.prototype.getUnits = function () { var t = this.value + ''; return t.replace(/[0-9\.\-]/g, '') }, o.Property.prototype.toPixels = function (t, e) { if (!this.hasValue()) return 0; var n = this.value + ''; if (n.match(/em$/)) return this.numValue() * this.getEM(t); if (n.match(/ex$/)) return this.numValue() * this.getEM(t) / 2; if (n.match(/px$/)) return this.numValue(); if (n.match(/pt$/)) return this.numValue() * this.getDPI(t) * (1 / 72); if (n.match(/pc$/)) return 15 * this.numValue(); if (n.match(/cm$/)) return this.numValue() * this.getDPI(t) / 2.54; if (n.match(/mm$/)) return this.numValue() * this.getDPI(t) / 25.4; if (n.match(/in$/)) return this.numValue() * this.getDPI(t); if (n.match(/%$/)) return this.numValue() * o.ViewPort.ComputeSize(t); var r = this.numValue(); return e && r < 1 ? r * o.ViewPort.ComputeSize(t) : r }, o.Property.prototype.toMilliseconds = function () { if (!this.hasValue()) return 0; var t = this.value + ''; return t.match(/s$/) ? 1e3 * this.numValue() : (t.match(/ms$/), this.numValue()) }, o.Property.prototype.toRadians = function () { if (!this.hasValue()) return 0; var t = this.value + ''; return t.match(/deg$/) ? this.numValue() * (Math.PI / 180) : t.match(/grad$/) ? this.numValue() * (Math.PI / 200) : t.match(/rad$/) ? this.numValue() : this.numValue() * (Math.PI / 180) }; var s = { baseline: 'alphabetic', 'before-edge': 'top', 'text-before-edge': 'top', middle: 'middle', central: 'middle', 'after-edge': 'bottom', 'text-after-edge': 'bottom', ideographic: 'ideographic', alphabetic: 'alphabetic', hanging: 'hanging', mathematical: 'alphabetic' }; return o.Property.prototype.toTextBaseline = function () { return this.hasValue() ? s[this.value] : null }, o.Font = new function () { this.Styles = 'normal|italic|oblique|inherit', this.Variants = 'normal|small-caps|inherit', this.Weights = 'normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit', this.CreateFont = function (t, e, n, r, i, a) { var s = a != null ? this.Parse(a) : this.CreateFont('', '', '', '', '', o.ctx.font); return { fontFamily: i = i || s.fontFamily, fontSize: r || s.fontSize, fontStyle: t || s.fontStyle, fontWeight: n || s.fontWeight, fontVariant: e || s.fontVariant, toString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') } } }; var t = this; this.Parse = function (e) { for (var n = {}, r = o.trim(o.compressSpaces(e || '')).split(' '), i = { fontSize: !1, fontStyle: !1, fontWeight: !1, fontVariant: !1 }, a = '', s = 0; s < r.length; s++)i.fontStyle || t.Styles.indexOf(r[s]) == -1 ? i.fontVariant || t.Variants.indexOf(r[s]) == -1 ? i.fontWeight || t.Weights.indexOf(r[s]) == -1 ? i.fontSize ? r[s] != 'inherit' && (a += r[s]) : (r[s] != 'inherit' && (n.fontSize = r[s].split('/')[0]), i.fontStyle = i.fontVariant = i.fontWeight = i.fontSize = !0) : (r[s] != 'inherit' && (n.fontWeight = r[s]), i.fontStyle = i.fontVariant = i.fontWeight = !0) : (r[s] != 'inherit' && (n.fontVariant = r[s]), i.fontStyle = i.fontVariant = !0) : (r[s] != 'inherit' && (n.fontStyle = r[s]), i.fontStyle = !0); return a != '' && (n.fontFamily = a), n } }(), o.ToNumberArray = function (t) { for (var e = o.trim(o.compressSpaces((t || '').replace(/,/g, ' '))).split(' '), n = 0; n < e.length; n++)e[n] = parseFloat(e[n]); return e }, o.Point = function (t, e) { this.x = t, this.y = e }, o.Point.prototype.angleTo = function (t) { return Math.atan2(t.y - this.y, t.x - this.x) }, o.Point.prototype.applyTransform = function (t) { var e = this.x * t[0] + this.y * t[2] + t[4]; var n = this.x * t[1] + this.y * t[3] + t[5]; this.x = e, this.y = n }, o.CreatePoint = function (t) { var e = o.ToNumberArray(t); return new o.Point(e[0], e[1]) }, o.CreatePath = function (t) { for (var e = o.ToNumberArray(t), n = [], r = 0; r < e.length; r += 2)n.push(new o.Point(e[r], e[r + 1])); return n }, o.BoundingBox = function (t, e, n, r) { this.x1 = Number.NaN, this.y1 = Number.NaN, this.x2 = Number.NaN, this.y2 = Number.NaN, this.x = function () { return this.x1 }, this.y = function () { return this.y1 }, this.width = function () { return this.x2 - this.x1 }, this.height = function () { return this.y2 - this.y1 }, this.addPoint = function (t, e) { t != null && ((isNaN(this.x1) || isNaN(this.x2)) && (this.x1 = t, this.x2 = t), t < this.x1 && (this.x1 = t), t > this.x2 && (this.x2 = t)), e != null && ((isNaN(this.y1) || isNaN(this.y2)) && (this.y1 = e, this.y2 = e), e < this.y1 && (this.y1 = e), e > this.y2 && (this.y2 = e)) }, this.addX = function (t) { this.addPoint(t, null) }, this.addY = function (t) { this.addPoint(null, t) }, this.addBoundingBox = function (t) { this.addPoint(t.x1, t.y1), this.addPoint(t.x2, t.y2) }, this.addQuadraticCurve = function (t, e, n, r, i, a) { var o = t + 2 / 3 * (n - t); var s = e + 2 / 3 * (r - e); var u = o + 1 / 3 * (i - t); var l = s + 1 / 3 * (a - e); this.addBezierCurve(t, e, o, u, s, l, i, a) }, this.addBezierCurve = function (t, e, n, r, i, a, o, s) { var u = [t, e]; var l = [n, r]; var c = [i, a]; var f = [o, s]; this.addPoint(u[0], u[1]), this.addPoint(f[0], f[1]); for (var d = 0; d <= 1; d++) { var h = function (t) { return Math.pow(1 - t, 3) * u[d] + 3 * Math.pow(1 - t, 2) * t * l[d] + 3 * (1 - t) * Math.pow(t, 2) * c[d] + Math.pow(t, 3) * f[d] }; var p = 6 * u[d] - 12 * l[d] + 6 * c[d]; var g = -3 * u[d] + 9 * l[d] - 9 * c[d] + 3 * f[d]; var m = 3 * l[d] - 3 * u[d]; if (g != 0) { var y = Math.pow(p, 2) - 4 * m * g; if (!(y < 0)) { var v = (-p + Math.sqrt(y)) / (2 * g); v > 0 && v < 1 && (d == 0 && this.addX(h(v)), d == 1 && this.addY(h(v))); var b = (-p - Math.sqrt(y)) / (2 * g); b > 0 && b < 1 && (d == 0 && this.addX(h(b)), d == 1 && this.addY(h(b))) } } else { if (p == 0) continue; var x = -m / p; x > 0 && x < 1 && (d == 0 && this.addX(h(x)), d == 1 && this.addY(h(x))) } } }, this.isPointInBox = function (t, e) { return this.x1 <= t && t <= this.x2 && this.y1 <= e && e <= this.y2 }, this.addPoint(t, e), this.addPoint(n, r) }, o.Transform = function (t) { var e = this; this.Type = {}, this.Type.translate = function (t) { this.p = o.CreatePoint(t), this.apply = function (t) { t.translate(this.p.x || 0, this.p.y || 0) }, this.unapply = function (t) { t.translate(-1 * this.p.x || 0, -1 * this.p.y || 0) }, this.applyToPoint = function (t) { t.applyTransform([1, 0, 0, 1, this.p.x || 0, this.p.y || 0]) } }, this.Type.rotate = function (t) { var e = o.ToNumberArray(t); this.angle = new o.Property('angle', e[0]), this.cx = e[1] || 0, this.cy = e[2] || 0, this.apply = function (t) { t.translate(this.cx, this.cy), t.rotate(this.angle.toRadians()), t.translate(-this.cx, -this.cy) }, this.unapply = function (t) { t.translate(this.cx, this.cy), t.rotate(-1 * this.angle.toRadians()), t.translate(-this.cx, -this.cy) }, this.applyToPoint = function (t) { var e = this.angle.toRadians(); t.applyTransform([1, 0, 0, 1, this.p.x || 0, this.p.y || 0]), t.applyTransform([Math.cos(e), Math.sin(e), -Math.sin(e), Math.cos(e), 0, 0]), t.applyTransform([1, 0, 0, 1, -this.p.x || 0, -this.p.y || 0]) } }, this.Type.scale = function (t) { this.p = o.CreatePoint(t), this.apply = function (t) { t.scale(this.p.x || 1, this.p.y || this.p.x || 1) }, this.unapply = function (t) { t.scale(1 / this.p.x || 1, 1 / this.p.y || this.p.x || 1) }, this.applyToPoint = function (t) { t.applyTransform([this.p.x || 0, 0, 0, this.p.y || 0, 0, 0]) } }, this.Type.matrix = function (t) { this.m = o.ToNumberArray(t), this.apply = function (t) { t.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]) }, this.unapply = function (t) { var e = this.m[0]; var n = this.m[2]; var r = this.m[4]; var i = this.m[1]; var a = this.m[3]; var o = this.m[5]; var s = 1 / (e * (1 * a - 0 * o) - n * (1 * i - 0 * o) + r * (0 * i - 0 * a)); t.transform(s * (1 * a - 0 * o), s * (0 * o - 1 * i), s * (0 * r - 1 * n), s * (1 * e - 0 * r), s * (n * o - r * a), s * (r * i - e * o)) }, this.applyToPoint = function (t) { t.applyTransform(this.m) } }, this.Type.SkewBase = function (t) { this.base = e.Type.matrix, this.base(t), this.angle = new o.Property('angle', t) }, this.Type.SkewBase.prototype = new this.Type.matrix(), this.Type.skewX = function (t) { this.base = e.Type.SkewBase, this.base(t), this.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0] }, this.Type.skewX.prototype = new this.Type.SkewBase(), this.Type.skewY = function (t) { this.base = e.Type.SkewBase, this.base(t), this.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0] }, this.Type.skewY.prototype = new this.Type.SkewBase(), this.transforms = [], this.apply = function (t) { for (var e = 0; e < this.transforms.length; e++) this.transforms[e].apply(t) }, this.unapply = function (t) { for (var e = this.transforms.length - 1; e >= 0; e--) this.transforms[e].unapply(t) }, this.applyToPoint = function (t) { for (var e = 0; e < this.transforms.length; e++) this.transforms[e].applyToPoint(t) }; for (var n = o.trim(o.compressSpaces(t)).replace(/\)([a-zA-Z])/g, ') $1').replace(/\)(\s?,\s?)/g, ') ').split(/\s(?=[a-z])/), r = 0; r < n.length; r++) { var i = o.trim(n[r].split('(')[0]); var a = n[r].split('(')[1].replace(')', ''); var s = this.Type[i]; if (void 0 !== s) { var u = new s(a); u.type = i, this.transforms.push(u) } } }, o.AspectRatio = function (t, e, n, r, i, a, s, u, l, c) { var f = (e = (e = o.compressSpaces(e)).replace(/^defer\s/, '')).split(' ')[0] || 'xMidYMid'; var d = e.split(' ')[1] || 'meet'; var h = n / r; var p = i / a; var g = Math.min(h, p); var m = Math.max(h, p); d == 'meet' && (r *= g, a *= g), d == 'slice' && (r *= m, a *= m), l = new o.Property('refX', l), c = new o.Property('refY', c), l.hasValue() && c.hasValue() ? t.translate(-g * l.toPixels('x'), -g * c.toPixels('y')) : (f.match(/^xMid/) && (d == 'meet' && g == p || d == 'slice' && m == p) && t.translate(n / 2 - r / 2, 0), f.match(/YMid$/) && (d == 'meet' && g == h || d == 'slice' && m == h) && t.translate(0, i / 2 - a / 2), f.match(/^xMax/) && (d == 'meet' && g == p || d == 'slice' && m == p) && t.translate(n - r, 0), f.match(/YMax$/) && (d == 'meet' && g == h || d == 'slice' && m == h) && t.translate(0, i - a)), f == 'none' ? t.scale(h, p) : d == 'meet' ? t.scale(g, g) : d == 'slice' && t.scale(m, m), t.translate(s == null ? 0 : -s, u == null ? 0 : -u) }, o.Element = {}, o.EmptyProperty = new o.Property('EMPTY', ''), o.Element.ElementBase = function (t) { this.attributes = {}, this.styles = {}, this.stylesSpecificity = {}, this.children = [], this.attribute = function (t, e) { var n = this.attributes[t]; return n != null ? n : (e == 1 && (n = new o.Property(t, ''), this.attributes[t] = n), n || o.EmptyProperty) }, this.getHrefAttribute = function () { for (var t in this.attributes) if (t == 'href' || t.match(/:href$/)) return this.attributes[t]; return o.EmptyProperty }, this.style = function (t, e, n) { var r = this.styles[t]; if (r != null) return r; var i = this.attribute(t); if (i != null && i.hasValue()) return this.styles[t] = i; if (n != 1) { var a = this.parent; if (a != null) { var s = a.style(t); if (s != null && s.hasValue()) return s } } return e == 1 && (r = new o.Property(t, ''), this.styles[t] = r), r || o.EmptyProperty }, this.render = function (t) { if (this.style('display').value != 'none' && this.style('visibility').value != 'hidden') { if (t.save(), this.style('mask').hasValue()) { var e = this.style('mask').getDefinition(); e != null && e.apply(t, this) } else if (this.style('filter').hasValue()) { var n = this.style('filter').getDefinition(); n != null && n.apply(t, this) } else this.setContext(t), this.renderChildren(t), this.clearContext(t); t.restore() } }, this.setContext = function (t) {}, this.clearContext = function (t) {}, this.renderChildren = function (t) { for (var e = 0; e < this.children.length; e++) this.children[e].render(t) }, this.addChild = function (t, e) { var n = t; e && (n = o.CreateElement(t)), n.parent = this, n.type != 'title' && this.children.push(n) }, this.addStylesFromStyleDefinition = function () { for (var e in o.Styles) if (e[0] != '@' && a(t, e)) { var n = o.Styles[e]; var r = o.StylesSpecificity[e]; if (n != null) for (var i in n) { var s = this.stylesSpecificity[i]; void 0 === s && (s = '000'), s < r && (this.styles[i] = n[i], this.stylesSpecificity[i] = r) } } }; var e; var n = new RegExp('^[A-Z-]+$'); if (t != null && t.nodeType == 1) { for (var r = 0; r < t.attributes.length; r++) { var i = t.attributes[r]; var s = (e = i.nodeName, n.test(e) ? e.toLowerCase() : e); this.attributes[s] = new o.Property(s, i.value) } if (this.addStylesFromStyleDefinition(), this.attribute('style').hasValue()) { var u = this.attribute('style').value.split(';'); for (r = 0; r < u.length; r++) if (o.trim(u[r]) != '') { var l = u[r].split(':'); var c = o.trim(l[0]); var f = o.trim(l[1]); this.styles[c] = new o.Property(c, f) } } for (this.attribute('id').hasValue() && o.Definitions[this.attribute('id').value] == null && (o.Definitions[this.attribute('id').value] = this), r = 0; r < t.childNodes.length; r++) { var d = t.childNodes[r]; if (d.nodeType == 1 && this.addChild(d, !0), this.captureTextNodes && (d.nodeType == 3 || d.nodeType == 4)) { var h = d.value || d.text || d.textContent || ''; o.compressSpaces(h) != '' && this.addChild(new o.Element.tspan(d), !1) } } } }, o.Element.RenderedElementBase = function (t) { this.base = o.Element.ElementBase, this.base(t), this.setContext = function (t) { var e; if (this.style('fill').isUrlDefinition())(e = this.style('fill').getFillStyleDefinition(this, this.style('fill-opacity'))) != null && (t.fillStyle = e); else if (this.style('fill').hasValue()) { var n; (n = this.style('fill')).value == 'currentColor' && (n.value = this.style('color').value), n.value != 'inherit' && (t.fillStyle = n.value == 'none' ? 'rgba(0,0,0,0)' : n.value) } if (this.style('fill-opacity').hasValue() && (n = (n = new o.Property('fill', t.fillStyle)).addOpacity(this.style('fill-opacity')), t.fillStyle = n.value), this.style('stroke').isUrlDefinition())(e = this.style('stroke').getFillStyleDefinition(this, this.style('stroke-opacity'))) != null && (t.strokeStyle = e); else if (this.style('stroke').hasValue()) { var r; (r = this.style('stroke')).value == 'currentColor' && (r.value = this.style('color').value), r.value != 'inherit' && (t.strokeStyle = r.value == 'none' ? 'rgba(0,0,0,0)' : r.value) } if (this.style('stroke-opacity').hasValue() && (r = (r = new o.Property('stroke', t.strokeStyle)).addOpacity(this.style('stroke-opacity')), t.strokeStyle = r.value), this.style('stroke-width').hasValue()) { var i = this.style('stroke-width').toPixels(); t.lineWidth = i == 0 ? 0.001 : i } if (this.style('stroke-linecap').hasValue() && (t.lineCap = this.style('stroke-linecap').value), this.style('stroke-linejoin').hasValue() && (t.lineJoin = this.style('stroke-linejoin').value), this.style('stroke-miterlimit').hasValue() && (t.miterLimit = this.style('stroke-miterlimit').value), this.style('paint-order').hasValue() && (t.paintOrder = this.style('paint-order').value), this.style('stroke-dasharray').hasValue() && this.style('stroke-dasharray').value != 'none') { var a = o.ToNumberArray(this.style('stroke-dasharray').value); void 0 !== t.setLineDash ? t.setLineDash(a) : void 0 !== t.webkitLineDash ? t.webkitLineDash = a : void 0 === t.mozDash || a.length == 1 && a[0] == 0 || (t.mozDash = a); var s = this.style('stroke-dashoffset').numValueOrDefault(1); void 0 !== t.lineDashOffset ? t.lineDashOffset = s : void 0 !== t.webkitLineDashOffset ? t.webkitLineDashOffset = s : void 0 !== t.mozDashOffset && (t.mozDashOffset = s) } if (void 0 !== t.font && (t.font = o.Font.CreateFont(this.style('font-style').value, this.style('font-variant').value, this.style('font-weight').value, this.style('font-size').hasValue() ? this.style('font-size').toPixels() + 'px' : '', this.style('font-family').value).toString()), this.style('transform', !1, !0).hasValue() && new o.Transform(this.style('transform', !1, !0).value).apply(t), this.style('clip-path', !1, !0).hasValue()) { var u = this.style('clip-path', !1, !0).getDefinition(); u != null && u.apply(t) } this.style('opacity').hasValue() && (t.globalAlpha = this.style('opacity').numValue()) } }, o.Element.RenderedElementBase.prototype = new o.Element.ElementBase(), o.Element.PathElementBase = function (t) { this.base = o.Element.RenderedElementBase, this.base(t), this.path = function (t) { return t != null && t.beginPath(), new o.BoundingBox() }, this.renderChildren = function (t) { this.path(t), o.Mouse.checkPath(this, t), t.fillStyle != '' && (this.style('fill-rule').valueOrDefault('inherit') != 'inherit' ? t.fill(this.style('fill-rule').value) : t.fill()), t.strokeStyle != '' && t.stroke(); var e = this.getMarkers(); if (e != null) { if (this.style('marker-start').isUrlDefinition() && (n = this.style('marker-start').getDefinition()).render(t, e[0][0], e[0][1]), this.style('marker-mid').isUrlDefinition()) for (var n = this.style('marker-mid').getDefinition(), r = 1; r < e.length - 1; r++)n.render(t, e[r][0], e[r][1]); this.style('marker-end').isUrlDefinition() && (n = this.style('marker-end').getDefinition()).render(t, e[e.length - 1][0], e[e.length - 1][1]) } }, this.getBoundingBox = function () { return this.path() }, this.getMarkers = function () { return null } }, o.Element.PathElementBase.prototype = new o.Element.RenderedElementBase(), o.Element.svg = function (t) { this.base = o.Element.RenderedElementBase, this.base(t), this.baseClearContext = this.clearContext, this.clearContext = function (t) { this.baseClearContext(t), o.ViewPort.RemoveCurrent() }, this.baseSetContext = this.setContext, this.setContext = function (t) { t.strokeStyle = 'rgba(0,0,0,0)', t.lineCap = 'butt', t.lineJoin = 'miter', t.miterLimit = 4, t.canvas.style && void 0 !== t.font && void 0 !== r.getComputedStyle && (t.font = r.getComputedStyle(t.canvas).getPropertyValue('font')), this.baseSetContext(t), this.attribute('x').hasValue() || (this.attribute('x', !0).value = 0), this.attribute('y').hasValue() || (this.attribute('y', !0).value = 0), t.translate(this.attribute('x').toPixels('x'), this.attribute('y').toPixels('y')); var e = o.ViewPort.width(); var n = o.ViewPort.height(); if (this.attribute('width').hasValue() || (this.attribute('width', !0).value = '100%'), this.attribute('height').hasValue() || (this.attribute('height', !0).value = '100%'), void 0 === this.root) { e = this.attribute('width').toPixels('x'), n = this.attribute('height').toPixels('y'); var i = 0; var a = 0; this.attribute('refX').hasValue() && this.attribute('refY').hasValue() && (i = -this.attribute('refX').toPixels('x'), a = -this.attribute('refY').toPixels('y')), this.attribute('overflow').valueOrDefault('hidden') != 'visible' && (t.beginPath(), t.moveTo(i, a), t.lineTo(e, a), t.lineTo(e, n), t.lineTo(i, n), t.closePath(), t.clip()) } if (o.ViewPort.SetCurrent(e, n), this.attribute('viewBox').hasValue()) { var s = o.ToNumberArray(this.attribute('viewBox').value); var u = s[0]; var l = s[1]; e = s[2], n = s[3], o.AspectRatio(t, this.attribute('preserveAspectRatio').value, o.ViewPort.width(), e, o.ViewPort.height(), n, u, l, this.attribute('refX').value, this.attribute('refY').value), o.ViewPort.RemoveCurrent(), o.ViewPort.SetCurrent(s[2], s[3]) } } }, o.Element.svg.prototype = new o.Element.RenderedElementBase(), o.Element.rect = function (t) { this.base = o.Element.PathElementBase, this.base(t), this.path = function (t) { var e = this.attribute('x').toPixels('x'); var n = this.attribute('y').toPixels('y'); var r = this.attribute('width').toPixels('x'); var i = this.attribute('height').toPixels('y'); var a = this.attribute('rx').toPixels('x'); var s = this.attribute('ry').toPixels('y'); return this.attribute('rx').hasValue() && !this.attribute('ry').hasValue() && (s = a), this.attribute('ry').hasValue() && !this.attribute('rx').hasValue() && (a = s), a = Math.min(a, r / 2), s = Math.min(s, i / 2), t != null && (t.beginPath(), t.moveTo(e + a, n), t.lineTo(e + r - a, n), t.quadraticCurveTo(e + r, n, e + r, n + s), t.lineTo(e + r, n + i - s), t.quadraticCurveTo(e + r, n + i, e + r - a, n + i), t.lineTo(e + a, n + i), t.quadraticCurveTo(e, n + i, e, n + i - s), t.lineTo(e, n + s), t.quadraticCurveTo(e, n, e + a, n), t.closePath()), new o.BoundingBox(e, n, e + r, n + i) } }, o.Element.rect.prototype = new o.Element.PathElementBase(), o.Element.circle = function (t) { this.base = o.Element.PathElementBase, this.base(t), this.path = function (t) { var e = this.attribute('cx').toPixels('x'); var n = this.attribute('cy').toPixels('y'); var r = this.attribute('r').toPixels(); return t != null && (t.beginPath(), t.arc(e, n, r, 0, 2 * Math.PI, !0), t.closePath()), new o.BoundingBox(e - r, n - r, e + r, n + r) } }, o.Element.circle.prototype = new o.Element.PathElementBase(), o.Element.ellipse = function (t) { this.base = o.Element.PathElementBase, this.base(t), this.path = function (t) { var e = (Math.sqrt(2) - 1) / 3 * 4; var n = this.attribute('rx').toPixels('x'); var r = this.attribute('ry').toPixels('y'); var i = this.attribute('cx').toPixels('x'); var a = this.attribute('cy').toPixels('y'); return t != null && (t.beginPath(), t.moveTo(i, a - r), t.bezierCurveTo(i + e * n, a - r, i + n, a - e * r, i + n, a), t.bezierCurveTo(i + n, a + e * r, i + e * n, a + r, i, a + r), t.bezierCurveTo(i - e * n, a + r, i - n, a + e * r, i - n, a), t.bezierCurveTo(i - n, a - e * r, i - e * n, a - r, i, a - r), t.closePath()), new o.BoundingBox(i - n, a - r, i + n, a + r) } }, o.Element.ellipse.prototype = new o.Element.PathElementBase(), o.Element.line = function (t) { this.base = o.Element.PathElementBase, this.base(t), this.getPoints = function () { return [new o.Point(this.attribute('x1').toPixels('x'), this.attribute('y1').toPixels('y')), new o.Point(this.attribute('x2').toPixels('x'), this.attribute('y2').toPixels('y'))] }, this.path = function (t) { var e = this.getPoints(); return t != null && (t.beginPath(), t.moveTo(e[0].x, e[0].y), t.lineTo(e[1].x, e[1].y)), new o.BoundingBox(e[0].x, e[0].y, e[1].x, e[1].y) }, this.getMarkers = function () { var t = this.getPoints(); var e = t[0].angleTo(t[1]); return [[t[0], e], [t[1], e]] } }, o.Element.line.prototype = new o.Element.PathElementBase(), o.Element.polyline = function (t) { this.base = o.Element.PathElementBase, this.base(t), this.points = o.CreatePath(this.attribute('points').value), this.path = function (t) { var e = new o.BoundingBox(this.points[0].x, this.points[0].y); t != null && (t.beginPath(), t.moveTo(this.points[0].x, this.points[0].y)); for (var n = 1; n < this.points.length; n++)e.addPoint(this.points[n].x, this.points[n].y), t != null && t.lineTo(this.points[n].x, this.points[n].y); return e }, this.getMarkers = function () { for (var t = [], e = 0; e < this.points.length - 1; e++)t.push([this.points[e], this.points[e].angleTo(this.points[e + 1])]); return t.length > 0 && t.push([this.points[this.points.length - 1], t[t.length - 1][1]]), t } }, o.Element.polyline.prototype = new o.Element.PathElementBase(), o.Element.polygon = function (t) { this.base = o.Element.polyline, this.base(t), this.basePath = this.path, this.path = function (t) { var e = this.basePath(t); return t != null && (t.lineTo(this.points[0].x, this.points[0].y), t.closePath()), e } }, o.Element.polygon.prototype = new o.Element.polyline(), o.Element.path = function (t) { this.base = o.Element.PathElementBase, this.base(t); var e = this.attribute('d').value; e = e.replace(/,/gm, ' '); for (var n = 0; n < 2; n++)e = e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm, '$1 $2'); for (e = (e = e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm, '$1 $2')).replace(/([0-9])([+\-])/gm, '$1 $2'), n = 0; n < 2; n++)e = e.replace(/(\.[0-9]*)(\.)/gm, '$1 $2'); e = e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm, '$1 $3 $4 '), e = o.compressSpaces(e), e = o.trim(e), this.PathParser = new function (t) { this.tokens = t.split(' '), this.reset = function () { this.i = -1, this.command = '', this.previousCommand = '', this.start = new o.Point(0, 0), this.control = new o.Point(0, 0), this.current = new o.Point(0, 0), this.points = [], this.angles = [] }, this.isEnd = function () { return this.i >= this.tokens.length - 1 }, this.isCommandOrEnd = function () { return !!this.isEnd() || this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null }, this.isRelativeCommand = function () { switch (this.command) { case 'm':case 'l':case 'h':case 'v':case 'c':case 's':case 'q':case 't':case 'a':case 'z':return !0 } return !1 }, this.getToken = function () { return this.i++, this.tokens[this.i] }, this.getScalar = function () { return parseFloat(this.getToken()) }, this.nextCommand = function () { this.previousCommand = this.command, this.command = this.getToken() }, this.getPoint = function () { var t = new o.Point(this.getScalar(), this.getScalar()); return this.makeAbsolute(t) }, this.getAsControlPoint = function () { var t = this.getPoint(); return this.control = t }, this.getAsCurrentPoint = function () { var t = this.getPoint(); return this.current = t }, this.getReflectedControlPoint = function () { return this.previousCommand.toLowerCase() != 'c' && this.previousCommand.toLowerCase() != 's' && this.previousCommand.toLowerCase() != 'q' && this.previousCommand.toLowerCase() != 't' ? this.current : new o.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y) }, this.makeAbsolute = function (t) { return this.isRelativeCommand() && (t.x += this.current.x, t.y += this.current.y), t }, this.addMarker = function (t, e, n) { n != null && this.angles.length > 0 && this.angles[this.angles.length - 1] == null && (this.angles[this.angles.length - 1] = this.points[this.points.length - 1].angleTo(n)), this.addMarkerAngle(t, e == null ? null : e.angleTo(t)) }, this.addMarkerAngle = function (t, e) { this.points.push(t), this.angles.push(e) }, this.getMarkerPoints = function () { return this.points }, this.getMarkerAngles = function () { for (var t = 0; t < this.angles.length; t++) if (this.angles[t] == null) for (var e = t + 1; e < this.angles.length; e++) if (this.angles[e] != null) { this.angles[t] = this.angles[e]; break } return this.angles } }(e), this.path = function (t) { var e = this.PathParser; e.reset(); var n = new o.BoundingBox(); for (t != null && t.beginPath(); !e.isEnd();) switch (e.nextCommand(), e.command) { case 'M':case 'm':var r = e.getAsCurrentPoint(); for (e.addMarker(r), n.addPoint(r.x, r.y), t != null && t.moveTo(r.x, r.y), e.start = e.current; !e.isCommandOrEnd();)r = e.getAsCurrentPoint(), e.addMarker(r, e.start), n.addPoint(r.x, r.y), t != null && t.lineTo(r.x, r.y); break; case 'L':case 'l':for (;!e.isCommandOrEnd();) { var i = e.current; r = e.getAsCurrentPoint(), e.addMarker(r, i), n.addPoint(r.x, r.y), t != null && t.lineTo(r.x, r.y) } break; case 'H':case 'h':for (;!e.isCommandOrEnd();) { var a = new o.Point((e.isRelativeCommand() ? e.current.x : 0) + e.getScalar(), e.current.y); e.addMarker(a, e.current), e.current = a, n.addPoint(e.current.x, e.current.y), t != null && t.lineTo(e.current.x, e.current.y) } break; case 'V':case 'v':for (;!e.isCommandOrEnd();)a = new o.Point(e.current.x, (e.isRelativeCommand() ? e.current.y : 0) + e.getScalar()), e.addMarker(a, e.current), e.current = a, n.addPoint(e.current.x, e.current.y), t != null && t.lineTo(e.current.x, e.current.y); break; case 'C':case 'c':for (;!e.isCommandOrEnd();) { var s = e.current; var u = e.getPoint(); var l = e.getAsControlPoint(); var c = e.getAsCurrentPoint(); e.addMarker(c, l, u), n.addBezierCurve(s.x, s.y, u.x, u.y, l.x, l.y, c.x, c.y), t != null && t.bezierCurveTo(u.x, u.y, l.x, l.y, c.x, c.y) } break; case 'S':case 's':for (;!e.isCommandOrEnd();)s = e.current, u = e.getReflectedControlPoint(), l = e.getAsControlPoint(), c = e.getAsCurrentPoint(), e.addMarker(c, l, u), n.addBezierCurve(s.x, s.y, u.x, u.y, l.x, l.y, c.x, c.y), t != null && t.bezierCurveTo(u.x, u.y, l.x, l.y, c.x, c.y); break; case 'Q':case 'q':for (;!e.isCommandOrEnd();)s = e.current, l = e.getAsControlPoint(), c = e.getAsCurrentPoint(), e.addMarker(c, l, l), n.addQuadraticCurve(s.x, s.y, l.x, l.y, c.x, c.y), t != null && t.quadraticCurveTo(l.x, l.y, c.x, c.y); break; case 'T':case 't':for (;!e.isCommandOrEnd();)s = e.current, l = e.getReflectedControlPoint(), e.control = l, c = e.getAsCurrentPoint(), e.addMarker(c, l, l), n.addQuadraticCurve(s.x, s.y, l.x, l.y, c.x, c.y), t != null && t.quadraticCurveTo(l.x, l.y, c.x, c.y); break; case 'A':case 'a':for (;!e.isCommandOrEnd();) { s = e.current; var f = e.getScalar(); var d = e.getScalar(); var h = e.getScalar() * (Math.PI / 180); var p = e.getScalar(); var g = e.getScalar(); var m = (c = e.getAsCurrentPoint(), new o.Point(Math.cos(h) * (s.x - c.x) / 2 + Math.sin(h) * (s.y - c.y) / 2, -Math.sin(h) * (s.x - c.x) / 2 + Math.cos(h) * (s.y - c.y) / 2)); var y = Math.pow(m.x, 2) / Math.pow(f, 2) + Math.pow(m.y, 2) / Math.pow(d, 2); y > 1 && (f *= Math.sqrt(y), d *= Math.sqrt(y)); var v = (p == g ? -1 : 1) * Math.sqrt((Math.pow(f, 2) * Math.pow(d, 2) - Math.pow(f, 2) * Math.pow(m.y, 2) - Math.pow(d, 2) * Math.pow(m.x, 2)) / (Math.pow(f, 2) * Math.pow(m.y, 2) + Math.pow(d, 2) * Math.pow(m.x, 2))); isNaN(v) && (v = 0); var b = new o.Point(v * f * m.y / d, v * -d * m.x / f); var x = new o.Point((s.x + c.x) / 2 + Math.cos(h) * b.x - Math.sin(h) * b.y, (s.y + c.y) / 2 + Math.sin(h) * b.x + Math.cos(h) * b.y); var _ = function (t) { return Math.sqrt(Math.pow(t[0], 2) + Math.pow(t[1], 2)) }; var w = function (t, e) { return (t[0] * e[0] + t[1] * e[1]) / (_(t) * _(e)) }; var E = function (t, e) { return (t[0] * e[1] < t[1] * e[0] ? -1 : 1) * Math.acos(w(t, e)) }; var S = E([1, 0], [(m.x - b.x) / f, (m.y - b.y) / d]); var M = [(m.x - b.x) / f, (m.y - b.y) / d]; var T = [(-m.x - b.x) / f, (-m.y - b.y) / d]; var C = E(M, T); w(M, T) <= -1 && (C = Math.PI), w(M, T) >= 1 && (C = 0); var k = 1 - g ? 1 : -1; var A = S + k * (C / 2); var O = new o.Point(x.x + f * Math.cos(A), x.y + d * Math.sin(A)); if (e.addMarkerAngle(O, A - k * Math.PI / 2), e.addMarkerAngle(c, A - k * Math.PI), n.addPoint(c.x, c.y), t != null) { w = d < f ? f : d; var P = d < f ? 1 : f / d; var N = d < f ? d / f : 1; t.translate(x.x, x.y), t.rotate(h), t.scale(P, N), t.arc(0, 0, w, S, S + C, 1 - g), t.scale(1 / P, 1 / N), t.rotate(-h), t.translate(-x.x, -x.y) } } break; case 'Z':case 'z':t != null && t.closePath(), e.current = e.start } return n }, this.getMarkers = function () { for (var t = this.PathParser.getMarkerPoints(), e = this.PathParser.getMarkerAngles(), n = [], r = 0; r < t.length; r++)n.push([t[r], e[r]]); return n } }, o.Element.path.prototype = new o.Element.PathElementBase(), o.Element.pattern = function (t) { this.base = o.Element.ElementBase, this.base(t), this.createPattern = function (t, e) { var n = this.attribute('width').toPixels('x', !0); var r = this.attribute('height').toPixels('y', !0); var a = new o.Element.svg(); a.attributes.viewBox = new o.Property('viewBox', this.attribute('viewBox').value), a.attributes.width = new o.Property('width', n + 'px'), a.attributes.height = new o.Property('height', r + 'px'), a.attributes.transform = new o.Property('transform', this.attribute('patternTransform').value), a.children = this.children; var s = i(); s.width = n, s.height = r; var u = s.getContext('2d'); this.attribute('x').hasValue() && this.attribute('y').hasValue() && u.translate(this.attribute('x').toPixels('x', !0), this.attribute('y').toPixels('y', !0)); for (var l = -1; l <= 1; l++) for (var c = -1; c <= 1; c++)u.save(), a.attributes.x = new o.Property('x', l * s.width), a.attributes.y = new o.Property('y', c * s.height), a.render(u), u.restore(); return t.createPattern(s, 'repeat') } }, o.Element.pattern.prototype = new o.Element.ElementBase(), o.Element.marker = function (t) { this.base = o.Element.ElementBase, this.base(t), this.baseRender = this.render, this.render = function (t, e, n) { t.translate(e.x, e.y), this.attribute('orient').valueOrDefault('auto') == 'auto' && t.rotate(n), this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth' && t.scale(t.lineWidth, t.lineWidth), t.save(); var r = new o.Element.svg(); r.attributes.viewBox = new o.Property('viewBox', this.attribute('viewBox').value), r.attributes.refX = new o.Property('refX', this.attribute('refX').value), r.attributes.refY = new o.Property('refY', this.attribute('refY').value), r.attributes.width = new o.Property('width', this.attribute('markerWidth').value), r.attributes.height = new o.Property('height', this.attribute('markerHeight').value), r.attributes.fill = new o.Property('fill', this.attribute('fill').valueOrDefault('black')), r.attributes.stroke = new o.Property('stroke', this.attribute('stroke').valueOrDefault('none')), r.children = this.children, r.render(t), t.restore(), this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth' && t.scale(1 / t.lineWidth, 1 / t.lineWidth), this.attribute('orient').valueOrDefault('auto') == 'auto' && t.rotate(-n), t.translate(-e.x, -e.y) } }, o.Element.marker.prototype = new o.Element.ElementBase(), o.Element.defs = function (t) { this.base = o.Element.ElementBase, this.base(t), this.render = function (t) {} }, o.Element.defs.prototype = new o.Element.ElementBase(), o.Element.GradientBase = function (t) { this.base = o.Element.ElementBase, this.base(t), this.stops = []; for (var e = 0; e < this.children.length; e++) { var n = this.children[e]; n.type == 'stop' && this.stops.push(n) } this.getGradient = function () {}, this.gradientUnits = function () { return this.attribute('gradientUnits').valueOrDefault('objectBoundingBox') }, this.attributesToInherit = ['gradientUnits'], this.inheritStopContainer = function (t) { for (var e = 0; e < this.attributesToInherit.length; e++) { var n = this.attributesToInherit[e]; !this.attribute(n).hasValue() && t.attribute(n).hasValue() && (this.attribute(n, !0).value = t.attribute(n).value) } }, this.createGradient = function (t, e, n) { var r = this; this.getHrefAttribute().hasValue() && (r = this.getHrefAttribute().getDefinition(), this.inheritStopContainer(r)); var a = function (t) { return n.hasValue() ? new o.Property('color', t).addOpacity(n).value : t }; var s = this.getGradient(t, e); if (s == null) return a(r.stops[r.stops.length - 1].color); for (var u = 0; u < r.stops.length; u++)s.addColorStop(r.stops[u].offset, a(r.stops[u].color)); if (this.attribute('gradientTransform').hasValue()) { var l = o.ViewPort.viewPorts[0]; var c = new o.Element.rect(); c.attributes.x = new o.Property('x', -o.MAX_VIRTUAL_PIXELS / 3), c.attributes.y = new o.Property('y', -o.MAX_VIRTUAL_PIXELS / 3), c.attributes.width = new o.Property('width', o.MAX_VIRTUAL_PIXELS), c.attributes.height = new o.Property('height', o.MAX_VIRTUAL_PIXELS); var f = new o.Element.g(); f.attributes.transform = new o.Property('transform', this.attribute('gradientTransform').value), f.children = [c]; var d = new o.Element.svg(); d.attributes.x = new o.Property('x', 0), d.attributes.y = new o.Property('y', 0), d.attributes.width = new o.Property('width', l.width), d.attributes.height = new o.Property('height', l.height), d.children = [f]; var h = i(); h.width = l.width, h.height = l.height; var p = h.getContext('2d'); return p.fillStyle = s, d.render(p), p.createPattern(h, 'no-repeat') } return s } }, o.Element.GradientBase.prototype = new o.Element.ElementBase(), o.Element.linearGradient = function (t) { this.base = o.Element.GradientBase, this.base(t), this.attributesToInherit.push('x1'), this.attributesToInherit.push('y1'), this.attributesToInherit.push('x2'), this.attributesToInherit.push('y2'), this.getGradient = function (t, e) { var n = this.gradientUnits() == 'objectBoundingBox' ? e.getBoundingBox() : null; this.attribute('x1').hasValue() || this.attribute('y1').hasValue() || this.attribute('x2').hasValue() || this.attribute('y2').hasValue() || (this.attribute('x1', !0).value = 0, this.attribute('y1', !0).value = 0, this.attribute('x2', !0).value = 1, this.attribute('y2', !0).value = 0); var r = this.gradientUnits() == 'objectBoundingBox' ? n.x() + n.width() * this.attribute('x1').numValue() : this.attribute('x1').toPixels('x'); var i = this.gradientUnits() == 'objectBoundingBox' ? n.y() + n.height() * this.attribute('y1').numValue() : this.attribute('y1').toPixels('y'); var a = this.gradientUnits() == 'objectBoundingBox' ? n.x() + n.width() * this.attribute('x2').numValue() : this.attribute('x2').toPixels('x'); var o = this.gradientUnits() == 'objectBoundingBox' ? n.y() + n.height() * this.attribute('y2').numValue() : this.attribute('y2').toPixels('y'); return r == a && i == o ? null : t.createLinearGradient(r, i, a, o) } }, o.Element.linearGradient.prototype = new o.Element.GradientBase(), o.Element.radialGradient = function (t) { this.base = o.Element.GradientBase, this.base(t), this.attributesToInherit.push('cx'), this.attributesToInherit.push('cy'), this.attributesToInherit.push('r'), this.attributesToInherit.push('fx'), this.attributesToInherit.push('fy'), this.getGradient = function (t, e) { var n = e.getBoundingBox(); this.attribute('cx').hasValue() || (this.attribute('cx', !0).value = '50%'), this.attribute('cy').hasValue() || (this.attribute('cy', !0).value = '50%'), this.attribute('r').hasValue() || (this.attribute('r', !0).value = '50%'); var r = this.gradientUnits() == 'objectBoundingBox' ? n.x() + n.width() * this.attribute('cx').numValue() : this.attribute('cx').toPixels('x'); var i = this.gradientUnits() == 'objectBoundingBox' ? n.y() + n.height() * this.attribute('cy').numValue() : this.attribute('cy').toPixels('y'); var a = r; var o = i; this.attribute('fx').hasValue() && (a = this.gradientUnits() == 'objectBoundingBox' ? n.x() + n.width() * this.attribute('fx').numValue() : this.attribute('fx').toPixels('x')), this.attribute('fy').hasValue() && (o = this.gradientUnits() == 'objectBoundingBox' ? n.y() + n.height() * this.attribute('fy').numValue() : this.attribute('fy').toPixels('y')); var s = this.gradientUnits() == 'objectBoundingBox' ? (n.width() + n.height()) / 2 * this.attribute('r').numValue() : this.attribute('r').toPixels(); return t.createRadialGradient(a, o, 0, r, i, s) } }, o.Element.radialGradient.prototype = new o.Element.GradientBase(), o.Element.stop = function (t) { this.base = o.Element.ElementBase, this.base(t), this.offset = this.attribute('offset').numValue(), this.offset < 0 && (this.offset = 0), this.offset > 1 && (this.offset = 1); var e = this.style('stop-color', !0); e.value === '' && (e.value = '#000'), this.style('stop-opacity').hasValue() && (e = e.addOpacity(this.style('stop-opacity'))), this.color = e.value }, o.Element.stop.prototype = new o.Element.ElementBase(), o.Element.AnimateBase = function (t) { this.base = o.Element.ElementBase, this.base(t), o.Animations.push(this), this.duration = 0, this.begin = this.attribute('begin').toMilliseconds(), this.maxDuration = this.begin + this.attribute('dur').toMilliseconds(), this.getProperty = function () { var t = this.attribute('attributeType').value; var e = this.attribute('attributeName').value; return t == 'CSS' ? this.parent.style(e, !0) : this.parent.attribute(e, !0) }, this.initialValue = null, this.initialUnits = '', this.removed = !1, this.calcValue = function () { return '' }, this.update = function (t) { if (this.initialValue == null && (this.initialValue = this.getProperty().value, this.initialUnits = this.getProperty().getUnits()), this.duration > this.maxDuration) { if (this.attribute('repeatCount').value == 'indefinite' || this.attribute('repeatDur').value == 'indefinite') this.duration = 0; else if (this.attribute('fill').valueOrDefault('remove') != 'freeze' || this.frozen) { if (this.attribute('fill').valueOrDefault('remove') == 'remove' && !this.removed) return this.removed = !0, this.getProperty().value = this.parent.animationFrozen ? this.parent.animationFrozenValue : this.initialValue, !0 } else this.frozen = !0, this.parent.animationFrozen = !0, this.parent.animationFrozenValue = this.getProperty().value; return !1 } this.duration = this.duration + t; var e = !1; if (this.begin < this.duration) { var n = this.calcValue(); this.attribute('type').hasValue() && (n = this.attribute('type').value + '(' + n + ')'), this.getProperty().value = n, e = !0 } return e }, this.from = this.attribute('from'), this.to = this.attribute('to'), this.values = this.attribute('values'), this.values.hasValue() && (this.values.value = this.values.value.split(';')), this.progress = function () { var t = { progress: (this.duration - this.begin) / (this.maxDuration - this.begin) }; if (this.values.hasValue()) { var e = t.progress * (this.values.value.length - 1); var n = Math.floor(e); var r = Math.ceil(e); t.from = new o.Property('from', parseFloat(this.values.value[n])), t.to = new o.Property('to', parseFloat(this.values.value[r])), t.progress = (e - n) / (r - n) } else t.from = this.from, t.to = this.to; return t } }, o.Element.AnimateBase.prototype = new o.Element.ElementBase(), o.Element.animate = function (t) { this.base = o.Element.AnimateBase, this.base(t), this.calcValue = function () { var t = this.progress(); return t.from.numValue() + (t.to.numValue() - t.from.numValue()) * t.progress + this.initialUnits } }, o.Element.animate.prototype = new o.Element.AnimateBase(), o.Element.animateColor = function (e) { this.base = o.Element.AnimateBase, this.base(e), this.calcValue = function () { var e = this.progress(); var n = new t(e.from.value); var r = new t(e.to.value); if (n.ok && r.ok) { var i = n.r + (r.r - n.r) * e.progress; var a = n.g + (r.g - n.g) * e.progress; var o = n.b + (r.b - n.b) * e.progress; return 'rgb(' + parseInt(i, 10) + ',' + parseInt(a, 10) + ',' + parseInt(o, 10) + ')' } return this.attribute('from').value } }, o.Element.animateColor.prototype = new o.Element.AnimateBase(), o.Element.animateTransform = function (t) { this.base = o.Element.AnimateBase, this.base(t), this.calcValue = function () { for (var t = this.progress(), e = o.ToNumberArray(t.from.value), n = o.ToNumberArray(t.to.value), r = '', i = 0; i < e.length; i++)r += e[i] + (n[i] - e[i]) * t.progress + ' '; return r } }, o.Element.animateTransform.prototype = new o.Element.animate(), o.Element.font = function (t) { this.base = o.Element.ElementBase, this.base(t), this.horizAdvX = this.attribute('horiz-adv-x').numValue(), this.isRTL = !1, this.isArabic = !1, this.fontFace = null, this.missingGlyph = null, this.glyphs = []; for (var e = 0; e < this.children.length; e++) { var n = this.children[e]; n.type == 'font-face' ? (this.fontFace = n).style('font-family').hasValue() && (o.Definitions[n.style('font-family').value] = this) : n.type == 'missing-glyph' ? this.missingGlyph = n : n.type == 'glyph' && (n.arabicForm != '' ? (this.isRTL = !0, this.isArabic = !0, void 0 === this.glyphs[n.unicode] && (this.glyphs[n.unicode] = []), this.glyphs[n.unicode][n.arabicForm] = n) : this.glyphs[n.unicode] = n) } }, o.Element.font.prototype = new o.Element.ElementBase(), o.Element.fontface = function (t) { this.base = o.Element.ElementBase, this.base(t), this.ascent = this.attribute('ascent').value, this.descent = this.attribute('descent').value, this.unitsPerEm = this.attribute('units-per-em').numValue() }, o.Element.fontface.prototype = new o.Element.ElementBase(), o.Element.missingglyph = function (t) { this.base = o.Element.path, this.base(t), this.horizAdvX = 0 }, o.Element.missingglyph.prototype = new o.Element.path(), o.Element.glyph = function (t) { this.base = o.Element.path, this.base(t), this.horizAdvX = this.attribute('horiz-adv-x').numValue(), this.unicode = this.attribute('unicode').value, this.arabicForm = this.attribute('arabic-form').value }, o.Element.glyph.prototype = new o.Element.path(), o.Element.text = function (t) { this.captureTextNodes = !0, this.base = o.Element.RenderedElementBase, this.base(t), this.baseSetContext = this.setContext, this.setContext = function (t) { this.baseSetContext(t); var e = this.style('dominant-baseline').toTextBaseline(); e == null && (e = this.style('alignment-baseline').toTextBaseline()), e != null && (t.textBaseline = e) }, this.getBoundingBox = function () { var t = this.attribute('x').toPixels('x'); var e = this.attribute('y').toPixels('y'); var n = this.parent.style('font-size').numValueOrDefault(o.Font.Parse(o.ctx.font).fontSize); return new o.BoundingBox(t, e - n, t + Math.floor(2 * n / 3) * this.children[0].getText().length, e) }, this.renderChildren = function (t) { this.x = this.attribute('x').toPixels('x'), this.y = this.attribute('y').toPixels('y'), this.attribute('dx').hasValue() && (this.x += this.attribute('dx').toPixels('x')), this.attribute('dy').hasValue() && (this.y += this.attribute('dy').toPixels('y')), this.x += this.getAnchorDelta(t, this, 0); for (var e = 0; e < this.children.length; e++) this.renderChild(t, this, this, e) }, this.getAnchorDelta = function (t, e, n) { var r = this.style('text-anchor').valueOrDefault('start'); if (r != 'start') { for (var i = 0, a = n; a < e.children.length; a++) { var o = e.children[a]; if (n < a && o.attribute('x').hasValue()) break; i += o.measureTextRecursive(t) } return -1 * (r == 'end' ? i : i / 2) } return 0 }, this.renderChild = function (t, e, n, r) { var i = n.children[r]; for (i.attribute('x').hasValue() ? (i.x = i.attribute('x').toPixels('x') + e.getAnchorDelta(t, n, r), i.attribute('dx').hasValue() && (i.x += i.attribute('dx').toPixels('x'))) : (i.attribute('dx').hasValue() && (e.x += i.attribute('dx').toPixels('x')), i.x = e.x), e.x = i.x + i.measureText(t), i.attribute('y').hasValue() ? (i.y = i.attribute('y').toPixels('y'), i.attribute('dy').hasValue() && (i.y += i.attribute('dy').toPixels('y'))) : (i.attribute('dy').hasValue() && (e.y += i.attribute('dy').toPixels('y')), i.y = e.y), e.y = i.y, i.render(t), r = 0; r < i.children.length; r++)e.renderChild(t, e, i, r) } }, o.Element.text.prototype = new o.Element.RenderedElementBase(), o.Element.TextElementBase = function (t) { this.base = o.Element.RenderedElementBase, this.base(t), this.getGlyph = function (t, e, n) { var r = e[n]; var i = null; if (t.isArabic) { var a = 'isolated'; (n == 0 || e[n - 1] == ' ') && n < e.length - 2 && e[n + 1] != ' ' && (a = 'terminal'), n > 0 && e[n - 1] != ' ' && n < e.length - 2 && e[n + 1] != ' ' && (a = 'medial'), n > 0 && e[n - 1] != ' ' && (n == e.length - 1 || e[n + 1] == ' ') && (a = 'initial'), void 0 !== t.glyphs[r] && (i = t.glyphs[r][a]) == null && t.glyphs[r].type == 'glyph' && (i = t.glyphs[r]) } else i = t.glyphs[r]; return i == null && (i = t.missingGlyph), i }, this.renderChildren = function (t) { var e = this.parent.style('font-family').getDefinition(); if (e == null)t.paintOrder == 'stroke' ? (t.strokeStyle != '' && t.strokeText(o.compressSpaces(this.getText()), this.x, this.y), t.fillStyle != '' && t.fillText(o.compressSpaces(this.getText()), this.x, this.y)) : (t.fillStyle != '' && t.fillText(o.compressSpaces(this.getText()), this.x, this.y), t.strokeStyle != '' && t.strokeText(o.compressSpaces(this.getText()), this.x, this.y)); else { var n = this.parent.style('font-size').numValueOrDefault(o.Font.Parse(o.ctx.font).fontSize); var r = this.parent.style('font-style').valueOrDefault(o.Font.Parse(o.ctx.font).fontStyle); var i = this.getText(); e.isRTL && (i = i.split('').reverse().join('')); for (var a = o.ToNumberArray(this.parent.attribute('dx').value), s = 0; s < i.length; s++) { var u = this.getGlyph(e, i, s); var l = n / e.fontFace.unitsPerEm; t.translate(this.x, this.y), t.scale(l, -l); var c = t.lineWidth; t.lineWidth = t.lineWidth * e.fontFace.unitsPerEm / n, r == 'italic' && t.transform(1, 0, 0.4, 1, 0, 0), u.render(t), r == 'italic' && t.transform(1, 0, -0.4, 1, 0, 0), t.lineWidth = c, t.scale(1 / l, -1 / l), t.translate(-this.x, -this.y), this.x += n * (u.horizAdvX || e.horizAdvX) / e.fontFace.unitsPerEm, void 0 === a[s] || isNaN(a[s]) || (this.x += a[s]) } } }, this.getText = function () {}, this.measureTextRecursive = function (t) { for (var e = this.measureText(t), n = 0; n < this.children.length; n++)e += this.children[n].measureTextRecursive(t); return e }, this.measureText = function (t) { var e = this.parent.style('font-family').getDefinition(); if (e != null) { var n = this.parent.style('font-size').numValueOrDefault(o.Font.Parse(o.ctx.font).fontSize); var r = 0; var i = this.getText(); e.isRTL && (i = i.split('').reverse().join('')); for (var a = o.ToNumberArray(this.parent.attribute('dx').value), s = 0; s < i.length; s++)r += (this.getGlyph(e, i, s).horizAdvX || e.horizAdvX) * n / e.fontFace.unitsPerEm, void 0 === a[s] || isNaN(a[s]) || (r += a[s]); return r } var u = o.compressSpaces(this.getText()); if (!t.measureText) return 10 * u.length; t.save(), this.setContext(t); var l = t.measureText(u).width; return t.restore(), l } }, o.Element.TextElementBase.prototype = new o.Element.RenderedElementBase(), o.Element.tspan = function (t) { this.captureTextNodes = !0, this.base = o.Element.TextElementBase, this.base(t), this.text = o.compressSpaces(t.value || t.text || t.textContent || ''), this.getText = function () { return this.children.length > 0 ? '' : this.text } }, o.Element.tspan.prototype = new o.Element.TextElementBase(), o.Element.tref = function (t) { this.base = o.Element.TextElementBase, this.base(t), this.getText = function () { var t = this.getHrefAttribute().getDefinition(); if (t != null) return t.children[0].getText() } }, o.Element.tref.prototype = new o.Element.TextElementBase(), o.Element.a = function (t) { this.base = o.Element.TextElementBase, this.base(t), this.hasText = t.childNodes.length > 0; for (var e = 0; e < t.childNodes.length; e++)t.childNodes[e].nodeType != 3 && (this.hasText = !1); this.text = this.hasText ? t.childNodes[0].value || t.childNodes[0].data : '', this.getText = function () { return this.text }, this.baseRenderChildren = this.renderChildren, this.renderChildren = function (t) { if (this.hasText) { this.baseRenderChildren(t); var e = new o.Property('fontSize', o.Font.Parse(o.ctx.font).fontSize); o.Mouse.checkBoundingBox(this, new o.BoundingBox(this.x, this.y - e.toPixels('y'), this.x + this.measureText(t), this.y)) } else if (this.children.length > 0) { var n = new o.Element.g(); n.children = this.children, n.parent = this, n.render(t) } }, this.onclick = function () { r.open(this.getHrefAttribute().value) }, this.onmousemove = function () { o.ctx.canvas.style.cursor = 'pointer' } }, o.Element.a.prototype = new o.Element.TextElementBase(), o.Element.image = function (t) { this.base = o.Element.RenderedElementBase, this.base(t); var e = this.getHrefAttribute().value; if (e != '') { var n = e.match(/\.svg$/); if (o.Images.push(this), this.loaded = !1, n) this.img = o.ajax(e), this.loaded = !0; else { this.img = document.createElement('img'), o.opts.useCORS == 1 && (this.img.crossOrigin = 'Anonymous'); var r = this; this.img.onload = function () { r.loaded = !0 }, this.img.onerror = function () { o.log('ERROR: image "' + e + '" not found'), r.loaded = !0 }, this.img.src = e } this.renderChildren = function (t) { var e = this.attribute('x').toPixels('x'); var i = this.attribute('y').toPixels('y'); var a = this.attribute('width').toPixels('x'); var s = this.attribute('height').toPixels('y'); a != 0 && s != 0 && (t.save(), n ? t.drawSvg(this.img, e, i, a, s) : (t.translate(e, i), o.AspectRatio(t, this.attribute('preserveAspectRatio').value, a, this.img.width, s, this.img.height, 0, 0), r.loaded && (void 0 === this.img.complete || this.img.complete) && t.drawImage(this.img, 0, 0)), t.restore()) }, this.getBoundingBox = function () { var t = this.attribute('x').toPixels('x'); var e = this.attribute('y').toPixels('y'); var n = this.attribute('width').toPixels('x'); var r = this.attribute('height').toPixels('y'); return new o.BoundingBox(t, e, t + n, e + r) } } }, o.Element.image.prototype = new o.Element.RenderedElementBase(), o.Element.g = function (t) { this.base = o.Element.RenderedElementBase, this.base(t), this.getBoundingBox = function () { for (var t = new o.BoundingBox(), e = 0; e < this.children.length; e++)t.addBoundingBox(this.children[e].getBoundingBox()); return t } }, o.Element.g.prototype = new o.Element.RenderedElementBase(), o.Element.symbol = function (t) { this.base = o.Element.RenderedElementBase, this.base(t), this.render = function (t) {} }, o.Element.symbol.prototype = new o.Element.RenderedElementBase(), o.Element.style = function (t) { this.base = o.Element.ElementBase, this.base(t); for (var e = '', n = 0; n < t.childNodes.length; n++)e += t.childNodes[n].data; e = e.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm, ''); var r = (e = o.compressSpaces(e)).split('}'); for (n = 0; n < r.length; n++) if (o.trim(r[n]) != '') for (var i = r[n].split('{'), a = i[0].split(','), s = i[1].split(';'), u = 0; u < a.length; u++) { var l = o.trim(a[u]); if (l != '') { for (var c = o.Styles[l] || {}, f = 0; f < s.length; f++) { var d = s[f].indexOf(':'); var h = s[f].substr(0, d); var g = s[f].substr(d + 1, s[f].length - d); h != null && g != null && (c[o.trim(h)] = new o.Property(o.trim(h), o.trim(g))) } if (o.Styles[l] = c, o.StylesSpecificity[l] = p(l), l == '@font-face') for (var m = c['font-family'].value.replace(/"/g, ''), y = c.src.value.split(','), v = 0; v < y.length; v++) if (y[v].indexOf('format("svg")') > 0) for (var b = y[v].indexOf('url'), x = y[v].indexOf(')', b), _ = y[v].substr(b + 5, x - b - 6), w = o.parseXml(o.ajax(_)).getElementsByTagName('font'), E = 0; E < w.length; E++) { var S = o.CreateElement(w[E]); o.Definitions[m] = S } } } }, o.Element.style.prototype = new o.Element.ElementBase(), o.Element.use = function (t) { this.base = o.Element.RenderedElementBase, this.base(t), this.baseSetContext = this.setContext, this.setContext = function (t) { this.baseSetContext(t), this.attribute('x').hasValue() && t.translate(this.attribute('x').toPixels('x'), 0), this.attribute('y').hasValue() && t.translate(0, this.attribute('y').toPixels('y')) }; var e = this.getHrefAttribute().getDefinition(); this.path = function (t) { e != null && e.path(t) }, this.getBoundingBox = function () { if (e != null) return e.getBoundingBox() }, this.renderChildren = function (t) { if (e != null) { var n = e; e.type == 'symbol' && ((n = new o.Element.svg()).type = 'svg', n.attributes.viewBox = new o.Property('viewBox', e.attribute('viewBox').value), n.attributes.preserveAspectRatio = new o.Property('preserveAspectRatio', e.attribute('preserveAspectRatio').value), n.attributes.overflow = new o.Property('overflow', e.attribute('overflow').value), n.children = e.children), n.type == 'svg' && (this.attribute('width').hasValue() && (n.attributes.width = new o.Property('width', this.attribute('width').value)), this.attribute('height').hasValue() && (n.attributes.height = new o.Property('height', this.attribute('height').value))); var r = n.parent; n.parent = null, n.render(t), n.parent = r } } }, o.Element.use.prototype = new o.Element.RenderedElementBase(), o.Element.mask = function (t) { this.base = o.Element.ElementBase, this.base(t), this.apply = function (t, e) { var n = this.attribute('x').toPixels('x'); var r = this.attribute('y').toPixels('y'); var a = this.attribute('width').toPixels('x'); var s = this.attribute('height').toPixels('y'); if (a == 0 && s == 0) { for (var u = new o.BoundingBox(), l = 0; l < this.children.length; l++)u.addBoundingBox(this.children[l].getBoundingBox()); n = Math.floor(u.x1), r = Math.floor(u.y1), a = Math.floor(u.width()), s = Math.floor(u.height()) } var c = e.attribute('mask').value; e.attribute('mask').value = ''; var f = i(); f.width = n + a, f.height = r + s; var d = f.getContext('2d'); this.renderChildren(d); var h = i(); h.width = n + a, h.height = r + s; var p = h.getContext('2d'); e.render(p), p.globalCompositeOperation = 'destination-in', p.fillStyle = d.createPattern(f, 'no-repeat'), p.fillRect(0, 0, n + a, r + s), t.fillStyle = p.createPattern(h, 'no-repeat'), t.fillRect(0, 0, n + a, r + s), e.attribute('mask').value = c }, this.render = function (t) {} }, o.Element.mask.prototype = new o.Element.ElementBase(), o.Element.clipPath = function (t) { this.base = o.Element.ElementBase, this.base(t), this.apply = function (t) { var e = typeof CanvasRenderingContext2D !== 'undefined'; var n = t.beginPath; var r = t.closePath; e && (CanvasRenderingContext2D.prototype.beginPath = function () {}, CanvasRenderingContext2D.prototype.closePath = function () {}), n.call(t); for (var i = 0; i < this.children.length; i++) { var a = this.children[i]; if (void 0 !== a.path) { var s = null; a.style('transform', !1, !0).hasValue() && (s = new o.Transform(a.style('transform', !1, !0).value)).apply(t), a.path(t), e && (CanvasRenderingContext2D.prototype.closePath = r), s && s.unapply(t) } }r.call(t), t.clip(), e && (CanvasRenderingContext2D.prototype.beginPath = n, CanvasRenderingContext2D.prototype.closePath = r) }, this.render = function (t) {} }, o.Element.clipPath.prototype = new o.Element.ElementBase(), o.Element.filter = function (t) { this.base = o.Element.ElementBase, this.base(t), this.apply = function (t, e) { var n = e.getBoundingBox(); var r = Math.floor(n.x1); var a = Math.floor(n.y1); var o = Math.floor(n.width()); var s = Math.floor(n.height()); var u = e.style('filter').value; e.style('filter').value = ''; for (var l = 0, c = 0, f = 0; f < this.children.length; f++) { var d = this.children[f].extraFilterDistance || 0; l = Math.max(l, d), c = Math.max(c, d) } var h = i(); h.width = o + 2 * l, h.height = s + 2 * c; var p = h.getContext('2d'); for (p.translate(-r + l, -a + c), e.render(p), f = 0; f < this.children.length; f++) typeof this.children[f].apply === 'function' && this.children[f].apply(p, 0, 0, o + 2 * l, s + 2 * c); t.drawImage(h, 0, 0, o + 2 * l, s + 2 * c, r - l, a - c, o + 2 * l, s + 2 * c), e.style('filter', !0).value = u }, this.render = function (t) {} }, o.Element.filter.prototype = new o.Element.ElementBase(), o.Element.feMorphology = function (t) { this.base = o.Element.ElementBase, this.base(t), this.apply = function (t, e, n, r, i) {} }, o.Element.feMorphology.prototype = new o.Element.ElementBase(), o.Element.feComposite = function (t) { this.base = o.Element.ElementBase, this.base(t), this.apply = function (t, e, n, r, i) {} }, o.Element.feComposite.prototype = new o.Element.ElementBase(), o.Element.feColorMatrix = function (t) { this.base = o.Element.ElementBase, this.base(t); var e = o.ToNumberArray(this.attribute('values').value); switch (this.attribute('type').valueOrDefault('matrix')) { case 'saturate':var n = e[0]; e = [0.213 + 0.787 * n, 0.715 - 0.715 * n, 0.072 - 0.072 * n, 0, 0, 0.213 - 0.213 * n, 0.715 + 0.285 * n, 0.072 - 0.072 * n, 0, 0, 0.213 - 0.213 * n, 0.715 - 0.715 * n, 0.072 + 0.928 * n, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]; break; case 'hueRotate':var r = e[0] * Math.PI / 180; var i = function (t, e, n) { return t + Math.cos(r) * e + Math.sin(r) * n }; e = [i(0.213, 0.787, -0.213), i(0.715, -0.715, -0.715), i(0.072, -0.072, 0.928), 0, 0, i(0.213, -0.213, 0.143), i(0.715, 0.285, 0.14), i(0.072, -0.072, -0.283), 0, 0, i(0.213, -0.213, -0.787), i(0.715, -0.715, 0.715), i(0.072, 0.928, 0.072), 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1]; break; case 'luminanceToAlpha':e = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.2125, 0.7154, 0.0721, 0, 0, 0, 0, 0, 0, 1] } function a (t, e, n, r, i, a) { return t[n * r * 4 + 4 * e + a] } function s (t, e, n, r, i, a, o) { t[n * r * 4 + 4 * e + a] = o } function u (t, n) { var r = e[t]; return r * (r < 0 ? n - 255 : n) } this.apply = function (t, e, n, r, i) { var o = t.getImageData(0, 0, r, i); for (n = 0; n < i; n++) for (e = 0; e < r; e++) { var l = a(o.data, e, n, r, 0, 0); var c = a(o.data, e, n, r, 0, 1); var f = a(o.data, e, n, r, 0, 2); var d = a(o.data, e, n, r, 0, 3); s(o.data, e, n, r, 0, 0, u(0, l) + u(1, c) + u(2, f) + u(3, d) + u(4, 1)), s(o.data, e, n, r, 0, 1, u(5, l) + u(6, c) + u(7, f) + u(8, d) + u(9, 1)), s(o.data, e, n, r, 0, 2, u(10, l) + u(11, c) + u(12, f) + u(13, d) + u(14, 1)), s(o.data, e, n, r, 0, 3, u(15, l) + u(16, c) + u(17, f) + u(18, d) + u(19, 1)) }t.clearRect(0, 0, r, i), t.putImageData(o, 0, 0) } }, o.Element.feColorMatrix.prototype = new o.Element.ElementBase(), o.Element.feGaussianBlur = function (t) { this.base = o.Element.ElementBase, this.base(t), this.blurRadius = Math.floor(this.attribute('stdDeviation').numValue()), this.extraFilterDistance = this.blurRadius, this.apply = function (t, n, r, i, a) { e && void 0 !== e.canvasRGBA ? (t.canvas.id = o.UniqueId(), t.canvas.style.display = 'none', document.body.appendChild(t.canvas), e.canvasRGBA(t.canvas, n, r, i, a, this.blurRadius), document.body.removeChild(t.canvas)) : o.log('ERROR: StackBlur.js must be included for blur to work') } }, o.Element.feGaussianBlur.prototype = new o.Element.ElementBase(), o.Element.title = function (t) {}, o.Element.title.prototype = new o.Element.ElementBase(), o.Element.desc = function (t) {}, o.Element.desc.prototype = new o.Element.ElementBase(), o.Element.MISSING = function (t) { o.log("ERROR: Element '" + t.nodeName + "' not yet implemented.") }, o.Element.MISSING.prototype = new o.Element.ElementBase(), o.CreateElement = function (t) { var e = t.nodeName.replace(/^[^:]+:/, ''); e = e.replace(/\-/g, ''); var n = null; return (n = void 0 !== o.Element[e] ? new o.Element[e](t) : new o.Element.MISSING(t)).type = t.nodeName, n }, o.load = function (t, e) { o.loadXml(t, o.ajax(e)) }, o.loadXml = function (t, e) { o.loadXmlDoc(t, o.parseXml(e)) }, o.loadXmlDoc = function (t, e) { o.init(t); var n = function (e) { for (var n = t.canvas; n;)e.x -= n.offsetLeft, e.y -= n.offsetTop, n = n.offsetParent; return r.scrollX && (e.x += r.scrollX), r.scrollY && (e.y += r.scrollY), e }; o.opts.ignoreMouse != 1 && (t.canvas.onclick = function (t) { var e = n(new o.Point(t != null ? t.clientX : event.clientX, t != null ? t.clientY : event.clientY)); o.Mouse.onclick(e.x, e.y) }, t.canvas.onmousemove = function (t) { var e = n(new o.Point(t != null ? t.clientX : event.clientX, t != null ? t.clientY : event.clientY)); o.Mouse.onmousemove(e.x, e.y) }); var i = o.CreateElement(e.documentElement); i.root = !0, i.addStylesFromStyleDefinition(); var a = !0; var s = function () { o.ViewPort.Clear(), t.canvas.parentNode ? o.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth, t.canvas.parentNode.clientHeight) : o.ViewPort.SetCurrent(800, 600), o.opts.ignoreDimensions != 1 && (i.style('width').hasValue() && (t.canvas.width = i.style('width').toPixels('x'), t.canvas.style && (t.canvas.style.width = t.canvas.width + 'px')), i.style('height').hasValue() && (t.canvas.height = i.style('height').toPixels('y'), t.canvas.style && (t.canvas.style.height = t.canvas.height + 'px'))); var n = t.canvas.clientWidth || t.canvas.width; var r = t.canvas.clientHeight || t.canvas.height; if (o.opts.ignoreDimensions == 1 && i.style('width').hasValue() && i.style('height').hasValue() && (n = i.style('width').toPixels('x'), r = i.style('height').toPixels('y')), o.ViewPort.SetCurrent(n, r), o.opts.offsetX != null && (i.attribute('x', !0).value = o.opts.offsetX), o.opts.offsetY != null && (i.attribute('y', !0).value = o.opts.offsetY), o.opts.scaleWidth != null || o.opts.scaleHeight != null) { var s = null; var u = null; var l = o.ToNumberArray(i.attribute('viewBox').value); o.opts.scaleWidth != null && (i.attribute('width').hasValue() ? s = i.attribute('width').toPixels('x') / o.opts.scaleWidth : isNaN(l[2]) || (s = l[2] / o.opts.scaleWidth)), o.opts.scaleHeight != null && (i.attribute('height').hasValue() ? u = i.attribute('height').toPixels('y') / o.opts.scaleHeight : isNaN(l[3]) || (u = l[3] / o.opts.scaleHeight)), s == null && (s = u), u == null && (u = s), i.attribute('width', !0).value = o.opts.scaleWidth, i.attribute('height', !0).value = o.opts.scaleHeight, i.style('transform', !0, !0).value += ' scale(' + 1 / s + ',' + 1 / u + ')' }o.opts.ignoreClear != 1 && t.clearRect(0, 0, n, r), i.render(t), a && (a = !1, typeof o.opts.renderCallback === 'function' && o.opts.renderCallback(e)) }; var u = !0; o.ImagesLoaded() && (u = !1, s()), o.intervalID = setInterval(function () { var t = !1; if (u && o.ImagesLoaded() && (t = !(u = !1)), o.opts.ignoreMouse != 1 && (t |= o.Mouse.hasEvents()), o.opts.ignoreAnimation != 1) for (var e = 0; e < o.Animations.length; e++)t |= o.Animations[e].update(1e3 / o.FRAMERATE); typeof o.opts.forceRedraw === 'function' && o.opts.forceRedraw() == 1 && (t = !0), t && (s(), o.Mouse.runEvents()) }, 1e3 / o.FRAMERATE) }, o.stop = function () { o.intervalID && clearInterval(o.intervalID) }, o.Mouse = new function () { this.events = [], this.hasEvents = function () { return this.events.length != 0 }, this.onclick = function (t, e) { this.events.push({ type: 'onclick', x: t, y: e, run: function (t) { t.onclick && t.onclick() } }) }, this.onmousemove = function (t, e) { this.events.push({ type: 'onmousemove', x: t, y: e, run: function (t) { t.onmousemove && t.onmousemove() } }) }, this.eventElements = [], this.checkPath = function (t, e) { for (var n = 0; n < this.events.length; n++) { var r = this.events[n]; e.isPointInPath && e.isPointInPath(r.x, r.y) && (this.eventElements[n] = t) } }, this.checkBoundingBox = function (t, e) { for (var n = 0; n < this.events.length; n++) { var r = this.events[n]; e.isPointInBox(r.x, r.y) && (this.eventElements[n] = t) } }, this.runEvents = function () { o.ctx.canvas.style.cursor = ''; for (var t = 0; t < this.events.length; t++) for (var e = this.events[t], n = this.eventElements[t]; n;)e.run(n), n = n.parent; this.events = [], this.eventElements = [] } }(), o }(u || {})); typeof n === 'string' && (n = document.getElementById(n)), n.svg != null && n.svg.stop(), n.childNodes && n.childNodes.length == 1 && n.childNodes[0].nodeName == 'OBJECT' || (n.svg = l); var c = n.getContext('2d'); void 0 !== s.documentElement ? l.loadXmlDoc(c, s) : s.substr(0, 1) == '<' ? l.loadXml(c, s) : l.load(c, s) } else for (var f = document.querySelectorAll('svg'), d = 0; d < f.length; d++) { var h = f[d]; var g = document.createElement('canvas'); g.width = h.clientWidth, g.height = h.clientHeight, h.parentNode.insertBefore(g, h), h.parentNode.removeChild(h); var m = document.createElement('div'); m.appendChild(h), o(g, m.innerHTML) } }; typeof Element === 'undefined' || (void 0 !== Element.prototype.matches ? a = function (t, e) { return t.matches(e) } : void 0 !== Element.prototype.webkitMatchesSelector ? a = function (t, e) { return t.webkitMatchesSelector(e) } : void 0 !== Element.prototype.mozMatchesSelector ? a = function (t, e) { return t.mozMatchesSelector(e) } : void 0 !== Element.prototype.msMatchesSelector ? a = function (t, e) { return t.msMatchesSelector(e) } : void 0 !== Element.prototype.oMatchesSelector ? a = function (t, e) { return t.oMatchesSelector(e) } : (typeof jQuery !== 'function' && typeof Zepto !== 'function' || (a = function (t, e) { return $(t).is(e) }), void 0 === a && typeof Sizzle !== 'undefined' && (a = Sizzle.matchesSelector))); var s = /(\[[^\]]+\])/g; var u = /(#[^\s\+>~\.\[:]+)/g; var l = /(\.[^\s\+>~\.\[:]+)/g; var c = /(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi; var f = /(:[\w-]+\([^\)]*\))/gi; var d = /(:[^\s\+>~\.\[:]+)/g; var h = /([^\s\+>~\.\[:]+)/g; function p (t) { var e = [0, 0, 0]; var n = function (n, r) { var i = t.match(n); i != null && (e[r] += i.length, t = t.replace(n, ' ')) }; return t = (t = t.replace(/:not\(([^\)]*)\)/g, '     $1 ')).replace(/{[\s\S]*/gm, ' '), n(s, 1), n(u, 0), n(l, 1), n(c, 2), n(f, 1), n(d, 1), t = (t = t.replace(/[\*\s\+>~]/g, ' ')).replace(/[#\.]/g, ' '), n(h, 2), e.join('') } typeof CanvasRenderingContext2D !== 'undefined' && (CanvasRenderingContext2D.prototype.drawSvg = function (t, e, n, r, i, a) { var s = { ignoreMouse: !0, ignoreAnimation: !0, ignoreDimensions: !0, ignoreClear: !0, offsetX: e, offsetY: n, scaleWidth: r, scaleHeight: i }; for (var u in a)a.hasOwnProperty(u) && (s[u] = a[u]); o(this.canvas, t, s) }), n.exports = o }(n = { exports: {} })), n.exports }(n(22), n(23))) }, function (t, e, n) {
    var r; var i = i || (function (t) { 'use strict'; if (!(void 0 === t || typeof navigator !== 'undefined' && /MSIE [1-9]\./.test(navigator.userAgent))) { var e = function () { return t.URL || t.webkitURL || t }; var n = t.document.createElementNS('http://www.w3.org/1999/xhtml', 'a'); var r = 'download' in n; var i = /constructor/i.test(t.HTMLElement) || t.safari; var a = /CriOS\/[\d]+/.test(navigator.userAgent); var o = function (e) { (t.setImmediate || t.setTimeout)(function () { throw e }, 0) }; var s = function (t) { setTimeout(function () { typeof t === 'string' ? e().revokeObjectURL(t) : t.remove() }, 4e4) }; var u = function (t) { return /^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type) ? new Blob([String.fromCharCode(65279), t], { type: t.type }) : t }; var l = function (l, c, f) { f || (l = u(l)); var d; var h = this; var p = l.type === 'application/octet-stream'; var g = function () { !(function (t, e, n) { for (var r = (e = [].concat(e)).length; r--;) { var i = t['on' + e[r]]; if (typeof i === 'function') try { i.call(t, n || t) } catch (t) { o(t) } } }(h, 'writestart progress write writeend'.split(' '))) }; if (h.readyState = h.INIT, r) return d = e().createObjectURL(l), void setTimeout(function () { n.href = d, n.download = c, (function (t) { var e = new MouseEvent('click'); t.dispatchEvent(e) }(n)), g(), s(d), h.readyState = h.DONE }); !(function () { if ((a || p && i) && t.FileReader) { var n = new FileReader(); return n.onloadend = function () { var e = a ? n.result : n.result.replace(/^data:[^;]*;/, 'data:attachment/file;'); t.open(e, '_blank') || (t.location.href = e), e = void 0, h.readyState = h.DONE, g() }, n.readAsDataURL(l), void (h.readyState = h.INIT) }d || (d = e().createObjectURL(l)), p ? t.location.href = d : t.open(d, '_blank') || (t.location.href = d); h.readyState = h.DONE, g(), s(d) }()) }; var c = l.prototype; return typeof navigator !== 'undefined' && navigator.msSaveOrOpenBlob ? function (t, e, n) { return e = e || t.name || 'download', n || (t = u(t)), navigator.msSaveOrOpenBlob(t, e) } : (c.abort = function () {}, c.readyState = c.INIT = 0, c.WRITING = 1, c.DONE = 2, c.error = c.onwritestart = c.onprogress = c.onwrite = c.onabort = c.onerror = c.onwriteend = null, function (t, e, n) { return new l(t, e || t.name || 'download', n) }) } }(typeof self !== 'undefined' && self || typeof window !== 'undefined' && window || this.content))
    /*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */void 0 !== t && t.exports ? t.exports.saveAs = i : n(24) !== null && n(25) !== null && (void 0 === (r = (function () { return i }.call(e, n, e, t))) || (t.exports = r))
  }, function (t, e, n) { (t.exports = n(26)(!1)).push([t.i, 'body > * {\n    visibility: hidden;\n}\nbody {\n    overflow: hidden;\n}\nbody * {\n    visibility: hidden !important;\n}\n\n.tau-chart__print-block {\n    position: absolute;\n    top: 0;\n    left: 0;\n    visibility: visible !important;\n    display: block !important;\n    width: 100%;\n    /*height: 100%;*/\n}\n', '']) },, function (t, e, n) { t.exports = n(27) }, function (t, e) { t.exports = function (t) { this.ok = !1, this.alpha = 1, t.charAt(0) == '#' && (t = t.substr(1, 6)), t = (t = t.replace(/ /g, '')).toLowerCase(); var e = { aliceblue: 'f0f8ff', antiquewhite: 'faebd7', aqua: '00ffff', aquamarine: '7fffd4', azure: 'f0ffff', beige: 'f5f5dc', bisque: 'ffe4c4', black: '000000', blanchedalmond: 'ffebcd', blue: '0000ff', blueviolet: '8a2be2', brown: 'a52a2a', burlywood: 'deb887', cadetblue: '5f9ea0', chartreuse: '7fff00', chocolate: 'd2691e', coral: 'ff7f50', cornflowerblue: '6495ed', cornsilk: 'fff8dc', crimson: 'dc143c', cyan: '00ffff', darkblue: '00008b', darkcyan: '008b8b', darkgoldenrod: 'b8860b', darkgray: 'a9a9a9', darkgreen: '006400', darkkhaki: 'bdb76b', darkmagenta: '8b008b', darkolivegreen: '556b2f', darkorange: 'ff8c00', darkorchid: '9932cc', darkred: '8b0000', darksalmon: 'e9967a', darkseagreen: '8fbc8f', darkslateblue: '483d8b', darkslategray: '2f4f4f', darkturquoise: '00ced1', darkviolet: '9400d3', deeppink: 'ff1493', deepskyblue: '00bfff', dimgray: '696969', dodgerblue: '1e90ff', feldspar: 'd19275', firebrick: 'b22222', floralwhite: 'fffaf0', forestgreen: '228b22', fuchsia: 'ff00ff', gainsboro: 'dcdcdc', ghostwhite: 'f8f8ff', gold: 'ffd700', goldenrod: 'daa520', gray: '808080', green: '008000', greenyellow: 'adff2f', honeydew: 'f0fff0', hotpink: 'ff69b4', indianred: 'cd5c5c', indigo: '4b0082', ivory: 'fffff0', khaki: 'f0e68c', lavender: 'e6e6fa', lavenderblush: 'fff0f5', lawngreen: '7cfc00', lemonchiffon: 'fffacd', lightblue: 'add8e6', lightcoral: 'f08080', lightcyan: 'e0ffff', lightgoldenrodyellow: 'fafad2', lightgrey: 'd3d3d3', lightgreen: '90ee90', lightpink: 'ffb6c1', lightsalmon: 'ffa07a', lightseagreen: '20b2aa', lightskyblue: '87cefa', lightslateblue: '8470ff', lightslategray: '778899', lightsteelblue: 'b0c4de', lightyellow: 'ffffe0', lime: '00ff00', limegreen: '32cd32', linen: 'faf0e6', magenta: 'ff00ff', maroon: '800000', mediumaquamarine: '66cdaa', mediumblue: '0000cd', mediumorchid: 'ba55d3', mediumpurple: '9370d8', mediumseagreen: '3cb371', mediumslateblue: '7b68ee', mediumspringgreen: '00fa9a', mediumturquoise: '48d1cc', mediumvioletred: 'c71585', midnightblue: '191970', mintcream: 'f5fffa', mistyrose: 'ffe4e1', moccasin: 'ffe4b5', navajowhite: 'ffdead', navy: '000080', oldlace: 'fdf5e6', olive: '808000', olivedrab: '6b8e23', orange: 'ffa500', orangered: 'ff4500', orchid: 'da70d6', palegoldenrod: 'eee8aa', palegreen: '98fb98', paleturquoise: 'afeeee', palevioletred: 'd87093', papayawhip: 'ffefd5', peachpuff: 'ffdab9', peru: 'cd853f', pink: 'ffc0cb', plum: 'dda0dd', powderblue: 'b0e0e6', purple: '800080', rebeccapurple: '663399', red: 'ff0000', rosybrown: 'bc8f8f', royalblue: '4169e1', saddlebrown: '8b4513', salmon: 'fa8072', sandybrown: 'f4a460', seagreen: '2e8b57', seashell: 'fff5ee', sienna: 'a0522d', silver: 'c0c0c0', skyblue: '87ceeb', slateblue: '6a5acd', slategray: '708090', snow: 'fffafa', springgreen: '00ff7f', steelblue: '4682b4', tan: 'd2b48c', teal: '008080', thistle: 'd8bfd8', tomato: 'ff6347', turquoise: '40e0d0', violet: 'ee82ee', violetred: 'd02090', wheat: 'f5deb3', white: 'ffffff', whitesmoke: 'f5f5f5', yellow: 'ffff00', yellowgreen: '9acd32' }; t = e[t] || t; for (var n = [{ re: /^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/, example: ['rgba(123, 234, 45, 0.8)', 'rgba(255,234,245,1.0)'], process: function (t) { return [parseInt(t[1]), parseInt(t[2]), parseInt(t[3]), parseFloat(t[4])] } }, { re: /^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/, example: ['rgb(123, 234, 45)', 'rgb(255,234,245)'], process: function (t) { return [parseInt(t[1]), parseInt(t[2]), parseInt(t[3])] } }, { re: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/, example: ['#00ff00', '336699'], process: function (t) { return [parseInt(t[1], 16), parseInt(t[2], 16), parseInt(t[3], 16)] } }, { re: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/, example: ['#fb0', 'f0f'], process: function (t) { return [parseInt(t[1] + t[1], 16), parseInt(t[2] + t[2], 16), parseInt(t[3] + t[3], 16)] } }], r = 0; r < n.length; r++) { var i = n[r].re; var a = n[r].process; var o = i.exec(t); if (o) { var s = a(o); this.r = s[0], this.g = s[1], this.b = s[2], s.length > 3 && (this.alpha = s[3]), this.ok = !0 } } this.r = this.r < 0 || isNaN(this.r) ? 0 : this.r > 255 ? 255 : this.r, this.g = this.g < 0 || isNaN(this.g) ? 0 : this.g > 255 ? 255 : this.g, this.b = this.b < 0 || isNaN(this.b) ? 0 : this.b > 255 ? 255 : this.b, this.alpha = this.alpha < 0 ? 0 : this.alpha > 1 || isNaN(this.alpha) ? 1 : this.alpha, this.toRGB = function () { return 'rgb(' + this.r + ', ' + this.g + ', ' + this.b + ')' }, this.toRGBA = function () { return 'rgba(' + this.r + ', ' + this.g + ', ' + this.b + ', ' + this.alpha + ')' }, this.toHex = function () { var t = this.r.toString(16); var e = this.g.toString(16); var n = this.b.toString(16); return t.length == 1 && (t = '0' + t), e.length == 1 && (e = '0' + e), n.length == 1 && (n = '0' + n), '#' + t + e + n }, this.getHelpXML = function () { for (var t = new Array(), r = 0; r < n.length; r++) for (var i = n[r].example, a = 0; a < i.length; a++)t[t.length] = i[a]; for (var o in e)t[t.length] = o; var s = document.createElement('ul'); s.setAttribute('id', 'rgbcolor-examples'); for (r = 0; r < t.length; r++) try { var u = document.createElement('li'); var l = new RGBColor(t[r]); var c = document.createElement('div'); c.style.cssText = 'margin: 3px; border: 1px solid black; background:' + l.toHex() + '; color:' + l.toHex(), c.appendChild(document.createTextNode('test')); var f = document.createTextNode(' ' + t[r] + ' -> ' + l.toRGB() + ' -> ' + l.toHex()); u.appendChild(c), u.appendChild(f), s.appendChild(u) } catch (t) {} return s } } }, function (t, e) { var n = [512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512, 454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512, 482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456, 437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512, 497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328, 320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456, 446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335, 329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512, 505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405, 399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328, 324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271, 268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456, 451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388, 385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335, 332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292, 289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259]; var r = [9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24]; function i (t, e, n, r, i) { if (typeof t === 'string')t = document.getElementById(t); else if (typeof HTMLCanvasElement !== 'undefined' && !(t instanceof HTMLCanvasElement)) return; var a; var o = t.getContext('2d'); try { try { a = o.getImageData(e, n, r, i) } catch (t) { throw new Error('unable to access local image data: ' + t) } } catch (t) { throw new Error('unable to access image data: ' + t) } return a } function a (t, e, n, r, a, s) { if (!(isNaN(s) || s < 1)) { s |= 0; var u = i(t, e, n, r, a); u = o(u, e, n, r, a, s), t.getContext('2d').putImageData(u, e, n) } } function o (t, e, i, a, o, s) { var u; var c; var f; var d; var h; var p; var g; var m; var y; var v; var b; var x; var _; var w; var E; var S; var M; var T; var C; var k; var A; var O; var P; var N; var L = t.data; var R = s + s + 1; var F = a - 1; var D = o - 1; var I = s + 1; var j = I * (I + 1) / 2; var z = new l(); var B = z; for (f = 1; f < R; f++) if (B = B.next = new l(), f == I) var V = B; B.next = z; var H = null; var W = null; g = p = 0; var G = n[s]; var U = r[s]; for (c = 0; c < o; c++) { for (S = M = T = C = m = y = v = b = 0, x = I * (k = L[p]), _ = I * (A = L[p + 1]), w = I * (O = L[p + 2]), E = I * (P = L[p + 3]), m += j * k, y += j * A, v += j * O, b += j * P, B = z, f = 0; f < I; f++)B.r = k, B.g = A, B.b = O, B.a = P, B = B.next; for (f = 1; f < I; f++)d = p + ((F < f ? F : f) << 2), m += (B.r = k = L[d]) * (N = I - f), y += (B.g = A = L[d + 1]) * N, v += (B.b = O = L[d + 2]) * N, b += (B.a = P = L[d + 3]) * N, S += k, M += A, T += O, C += P, B = B.next; for (H = z, W = V, u = 0; u < a; u++)L[p + 3] = P = b * G >> U, P != 0 ? (P = 255 / P, L[p] = (m * G >> U) * P, L[p + 1] = (y * G >> U) * P, L[p + 2] = (v * G >> U) * P) : L[p] = L[p + 1] = L[p + 2] = 0, m -= x, y -= _, v -= w, b -= E, x -= H.r, _ -= H.g, w -= H.b, E -= H.a, d = g + ((d = u + s + 1) < F ? d : F) << 2, m += S += H.r = L[d], y += M += H.g = L[d + 1], v += T += H.b = L[d + 2], b += C += H.a = L[d + 3], H = H.next, x += k = W.r, _ += A = W.g, w += O = W.b, E += P = W.a, S -= k, M -= A, T -= O, C -= P, W = W.next, p += 4; g += a } for (u = 0; u < a; u++) { for (M = T = C = S = y = v = b = m = 0, x = I * (k = L[p = u << 2]), _ = I * (A = L[p + 1]), w = I * (O = L[p + 2]), E = I * (P = L[p + 3]), m += j * k, y += j * A, v += j * O, b += j * P, B = z, f = 0; f < I; f++)B.r = k, B.g = A, B.b = O, B.a = P, B = B.next; for (h = a, f = 1; f <= s; f++)p = h + u << 2, m += (B.r = k = L[p]) * (N = I - f), y += (B.g = A = L[p + 1]) * N, v += (B.b = O = L[p + 2]) * N, b += (B.a = P = L[p + 3]) * N, S += k, M += A, T += O, C += P, B = B.next, f < D && (h += a); for (p = u, H = z, W = V, c = 0; c < o; c++)L[(d = p << 2) + 3] = P = b * G >> U, P > 0 ? (P = 255 / P, L[d] = (m * G >> U) * P, L[d + 1] = (y * G >> U) * P, L[d + 2] = (v * G >> U) * P) : L[d] = L[d + 1] = L[d + 2] = 0, m -= x, y -= _, v -= w, b -= E, x -= H.r, _ -= H.g, w -= H.b, E -= H.a, d = u + ((d = c + I) < D ? d : D) * a << 2, m += S += H.r = L[d], y += M += H.g = L[d + 1], v += T += H.b = L[d + 2], b += C += H.a = L[d + 3], H = H.next, x += k = W.r, _ += A = W.g, w += O = W.b, E += P = W.a, S -= k, M -= A, T -= O, C -= P, W = W.next, p += a } return t } function s (t, e, n, r, a, o) { if (!(isNaN(o) || o < 1)) { o |= 0; var s = i(t, e, n, r, a); s = u(s, e, n, r, a, o), t.getContext('2d').putImageData(s, e, n) } } function u (t, e, i, a, o, s) { var u; var c; var f; var d; var h; var p; var g; var m; var y; var v; var b; var x; var _; var w; var E; var S; var M; var T; var C; var k; var A = t.data; var O = s + s + 1; var P = a - 1; var N = o - 1; var L = s + 1; var R = L * (L + 1) / 2; var F = new l(); var D = F; for (f = 1; f < O; f++) if (D = D.next = new l(), f == L) var I = D; D.next = F; var j = null; var z = null; g = p = 0; var B = n[s]; var V = r[s]; for (c = 0; c < o; c++) { for (w = E = S = m = y = v = 0, b = L * (M = A[p]), x = L * (T = A[p + 1]), _ = L * (C = A[p + 2]), m += R * M, y += R * T, v += R * C, D = F, f = 0; f < L; f++)D.r = M, D.g = T, D.b = C, D = D.next; for (f = 1; f < L; f++)d = p + ((P < f ? P : f) << 2), m += (D.r = M = A[d]) * (k = L - f), y += (D.g = T = A[d + 1]) * k, v += (D.b = C = A[d + 2]) * k, w += M, E += T, S += C, D = D.next; for (j = F, z = I, u = 0; u < a; u++)A[p] = m * B >> V, A[p + 1] = y * B >> V, A[p + 2] = v * B >> V, m -= b, y -= x, v -= _, b -= j.r, x -= j.g, _ -= j.b, d = g + ((d = u + s + 1) < P ? d : P) << 2, m += w += j.r = A[d], y += E += j.g = A[d + 1], v += S += j.b = A[d + 2], j = j.next, b += M = z.r, x += T = z.g, _ += C = z.b, w -= M, E -= T, S -= C, z = z.next, p += 4; g += a } for (u = 0; u < a; u++) { for (E = S = w = y = v = m = 0, b = L * (M = A[p = u << 2]), x = L * (T = A[p + 1]), _ = L * (C = A[p + 2]), m += R * M, y += R * T, v += R * C, D = F, f = 0; f < L; f++)D.r = M, D.g = T, D.b = C, D = D.next; for (h = a, f = 1; f <= s; f++)p = h + u << 2, m += (D.r = M = A[p]) * (k = L - f), y += (D.g = T = A[p + 1]) * k, v += (D.b = C = A[p + 2]) * k, w += M, E += T, S += C, D = D.next, f < N && (h += a); for (p = u, j = F, z = I, c = 0; c < o; c++)A[d = p << 2] = m * B >> V, A[d + 1] = y * B >> V, A[d + 2] = v * B >> V, m -= b, y -= x, v -= _, b -= j.r, x -= j.g, _ -= j.b, d = u + ((d = c + L) < N ? d : N) * a << 2, m += w += j.r = A[d], y += E += j.g = A[d + 1], v += S += j.b = A[d + 2], j = j.next, b += M = z.r, x += T = z.g, _ += C = z.b, w -= M, E -= T, S -= C, z = z.next, p += a } return t } function l () { this.r = 0, this.g = 0, this.b = 0, this.a = 0, this.next = null }t.exports = { image: function (t, e, n, r) { if (typeof t === 'string')t = document.getElementById(t); else if (typeof HTMLImageElement !== 'undefined' && !(t instanceof HTMLImageElement)) return; var i = t.naturalWidth; var o = t.naturalHeight; if (typeof e === 'string')e = document.getElementById(e); else if (typeof HTMLCanvasElement !== 'undefined' && !(e instanceof HTMLCanvasElement)) return; e.style.width = i + 'px', e.style.height = o + 'px', e.width = i, e.height = o; var u = e.getContext('2d'); u.clearRect(0, 0, i, o), u.drawImage(t, 0, 0), isNaN(n) || n < 1 || (r ? a(e, 0, 0, i, o, n) : s(e, 0, 0, i, o, n)) }, canvasRGBA: a, canvasRGB: s, imageDataRGBA: o, imageDataRGB: u } }, function (t, e) { t.exports = function () { throw new Error('define cannot be used indirect') } }, function (t, e) { (function (e) { t.exports = e }).call(this, {}) }, function (t, e) { t.exports = function (t) { var e = []; return e.toString = function () { return this.map(function (e) { var n = (function (t, e) { var n = t[1] || ''; var r = t[3]; if (!r) return n; if (e && typeof btoa === 'function') { var i = (function (t) { return '/*# sourceMappingURL=data:application/json;charset=utf-8;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(t)))) + ' */' }(r)); var a = r.sources.map(function (t) { return '/*# sourceURL=' + r.sourceRoot + t + ' */' }); return [n].concat(a).concat([i]).join('\n') } return [n].join('\n') }(e, t)); return e[2] ? '@media ' + e[2] + '{' + n + '}' : n }).join('') }, e.i = function (t, n) { typeof t === 'string' && (t = [[null, t, '']]); for (var r = {}, i = 0; i < this.length; i++) { var a = this[i][0]; typeof a === 'number' && (r[a] = !0) } for (i = 0; i < t.length; i++) { var o = t[i]; typeof o[0] === 'number' && r[o[0]] || (n && !o[2] ? o[2] = n : n && (o[2] = '(' + o[2] + ') and (' + n + ')'), e.push(o)) } }, e } }, function (t, e, n) { 'use strict'; n.r(e); var r = n(1); var i = n(9); function a (t, e) { return t.replace(/\{\{\s*(.+?)\s*\}\}/g, function (t, n) { return e.hasOwnProperty(n) ? e[n] : '' }) } var o = r.default.api.utils; var s = r.default.api.pluginsSDK; var u = function (t, e, n) { n === 'front' ? t.push(e) : t.unshift(e) }; var l = function (t) { return function (e) { var n = {}; var i = [{ dim: e.scaleX.dim, scale: e.scaleY, method: 'yi', k: -1 }, { dim: e.scaleY.dim, scale: e.scaleX, method: 'xi', k: 1 }, { dim: null, scale: null, method: null, k: null }].find(function (e) { return Array.isArray(t.dim) ? t.dim.indexOf(e.dim) >= 0 : e.dim === t.dim }); if (i.method === null) return n; var a = i.k; var o = { l: -0.5, r: 0.5 }; var s = i.method; var u = i.scale; return n[s] = function (t) { var n = (o[t.__pos__] || 0) * a; if (u.discrete) return e[s](t) + u.stepSize(t[u.dim]) * n; if (u.period) { for (var i = r.default.api.tickPeriod.get(u.period, { utc: u.utcTime }), l = u.domain(), c = i.cast(l[0]); c < l[0];)c = i.next(c); var f = i.cast(l[1]); var d = (u(f) - u(c)) / (f - c); switch (t.__pos__) { case 'l':var h = Math.min(0, l[0] - c); return u(c) + d * h; case 'r':h = Math.max(0, l[1] - f); return u(f) + d * h } } return e[s](t) }, n } }; function c (t) { var e = o.defaults(t || {}, { items: [], formatters: {} }); return { init: function (t) { var e = this; this._chart = t; var n = t.getSpec(); n.scales.annotation_text = { type: 'value', dim: 'text', source: '?' }, n.transformations = n.transformations || {}; var i = function (t) { return n.settings.log(t, 'LOG') }; this._dataRefs = {}, n.transformations.dataRange = function (o, s) { var u = s.from; var l = s.to; var c = t.getScaleInfo(s.primaryScale); if (c.period) { var f = r.default.api.tickPeriod.get(c.period, { utc: n.settings.utcTime }); u = f.cast(new Date(s.from)), l = f.cast(new Date(s.to)) } var d = !c.isInDomain(u); var h = !c.isInDomain(l); if (c.discrete ? d || h : d && h) return i('Annotation is out of domain'), []; var p = t.getScaleInfo(s.secondaryScale); var g = p.domain(); var m = [g[0], g[g.length - 1]]; var y = c.dim; var v = p.dim; var b = '__pos__'; var x = {}; var _ = {}; var w = {}; var E = {}; x[b] = 'l', x[y] = u, x[v] = m[0], _[b] = 'l', _[y] = l, _[v] = m[0], w[b] = 'r', w[y] = l, w[v] = m[1], E[b] = 'r', E[y] = u, E[v] = m[1]; var S = s.axis === 'y' ? w : E; var M = s.axis === 'y' ? E : w; var T = e._getFormat(y); return s.startText && (S.text = a(s.startText, { value: T(S[y]) })), s.endText && (M.text = a(s.endText, { value: T(M[y]) })), e._useSavedDataRefs([x, _, w, E], String([y, u, l])) }, n.transformations.dataLimit = function (o, s) { var u = s.primaryScale; var l = s.secondaryScale; var c = t.getScaleInfo(u); var f = c.period ? r.default.api.tickPeriod.get(c.period, { utc: n.settings.utcTime }).cast(new Date(s.from)) : s.from; if (!c.isInDomain(f)) return i('Annotation is out of domain'), []; var d = t.getScaleInfo(l); var h = d.domain(); var p = [h[0], h[h.length - 1]]; var g = {}; var m = {}; var y = c.dim; var v = d.dim; var b = '__pos__'; var x = e._getFormat(y); return g[y] = f, g[v] = p[0], g[b] = 'l', s.startText && (g.text = a(s.startText, { value: x(f) })), m[y] = f, m[v] = p[1], m[b] = 'r', s.endText && (m.text = a(s.endText, { value: x(f) })), e._useSavedDataRefs([g, m], String([y, v, f])) }, n.transformations.lineNoteData = function (n, o) { var s = o.xScale; var u = o.yScale; var l = t.getScaleInfo(s); var c = t.getScaleInfo(u); var f = l.period ? r.default.api.tickPeriod.get(l.period, { utc: l.utcTime }) : null; var d = c.period ? r.default.api.tickPeriod.get(c.period, { utc: c.utcTime }) : null; var h = o.points.map(function (t) { return [f ? f.cast(t[0]) : t[0], d ? d.cast(t[1]) : t[1]] }); if (h.some(function (t) { return !l.isInDomain(t[0]) || !c.isInDomain(t[1]) })) return i('Annotation is out of domain'), []; var p = l.dim; var g = c.dim; var m = [p, g].map(function (t) { return e._getFormat(t) }); var y = h.map(function (t, e) { e === 0 || h.length; var n; var r = e === 0 ? o.startText : e === h.length - 1 ? o.endText : ''; return (n = {})[p] = t[0], n[g] = t[1], n.text = r ? a(r, { x: m[0](t[0]), y: m[1](t[1]) }) : null, n }); return e._useSavedDataRefs(y, JSON.stringify([p, g, o.points])) } }, addAreaNote: function (t, e, n) { var r = t.scales[e.x]; var i = t.scales[e.y]; var a = n.dim === r.dim ? ['x', 'y'] : n.dim === i.dim ? ['y', 'x'] : null; if (a !== null) { var o = n.val[0]; var s = n.val[1]; var c = n.text; var f = { type: 'ELEMENT.PATH', namespace: 'annotations', x: e.x, y: e.y, color: n.colorScaleName, label: 'annotation_text', expression: { inherit: !1, operator: 'none', params: [], source: '/' }, transformModel: [l(n)], transformation: [{ type: 'dataRange', args: { axis: a[0], startText: typeof c === 'string' ? c : c.start, endText: typeof c === 'string' ? '' : c.end, from: o, to: s, primaryScale: e[a[0]], secondaryScale: e[a[1]] } }], guide: { animationSpeed: e.guide.animationSpeed, showAnchors: 'never', cssClass: 'tau-chart__annotation-area', label: { fontColor: n.color, position: ['r', 'b', 'keep-in-box'] } } }; u(e.units, f, n.position) } else !(function (e) { t.settings.log(e, 'LOG') }("Annotation doesn't match any data field")) }, addLineNote: function (t, e, n) { var r; var i = t.scales[e.x]; var a = t.scales[e.y]; var o = null; var s = !0; if (Array.isArray(n.dim) ? (s = !1, ((r = n.dim)[0] === i.dim && r[1] === a.dim || r[0] === a.dim && r[1] === i.dim) && (o = ['x', 'y'])) : n.dim === i.dim ? o = ['x', 'y'] : n.dim === a.dim && (o = ['y', 'x']), o !== null) { var c = n.text; var f = { type: 'ELEMENT.LINE', namespace: 'annotations', x: e.x, y: e.y, label: 'annotation_text', color: n.colorScaleName, expression: { inherit: !1, operator: 'none', params: [], source: '/' }, guide: { animationSpeed: e.guide.animationSpeed, showAnchors: 'never', widthCssClass: 'tau-chart__line-width-2', cssClass: 'tau-chart__annotation-line', label: { fontColor: n.color, position: s ? ['r', 'b', 'keep-in-box'] : ['auto:avoid-label-edges-overlap', 'auto:adjust-on-label-overflow', 'keep-in-box'] }, x: { fillGaps: !1 }, y: { fillGaps: !1 } } }; var d = s ? { transformModel: [l(n)], transformation: [{ type: 'dataLimit', args: { from: n.val, startText: typeof c === 'string' ? '' : c.start, endText: typeof c === 'string' ? c : c.end, primaryScale: e[o[0]], secondaryScale: e[o[1]] } }] } : { transformation: [{ type: 'lineNoteData', args: { points: r[0] === i.dim ? n.val : n.val.map(function (t) { return t.slice().reverse() }), startText: typeof c === 'string' ? '' : c.start, endText: typeof c === 'string' ? c : c.end, xScale: e.x, yScale: e.y } }] }; Object.assign(f, d), u(e.units, f, n.position) } else !(function (e) { t.settings.log(e, 'LOG') }("Annotation doesn't match any field")) }, onRender: function () { this._clearUnusedDataRefs() }, onSpecReady: function (t, n) { var r = this; var a = []; this._setupAdditionalSeries(), this._startWatchingDataRefs(), t.traverseSpec(n, function (t) { t && t.type === 'COORDS.RECT' && t.units && a.push(t) }), this._formatters = s.getFieldFormatters(n, e.formatters); var o = s.spec(n); a.forEach(function (t) { e.items.map(function (t, e) { var n = (t.color || '#BD10E0').toLowerCase(); var r = i.rgb(n).toString(); n !== 'black' && r === 'rgb(0, 0, 0)' && (r = null); var a = r || n; var s = 'annotation_color_' + e; return o.addScale(s, { type: 'color', source: '?', brewer: [a] }), { dim: t.dim, val: t.val, text: t.text, color: a, position: t.position, colorScaleName: s } }).forEach(function (e) { Array.isArray(e.dim) ? Array.isArray(e.val) && e.val.every(Array.isArray) ? r.addLineNote(n, t, e) : (function (t) { n.settings.log(t, 'LOG') }('Point annotation is not implemented yet')) : Array.isArray(e.val) ? r.addAreaNote(n, t, e) : r.addLineNote(n, t, e) }) }) }, _setupAdditionalSeries: function () { var t = this._chart; var n = t.getSpec(); var r = t.getDataSources()['/'].data; var i = this._getAnnotatedDimValues(e.items); Object.keys(i).forEach(function (t) { ['x_' + t, 'y_' + t].forEach(function (e) { if (e in n.scales) { var a = n.scales[e]; var s = r.map(function (e) { return e[t] }); var u = ['period', 'time'].indexOf(a.type) >= 0 ? i[t].map(function (t) { return new Date(t) }) : i[t]; a.series = o.unique(s.concat(u)) } }) }) }, _getFormat: function (t) { return this._formatters[t] ? this._formatters[t].format : function (t) { return String(t) } }, _useSavedDataRefs: function (t, e) { var n = this._dataRefs; return this._usedDataRefsKeys.add(e), e in n ? (n[e].forEach(function (e, n) { return Object.assign(e, t[n]) }), n[e]) : (n[e] = t, t) }, _startWatchingDataRefs: function () { var t = this._dataRefs; this._initialDataRefsKeys = new Set(Object.keys(t)), this._usedDataRefsKeys = new Set() }, _clearUnusedDataRefs: function () { var t = this._dataRefs; var e = this._initialDataRefsKeys; var n = this._usedDataRefsKeys; Array.from(e).filter(function (t) { return !n.has(t) }).forEach(function (e) { return delete t[e] }), this._initialDataRefsKeys = null, this._usedDataRefsKeys = null }, _getDataRowsFromItems: function (t) { var e = function (t, e) { return t.reduce(function (t, n, r) { return t[n] = e[r], t }, {}) }; return t.reduce(function (t, n) { return Array.isArray(n.dim) ? Array.isArray(n.val) && n.val.every(Array.isArray) && n.val.forEach(function (r) { t.push(e(n.dim, r)) }) : Array.isArray(n.val) ? n.val.forEach(function (r) { t.push(e([n.dim], [r])) }) : t.push(e([n.dim], [n.val])), t }, []) }, _getAnnotatedDimValues: function (t) { var e = {}; return this._getDataRowsFromItems(t).forEach(function (t) { Object.keys(t).forEach(function (n) { e[n] = e[n] || [], e[n].push(t[n]) }) }), e } } }r.default.api.plugins.add('annotations', c); var f = r.default.api.utils; function d (t) { var e = t.x0; var n = t.y0; var r = t.collapse == null || t.collapse; var i = function (t) { return { y0: function (n) { return t.scaleY.value(n[e]) } } }; var a = function (t) { return { y0: function (e) { return t.scaleY.value(e[n]) } } }; var o = function (t) { var r = t.data(); if (r.length === 0) return {}; var i = t.scaleY; var a = Number.MAX_VALUE; var o = Number.MIN_VALUE; var s = t.flip ? e : n; var u = i.dim; return r.forEach(function (t) { var e = t[s]; var n = t[u]; var r = e < n ? e : n; var i = n > e ? n : e; a = r < a ? r : a, o = i > o ? i : o }), i.fixup(function (t) { var e = {}; return (!t.hasOwnProperty('max') || t.max < o) && (e.max = o), (!t.hasOwnProperty('min') || t.min > a) && (e.min = a), e }), {} }; var s = {}; var u = {}; var l = function (t) { var i = t.data().slice(); var a = t.scaleX; var o = t.scaleY; if (i.length === 0 || !a.discrete) return {}; var l = t.flip ? e : n; var c = o.dim; i.sort(f.createMultiSorter(function (t, e) { return t[l] - e[l] }, function (t, e) { return t[c] - e[c] })); var d = a.dim; var h = a.domain().reduce(function (t, e) { return t[e] = [], t }, {}); var p = new Map(); return i.forEach(r ? function (t) { var e = t[d]; var n = h[e]; var r = n.findIndex(function (e) { return e[e.length - 1][c] <= t[l] }); r < 0 && (r = n.length, n.push([])), n[r].push(t), p.set(t, r) } : function (t) { var e = t[d]; var n = h[e]; var r = r = n.length; n.push([]), n[r].push(t), p.set(t, r) }), Object.keys(h).forEach(function (t) { s[t] = h[t] }), a.fixup(function (t) { var e = {}; var n = a.domain().reduce(function (t, e) { return t + s[e].length }, 0); return a.domain().forEach(function (t) { u[t] = n }), e.ratio = function (t) { return s[t].length / u[t] }, e }), { xi: function (e) { var n = e[d]; var r = a.stepSize(n); return t.xi(e) - r / 2 + r / s[n].length * (p.get(e) + 0.5) } } }; return { onSpecReady: function (t, e) { t.traverseSpec(e, function (t, e) { t.type === 'ELEMENT.INTERVAL' && (t.transformModel = [t.flip ? i : a, l], t.adjustScales = [o], t.guide.enableColorToBarPosition = !1, t.guide.label = t.guide.label || {}, t.guide.label.position = t.guide.label.position || (t.flip ? ['inside-start-then-outside-end-horizontal', 'hide-by-label-height-horizontal'] : ['inside-start-then-outside-end-vertical'])) }) } } }r.default.api.plugins.add('bar-as-span', d); var h = n(0); var p = r.default.api.utils; var g = 'minimum'; var m = 'maximum'; var y = { MIN: g, MAX: m, MEDIAN: 'median', Q1: 'Q1', Q3: 'Q3' }; function v (t, e) { var n = t.length - 1; var r = e / 100 * n; var i = Math.floor(r); if (i === 0) return { pos: 0, value: t[0] }; if (i === n) return { pos: n, value: t[n] }; var a = r - i; return a ? { pos: r, value: t[i] + a * (t[i + 1] - t[i]) } : { pos: r, value: t[r] } } function b (t, e, n) { for (var r = t.sort(function (t, e) { return t - e }), i = v(r, 25), a = v(r, 50), o = v(r, 75), s = o.value - i.value, u = i.value - 1.5 * s, l = o.value + 1.5 * s, c = r[0], f = r[r.length - 1], d = 0; d <= i.pos; d++) { var h = r[d]; if (h > u) { c = h; break } } for (var p = r.length - 1; p >= o.pos; p--) { var g = r[p]; if (g < l) { f = g; break } } return e[n.MIN] = c, e[n.MAX] = f, e[n.MEDIAN] = a.value, e[n.Q1] = i.value, e[n.Q3] = o.value, e } function x (t) { return t = p.defaults(t || {}, { mode: 'outliers-only' }), { init: function (t) { this._chart = t }, onSpecReady: function (e, n) { var r = !0 === t.flip; n.transformations = n.transformations || {}, n.transformations.empty = function () { return [] }, n.transformations.outliers = function (t, e) { var n = e.x.dim; var r = e.y.dim; var i = t.reduce(function (t, e) { var i = e[n]; return t[i] = t[i] || [], t[i].push(e[r]), t }, {}); var a = Object.keys(i).reduce(function (t, e) { var a = b(i[e], {}, y); var o = a[y.MAX]; var s = a[y.MIN]; return t.concat(function (t) { return t[n] !== e || (t[r] > o || t[r] < s) }) }, []); return t.filter(function (t) { return !a.some(function (e) { return !e(t) }) }) }, e.traverseSpec(n, function (e, i) { if (e.type === 'ELEMENT.POINT') { var a = JSON.parse(JSON.stringify(e)); a.type = 'ELEMENT.BOX-WHISKERS', a.flip = r, a.namespace = 'boxwhiskers', a.guide = a.guide || {}, a.guide.fitScale = t.mode === 'hide-scatter'; var o = { 'show-scatter': [], 'hide-scatter': [{ type: 'empty' }], 'outliers-only': [{ type: 'outliers', args: { x: n.scales[r ? e.y : e.x], y: n.scales[r ? e.x : e.y] } }] }; e.transformation = e.transformation || [], e.transformation = e.transformation.concat(o[t.mode]), i.units.push(a) } }) } } }r.default.api.unitsRegistry.reg('ELEMENT.BOX-WHISKERS', { getAdjustScalesRules: function () { var t = this; var e = []; return t.node().config.guide.fitScale && e.push(function (e) { t.fixScale(e, t.calcStat(e)) }), e }, fixScale: function (t, e) { var n = e.reduce(function (t, e) { return t.concat([e[y.MIN], e[y.MAX]]) }, []).sort(function (t, e) { return t - e }); var r = n[0]; var i = n[n.length - 1]; t.scaleY.fixup(function (t) { var e = {}; if (t.hasOwnProperty('series')) { var n = Math.min(t.series[0], r); var a = Math.max(t.series[1], i); e.series = [n, a] } else e.series = [r, i]; return e }) }, calcStat: function (t) { var e = t.data().reduce(function (e, n) { var r = n[t.scaleX.dim]; return e[r] = e[r] || [], e[r].push(n[t.scaleY.dim]), e }, {}); return Object.keys(e).reduce(function (n, r) { var i = {}; return i[t.scaleX.dim] = r, n.concat(b(e[r], i, y)) }, []) }, buildRangeModel: function (t, e) { var n = t.flip; var r = n ? 'y' : 'x'; var i = n ? 'x' : 'y'; var a = n ? 'height' : 'width'; var o = n ? 'width' : 'height'; var s = n ? e.y1 : e.y0; var u = n ? e.y0 : e.y1; var l = e.size; var c = t.model.scaleX; var f = t.model.scaleY; var d = { class: e.class }; return d[r] = function (t) { return c(t[c.dim]) - 0.5 * l }, d[i] = function (t) { return f(t[u]) }, d[a] = function () { return l }, d[o] = function (t) { return Math.max(e.minHeight || 1, Math.abs(f(t[s]) - f(t[u]))) }, Object.assign(d, { fill: function () { return e.color || 'rgba(0,0,256, 0.5)' } }) }, draw: function () { var t = this.node().config; var e = t.options.slot(t.uid); var n = this.calcStat(this.node().screenModel.model); this.drawElement(e, n) }, drawElement: function (t, e) { var n = this; var i = this.node().screenModel; var a = r.default.api.d3_animationInterceptor; var o = function (t, e) { var r = n.node().config.guide.animationSpeed; var o = t.selectAll('.' + e.class).data(function (t) { return [t] }, i.id); o.exit().call(a(r, null, { width: 0 }, function (t) { h.select(t).remove() })), o.call(a(r, null, e)), o.enter().append('rect').style('stroke-width', 0).call(a(r, { width: 0 }, e)) }; var s = function (t) { o(t, n.buildRangeModel(i, { size: 2, y0: g, y1: 'Q1', class: 'range-min-Q1' })), o(t, n.buildRangeModel(i, { size: 2, y0: 'Q3', y1: m, class: 'range-Q3-max' })), o(t, n.buildRangeModel(i, { size: 20, y0: 'Q1', y1: 'Q3', class: 'range-Q1-Q3' })), o(t, n.buildRangeModel(i, { size: 20, minHeight: 1, y0: m, y1: m, class: 'limit-max' })), o(t, n.buildRangeModel(i, { size: 20, minHeight: 1, y0: g, y1: g, class: 'limit-min' })), o(t, n.buildRangeModel(i, { size: 20, minHeight: 2, y0: 'median', y1: 'median', color: '#ff0000', class: 'limit-median' })) }; var u = t.selectAll('.box-whiskers-node').data(e); u.exit().remove(), u.call(s), u.enter().append('g').attr('class', 'box-whiskers-node').call(s) } }, 'ELEMENT.GENERIC.CARTESIAN'), r.default.api.plugins.add('box-whiskers', x); var _ = r.default.api.utils; var w = r.default.api.pluginsSDK; var E = 'tau-chart__category-filter'; var S = E + '__value'; var M = S + '_checked'; var T = S + '__toggle'; var C = function (t) { return t.join('\n') }; var k = function (t) { var e = t.label; var n = t.values; return '\n    <div class="' + E + '__category">\n        <div class="' + E + '__category__label">' + e + '</div>\n        <div class="' + E + '__category__values">\n            ' + C(n.map(function (t) { return A(t) })) + '\n    </div>\n\n' }; var A = function (t) { var e = t.key; var n = t.label; var r = t.checked; return '\n    <div class="' + S + (r ? ' ' + M : '') + '" data-key="' + e + '">\n        ' + O() + '\n        <span class="' + S + '__label">' + n + '</span>\n    </div>\n' }; var O = function () { return ['<span class="' + T + '">', '<span class="' + T + '__icon"></span>', '</span>'].join('') }; var P = function (t, e, n, r) { t.addEventListener(e, function (t) { for (var e = t.target; e !== t.currentTarget && e !== null;)e.matches(n) && r(t, e), e = e.parentNode }) }; var N = function (t, e) { var n = function (t) { return JSON.stringify((function (t) { return t == null || t === '' }(t)) ? null : t) }; var r = n(e); return function (e) { var i = e[t]; var a = n(i); return r === a } }; var L = (function () { function t (t) { this.settings = _.defaults(t || {}, { formatters: {}, fields: null, skipColorDim: !0 }), this._filters = {}, this.onRender = this._createRenderHandler() } return t.prototype.init = function (t) { var e = this; this._chart = t; var n = function (e) { var n = t.getSpec().scales; return Object.keys(n).map(function (t) { return { name: t, config: n[t] } }).filter(e) }; var r = n(function (t) { var e = t.config; t.name; return e.type === 'ordinal' && e.dim }); var i = _.unique(r.map(function (t) { return t.config.dim })); if (this.settings.fields && (i = i.filter(function (t) { return e.settings.fields.indexOf(t) >= 0 })), this.settings.skipColorDim) { var a = n(function (t) { var e = t.config; t.name; return e.type === 'color' && e.dim }).map(function (t) { return t.config.dim }); i = i.filter(function (t) { return a.indexOf(t) < 0 }) }r = r.filter(function (t) { return i.indexOf(t.config.dim) >= 0 }), this._categoryScales = r, this._render() }, t.prototype.destroy = function () { var t = this._filters; var e = this._chart; Object.keys(t).forEach(function (n) { return e.removeFilter(t[n]) }); !(function (t) { t && t.parentElement && t.parentElement.removeChild(t) }(this._node)) }, t.prototype._createRenderHandler = function () { return function () { if (this._lastClickedScrollInfo) { var t = this._lastClickedScrollInfo.key; var e = this._node.querySelector('[data-key="' + t + '"]'); if (e) { var n = this._lastClickedScrollInfo.top; var r = e.getBoundingClientRect().top; var i = this._getScrollContainer(); var a = i.getBoundingClientRect().top; i.scrollTop = i.scrollTop - n - a + r } this._lastClickedScrollInfo = null } } }, t.prototype._getContent = function (t) { return (function (t) { var e = t.categories; return '\n    <div class="' + E + '">\n        ' + C(e.map(function (t) { return k(t) })) + '\n    </div>\n' }({ categories: t })) }, t.prototype._getCategoriesInfo = function () { var t = this; return this._categoryScales.map(function (e) { var n = e.name; return t._chart.getScaleInfo(n) }).map(function (e) { var n = e.dim; var r = t._getFieldLabel(n); var i = t._getFieldFormat(n); var a = t._chart.getDataSources({ excludeFilter: ['category-filter'] }); var o = _.unique(a[e.source].data.map(function (t) { return t[n] })).map(function (e) { var r = i(e); var a = t._getFilterKey(n, e); return { label: r, checked: !t._filters[a], key: a, value: e } }); return { dim: n, label: r, values: o } }) }, t.prototype._render = function () { this._clear(), this._formatters = w.getFieldFormatters(this._chart.getSpec(), this.settings.formatters); var t = this._getCategoriesInfo(); var e = (function (t) { var e = document.createElement('div'); return e.innerHTML = t, e.firstElementChild }(this._getContent(t))); this._node = e, this._chart.insertToRightSidebar(e), this._subscribeToEvents(), this._filterKeys = t.reduce(function (t, e) { var n = e.dim; return e.values.forEach(function (e) { var r = e.key; var i = e.value; t[r] = { dim: n, value: i } }), t }, {}) }, t.prototype._subscribeToEvents = function () { var t = this; var e = this._node; P(e, 'click', '.' + S, function (e, n) { var r = n.getAttribute('data-key'); var i = e.target.matches('.' + T); t._toggleCategory(r, i ? 'toggle' : 'focus') }), P(e, 'mouseover', '.' + S, function (e, n) { var r = n.getAttribute('data-key'); t._toggleHighlight(r, !0) }), P(e, 'mouseout', '.' + S, function (e, n) { var r = n.getAttribute('data-key'); t._toggleHighlight(r, !1) }) }, t.prototype._isFilteredOut = function (t) { return t in this._filters }, t.prototype._toggleCategory = function (t, e) { var n = this; var r = Array.from(this._node.querySelectorAll('.' + S)).reduce(function (t, e) { return t[e.getAttribute('data-key')] = e, t }, {}); var i = Object.keys(this._filterKeys).map(function (t) { var e = n._filterKeys[t]; var i = e.dim; var a = e.value; return { node: r[t], key: t, dim: i, value: a, isChecked: !n._isFilteredOut(t) } }); var a = i.reduce(function (t, e) { return t[e.key] = e, t }, {})[t]; var o = i.filter(function (t) { return t.dim === a.dim }); var s = function (t, e) { e ? t.classList.add(M) : t.classList.remove(M) }; switch (e) { case 'toggle':a.isChecked ? (this._addFilter(t), s(a.node, !1)) : (this._removeFilter(t), s(a.node, !0)); break; case 'focus':a.isChecked && o.every(function (t) { return t === a || !t.isChecked }) ? o.forEach(function (t) { t.isChecked || (s(t.node, !0), n._removeFilter(t.key)) }) : (o.forEach(function (t) { t !== a && t.isChecked && (s(t.node, !1), n._addFilter(t.key)) }), a.isChecked || (s(a.node, !0), this._removeFilter(a.key))) } this._lastClickedScrollInfo = { key: t, top: a.node.getBoundingClientRect().top - this._getScrollContainer().getBoundingClientRect().top }, this._chart.refresh() }, t.prototype._toggleHighlight = function (t, e) { if (!this._isFilteredOut(t)) { var n = this._filterKeys[t]; var r = n.dim; var i = n.value; var a = e ? N(r, i) : function (t) { return null }; this._chart.select(function (t) { return !0 }).forEach(function (t) { return t.fire('highlight', a) }) } }, t.prototype._clear = function () { var t = this._node; t && t.parentElement && t.parentElement.removeChild(t) }, t.prototype._getScrollContainer = function () { return this._node.parentElement.parentElement }, t.prototype._getFilterKey = function (t, e) { return t + '__' + e }, t.prototype._addFilter = function (t) { var e = this._filterKeys[t]; var n = e.dim; var r = e.value; var i = N(n, r); this._filters[t] = this._chart.addFilter({ tag: 'category-filter', predicate: function (t) { return !i(t) } }) }, t.prototype._removeFilter = function (t) { var e = this._filters[t]; delete this._filters[t], this._chart.removeFilter(e) }, t.prototype._getFieldLabel = function (t) { return this._formatters[t] ? this._formatters[t].label : t }, t.prototype._getFieldFormat = function (t) { return this._formatters[t] ? this._formatters[t].format : function (t) { return String(t) } }, t }()); r.default.api.plugins.add('category-filter', function (t) { return new L(t) }); var R = 'http://www.w3.org/2000/svg'; var F = r.default.api.utils; var D = r.default.api.svgUtils; var I = r.default.api.pluginsSDK; function j (t) { t = t || {}; var e = document.createElementNS(R, 'g'); var n = h.select(e).attr('class', 'tau-crosshair__label'); n.append('rect').attr('class', 'tau-crosshair__label__box'), n.append('text').attr('class', 'tau-crosshair__label__text-shadow'), n.append('text').attr('class', 'tau-crosshair__label__text'); var r = { options: function (e) { return t = Object.assign(t, e), r }, show: function (i) { return t.container.appendChild(e), (function (e) { var r = e.x; var i = e.y; var a = e.text; var o = e.color; var s = e.colorCls; n.attr('class', 'tau-crosshair__label ' + s); var u = t.halign; var l = t.valign; var c = t.hpad; var f = t.vpad; var d = { left: 'end', middle: 'middle', right: 'start' }[u]; var h = { left: -c, middle: 0, right: c }[u]; var p = n.select('.tau-crosshair__label__text').attr('fill', o); var g = n.selectAll('.tau-crosshair__label__text, .tau-crosshair__label__text-shadow').attr('text-anchor', d).attr('x', r + h).attr('y', 0).text(a); var m = p.node().getBBox(); var y = { top: -f - m.height / 2, middle: 0, bottom: f + m.height / 2 }[l] - m.height / 2 - m.y; g.attr('y', i + y); var v = m.width + 2 * c; var b = m.height + 2 * f; var x = { left: -v, middle: -v / 2, right: 0 }[u]; var _ = { top: -b, middle: -b / 2, bottom: 0 }[l]; n.select('.tau-crosshair__label__box').attr('fill', o).attr('rx', t.boxCornerRadius).attr('ry', t.boxCornerRadius).attr('x', r + x).attr('y', i + _).attr('width', v).attr('height', b) }(i)), (function () { n.attr('transform', ''); var r = t.chart.getLayout().contentContainer.getBoundingClientRect(); var i = t.chart.getSVG().getBoundingClientRect(); var a = e.getBoundingClientRect(); var o = Math.max(0, Math.max(r.left, i.left) - a.left) || Math.min(0, Math.min(r.right, i.right) - a.right); var s = Math.max(0, Math.max(r.top, i.top) - a.top) || Math.min(0, Math.min(r.bottom, i.bottom) - a.bottom); n.attr('transform', 'translate(' + o + ',' + s + ')') }()), r }, hide: function () { return e.parentNode && e.parentNode.removeChild(e), r } }; return r } function z (t) { var e = F.defaults(t || {}, { xAxis: !0, yAxis: !0, formatters: {}, labelBoxHPadding: 5, labelBoxVPadding: 3, labelBoxCornerRadius: 3, axisHPadding: 22, axisVPadding: 22 }); return { init: function (t) { this._chart = t, this._formatters = {}, this._createNode() }, _createNode: function () { var t = h.select(document.createElementNS(R, 'g')).attr('class', 'tau-crosshair'); this._labels = { x: null, y: null }; var n = function (n) { var r = t.append('g').attr('class', 'tau-crosshair__group ' + n); r.append('line').attr('class', 'tau-crosshair__line-shadow'), r.append('line').attr('class', 'tau-crosshair__line'), this._labels[n] = j({ container: r.node(), chart: this._chart, halign: n === 'x' ? 'middle' : 'left', valign: n === 'x' ? 'bottom' : 'middle', boxCornerRadius: e.labelBoxCornerRadius, hpad: e.labelBoxHPadding, vpad: e.labelBoxVPadding }) }.bind(this); e.xAxis && n('x'), e.yAxis && n('y'), this._element = t }, _setValues: function (t, n, r) { var i = function (t) { var n = this._element.select('.tau-crosshair__group.' + t.dir); n.select('.tau-crosshair__line').attr('class', 'tau-crosshair__line ' + r.cls).attr('stroke', r.color), n.selectAll('.tau-crosshair__line, .tau-crosshair__line-shadow').attr('x1', t.startPt.x).attr('x2', t.valuePt.x).attr('y1', t.startPt.y).attr('y2', t.valuePt.y), (t.dir === 'x' && e.xAxis || t.dir === 'y' && e.yAxis) && this._labels[t.dir].options({ halign: t.labelHAlign, valign: t.labelVAlign }).show({ x: t.startPt.x, y: t.startPt.y, text: t.label, color: r.color, colorCls: r.cls }) }.bind(this); i({ dir: 'x', startPt: { x: t.value, y: n.start + (t.minMode ? 0 : e.axisVPadding) }, valuePt: { x: t.value, y: n.value + n.crossPadding }, label: t.label, labelHAlign: 'middle', labelVAlign: 'bottom' }), i({ dir: 'y', startPt: { x: t.start - (n.minMode ? 0 : e.axisHPadding), y: n.value }, valuePt: { x: t.value - t.crossPadding, y: n.value }, label: n.label, labelHAlign: 'left', labelVAlign: 'middle' }) }, _showCrosshair: function (t, e, n) { var r = this._chart.getSVG(); var i = e.config.options.container.node(); var a = D.getDeepTransformTranslate(i); this._element.attr('transform', D.translate(a.x, a.y)), r.appendChild(this._element.node()); var o = e.getScale('x'); var s = e.getScale('y'); var u = e.getScale('color'); var l = u(t.data[u.dim]); var c = t.data[o.dim]; var f = t.data[s.dim]; var d = e.screenModel.x(t.data); var h = e.screenModel.y(t.data); if (e.config.stack) if (e.config.flip) { var p = e.data().filter(function (n) { var r = n[s.dim]; return n === t.data || (r === f || r - f == 0) && (e.screenModel.x(t.data) - e.screenModel.x(n)) * n[o.dim] > 0 }); d = (c < 0 ? Math.min : Math.max).apply(null, p.map(function (t) { return e.screenModel.x(t) }, 0)), c = p.reduce(function (t, e) { return t + e[o.dim] }, 0) } else { var g = e.data().filter(function (n) { var r = n[o.dim]; return n === t.data || (r === c || r - c == 0) && (e.screenModel.y(n) - e.screenModel.y(t.data)) * n[s.dim] > 0 }); h = (f < 0 ? Math.max : Math.min).apply(null, g.map(function (t) { return e.screenModel.y(t) }, 0)), f = g.reduce(function (t, e) { return t + e[s.dim] }, 0) } var m = t.node.getBBox(); var y = ['ELEMENT.AREA', 'ELEMENT.INTERVAL', 'ELEMENT.INTERVAL.STACKED'].indexOf(e.config.type) >= 0 ? { x: m.width * (e.config.flip ? c > 0 ? 1 : 0 : 0.5), y: m.height * (e.config.flip ? 0.5 : f > 0 ? 1 : 0) } : { x: m.width / 2, y: m.height / 2 }; this._setValues({ label: this._getFormat(o.dim)(c), start: 0, value: d, crossPadding: y.x, minMode: n && n.guide.x.hide }, { label: this._getFormat(s.dim)(f), start: e.config.options.height, value: h, crossPadding: y.y, minMode: n && n.guide.y.hide }, { cls: u.toColor(l) ? '' : l, color: u.toColor(l) ? l : '' }) }, _hideCrosshair: function () { var t = this._element.node(); t.parentNode && t.parentNode.removeChild(t) }, destroy: function () { this._hideCrosshair() }, _subscribeToHover: function () { var t = ['ELEMENT.LINE', 'ELEMENT.AREA', 'ELEMENT.PATH', 'ELEMENT.INTERVAL', 'ELEMENT.INTERVAL.STACKED', 'ELEMENT.POINT']; this._chart.select(function (e) { return t.indexOf(e.config.type) >= 0 }).forEach(function (t) { t.on('data-hover', function (t, e) { if (e.data) { if (t === e.unit) { var n = I.getParentUnit(this._chart.getSpec(), t.config); this._showCrosshair(e, t, n) } } else this._hideCrosshair() }.bind(this)) }, this) }, _getFormat: function (t) { return this._formatters[t] ? this._formatters[t].format : function (t) { return String(t) } }, onRender: function () { this._formatters = I.getFieldFormatters(this._chart.getSpec(), e.formatters), this._subscribeToHover() } } }r.default.api.plugins.add('crosshair', z); var B = 'tau-chart__tooltip'; function V (t, e) { return { render: function (t) { return this.args = t, t = Object.assign({}, t, { fields: this.filterFields(t.fields) }), this.rootTemplate(t) }, rootTemplate: function (t) { return ['<div class="' + B + '__buttons ' + B + '__clickable">', this.buttonsTemplate(), '</div>', '<div class="i-role-content ' + B + '__content">', this.contentTemplate(t), '</div>'].join('\n') }, contentTemplate: function (t) { return this.fieldsTemplate(t) }, filterFields: function (t) { return t }, getLabel: function (e) { return t.getFieldLabel(e) }, getFormatter: function (e) { return t.getFieldFormat(e) }, fieldsTemplate: function (t) { var e = this; var n = t.data; return t.fields.map(function (t) { return e.itemTemplate({ data: n, field: t }) }).join('\n') }, itemTemplate: function (t) { var e = t.data; var n = t.field; var r = this.getLabel(n); var i = this.getFormatter(n)(e[n]); return ['<div class="' + B + '__list__item">', '  <div class="' + B + '__list__elem">' + r + '</div>', '  <div class="' + B + '__list__elem">' + i + '</div>', '</div>'].join('\n') }, buttonsTemplate: function () { return [this.buttonTemplate({ cls: 'i-role-exclude', text: 'Exclude', icon: function () { return '<span class="tau-icon-close-gray"></span>' } })].join('\n') }, buttonTemplate: function (t) { var e = t.icon; var n = t.text; var r = t.cls; return ['<div class="' + B + '__button ' + r + '">', '  <div class="' + B + '__button__wrap">', '    ' + (e ? e() + ' ' : '') + n, '  </div>', '</div>'].join('\n') }, didMount: function () { var e = t.getDomNode().querySelector('.i-role-exclude'); e && e.addEventListener('click', function () { t.excludeHighlightedElement(), t.setState({ highlight: null, isStuck: !1 }) }) } } } var H = r.default.api.utils; var W = r.default.api.domUtils; var G = r.default.api.pluginsSDK; var U = 'tau-chart__tooltip'; var X = (function () { function t (t) { this.settings = H.defaults(t || {}, { align: 'bottom-right', clickable: !0, clsClickable: U + '__clickable', clsStuck: 'stuck', clsTarget: U + '-target', escapeHtml: !0, fields: null, formatters: {}, getTemplate: null, spacing: 24, winBound: 12 }), this.onRender = this._getRenderHandler() } return t.prototype.init = function (t) { this._chart = t, this._tooltip = this._chart.addBalloon({ spacing: this.settings.spacing, winBound: this.settings.winBound, auto: !0, effectClass: 'fade' }), this._initDomEvents(), this.state = { highlight: null, isStuck: !1 }, this.setState(this.state), this._template = this._getTemplate() }, t.prototype._getTemplate = function () { var t = V(this, this.settings); return typeof this.settings.getTemplate === 'function' ? this.settings.getTemplate(t, this, this.settings) : t }, t.prototype._renderTemplate = function (t, e) { return this._template.render({ data: t, fields: e }) }, t.prototype._initDomEvents = function () { var t = this; this._scrollHandler = function () { t.setState({ highlight: null, isStuck: !1 }) }, window.addEventListener('scroll', this._scrollHandler, !0), this.settings.clickable && (this._outerClickHandler = function (e) { var n = Array.from(document.querySelectorAll('.' + t.settings.clsClickable)).concat(t.getDomNode()).map(function (t) { return t.getBoundingClientRect() }); var r = Math.min.apply(Math, n.map(function (t) { return t.top })); var i = Math.min.apply(Math, n.map(function (t) { return t.left })); var a = Math.max.apply(Math, n.map(function (t) { return t.right })); var o = Math.max.apply(Math, n.map(function (t) { return t.bottom })); (e.clientX < i || e.clientX > a || e.clientY < r || e.clientY > o) && t.setState({ highlight: null, isStuck: !1 }) }) }, t.prototype.getDomNode = function () { return this._tooltip.getElement() }, t.prototype.setState = function (t) { var e = this; var n = this.settings; var r = this.state; var i = this.state = Object.assign({}, r, t); r.highlight = r.highlight || { data: null, cursor: null, unit: null }, i.highlight = i.highlight || { data: null, cursor: null, unit: null }, i.isStuck && r.highlight.data && (i.highlight = r.highlight), i.highlight.data !== r.highlight.data && (i.highlight.data ? (this._hideTooltip(), this._showTooltip(i.highlight.data, i.highlight.cursor), this._setTargetSvgClass(!0), requestAnimationFrame(function () { e._setTargetSvgClass(!0) })) : i.isStuck || !r.highlight.data || i.highlight.data || (this._removeFocus(), this._hideTooltip(), this._setTargetSvgClass(!1))), !i.highlight.data || r.highlight.cursor && i.highlight.cursor.x === r.highlight.cursor.x && i.highlight.cursor.y === r.highlight.cursor.y || (this._tooltip.position(i.highlight.cursor.x, i.highlight.cursor.y), this._tooltip.updateSize()); var a = this.getDomNode(); this.settings.clickable && i.isStuck !== r.isStuck && (i.isStuck ? (window.addEventListener('click', this._outerClickHandler, !0), a.classList.add(n.clsStuck), this._setTargetEventsEnabled(!1), this._accentFocus(i.highlight.data), this._tooltip.updateSize()) : (window.removeEventListener('click', this._outerClickHandler, !0), a.classList.remove(n.clsStuck), requestAnimationFrame(function () { e._setTargetEventsEnabled(!0); var t = e._chart.getSVG(); t && W.dispatchMouseEvent(t, 'mouseleave') }))) }, t.prototype._showTooltip = function (t, e) { var n = this.settings; var r = n.fields || typeof n.getFields === 'function' && n.getFields(this._chart) || Object.keys(t); var i = this._renderTemplate(t, r); this._tooltip.content(i).position(e.x, e.y).place(n.align).show().updateSize(), this._template.didMount && this._template.didMount() }, t.prototype._hideTooltip = function () { window.removeEventListener('click', this._outerClickHandler, !0), this._template.willUnmount && this._template.willUnmount(), this._tooltip.hide() }, t.prototype.destroy = function () { window.removeEventListener('scroll', this._scrollHandler, !0), this._setTargetSvgClass(!1), this.setState({ highlight: null, isStuck: !1 }), this._tooltip.destroy() }, t.prototype._subscribeToHover = function () { var t = this; var e = ['ELEMENT.LINE', 'ELEMENT.AREA', 'ELEMENT.PATH', 'ELEMENT.INTERVAL', 'ELEMENT.INTERVAL.STACKED', 'ELEMENT.POINT']; this._chart.select(function (t) { return e.indexOf(t.config.type) >= 0 }).forEach(function (e) { e.on('data-hover', function (e, n) { var r = document.body.getBoundingClientRect(); t.setState({ highlight: n.data ? { data: n.data, cursor: { x: n.event.clientX - r.left, y: n.event.clientY - r.top }, unit: n.unit } : null }) }), t.settings.clickable && e.on('data-click', function (e, n) { var r = document.body.getBoundingClientRect(); t.setState(n.data ? { highlight: { data: n.data, cursor: { x: n.event.clientX - r.left, y: n.event.clientY - r.top }, unit: n.unit }, isStuck: !0 } : { highlight: null, isStuck: null }) }) }) }, t.prototype.getFieldFormat = function (t) { var e = this._formatters[t] ? this._formatters[t].format : function (t) { return String(t) }; return this.settings.escapeHtml ? function (t) { return H.escapeHtml(e(t)) } : e }, t.prototype.getFieldLabel = function (t) { var e = this._formatters[t] ? this._formatters[t].label : t; return this.settings.escapeHtml ? H.escapeHtml(e) : e }, t.prototype._accentFocus = function (t) { var e = function (e) { return e === t }; this._chart.select(function () { return !0 }).forEach(function (t) { t.fire('highlight', e) }) }, t.prototype._removeFocus = function () { var t = function () { return null }; this._chart.select(function () { return !0 }).forEach(function (e) { e.fire('highlight', t), e.fire('highlight-data-points', t) }) }, t.prototype.excludeHighlightedElement = function () { var t = this.state.highlight.data; this._chart.addFilter({ tag: 'exclude', predicate: function (e) { return e !== t } }), this._chart.refresh() }, t.prototype._getRenderHandler = function () { return function () { this._formatters = G.getFieldFormatters(this._chart.getSpec(), this.settings.formatters), this._subscribeToHover(), this.setState({ highlight: null, isStuck: !1 }) } }, t.prototype._setTargetSvgClass = function (t) { h.select(this._chart.getSVG()).classed(this.settings.clsTarget, t) }, t.prototype._setTargetEventsEnabled = function (t) { t ? this._chart.enablePointerEvents() : this._chart.disablePointerEvents() }, t }()); var q = 'diff-tooltip'; var Y = q + '__item'; var $ = q + '__header'; var K = r.default.api.utils; var J = { draw: function () { var t = this.node().config; this._container = t.options.slot(t.uid) }, addInteraction: function () { var t = this; this.node().on('interval-highlight', function (e, n) { t._drawRange(n) }) }, _drawRange: function (t) { var e = this.node(); var n = e.config; var r = e.screenModel.flip; var i = this._container; var a = 'interval-highlight'; var o = a + '__gradient'; var s = t ? t[0] : null; var u = t ? t[1] : null; var l = r ? n.options.width : n.options.height; K.take(function () { var e = i.selectAll('.' + a).data(t ? [1] : []); return e.exit().remove(), { g: e, gEnter: e.enter().append('g').attr('class', a).attr('pointer-events', 'none') } }()).then(function (e) { !(function () { for (var e = a + '__defs', s = a + '__gradient-start', u = a + '__gradient-end', l = i.node(); (l = l.parentNode).tagName !== 'svg';);var c = e + '__' + n.uid; var f = h.select(l).selectAll('#' + c).data(t ? [1] : []); f.exit().remove(); var d = f.enter().append('defs').attr('class', e).attr('id', c).append('linearGradient').attr('id', o).attr('x1', '0%').attr('y1', r ? '100%' : '0%').attr('x2', r ? '0%' : '100%').attr('y2', '0%'); d.append('stop').attr('class', s).attr('offset', '0%'), d.append('stop').attr('class', u).attr('offset', '100%') }()), (function (t) { var e = t.g; var n = t.gEnter; var i = a + '__range'; var c = e.select('.' + i); var f = n.append('rect').attr('class', i).attr('fill', 'url(#' + o + ')'); var d = r ? { x: 0, y: u, width: l, height: s - u } : { x: s, y: 0, width: u - s, height: l }; var h = d.x; var p = d.y; var g = d.width; var m = d.height; f.merge(c).attr('x', h).attr('y', p).attr('width', Math.abs(g)).attr('height', Math.abs(m)) }(e)), (function (t) { var e = t.g; var n = t.gEnter; var i = a + '__range-start'; var o = e.select('.' + i); var u = n.append('line').attr('class', i); var c = r ? { x1: 0, y1: s, x2: l, y2: s } : { x1: s, y1: 0, x2: s, y2: l }; var f = c.x1; var d = c.y1; var h = c.x2; var p = c.y2; u.merge(o).attr('x1', f).attr('y1', d).attr('x2', h).attr('y2', p) }(e)), (function (t) { var e = t.g; var n = t.gEnter; var i = a + '__range-end'; var o = e.select('.' + i); var s = n.append('line').attr('class', i); var c = r ? { x1: 0, y1: u, x2: l, y2: u } : { x1: u, y1: 0, x2: u, y2: l }; var f = c.x1; var d = c.y1; var h = c.x2; var p = c.y2; s.merge(o).attr('x1', f).attr('y1', d).attr('x2', h).attr('y2', p) }(e)) }) } }; var Q = (function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e)e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function r () { this.constructor = e }t(e, n), e.prototype = n === null ? Object.create(n) : (r.prototype = n.prototype, new r()) } }()); var Z = r.default.api.utils; var tt = (function (t) { function e (e) { var n = t.call(this, e) || this; return n.onSpecReady = n._getSpecReadyHandler(), n } return Q(e, t), e.prototype.init = function (e) { t.prototype.init.call(this, e), this._unitsGroupedData = new Map() }, e.prototype._getTemplate = function () { var t = (function (t, e) { var n = V(t); return Object.assign({}, n, { hasColor: function () { return this.args.colorField != null }, contentTemplate: function (t) { return [this.fieldsTemplate(t), this.tableTemplate(t)].join('\n') }, filterFields: function (e) { var r = t.state.highlight.unit.screenModel.model; var i = r.scaleColor; var a = r.scaleX; var o = r.scaleY; var s = e.filter(function (t) { return t !== i.dim && t !== a.dim && t !== o.dim }); var u = function () { return s.push(a.dim) }; return this.shouldShowColorTable() ? u() : (u(), i.dim && s.push(i.dim), s.push(o.dim)), n.filterFields.call(this, s) }, itemTemplate: function (t) { var e = t.data; var n = t.field; var r = this.getLabel(n); var i = this.getFormatter(n)(e[n]); var a = this.args.prev; var o = (this.args.valueField, this.shouldShowDiff(n)); var s = ['<span class="' + Y + '__value">', '' + i, o ? ' ' + this.fieldUpdownTemplate(this.getDiff({ data: e, prev: a, field: n })) : '', '</span>'].join(''); return ['<div class="' + B + '__list__item">', '  <div class="' + B + '__list__elem">' + r + '</div>', '  ' + s, '</div>'].join('\n') }, shouldShowDiff: function (t) { return t === this.args.valueField }, getDiff: function (t) { var e = t.data; var n = t.prev; var r = t.field; var i = this.getFormatter(r); var a = (e ? e[r] : 0) - (n ? n[r] : 0); return { diff: i(a), sign: Math.sign(a) } }, fieldUpdownTemplate: function (t) { var e = t.diff; var n = t.sign; var r = q + '__field__updown'; return ['<span class="' + r + ' ' + r + '_' + (n > 0 ? 'positive' : 'negative') + '">', (n > 0 ? '&#x25B2;' : n < 0 ? '&#x25BC;' : '') + (n === 0 ? '' : e), '</span>'].join('') }, shouldShowColorTable: function () { var t = this.args.groups; return this.hasColor() && t.length > 1 }, tableTemplate: function (t) { return this.shouldShowColorTable() ? ['<div class="' + q + '__table">', this.tableHeaderTemplate(t), this.tableBodyTemplate(t), '</div>'].join('\n') : '' }, tableHeaderTemplate: function (t) { var e = t.colorField; var n = t.valueField; var r = this.getLabel(e); var i = this.getLabel(n); return ['<div class="' + $ + '">', '  <span class="' + $ + '__text">' + r + '</span>', '  <span class="' + $ + '__value">' + i + '</span>', '  <span class="' + $ + '__updown">&#x25BC;&#x25B2;</span>', '</div>'].join('\n') }, tableBodyTemplate: function (t) { var e = this; var n = t.data; var r = t.groups; var i = t.valueField; var a = t.colorField; var o = n; var s = r.map(function (t) { var e = t.data; return e ? e[i] : 0 }); var u = Math.min.apply(Math, s); var l = Math.max.apply(Math, s); return ['<div class="' + q + '__body">', '<div class="' + q + '__body__content">', r.map(function (t) { var n = t.data; var r = t.prev; return e.tableRowTemplate({ data: n, prev: r, highlighted: o, valueField: i, colorField: a, min: u, max: l }) }).join('\n'), '</div>', '</div>'].join('\n') }, tableRowTemplate: function (t) { var e = t.data; var n = t.prev; var r = t.highlighted; var i = t.valueField; var a = t.colorField; var o = t.min; var s = t.max; var u = e ? e[i] : 0; var l = this.getFormatter(a)((e || n)[a]); var c = this.getFormatter(i)(u); var f = e === r; var d = this.getDiff({ data: e, prev: n, field: i }); var h = d.diff; var p = d.sign; var g = this.getColor(e || n); var m = g.color; var y = g.colorCls; return ['<div class="' + Y + (f ? ' ' + Y + '_highlighted' : '') + '">', '  ' + this.valueBarTemplate({ min: o, max: s, v: u, color: m, colorCls: y }), '  <span class="' + Y + '__text">' + l + '</span>', '  <span class="' + Y + '__value">' + c + '</span>', '  ' + this.updownTemplate({ diff: h, sign: p }), '</div>'].join('\n') }, valueBarTemplate: function (t) { var e = t.min; var n = t.max; var r = t.v; var i = t.color; var a = t.colorCls; e = Math.min(e, 0); var o = (n = Math.max(0, n)) - e; return ['<span', '    class="' + Y + '__bg' + (a ? ' ' + a : '') + '"', '    style="left: ' + 100 * (o === 0 ? 0 : (r < 0 ? r - e : -e) / o) + '%; width: ' + 100 * (o === 0 ? 0 : (r < 0 ? -r : r) / o) + '%; background-color: ' + i + ';"', '    ></span>'].join('\n') }, getColor: function (e) { var n = t.state.highlight.unit.screenModel; return { color: n.color(e), colorCls: n.class(e) } }, updownTemplate: function (t) { var e = t.diff; var n = t.sign; var r = Y + '__updown'; return ['<span class="' + r + ' ' + r + '_' + (n > 0 ? 'positive' : 'negative') + '">', (n > 0 ? '&#x25B2;' : n < 0 ? '&#x25BC;' : '') + (n === 0 ? '' : e), '</span>'].join('') }, didMount: function () { n.didMount.call(this), this._scrollToHighlighted(), this._reserveSpaceForUpdown() }, _scrollToHighlighted: function () { var e = t.getDomNode(); var n = e.querySelector('.' + q + '__body'); var r = e.querySelector('.' + q + '__body__content'); var i = e.querySelector('.' + Y + '_highlighted'); if (n && r && i) { var a = n.getBoundingClientRect(); var o = r.getBoundingClientRect(); var s = i.getBoundingClientRect(); var u = 0; if (s.bottom > a.bottom) { var l = s.bottom - a.bottom + s.height; var c = o.bottom - a.bottom; u = -Math.min(l, c), r.style.transform = 'translateY(' + u + 'px)' }o.top + u < a.top && n.classList.add(q + '__body_overflow-top'), o.bottom + u > a.bottom && n.classList.add(q + '__body_overflow-bottom') } }, _reserveSpaceForUpdown: function () { var e = t.getDomNode(); var n = e.querySelector('.' + q + '__body'); var r = e.querySelector('.' + $); if (n && r) { var i = '.' + Y + '__updown:not(:empty)'; var a = Array.from(e.querySelectorAll(i)).map(function (t) { return t.scrollWidth }); var o = Math.max.apply(Math, a); var s = Math.max(0, Math.ceil(o - 15)); n.style.paddingRight = s + 'px', r.style.paddingRight = s + 'px' } } }) }(this, this.settings)); return typeof this.settings.getTemplate === 'function' ? this.settings.getTemplate(t, this, this.settings) : t }, e.prototype._renderTemplate = function (t, e) { var n = this.state.highlight.unit; var r = n.screenModel; var i = r.model; var a = i.scaleColor; var o = (i.scaleX, i.scaleY); var s = this._unitsGroupedData.get(n); var u = this._getHighlightRange(t, n); var l = u[0]; var c = u[1]; var f = function (t) { var e = r.model.color(t); return isFinite(l) && s[l][e] ? s[l][e][0] : null }; var d = f(t); var h = n.config.stack; var p = !(!n.config.flip && n.config.guide.obsoleteVerticalStackOrder && n.config.stack); var g = (function () { var t = a.domain().slice().reduce(function (t, e, n) { return t[e] = n, t }, {}); return p ? function (e, n) { return t[e[a.dim]] - t[n[a.dim]] } : function (e, n) { return t[n[a.dim]] - t[e[a.dim]] } }()); var m = p ? function (t, e) { return o(t[o.dim]) - o(e[o.dim]) } : function (t, e) { return o(e[o.dim]) - o(t[o.dim]) }; var y = function (t) { return Object.keys(s[t]).reduce(function (e, n) { return e.concat(s[t][n]) }, []).sort(h ? g : m) }; var v = y(c).map(function (t) { r.model.color(t); return { data: t, prev: f(t) } }); if (isFinite(l)) { var b = y(l); var x = v.reduce(function (t, e) { return t[r.model.color(e.data)] = !0, t }, {}); b.forEach(function (t) { var e = r.model.color(t); x[e] || v.push({ data: null, prev: t }) }), h && v.sort(function (t, e) { return g(t.data || t.prev, e.data || e.prev) }) } return this._template.render({ data: t, prev: d, fields: e, groups: v, valueField: o.dim, colorField: a.dim }) }, e.prototype._getRenderHandler = function () { var e = t.prototype._getRenderHandler.call(this); return function () { var t = this; e.call(this); var n = this._chart; var r = n.select(function (t) { return t.config.namespace === 'chart' && t.config.type.indexOf('ELEMENT.') === 0 && t.config.type !== 'ELEMENT.INTERVAL_HIGHLIGHT' }); var i = n.select(function (t) { return t.config.type === 'ELEMENT.INTERVAL_HIGHLIGHT' }).reduce(function (t, e, n) { return t[n] = e, t }, {}); r.forEach(function (e, n) { var r = e.data(); t._unitsGroupedData.set(e, t._getGroupedData(r, e)), e.on('data-hover', function (r, a) { var o = i[n]; var s = a.unit && a.unit === e ? t._getHighlightRange(a.data, a.unit) : null; o.fire('interval-highlight', s) }) }) } }, e.prototype._getSpecReadyHandler = function () { return function (t, e) { t.traverseSpec(e, function (t, e) { if (t.type.indexOf('ELEMENT.') === 0) { var n = JSON.parse(JSON.stringify(t)); n.type = 'ELEMENT.INTERVAL_HIGHLIGHT', n.namespace = 'highlight'; var r = e.units.indexOf(t); e.units.splice(r, 0, n) } }) } }, e.prototype._getGroupedData = function (t, e) { var n = e.screenModel.model.scaleX; var i = Z.groupBy(t, function (t) { return n(t[n.dim]).toString() }); var a = e.config.guide.x.tickPeriod || e.config.guide.x.timeInterval; if (a) { var o = n.domain(); var s = e.config.guide.utcTime; r.default.api.tickPeriod.generate(o[0], o[1], a, { utc: s }).filter(function (t) { return t >= o[0] && t <= o[1] }).forEach(function (t) { var e = n(t); i[e] || (i[e] = []) }) } return Object.keys(i).reduce(function (t, n) { return t[n] = Z.groupBy(i[n], function (t) { return e.screenModel.model.color(t) }), t }, {}) }, e.prototype._getHighlightRange = function (t, e) { var n = e.screenModel.flip; var r = e.screenModel.model.scaleX; var i = r(t[r.dim]); var a = this._unitsGroupedData.get(e); var o = Object.keys(a).map(Number).sort(n ? function (t, e) { return e - t } : function (t, e) { return t - e }); var s = o.indexOf(i); return s === 0 ? [i, i] : [o[s - 1], i] }, e }(X)); function et (t) { return new tt(t) }r.default.api.unitsRegistry.reg('ELEMENT.INTERVAL_HIGHLIGHT', J, 'ELEMENT.GENERIC.CARTESIAN'), r.default.api.plugins.add('diff-tooltip', et); var nt = n(17); var rt = n.n(nt); var it = n(18); var at = n(19); var ot = n.n(at); var st = 'Taucharts Export Plug-in:'; var ut = r.default.api.utils; var lt = r.default.api.pluginsSDK; var ct = lt.tokens(); var ft = function (t, e) { return t.replace(new RegExp('^' + e + '+|' + e + '+$', 'g'), '') }; var dt = function (t) { return (t = Math.round(t)) % 2 ? t + 1 : t }; var ht = function (t) { return t === null || t === '' || void 0 === t }; var pt; var gt = { BACKSPACE: 8, COMMA: 188, DELETE: 46, DOWN: 40, END: 35, ENTER: 13, ESCAPE: 27, HOME: 36, LEFT: 37, PAGE_DOWN: 34, PAGE_UP: 33, PERIOD: 190, RIGHT: 39, SPACE: 32, TAB: 9, UP: 38 }; var mt = function (t, e) { e = e || 'all'; var n = document.createElement('style'); return n.setAttribute('media', e), n.innerHTML = t, n }; var yt = mt(ot.a, 'print'); var vt = function () { yt && yt.parentNode && yt.parentNode.removeChild(yt), pt && pt.parentNode && pt.parentNode.removeChild(pt) }; /PhantomJS/.test(navigator.userAgent) || ('onafterprint' in window ? window.addEventListener('afterprint', vt) : window.matchMedia('screen').addListener(function (t) { t.matches && vt() })); var bt = function (t, e, n) { var r = 'data:' + e + ';charset=UTF-8,%ef%bb%bf' + encodeURIComponent(n); var i = document.createElement('a'); i.setAttribute('href', r), i.setAttribute('download', t), i.setAttribute('target', '_new'), document.body.appendChild(i), i.click(), document.body.removeChild(i), i = null }; var xt = function (t) { return [].slice.call(t.querySelectorAll('text.label')).forEach(function (t) { t.innerHTML = [].slice.call(t.querySelectorAll('tspan')).reduce(function (t, e) { var n = e.value || e.text || e.textContent || ''; return t + (n = n.charAt(0).toUpperCase() + n.substr(1)) }, '') }), t }; var _t = function (t, e, n) { n = n == null ? '' : String(n); var r = (t || {})[e] || {}; return (ut.isObject(r.label) ? r.label.text : r.label) || n }; function wt (t) { return { onRender: function () { this._info = lt.extractFieldsFormatInfo(this._chart.getSpec()) }, _normalizeExportFields: function (t, e) { var n = this._info; return t.map(function (t) { var e = t; var r = n[t] || {}; return typeof t === 'string' && (e = { field: t, title: r.label || t }), typeof e.value !== 'function' && (e.value = function (t) { var e = t[this.field]; return r.isComplexField ? (e || {})[r.tickLabel] : e }), e }).filter(function (t) { return !e.find(function (e) { return t.field === e }) }) }, _handleError: function (t) { r.default.api.globalSettings.log([st, t], 'error') }, _createDataUrl: function (t, e) { var n = this; (function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; var n = t.slice(0, t.length - 1); var r = t[t.length - 1]; if (n.length === 0) return void setTimeout(function () { return r(null, []) }, 0); var i = ut.range(0, n.length).map(function () { return null }); var a = n.map(function (t, e) { var n = new XMLHttpRequest(); n.onload = function () { if (n.status >= 200 && n.status < 300) { var t = n.responseText; i[e] = t, a.splice(a.indexOf(n), 1), a.length === 0 && r(null, i) } else a.forEach(function (t) { return t.abort() }), r(new Error(n.status + ': ' + n.statusText), null) }, n.onerror = function (t) { a.forEach(function (t) { return t.abort() }), r(t.error, null) }, n.open('GET', t, !0), n.send(null) }) }).apply(void 0, this._cssPaths.concat([function (i, a) { if (i)e(i, null); else try { var o = a.join(' ').replace(/&/g, ''); var s = mt(o); var u = document.createElement('div'); t.fire('beforeExportSVGNode'); var l = t.getSVG().cloneNode(!0); t.fire('afterExportSVGNode'), u.appendChild(xt(l)), h.select(l).attr('version', 1.1).attr('xmlns', 'http://www.w3.org/2000/svg'), l.insertBefore(s, l.firstChild), n._renderAdditionalInfo(l, t), n._addBackground(l, n._backgroundColor); var c = document.createElement('canvas'); c.height = l.getAttribute('height'), c.width = l.getAttribute('width'), rt()(c, l.parentNode.innerHTML, { renderCallback: function (t) { var n = (new XMLSerializer()).serializeToString(t); n.substring(0, 5).toLowerCase() === '<html' && (r.default.api.globalSettings.log('[export plugin]: canvg error', 'error'), r.default.api.globalSettings.log(n, 'error')), e(null, c.toDataURL('image/png')) } }) } catch (i) { e(i, null) } }])) }, _findUnit: function (t) { var e = t.getSpec(); var n = t.getSpec(); var r = function (t) { var e = n.scales[t]; return e && e.dim && e.source && n.sources[e.source].dims[e.dim] }; return lt.depthFirstSearch(e.unit, function (t) { if (r(t.color)) return !0; if (r(t.size)) { var e = n.scales[t.size]; return n.sources[e.source].dims[e.dim].type === 'measure' } }) }, _toPng: function (t) { var e = this; this._createDataUrl(t, function (t, n) { if (t)e._handleError(t); else { for (var r = atob(n.substring('data:image/png;base64,'.length)), i = new Uint8Array(r.length), a = 0, o = r.length; a < o; ++a)i[a] = r.charCodeAt(a); var s = new Blob([i.buffer], { type: 'image/png' }); Object(it.saveAs)(s, (e._fileName || 'export') + '.png') } }) }, _toPrint: function (t) { var e = this; this._createDataUrl(t, function (t, n) { if (t)e._handleError(t); else { (pt = document.createElement('img')).classList.add('tau-chart__print-block'); var r = pt; document.body.appendChild(r), r.src = n, document.head.appendChild(yt), r.onload = function () { window.print() } } }) }, _toJson: function (t) { var e = this._exportFields; var n = t.getData(); var r = t.getDataDims(); var i = e.length ? e : Object.keys(r); var a = this._normalizeExportFields(i.concat(this._appendFields), this._excludeFields); var o = n.map(function (t) { return a.reduce(function (e, n) { return e[n.title] = n.value(t), e }, {}) }); var s = JSON.stringify(o, null, 2); var u = (this._fileName || 'export') + '.json'; bt(u, 'application/json', s) }, _toCsv: function (t) { var e = this._csvSeparator; var n = this._exportFields; var r = t.getData(); var i = t.getDataDims(); var a = n.length ? n : Object.keys(i); var o = this._normalizeExportFields(a.concat(this._appendFields), this._excludeFields); var s = r.reduce(function (t, n) { return t.concat(o.reduce(function (t, e) { var r = e.value(n); var i = JSON.stringify(r); if (!ut.isDate(r) && ut.isObject(r))i = '"' + i.replace(/"/g, '""') + '"'; else { var a = ft(i, '"').replace(/"/g, '""'); i = ['"', ',', ';', '\n', '\r'].find(function (t) { return a.indexOf(t) >= 0 }) ? '"' + a + '"' : a } return t.concat(i) }, []).join(e)) }, [o.map(function (t) { return t.title }).join(e)]).join('\r\n'); var u = (this._fileName || 'export') + '.csv'; bt(u, 'text/csv', s) }, _renderFillLegend: function (e, n, r, i) { var a = function (t, e) { var n = t[0]; var r = t[1]; var i = (r - n) / (e - 1); var a = ut.range(e - 2).map(function (t) { return n + i * (t + 1) }); return [n].concat(a).concat(r) }; var o = this._unit.getScale('color'); var s = _t(e.guide, 'color', o.dim).toUpperCase(); var u = 'text-transform:uppercase;font-weight:600;font-size:' + t.fontSize + 'px'; var l = o.domain().sort(function (t, e) { return t - e }); var c = o.brewer.length; var f = t.fontSize; var d = a(l, c).reverse().map(function (t, e) { return '<stop offset="' + e / (c - 1) * 100 + '%"      style="stop-color:' + o(t) + ';stop-opacity:1" />' }); var h = a(l, 3).reverse().map(function (t, e, n) { return '<text x="25" y="' + (100 * (e / 2) + 0.5 * (e === 0 ? f : e === n.length - 1 ? -f : 0) + f / 2) + '">' + t + '</text>' }); var p = ['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="120" width="100%">', '   <defs>', '       <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">', d.join(''), '       </linearGradient>', '   </defs>', '   <text x="0" y="10" style="' + u + '">' + s + '</text>', '   <g transform="translate(0,20)">', '       <rect x="0" y="0" height="100" width="20" fill="url(#grad1)">', '       </rect>', h.join(''), '   </g>', '   Sorry, your browser does not support inline SVG.', '</svg>'].join(''); var g = (new DOMParser()).parseFromString(p, 'application/xml').documentElement; return document.body.appendChild(g), n.append('g').attr('class', 'legend').attr('transform', 'translate(' + (i + 10) + ',' + t.paddingTop + ')').node().appendChild(g), { h: 120, w: 0 } }, _renderColorLegend: function (e, n, r, i) { var a = this._unit.getScale('color'); var o = _t(e.guide, 'color', a.dim).toUpperCase(); var s = this._getColorMap(r.getChartModelData({ excludeFilter: ['legend'] }), a, a.dim).values; var u = n.append('g').attr('class', 'legend').attr('transform', 'translate(' + (i + 10) + ',' + t.paddingTop + ')'); return u.append('text').text(o.toUpperCase()).style({ 'text-transform': 'uppercase', 'font-weight': '600', 'font-size': t.fontSize + 'px' }), u.selectAll('g').data(s).enter().append('g').call(function (e) { e.attr('transform', function (t, e) { return 'translate(5,' + 20 * (e + 1) + ')' }), e.append('circle').attr('r', 6).attr('fill', function (t) { return a.toColor(t.color) }).attr('class', function (t) { return a.toClass(t.color) }), e.append('text').attr('x', 12).attr('y', 5).text(function (t) { return ut.escape(ht(t.label) ? 'No ' + o : t.label) }).style({ 'font-size': t.fontSize + 'px' }) }), { h: 20 * s.length, w: 0 } }, _renderSizeLegend: function (e, n, r, i, a) { var o; var s = this._unit.getScale('size'); var u = _t(e.guide, 'size', s.dim).toUpperCase(); var l = r.getChartModelData().sort(function (t, e) { return s(t[s.dim]) - s(e[s.dim]) }); var c = l.length; var f = l[0][s.dim]; var d = l[c - 1][s.dim]; if (d - f) { var h = (function (t) { return Math.log(t) / Math.LN10 }(d - f)); var p = 4 - h < 0 ? 0 : Math.round(4 - h); var g = Math.pow(10, p); var m = (d - f) / 5; o = ut.unique([f, f + m, f + 2 * m, f + 3 * m, d].map(function (t) { return t === d || t === f ? t : Math.round(t * g) / g })) } else o = [f]; var y = o.map(function (t) { var n = s(t); var r = n / 2; return { diameter: dt(n + 2), radius: r, value: t, className: e.color ? 'color-definite' : '' } }).reverse(); var v = Math.max.apply(null, y.map(function (t) { return t.diameter })); var b = t.fontSize; var x = 0; var _ = n.append('g').attr('class', 'legend').attr('transform', 'translate(' + (i + 10) + ',' + (t.paddingTop + a.h + 20) + ')'); _.append('text').text(u.toUpperCase()).style({ 'text-transform': 'uppercase', 'font-weight': '600', 'font-size': b + 'px' }), _.selectAll('g').data(y).enter().append('g').call(function (t) { t.attr('transform', function () { var t = 'translate(5,' + (x += v) + ')'; return x += 10, t }), t.append('circle').attr('r', function (t) { return t.radius }).attr('class', function (t) { return t.className }).style({ opacity: 0.4 }), t.append('g').attr('transform', function () { return 'translate(' + v + ',' + b / 2 + ')' }).append('text').attr('x', 0).attr('y', 0).text(function (t) { return t.value }).style({ 'font-size': b + 'px' }) }) }, _renderAdditionalInfo: function (t, e) { var n = this._findUnit(e); if (n) { var r = { h: 0, w: 0 }; t = h.select(t); var i = parseInt(t.attr('width'), 10); t.attr('height'); t.attr('width', i + 160); var a = e.getScaleInfo(n.color); if (a.dim && !a.discrete) { var o = this._renderFillLegend(n, t, e, i); r.h = o.h + 20, r.w = o.w } if (a.dim && a.discrete) { var s = this._renderColorLegend(n, t, e, i); r.h = s.h + 20, r.w = s.w } var u = e.getScaleInfo(n.size); u.dim && !u.discrete && this._renderSizeLegend(n, t, e, i, r) } }, _addBackground: function (t, e) { if (e && e !== 'transparent') { var n = document.createElementNS('http://www.w3.org/2000/svg', 'rect'); n.setAttribute('fill', e), n.setAttribute('x', 0), n.setAttribute('y', 0), n.setAttribute('width', t.getAttribute('width')), n.setAttribute('height', t.getAttribute('height')), t.insertBefore(n, t.firstChild) } }, onUnitDraw: function (t, e) { r.default.api.isChartElement(e) && e.config.namespace === 'chart' && (this._unit = e) }, _getColorMap: function (t, e, n) { return ut.unique(t.map(function (t) { var r = t[n]; return { color: e(r), value: r, label: r } }), function (t) { return t.value }).reduce(function (t, e) { return t.brewer[e.value] = e.color, t.values.push(e), t }, { brewer: {}, values: [] }) }, _select: function (t, e) { var n = this['_to' + (t = t || '').charAt(0).toUpperCase() + t.slice(1)]; n && n.call(this, e) }, _handleMenu: function (t, e, n) { t.addEventListener('click', function (t) { if (t.target.tagName.toLowerCase() === 'a') { var r = t.target.getAttribute('data-value'); this._select(r, e), n.hide() } }.bind(this)), t.addEventListener('mouseover', function (t) { t.target.tagName.toLowerCase() === 'a' && t.target.focus() }), t.addEventListener('keydown', function (t) { if (t.keyCode === gt.ESCAPE && n.hide(), t.keyCode === gt.DOWN && (t.target.parentNode.nextSibling ? t.target.parentNode.nextSibling.childNodes[0].focus() : t.target.parentNode.parentNode.firstChild.childNodes[0].focus()), t.keyCode === gt.UP && (t.target.parentNode.previousSibling ? t.target.parentNode.previousSibling.childNodes[0].focus() : t.target.parentNode.parentNode.lastChild.childNodes[0].focus()), t.keyCode === gt.ENTER) { var r = t.target.getAttribute('data-value'); this._select(r, e) }t.preventDefault() }.bind(this)); var r = null; var i = function () { r = setTimeout(function () { n.hide() }, 100) }; var a = function () { clearTimeout(r) }; var o = function () { n.toggle(), n.hidden || t.querySelectorAll('a')[0].focus() }; t.addEventListener('blur', i, !0), t.addEventListener('focus', a, !0), this._container.addEventListener('click', o), this._onDestroy(function () { t.removeEventListener('blur', i, !0), t.removeEventListener('focus', a, !0), this._container.removeEventListener('click', o), clearTimeout(r) }) }, init: function (e) { t = t || {}, t = ut.defaults(t, { backgroundColor: 'white', visible: !0, fontSize: 13, paddingTop: 30 }), this._chart = e, this._info = {}, this._cssPaths = t.cssPaths, this._fileName = t.fileName, this._backgroundColor = t.backgroundColor || 'white', this._destroyListeners = [], this._csvSeparator = t.csvSeparator || ',', this._exportFields = t.exportFields || [], this._appendFields = t.appendFields || [], this._excludeFields = t.excludeFields || [], this._cssPaths || (this._cssPaths = [], r.default.api.globalSettings.log('[export plugin]: the "cssPath" parameter should be specified for correct operation', 'warn')); var n = t.visible ? '' : 'display:none'; this._container = e.insertToHeader('<a class="tau-chart__export" style="' + n + '">Export</a>'); var i = e.addBalloon({ place: 'bottom-left' }); i.content(['<ul class="tau-chart__export__list">', '<li class="tau-chart__export__item">', '   <a data-value="print" tabindex="1">' + ct.get('Print') + '</a>', '</li>', '<li class="tau-chart__export__item">', '   <a data-value="png" tabindex="2">' + ct.get('Export to png') + '</a>', '</li>', '<li class="tau-chart__export__item">', '   <a data-value="csv" tabindex="3">' + ct.get('Export to CSV') + '</a>', '</li>', '<li class="tau-chart__export__item">', '   <a data-value="json" tabindex="4">' + ct.get('Export to JSON') + '</a>', '</li>', '</ul>'].join('')), i.attach(this._container); var a = i.getElement(); a.setAttribute('tabindex', '-1'), this._handleMenu(a, e, i); var o = e.on('export-to', function (t, e) { var n = e.type; var r = e.fileName; this._fileName = r || this._fileName, this._select(n, t) }.bind(this)); var s = e.on('exportTo', function (t, e) { r.default.api.globalSettings.log([st, '`exportTo` event is deprecated, use `export-to` instead.'], 'warn'), this._select(e, t) }.bind(this)); this._onDestroy(function () { i.destroy(), e.removeHandler(o), e.removeHandler(s) }) }, _onDestroy: function (t) { this._destroyListeners.push(t) }, destroy: function () { this._destroyListeners.forEach(function (t) { t.call(this) }, this); !(function (t) { t && t.parentElement && t.parentElement.removeChild(t) }(this._container)) } } }r.default.api.plugins.add('export-to', wt); var Et = function () { return (Et = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var St = Et({}, h); var Mt = r.default.api.domUtils; var Tt = r.default.api.utils; var Ct = 16; var kt = '#E5E7EB'; var At = '#FFFFFF'; var Ot = 1; var Pt = 0; var Nt = '__transitionAttrs__'; var Lt = '__floatingAxesSrcParent__'; var Rt = '__floatingAxesSrcTransform__'; var Ft = 0; var Dt = function () { return ++Ft }; function It (t) { var e = Tt.defaults(t || {}, { detectBackground: !0, bgcolor: '#fff' }); return { init: function (t) { this.instanceId = Dt(), this.chart = t, this.rootNode = t.getLayout().contentContainer, this.beforeExportHandler = t.on('beforeExportSVGNode', function () { this.removeFloatingLayout() }, this), this.afterExportHandler = t.on('afterExportSVGNode', function () { this.createFloatingLayout() }, this) }, onBeforeRender: function () { this.removeFloatingLayout() }, onRender: function () { if (e.detectBackground) { var t = this.detectChartBackgroundColor(); t && (e.bgcolor = t) }At = e.bgcolor; var n = !0; this.chart.traverseSpec(this.chart.getSpec(), function (t) { t && t.type.indexOf('COORDS.') === 0 && (t.type !== 'COORDS.RECT' ? n = !1 : (t.guide || {}).autoLayout !== 'extract-axes' && (n = !1)) }), n && this.createFloatingLayout() }, destroy: function () { this.removeFloatingLayout(), this.chart.removeHandler(this.beforeExportHandler, this), this.chart.removeHandler(this.afterExportHandler, this) }, createFloatingLayout: function () { var t = this.instanceId; var n = this.rootNode; var i = this.chart.getSVG(); var a = St.select(i); var o = this.chart.configGPL.settings.animationSpeed; var s = this.scrollManager = new function (t) { var e = { x: [], y: [] }; var n = { x: 0, y: 0 }; var r = { x: null, y: null }; var i = t; var a = []; this.onScroll = function (t) { return a.push(t), this }, this.handleVisibilityFor = function (t, n) { return n.indexOf('x') >= 0 && e.x.push(t), n.indexOf('y') >= 0 && e.y.push(t), this }; var o = function () { var t = i.scrollLeft; var o = i.scrollTop; a.forEach(function (e) { e.call(null, t, o) }); var u = function (i) { var a = i === 'x' ? t : o; a !== n[i] && (clearTimeout(r[i]), s(e[i], function (t) { t.transition('floatingAxes_scrollVisibility'), t.attr('opacity', 1e-6) }), r[i] = setTimeout(function () { s(e[i], function (t) { r[i] = null, t.transition('floatingAxes_scrollVisibility').duration(256).attr('opacity', 1) }) }, 128)), n[i] = a }; u('x'), u('y') }; function s (t, e, n) { t.forEach(function (t) { e.call(n, t) }) }i.addEventListener('scroll', o), this.fireScroll = function () { o.call(null, i.scrollLeft, i.scrollTop) }, this.destroy = function () { i.removeEventListener('scroll', o) } }(n); var u = (function () { var t = function (t) { var e = '> .' + t + '.axis.tau-active'; return ['.frame-root.tau-active ' + e, '.frame-root.tau-active .cell.tau-active ' + e].join(', ') }; return { x: Array.from(i.querySelectorAll(t('x'))), y: Array.from(i.querySelectorAll(t('y'))) } }()); var l = (function () { function t (t) { return { axis: t, parentTransform: (function (t) { var e; var n = { translate0: { x: 0, y: 0 }, translate: { x: 0, y: 0 } }; var r = t; for (;r && r.nodeName.toUpperCase() !== 'SVG';)e = Bt(r), n.translate0.x += e.translate0.x, n.translate0.y += e.translate0.y, n.translate.x += e.translate.x, n.translate.y += e.translate.y, r = r.parentNode; return n }(t.parentNode)), axisTransform: Bt(t) } } return { x: u.x.map(t), y: u.y.map(t) } }()); var c = (function (t) { return Math.max.apply(null, t) }(l.y.map(function (t) { return t.axisTransform.translate.x + t.parentTransform.translate.x }))) + 1; var f = (function (t) { return Math.min.apply(null, t) }(l.x.map(function (t) { return t.axisTransform.translate.y + t.parentTransform.translate.y }))) - 1; var d = r.default.api.globalSettings.getScrollbarSize(n); var p = { scrollLeft: n.scrollLeft, scrollTop: n.scrollTop, visibleWidth: n.clientWidth, visibleHeight: n.clientHeight, scrollbarWidth: d.width, scrollbarHeight: d.height, svgWidth: Number(a.attr('width')), svgHeight: Number(a.attr('height')), minXAxesY: f, maxYAxesX: c }; var g = (function () { var e = a.append('defs').attr('class', 'floating-axes floating-axes__defs'); var n = { ns: { x1: 0, y1: 0, x2: 0, y2: 1 }, ew: { x1: 1, y1: 0, x2: 0, y2: 0 }, sn: { x1: 0, y1: 1, x2: 0, y2: 0 }, we: { x1: 0, y1: 0, x2: 1, y2: 0 } }; return Object.keys(n).forEach(function (r) { var i = n[r]; var a = e.append('linearGradient').attr('id', 'shadow-gradient-' + r + '-' + t).attr('x1', i.x1).attr('y1', i.y1).attr('x2', i.x2).attr('y2', i.y2); a.append('stop').attr('class', 'floating-axes__shadow-start').attr('offset', '0%').attr('stop-color', kt).attr('stop-opacity', Ot), a.append('stop').attr('class', 'floating-axes__shadow-end').attr('offset', '100%').attr('stop-color', At).attr('stop-opacity', Pt) }), e }()); function m (t, e) { e.forEach(function (e) { e.axis[Lt] = e.axis.parentNode; var n = t.append('g'); o ? n.attr('transform', jt(e.parentTransform.translate0.x, e.parentTransform.translate0.y)).transition().duration(o).attr('transform', jt(e.parentTransform.translate.x, e.parentTransform.translate.y)) : n.attr('transform', jt(e.parentTransform.translate.x, e.parentTransform.translate.y)), n.node().appendChild(e.axis), Array.prototype.forEach.call(e.axis.querySelectorAll('.label'), function (t) { t[Rt] = t.getAttribute('transform') }) }) } var y = (function () { var t = p.svgHeight - p.minXAxesY + 1 + p.scrollbarHeight; var e = a.append('g').attr('class', 'floating-axes floating-axes__x').call(x, p.svgWidth, t, 0, p.minXAxesY); m(e, l.x); var n = e.selectAll('.label'); return s.handleVisibilityFor(e, 'y').handleVisibilityFor(n, 'x').onScroll(function (t, r) { var i = Math.min(p.visibleHeight + r - p.svgHeight - p.scrollbarHeight, 0); e.attr('transform', jt(0, i)), n.each(function () { var e = zt(this[Rt]); var n = -p.svgWidth + p.visibleWidth + t - 10; this.setAttribute('transform', 'translate(' + (e.x + n) + ',' + e.y + ') rotate(' + e.r + ')') }) }), e }()); var v = (function () { var t = a.append('g').attr('class', 'floating-axes floating-axes__y').call(x, p.maxYAxesX, p.svgHeight); m(t, l.y); var e = t.selectAll('.label'); return s.handleVisibilityFor(t, 'x').handleVisibilityFor(e, 'y').onScroll(function (n, r) { var i = Math.max(n, 0); t.attr('transform', jt(i, 0)), e.each(function () { var t = zt(this[Rt]); var e = r + 10; this.setAttribute('transform', 'translate(' + t.x + ',' + (t.y + e) + ') rotate(' + t.r + ')') }) }), t }()); var b = (function () { var t = p.svgHeight - p.minXAxesY + p.scrollbarHeight; var e = a.append('g').attr('class', 'floating-axes floating-axes__corner').call(x, p.maxYAxesX, t); return s.handleVisibilityFor(e, 'xy').onScroll(function (n, r) { var i = Math.max(n, 0); var a = p.minXAxesY; var o = Math.min(r + p.visibleHeight - t, a); e.attr('transform', jt(i, o)) }), e }()); function x (t, n, r, i, a) { i = i || 0, a = a || 0, t.append('rect').attr('class', 'i-role-bg').attr('x', i - 1).attr('y', a - 1).attr('width', Math.max(0, n + 2)).attr('height', Math.max(0, r + 2)).attr('fill', e.bgcolor) } var _ = (function () { var e = p.maxYAxesX; var n = p.svgHeight - p.minXAxesY + p.scrollbarHeight; var r = a.append('g').attr('class', 'floating-axes floating-axes__shadows').attr('pointer-events', 'none'); var i = function (e, n, i, a, o) { return r.append('rect').attr('fill', 'url(#shadow-gradient-' + e + '-' + t + ')').attr('x', n).attr('y', i).attr('width', Math.max(0, a)).attr('height', Math.max(0, o)) }; var o = i('ns', 0, 0, e, Ct); var u = i('ew', p.visibleWidth - Ct, p.visibleHeight - n, Ct, n); var l = i('sn', 0, p.visibleHeight - n - Ct, e, Ct); var c = i('we', e, p.visibleHeight - n, Ct, n); s.handleVisibilityFor(o, 'xy').handleVisibilityFor(u, 'xy').handleVisibilityFor(l, 'xy').handleVisibilityFor(c, 'xy').onScroll(function (t, e) { var n = t; var i = e; r.attr('transform', jt(n, i)); var a = function (t, e) { t.style('visibility', e ? '' : 'hidden') }; a(o, e > 0 && p.svgHeight > p.visibleHeight), a(u, t + p.visibleWidth < p.svgWidth && p.svgWidth > p.visibleWidth), a(l, e + p.visibleHeight < p.svgHeight && p.svgHeight > p.visibleHeight), a(c, t > 0 && p.svgWidth > p.visibleWidth) }) }()); var w = y.node(); var E = v.node(); var S = b.node(); s.onScroll(function (t) { i.insertBefore(w, t === 0 ? S.nextElementSibling : E) }), s.fireScroll(), this.floatingLayout = { defs: g, xAxes: y, yAxes: v, shadows: _ }, a.selectAll('.floating-axes').on('mouseenter', function () { Mt.dispatchMouseEvent(i, 'mouseleave') }).on('mousemove', function () { h.event.stopPropagation() }).on('click', function () { h.event.stopPropagation() }) }, removeFloatingLayout: function () { function t (t) { t.selectAll('.axis').each(function () { this[Lt].appendChild(this), delete this[Lt], Array.prototype.forEach.call(this.querySelectorAll('.label'), function (t) { t.setAttribute('transform', t[Rt]), delete t[Rt] }) }) } this.floatingLayout && (this.floatingLayout.xAxes.call(t), this.floatingLayout.yAxes.call(t), this.scrollManager.destroy(), this.floatingLayout = null), St.select(this.chart.getSVG()).selectAll('.floating-axes').remove() }, detectChartBackgroundColor: function () { var t; var e = this.chart.getLayout().layout; do { if ((t = window.getComputedStyle(e)).backgroundImage !== 'none') return null; if (t.backgroundColor !== 'transparent' && t.backgroundColor !== 'rgba(0, 0, 0, 0)') return t.backgroundColor } while (e = e.parentElement);return null } } } function jt (t, e) { return 'translate(' + t + ',' + e + ')' } function zt (t) { var e = { x: 0, y: 0, r: 0 }; if (!t) return e; var n = t.indexOf('translate('); if (n >= 0) { var r = t.indexOf(')', n + 10); var i = t.substring(n + 10, r).trim().replace(',', ' ').replace(/\s+/, ' ').split(' '); e.x = parseFloat(i[0]), i.length > 1 && (e.y = parseFloat(i[1])) } var a = t.indexOf('rotate('); if (a >= 0) { var o = t.indexOf(')', a + 7); var s = t.substring(a + 7, o); e.r = parseFloat(s.trim()) } return e } function Bt (t) { var e = t[Nt] && t[Nt].transform; var n = zt(t.getAttribute('transform')); return { translate0: n, translate: e ? zt(t[Nt].transform) : n } }r.default.api.plugins.add('floating-axes', It); var Vt = r.default.api.utils; function Ht (t) { Vt.defaults(t || {}, {}); var e = function (t, e, n, r) { t.addEventListener(e, function (t) { for (var e = t.target; e !== t.currentTarget && e !== null;)e.classList.contains(n) && r(t, e), e = e.parentNode }) }; return { init: function (t) { this._chart = t, this._currentFilters = {}, this._legendColorByScaleId = {}; var n = this._chart.getSpec(); var r = function (t) { return function (e, r) { var i = n.scales[r]; return i.type === t && i.dim && e.push(r), e } }; this._color = Object.keys(n.scales).reduce(r('color'), []), this._fill = Object.keys(n.scales).reduce(r('fill'), []); var i = this._color.length > 0; var a = this._fill.length > 0; (i || a) && (this._container = this._chart.insertToRightSidebar(this._containerTemplate), i && (e(this._container, 'click', 'tau-chart__legend__item-color', function (t, e) { this._toggleLegendItem(e) }.bind(this)), e(this._container, 'mouseover', 'tau-chart__legend__item-color', function (t, e) { this._highlightToggle(e, !0) }.bind(this)), e(this._container, 'mouseout', 'tau-chart__legend__item-color', function (t, e) { this._highlightToggle(e, !1) }.bind(this)))) }, onSpecReady: function () { this._assignStaticBrewersOrEx() }, onRender: function () { this._clearPanel(), this._drawColorLegend(), this._drawFillLegend() }, _containerTemplate: '<div class="tau-chart__legend"></div>', _template: Vt.template('<div class="tau-chart__legend"><div class="tau-chart__legend__title"><%=name%></div><%=items%></div>'), _itemTemplate: Vt.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">", '<div class="tau-chart__legend__guide__wrap">', '<div class="tau-chart__legend__guide <%=color%>"></div>', '</div>', '<%=label%>', '</div>'].join('')), _itemFillTemplate: Vt.template(['<div data-value=\'<%=value%>\' class="tau-chart__legend__item tau-chart__legend__item-color" style="padding: 6px 0px 10px 40px;margin-left:10px;">', '<div class="tau-chart__legend__guide__wrap" style="top:0;left:0;">', '   <span class="tau-chart__legend__guide" style="background-color:<%=color%>;border-radius:0"></span>', '   <span style="padding-left: 20px"><%=label%></span>', '</div>', '</div>'].join('')), _clearPanel: function () { this._container && (this._container.innerHTML = '') }, _drawColorLegend: function () { var t = this; t._color.forEach(function (e) { var n = t._chart.select(function (t) { return t.config.color === e })[0]; if (n) { var r = n.getScale('color'); var i = t._chart.getDataSources({ excludeFilter: ['legend'] }); var a = Vt.unique(i[r.source].data.map(function (t) { return t[r.dim] })).map(function (n) { var i = Vt.escape(n); var a = r.dim + i; return { scaleId: e, dim: r.dim, color: r(n), disabled: t._currentFilters.hasOwnProperty(a), label: n, value: i } }); t._legendColorByScaleId[e] = a, t._container.insertAdjacentHTML('beforeend', t._template({ items: a.map(function (e) { return t._itemTemplate({ scaleId: e.scaleId, dim: e.dim, color: e.color, classDisabled: e.disabled ? 'disabled' : '', label: e.label, value: e.value }) }).join(''), name: (((n.guide || {}).color || {}).label || {}).text || r.dim })) } }) }, _drawFillLegend: function () { var t = this; t._fill.forEach(function (e) { var n = t._chart.select(function (t) { return t.config.type === 'COORDS.MAP' && t.config.fill === e }); if (n.length > 0) { var r = n[0].getScale('fill'); var i = r.brewer; var a = r.domain(); var o = (a[1] - a[0]) / i.length; var s = Vt.range(i.length).map(function (e) { var n = a[0] + e * o; var s = ''; return e === 0 && (s = a[0]), e === i.length - 1 && (s = a[1]), t._itemFillTemplate({ color: r(n), label: s, value: Vt.escape(n) }) }); t._container.insertAdjacentHTML('beforeend', t._template({ items: s.join(''), name: (((n[0].guide || {}).fill || {}).label || {}).text || r.dim })) } }) }, _toggleLegendItem: function (t) { var e = t.getAttribute('data-scale-id'); var n = t.getAttribute('data-dim'); var r = t.getAttribute('data-value'); var i = n + r; var a = this._legendColorByScaleId[e].filter(function (t) { return !t.disabled }); if (a.length !== 1 || e !== a[0].scaleId || r !== a[0].value) { var o = this._currentFilters; if (o.hasOwnProperty(i)) { var s = o[i]; delete o[i], t.classList.remove('disabled'), this._chart.removeFilter(s) } else t.classList.add('disabled'), o[i] = this._chart.addFilter({ tag: 'legend', predicate: function (t) { return t[n] != r } }); this._chart.refresh() } }, _highlightToggle: function (t, e) { var n = t.getAttribute('data-scale-id'); var r = t.getAttribute('data-dim'); var i = t.getAttribute('data-value'); this._chart.select(function (t) { return t.config.color === n }).forEach(function (t) { t.fire('highlight', function (t) { return !e || t[r] == i }) }) }, _generateColorMap: function (t) { var e = Vt.range(20).map(function (t) { return 'color20-' + (1 + t) }); return t.reduce(function (t, n, r) { return t[n] = e[r % 20], t }, {}) }, _assignStaticBrewersOrEx: function () { var t = this; t._color.forEach(function (e) { var n = t._chart.getSpec().scales[e]; var r = t._chart.getDataSources({ excludeFilter: ['legend'] }); var i = t._chart.getScaleFactory(r).createScaleInfoByName(e).domain(); n.brewer || (n.brewer = n.dimType !== 'measure' ? t._generateColorMap(i) : ['#e5f5e0', '#a1d99b', '#31a354']) }) } } }r.default.api.plugins.add('geomap-legend', Ht); var Wt = r.default.api.utils; function Gt (t) { Wt.defaults(t || {}, {}); var e = function () { return !1 }; return { init: function (t) { this._currNode = null, this._currData = null, this._chart = t, this._tooltip = t.addBalloon({ spacing: 3, auto: !0, effectClass: 'fade' }), this._tooltip.content(this.template), this._tooltip.getElement().addEventListener('click', function (t) { for (var e = t.target; e !== t.currentTarget && e !== null;)e.classList.contains('i-role-exclude') && (n._exclude(), n._tooltip.hide(), n._blurSelection()), e = e.parentNode }, !1); var e; var n = this; this._showTooltip = function (t) { clearTimeout(e), n._currData = t.data; var r = 'No data'; t.data !== null && (r = Object.keys(t.data).map(function (e) { return n.itemTemplate({ label: e, value: t.data[e] }) }).join('')); var i = n._tooltip.getElement().querySelectorAll('.i-role-content'); i[0] && (i[0].innerHTML = r); var a = n._tooltip.getElement().querySelectorAll('.i-role-exclude'); if (a[0]) { var o = t.data && n._chart.getChartModelData().length > 1; a[0].style.visibility = o ? 'visible' : 'hidden' }n._tooltip.show(t.event.pageX, t.event.pageY).updateSize() }, this._hideTooltip = function (t) { e = setTimeout(function () { n._tooltip.hide() }, t ? 0 : 1e3) }, this._tooltip.getElement().addEventListener('mouseover', function (t) { clearTimeout(e) }, !1), this._tooltip.getElement().addEventListener('mouseleave', function (t) { n._hideTooltip(!0), n._blurSelection() }, !1) }, onRender: function () { var t = this; this._chart.select(function (t) { return t.config.type === 'COORDS.MAP' }).forEach(function (e) { t._subscribeToPoints(e), t._subscribeToArea(e) }) }, template: ['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">', '<div class="tau-chart__tooltip__button i-role-exclude">', '<div class="tau-chart__tooltip__button__wrap">', '<span class="tau-icon-close-gray"></span>', 'Exclude', '</div>', '</div>', '</div>', '<div class="i-role-content tau-chart__tooltip__content"></div>'].join(''), itemTemplate: Wt.template(['<div class="tau-chart__tooltip__list__item">', '<div class="tau-chart__tooltip__list__elem"><%=label%></div>', '<div class="tau-chart__tooltip__list__elem"><%=value%></div>', '</div>'].join('')), _exclude: function () { this._chart.addFilter({ tag: 'exclude', predicate: (function (t) { return function (e) { return JSON.stringify(e) !== JSON.stringify(t) } }(this._currData)) }), this._chart.refresh() }, _blurSelection: function () { this._chart.select(function (t) { return t.config.type === 'COORDS.MAP' }).forEach(function (t) { t.fire('highlight-area', e) }), this._currNode = null, this._currData = null }, _subscribeToPoints: function (t) { var e = this; t.on('point-mouseover', function (t, n) { e._showTooltip(n) }), t.on('point-mouseout', function (t, n) { e._hideTooltip() }) }, _subscribeToArea: function (t) { var e = this; !t.getScale('code').dim || t.on('area-click', function (n, r) { e._currNode = n, r.data ? e._currData === r.data ? (e._hideTooltip(!0), e._blurSelection()) : (t.fire('highlight-area', (function (t) { var e = JSON.stringify(t); return function (t) { return JSON.stringify(t) === e } }(r.data))), e._showTooltip(r)) : (e._showTooltip(r), e._hideTooltip(!1), e._blurSelection()) }) } } }r.default.api.plugins.add('geomap-tooltip', Gt); var Ut = n(2); var Xt = r.default.api.utils; var qt = r.default.api.pluginsSDK; var Yt = qt.tokens(); function $t (t) { var e = Xt.defaults(t || {}, { title: 'Layers', label: 'Layer Type', showPanel: !0, showLayers: !0, mode: 'merge', axisWidth: 45, layers: [] }); e.layers.forEach(function (t) { t.guide = Xt.defaults(t.guide || {}, { scaleOrient: 'left', textAnchor: 'end', hide: !1 }) }); var n = function (t) { return function (e) { return Object.assign(e, t) } }; var r = { line: n({ type: 'ELEMENT.LINE' }), area: n({ type: 'ELEMENT.AREA' }), dots: n({ type: 'ELEMENT.POINT' }), scatterplot: n({ type: 'ELEMENT.POINT' }), bar: n({ type: 'ELEMENT.INTERVAL' }), 'stacked-bar': n({ type: 'ELEMENT.INTERVAL', stack: !0 }) }; return { init: function (t) { this._chart = t; var n = qt.spec(this._chart.getSpec()); var r = this.checkIfApplicable(n); if (this._isApplicable = r.length === 0, n.addTransformation('defined-only', function (t, e) { var n = e.key; return t.filter(function (t) { return t[n] !== null && void 0 !== t[n] }) }), this._isApplicable) { this.isFacet = this.checkIsFacet(n), this.primaryY = this.findPrimaryLayer(n); var i = this.getLayersText(); var a = this.getLayersGroup(); var o = e.label; this.fieldColorScale = o, n.setSettings('excludeNull', !1).setSettings('fitModel', null).addScale(o, { type: 'color', source: '/', dim: o, brewer: e.brewer }).addTransformation('slice-layer', function (t, e) { var n = e.key; var r = e.group; return r ? t.filter(function (t) { var e = t[r]; var n = t[e]; return e && n !== null && void 0 !== n }) : t.filter(function (t) { return t[o] === i[n] && t[n] !== null && void 0 !== t[n] }) }); var s = [this.primaryY].concat(e.layers).reduce(function (t, e) { return t.concat(e.y) }, []); t.setupChartSourceModel(function (t) { var e = {}; e[o] = { type: 'category' }; var n = { '/': { dims: e, data: [] } }; return n['/'].dims = Object.assign(e, t['/'].dims), n['/'].data = t['/'].data.reduce(function (t, e) { return t.concat(s.map(function (t) { var n = {}; n[o] = i[t]; var r = a[t]; return r && (n[r] = e[t], n.subLayer = r), Object.assign(n, e) })) }, []), Object.assign(n, Xt.omit(t, '/')) }), e.showPanel && (this._container = t.insertToRightSidebar(this.containerTemplate), this._container.classList.add('applicable-true'), this.uiChangeEventsDispatcher = function (t) { var n = t.target; var r = n.classList; r.contains('i-role-show-layers') && (e.showLayers = n.checked), r.contains('i-role-change-mode') && (e.mode = n.value), this._chart.refresh() }.bind(this), this._container.addEventListener('change', this.uiChangeEventsDispatcher, !1)) } else { n.getSettings('log')('[layers plugin]: is not applicable. ' + r.join(' / ')) } }, getLayersText: function () { return [this.primaryY].concat(e.layers).reduce(function (t, e) { return (Array.isArray(e.y) ? e.y : [e.y]).reduce(function (t, n) { return t[n] = this.extractLabelForKey(e, n), t }.bind(this), t) }.bind(this), {}) }, getLayersGroup: function () { return [this.primaryY].concat(e.layers).reduce(function (t, e) { var n = null; return Array.isArray(e.y) && (n = e.y.join(', ')), Xt.flatten([e.y]).reduce(function (t, e) { return t[e] = n, t }, t) }, {}) }, checkIsFacet: function (t) { return t.unit().reduce(function (t, e, n) { return t || (n && n.type === 'COORDS.RECT' && e.type === 'COORDS.RECT' ? t = !0 : t) }, !1) }, checkIfApplicable: function (t) { return t.unit().reduce(function (e, n, r) { if (r && r.type !== 'COORDS.RECT') return e.concat('Chart specification contains non-rectangular coordinates'); if (r && r.type === 'COORDS.RECT' && n.type !== 'COORDS.RECT') { var i = t.getScale(n.y); if (t.getSourceDim(i.source, i.dim).type !== 'measure') return e.concat('Y scale is not a measure') } return e }, []) }, isLeafElement: function (t, e) { return e && e.type === 'COORDS.RECT' && t.type !== 'COORDS.RECT' }, isFirstCoordNode: function (t, e) { return !e && t && t.type === 'COORDS.RECT' }, isFinalCoordNode: function (t, e) { return t && t.type === 'COORDS.RECT' && t.units.every(function (t) { return t.type !== 'COORDS.RECT' }) }, buildLayersLayout: function (t) { return t.regSource('$', { dims: { x: { type: 'category' }, y: { type: 'category' } }, data: [{ x: 1, y: 1 }] }).addScale('xLayoutScale', { type: 'ordinal', source: '$', dim: 'x' }).addScale('yLayoutScale', { type: 'ordinal', source: '$', dim: 'y' }).unit({ type: 'COORDS.RECT', x: 'xLayoutScale', y: 'yLayoutScale', expression: { source: '$', inherit: !1, operator: !1 }, guide: { showGridLines: '', x: { cssClass: 'facet-axis' }, y: { cssClass: 'facet-axis' } } }) }, findPrimaryLayer: function (t) { var e = this; var n = t.unit().reduce(function (n, r) { return n.concat(e.isFinalCoordNode(r) ? { y: t.getScale(r.y).dim, isPrimary: !0, guide: r.guide.y, scaleName: r.y } : []) }, []); return qt.cloneObject(n[0]) }, createPrimaryUnitReducer: function (t, n, r, i) { var a = this; return function (o, s, u) { var l = function (t) { return !0 !== t.guide.hide }; if (a.isFacet && a.isFirstCoordNode(s, u)) { s.guide.y.label = s.guide.y.label || {}; var c = s.guide.y.label._original_text || s.guide.y.label.text; s.guide.y.label.text = [c, n.filter(l).map(a.extractLayerLabel.bind(a)).join(', ')].join(t.getSettings('facetLabelDelimiter')), e.mode === 'dock' && (s.guide.y.label.padding -= 15, s.guide.y.padding += 15, s.guide.y.rotate = -90, s.guide.y.textAnchor = 'middle') } return a.isLeafElement(s, u) && (u.units = u.units.filter(function (t) { return t !== s })), a.isFinalCoordNode(s) && (s.guide.y.label = s.guide.y.label || {}, e.mode === 'dock' && (s.guide.padding.l = r, s.guide.padding.r = i, s.guide.y.hide = !0), e.mode === 'merge' && (s.guide.y.label.text = a.isFacet ? '' : n.filter(l).map(a.extractLayerLabel.bind(a)).join(', '))), o } }, createSecondaryUnitReducer: function (t, n, i, a, o, s, u, l) { var c = this; var f = c.getScaleName(n.scaleName || n.y); var d = n.guide.scaleOrient; var h = Array.isArray(n.y); var p = n.isPrimary; return function (g, m, y) { if (c.isFacet && c.isFirstCoordNode(m, y) && (m.guide.y.label.text = '', m.guide.x.hide = !0, m.guide.y.hide = !0), c.isLeafElement(m, y)) { (n.type ? r[n.type] : function (t) { return t })(m), m.y = f; var v = t.getScale(m.size).dim; if (p && v);else { var b = 'size_null' + l; t.addScale(b, { type: 'size', source: '?', mid: 1 }), m.size = b } var x = t.getScale(m.color).dim; p && x || (m.color = c.fieldColorScale, m.expression.operator = 'groupBy', m.expression.params = h ? ['subLayer'] : [c.fieldColorScale]); var _ = h ? { group: 'subLayer' } : { key: n.y }; qt.unit(m).addTransformation('slice-layer', _) } if (c.isFinalCoordNode(m)) { if (m.y = f, m.guide.y = Object.assign(m.guide.y, n.guide || {}), m.guide.y.label = m.guide.y.label || {}, m.guide.y.label.text = c.extractLayerLabel(n), m.guide.x.hide = !0, e.mode === 'dock') { m.guide.showGridLines = '', m.guide.padding.l = i, m.guide.padding.r = a, m.guide.y.label.textAnchor = 'end', m.guide.y.label.dock = 'right', m.guide.y.label.padding = d === 'right' ? 1 : -10, m.guide.y.label.cssClass = 'label inline'; var w = d === 'right' ? u : s; m.guide.y.padding += o * w }e.mode === 'merge' && (m.guide.showGridLines = '', m.guide.y.hide = !0) } return g } }, getScaleName: function (t) { return Array.isArray(t) ? t.join(', ') : t }, extractLabelForKey: function (t, e) { var n = t.guide || {}; n.label = typeof n.label === 'string' ? { text: n.label } : n.label; var r = n.label || {}; var i = r.byKeys || {}; return Array.isArray(t.y) ? i[e] || e : r.text || r._original_text || t.y }, extractLayerLabel: function (t) { var e = this; return (Array.isArray(t.y) ? t.y : [t.y]).map(function (n) { return e.extractLabelForKey(t, n) }).join(', ') }, onSpecReady: function (t, n) { var r = this; var i = qt.spec(n); if (e.showLayers && r._isApplicable) { i = e.layers.reduce(function (t, e) { var n = r.getScaleName(e.y); return t.addScale(n, Object.assign({ type: 'linear', source: '/', dim: n, autoScale: !0 }, Xt.pick(e.guide || {}, 'min', 'max', 'autoScale', 'nice', 'niceInterval'))) }, i); var a; var o = [this.primaryY].concat(e.layers).sort(function (t, e) { return (t.guide.zIndex || 0) - (e.guide.zIndex || 0) }); var s = i.unit(); var u = e.axisWidth; var l = function (t) { return function (e) { var n = e.guide.scaleOrient || 'left'; return !0 !== e.guide.hide && n === t } }; var c = l('left'); var f = l('right'); var d = o.filter(c).length * u; var h = o.filter(f).length * u; var p = r.buildLayersLayout(i).addFrame({ key: { x: 1, y: 1 }, units: [(a = qt.unit(s.clone())).reduce(r.createPrimaryUnitReducer(i, o, d, h), a).value()] }); var g = -1; var m = -1; o.reduce(function (t, e, n) { return g = c(e) ? g + 1 : g, m = f(e) ? m + 1 : m, t.addFrame({ key: { x: 1, y: 1 }, units: [(a = qt.unit(s.clone())).reduce(r.createSecondaryUnitReducer(i, e, d, h, u, g, m, n), a).value()] }) }, p) } else i.unit().traverse(function (t, e) { r.isLeafElement(t, e) && qt.unit(t).addTransformation('defined-only', { key: i.getScale(t.y).dim }) }) }, onUnitsStructureExpanded: function () { var t = this; if (t._isApplicable && e.mode === 'merge') { var n = qt.spec(t._chart.getSpec()); var r = t.primaryY.scaleName; var i = e.layers.map(function (e) { return t.getScaleName(e.y) }).filter(function (t) { return n.getScale(t) }).concat(r); var a = i.reduce(function (e, n) { var r = t._chart.getScaleInfo(n); return e[n] = r.domain().filter(function (t) { return Number.isFinite(t) }), e }, {}); var o = Ut.extent(Xt.flatten(Object.keys(a).map(function (t) { return a[t] }))); i.forEach(function (t) { var e = n.getScale(t); e.min = o[0], e.max = o[1], e.nice = !1 }) } }, containerTemplate: '<div class="tau-chart__trendlinepanel"></div>', template: Xt.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">', '   <input type="checkbox"', '          class="tau-chart__checkbox__input i-role-show-layers"', '          <%= (showLayers ? "checked" : "") %>', '   />', '   <span class="tau-chart__checkbox__icon"></span>', '   <span class="tau-chart__checkbox__text"><%= title %></span>', '</label>', '<div>', '<select class="i-role-change-mode tau-chart__select tau-chart__trendlinepanel__control">', '   <option <%= ((mode === "dock")  ? "selected" : "") %> value="dock">' + Yt.get('Dock') + '</option>', '   <option <%= ((mode === "merge") ? "selected" : "") %> value="merge">' + Yt.get('Merge') + '</option>', '</select>', '</div>'].join('')), onRender: function () { this._isApplicable && e.showPanel && (this._container.innerHTML = this.template({ title: e.title, mode: e.mode, showLayers: e.showLayers })) } } }r.default.api.plugins.add('layers', $t); var Kt = n(6); var Jt = r.default.api.utils; var Qt = r.default.api.pluginsSDK; var Zt = '.tau-chart__legend__reset'; var te = '.tau-chart__legend__item-color'; var ee = '.tau-chart__legend__guide--color__overlay'; var ne = 4; var re = 13; var ie = 0; var ae = function () { return ++ie }; var oe = r.default.api.utils.xml; var se = function (t, e) { var n = t[0]; var r = t[1]; var i = (r - n) / (e - 1); var a = Jt.range(e - 2).map(function (t) { return n + i * (t + 1) }); return [n].concat(a).concat(r) }; var ue = function (t, e, n) { if (t.length < 3) return t.slice(0); if (e < 3) return [t[0], t[t.length - 1]]; var r; var i = t[0] < 0 ? Math.abs(t[0]) : 0; var a = function (t) { return t }; var o = n === 'sqrt' ? function (t) { return Math.sqrt(t + i) } : a; var s = n === 'sqrt' ? function (t) { return Math.pow(t, 2) - i } : a; var u = [(t = t.map(o))[0]]; var l = t[t.length - 1] - t[0]; var c = 0.5 * l / (e - 1); var f = Jt.range(1, e - 1).map(function (t) { var n = l * t / (e - 1); return { min: n - c, mid: n, max: n + c, diff: Number.MAX_VALUE, closest: null } }); var d = 0; var h = function () { if (d !== f.length) { var t = r; (r = f[d++]).min = Math.max(r.min, (t && t.closest !== null ? t.closest : u[0]) + c) } }; return h(), t.forEach(function (t) { if (!(t < r.min)) { t > r.max && h(); var e = Math.abs(t - r.mid); e < r.diff && e < c ? (r.diff = e, r.closest = t) : h(), e === 0 && h() } }), f.forEach(function (t) { t.closest !== null && u.push(t.closest) }), u.push(t[t.length - 1]), u = u.map(s) }; var le = function (t) { return Math.log(t) / Math.LN10 }; var ce = function (t) { return t === 0 ? 0 : Math.floor(le(Math.abs(t))) }; var fe = (function () { var t = /\.0+([^\d].*)?$/; var e = /(\.\d+?)0+([^\d].*)?$/; return function (n) { return n.replace(t, '$1').replace(e, '$1$2') } }()); var de = Kt.format('.3s'); var he = function (t) { return fe(de(t)) }; var pe = function (t, e) { var n = Math.max(Math.abs(t), Math.abs(e)); var r = ce(n); var i = t * e > 0 ? Math.abs(e - t) : n; var a = ce(i); var o = Math.abs(r - a); return Math.abs(r) > 3 && o <= 3 ? he : function (t) { var e = ce(n - t); var r = Math.min((a < 0 ? Math.abs(a) : 0) + (e < a ? 1 : 0), 20); return fe(t.toFixed(r)) } }; function ge (t) { var e = !0; var n = Jt.defaults(t || {}, { formatters: {}, onSelect: function () {} }); var r = function (t) { return t === null || t === '' || void 0 === t }; var i = function (t) { return t.every(function (t) { return Jt.isDate(t) }) }; var a = function (t, e) { return function (n) { var i = n[t]; var a = JSON.stringify(r(i) ? null : i); return e === a } }; var o = function (t, e, n, r) { t.addEventListener(e, function (t) { for (var e = t.target; e !== t.currentTarget && e !== null;)e.matches(n) && r(t, e), e = e.parentNode }) }; return { init: function (t) { var e = this; this.instanceId = ae(), this._chart = t, this._currentFilters = {}, this._legendColorByScaleId = {}, this._legendOrderState = {}; var r = this._chart.getSpec(); var i = function (t) { return function (e, n) { var i = r.scales[n]; return i.type === t && i.dim && e.push(n), e } }; this._color = Object.keys(r.scales).reduce(i('color'), []).filter(function (e) { return t.getScaleInfo(e).discrete }), this._fill = Object.keys(r.scales).reduce(i('color'), []).filter(function (e) { return !t.getScaleInfo(e).discrete }), this._size = Object.keys(r.scales).reduce(i('size'), []); var a = this._color.length > 0; var s = this._fill.length > 0; var u = this._size.length > 0; if (this._assignStaticBrewersOrEx(), a || s || u) { switch (n.position) { case 'left':this._container = this._chart.insertToLeftSidebar(this._containerTemplate); break; case 'right':this._container = this._chart.insertToRightSidebar(this._containerTemplate); break; case 'top':this._container = this._chart.insertToHeader(this._containerTemplate); break; case 'bottom':this._container = this._chart.insertToFooter(this._containerTemplate); break; default:this._container = this._chart.insertToRightSidebar(this._containerTemplate) }a && (o(this._container, 'click', Zt, function (t, n) { e._toggleLegendItem(n, 'reset') }), o(this._container, 'click', te, function (t, n) { var r = t.ctrlKey || t.target.matches(ee) ? 'leave-others' : 'focus-single'; e._toggleLegendItem(n, r) }), o(this._container, 'mouseover', te, function (t, n) { e._highlightToggle(n, !0) }), o(this._container, 'mouseout', te, function (t, n) { e._highlightToggle(n, !1) })) } }, destroy: function () { var t = this._currentFilters; var e = this._chart; Object.keys(t).forEach(function (n) { return e.removeFilter(t[n]) }), this._container && this._container.parentElement && (this._clearPanel(), this._container.parentElement.removeChild(this._container)) }, onSpecReady: function (t, e) { this._formatters = Qt.getFieldFormatters(e, n.formatters) }, _getFormat: function (t) { return this._formatters[t] ? this._formatters[t].format : function (t) { return String(t) } }, onRender: function () { var t = this; if (e && n.selectedCategories && n.selectedCategories.length !== 0) { var r = this._getLegendColorByScales(); return Object.keys(r).forEach(function (e) { r[e].legendColorItems.forEach(function (e) { var r = e.value; var i = e.dim; if (n.selectedCategories.indexOf(JSON.parse(r)) === -1) { var o = i + r; var s = a(i, r); t._currentFilters[o] = t._chart.addFilter({ tag: 'legend', predicate: function (t) { return !s(t) } }) } }) }), e = !1, void this._chart.refresh() } this._clearPanel(), this._drawColorLegend(), this._drawFillLegend(), this._drawSizeLegend() }, _containerTemplate: '<div class="tau-chart__legend"></div>', _template: Jt.template(['<div class="tau-chart__legend__wrap">', '<%=top%>', '<div class="tau-chart__legend__title"><%=name%></div>', '<%=items%>', '</div>'].join('')), _itemTemplate: Jt.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">", '   <div class="tau-chart__legend__guide__wrap">', '   <div class="tau-chart__legend__guide tau-chart__legend__guide--color <%=cssClass%>"', '        style="background-color: <%=cssColor%>; border-color: <%=borderColor%>;">', '       <div class="tau-chart__legend__guide--color__overlay">', '       </div>', '   </div>', '   </div>', '   <span class="tau-chart__legend__guide__label"><%=label%></span>', '</div>'].join('')), _resetTemplate: Jt.template(['<div class="tau-chart__legend__reset <%=classDisabled%>">', '    <div role="button" class="tau-chart__button">Reset</div>', '</div>'].join('')), _clearPanel: function () { this._container && (clearTimeout(this._scrollTimeout), this._getScrollContainer().removeEventListener('scroll', this._scrollListener), this._container.innerHTML = '') }, _drawFillLegend: function () { var t = this; t._fill.forEach(function (e) { var n = t._chart.select(function (t) { return t.config.color === e })[0]; if (n) { var r = n.config.guide || {}; var a = n.getScale('color'); var o = a.domain().sort(function (t, e) { return t - e }); var s = i(o); var u = s ? o.map(Number) : o; var l = pe(u[0], u[u.length - 1]); var c = (function () { var e = t._chart.getSpec(); var n = Qt.extractFieldsFormatInfo(e)[a.dim].format; return n || (n = function (t) { return new Date(t) }), function (t) { return String(n(t)) } }()); var f = s ? c : l; var d = a.brewer.length; var h = ((r.color || {}).label || {}).text || a.dim; var p = function (t) { return t.length * re * 0.618 }; var g = a.isInteger ? (u[1] - u[0]) % 3 == 0 ? 4 : (u[1] - u[0]) % 2 == 0 ? 3 : 2 : 3; var m = se(u, g); var y = (s ? m.map(function (t) { return new Date(t) }) : m).map(f); y[0] === y[y.length - 1] && (y = [y[0]]), t._container.insertAdjacentHTML('beforeend', t._template({ name: h, top: null, items: '<div class="tau-chart__legend__gradient-wrapper"></div>' })); var v = t._container.lastElementChild.querySelector('.tau-chart__legend__gradient-wrapper'); var b = v.getBoundingClientRect().width; var x = !1; y.reduce(function (t, e) { return t + p(e) }, 0) > b && (y.length > 1 && p(y[0]) + p(y[y.length - 1]) > b ? x = !0 : y = [y[0], y[y.length - 1]]); var _ = x ? (function () { var t = -0.382 * re / 2; return { width: b, height: 120, barX: 0, barY: 0, barWidth: 20, barHeight: 120, textAnchor: 'start', textX: Jt.range(g).map(function () { return 25 }), textY: y.length === 1 ? 60 + 0.618 * re : y.map(function (e, n) { var r = (y.length - 1 - n) / (y.length - 1); return re * (1 - r) + 120 * r + t }) } }()) : (function () { var t = p(y[0]) / 2; var e = p(y[y.length - 1]) / 2; return { width: b, height: 28 + re, barX: 0, barY: 0, barWidth: b, barHeight: 20, textAnchor: 'middle', textX: y.length === 1 ? [b / 2] : y.map(function (n, r) { var i = r / (y.length - 1); return t * (1 - i) + (b - e) * i }), textY: Jt.range(g).map(function () { return 28 + re }) } }()); var w = se(u, d).map(function (t, e) { return oe('stop', { offset: e / (d - 1) * 100 + '%', style: 'stop-color:' + a(t) + ';stop-opacity:1"' }) }); var E = 'legend-gradient-' + t.instanceId; var S = oe.apply(void 0, ['svg', { class: 'tau-chart__legend__gradient', width: _.width, height: _.height }, oe('defs', oe.apply(void 0, ['linearGradient', { id: E, x1: '0%', y1: x ? '100%' : '0%', x2: x ? '0%' : '100%', y2: '0%' }].concat(w))), oe('rect', { class: 'tau-chart__legend__gradient__bar', x: _.barX, y: _.barY, width: _.barWidth, height: _.barHeight, fill: 'url(#' + E + ')' })].concat(y.map(function (t, e) { return oe('text', { x: _.textX[e], y: _.textY[e], 'text-anchor': _.textAnchor }, t) }))); v.insertAdjacentHTML('beforeend', S) } }) }, _drawSizeLegend: function () { var t = this; t._size.forEach(function (e) { var n = t._chart.select(function (t) { return t.config.size === e })[0]; if (n) { var r = n.config.guide || {}; var i = n.getScale('size'); var a = i.domain().sort(function (t, e) { return t - e }); if (!Array.isArray(a) || !a.every(isFinite)) return; var o = ((r.size || {}).label || {}).text || i.dim; var s = a[0]; var u = a[a.length - 1]; var l = [s]; if (u - s) { var c = le(u - s); var f = Math.round(4 - c); var d = Math.pow(10, f); var h = Jt.unique(t._chart.getDataSources({ excludeFilter: ['legend'] })[i.source].data.map(function (t) { return t[i.dim] }).filter(function (t) { return t >= s && t <= u })).sort(function (t, e) { return t - e }); var p = ue(h, ne, i.funcType); l = Jt.unique(p.map(function (t) { return Math.round(t * d) / d })) } var g = pe(l[0], l[l.length - 1]); var m = function (t) { return t.length * re * 0.618 }; l.reverse(); var y = l.map(i); var v = Math.max.apply(null, y); var b = l.map(g); t._container.insertAdjacentHTML('beforeend', t._template({ name: o, top: null, items: '<div class="tau-chart__legend__size-wrapper"></div>' })); var x = t._container.lastElementChild.querySelector('.tau-chart__legend__size-wrapper'); var _ = x.getBoundingClientRect().width; var w = !1; (Math.max.apply(null, b.map(m)) > _ / 4 || b.length === 1) && (w = !0); var E = w ? (function () { for (var t = re, e = y[0] / 2, n = y[y.length - 1] / 2, r = [e], i = 1, a = void 0, o = void 0; i < y.length; i++)o = y[i - 1] / 2, a = y[i] / 2, r.push(r[i - 1] + Math.max(1.618 * re, o + t + a)); var s = 0.618 * re / 2; return { width: _, height: r[r.length - 1] + Math.max(n, re / 2), circleX: Jt.range(y.length).map(function () { return v / 2 }), circleY: r, textAnchor: 'start', textX: Jt.range(b.length).map(function () { return v + 8 }), textY: r.map(function (t) { return t + s }) } }()) : (function () { for (var t = Math.max(m(b[0]) / 2, y[0] / 2), e = Math.max(m(b[b.length - 1]) / 2, y[y.length - 1] / 2), n = (_ - y.reduce(function (t, e, n) { return t + (n === 0 || n === y.length - 1 ? e / 2 : e) }, 0) - t - e) / (ne - 1), r = [t], i = 1, a = void 0, o = void 0; i < y.length; i++)o = y[i - 1] / 2, a = y[i] / 2, r.push(r[i - 1] + o + n + a); var s = y.map(function (t) { return v - t / 2 }); return { width: _, height: v + 8 + re, circleX: r, circleY: s, textAnchor: 'middle', textX: r, textY: Jt.range(b.length).map(function () { return v + 8 + re }) } }()); var S = oe.apply(void 0, ['svg', { class: 'tau-chart__legend__size', width: E.width, height: E.height }].concat(y.map(function (t, e) { return oe('circle', { class: 'tau-chart__legend__size__item__circle ' + (n.config.color ? 'color-definite' : 'color-default-size'), cx: E.circleX[e], cy: E.circleY[e], r: t / 2 }) }), b.map(function (t, e) { return oe('text', { class: 'tau-chart__legend__size__item__label', x: E.textX[e], y: E.textY[e], 'text-anchor': E.textAnchor }, t) }))); x.insertAdjacentHTML('beforeend', S) } }) }, _getLegendColorByScales: function () { var t = this; return t._color.reduce(function (e, n) { var a = t._chart.select(function (t) { return t.config.color === n })[0]; if (a) { var o = a.config.guide || {}; var s = a.getScale('color'); var u = t._chart.getDataSources({ excludeFilter: ['legend'] }); var l = Jt.unique(u[s.source].data.map(function (t) { return t[s.dim] })); var c = t._chart.getSpec().scales[n]; var f = i(l); if (c.order)l = Jt.union(Jt.intersection(c.order, l), l); else if (c.dimType === 'order' && f)l = l.sort(function (t, e) { return new Date(t) - new Date(e) }); else { var d = t._legendOrderState[n]; l = l.sort(function (t, e) { var n = d[t] - d[e]; return n && n / Math.abs(n) }) } var h = ((o.color || {}).label || {}).text || s.dim; var p = (o.color || {}).tickFormatNullAlias || 'No ' + h; var g = t._getFormat(s.dim); var m = l.map(function (e) { var i = JSON.stringify(r(e) ? null : e); var a = s.dim + i; return { scaleId: n, dim: s.dim, color: s(e), disabled: t._currentFilters.hasOwnProperty(a), label: g(e), value: i } }); e[n] = { legendColorItems: m, title: h, colorScale: s, noVal: p } } return e }, {}) }, _drawColorLegend: function () { var t = this; var e = this._getLegendColorByScales(); Object.keys(e).forEach(function (n) { var i = e[n]; var a = i.legendColorItems; var o = i.title; var s = i.colorScale; var u = i.noVal; t._container.insertAdjacentHTML('beforeend', t._template({ name: o, top: t._resetTemplate({ classDisabled: a.some(function (t) { return t.disabled }) ? '' : 'disabled' }), items: a.map(function (e) { return t._itemTemplate({ scaleId: e.scaleId, dim: Jt.escape(e.dim), color: e.color, cssClass: s.toClass(e.color), cssColor: e.disabled ? 'transparent' : s.toColor(e.color), borderColor: s.toColor(e.color), classDisabled: e.disabled ? 'disabled' : '', label: Jt.escape(r(e.label) ? u : e.label), value: Jt.escape(e.value) }) }).join('') })) }), t._color.length > 0 && (t._updateResetButtonPosition(), t._scrollTimeout = null, t._scrollListener = function () { var e = t._container.querySelector(Zt); e.style.display = 'none', t._scrollTimeout && clearTimeout(t._scrollTimeout), t._scrollTimeout = setTimeout(function () { t._updateResetButtonPosition(), e.style.display = '', t._scrollTimeout = null }, 250) }, t._getScrollContainer().addEventListener('scroll', t._scrollListener)) }, _toggleLegendItem: function (t, e) { var r = this; var i = this._currentFilters; var o = t ? Array.prototype.filter.call(t.parentNode.childNodes, function (t) { return t.matches(te) }) : null; var s = function (t) { var e = t.getAttribute('data-dim'); var n = t.getAttribute('data-value'); return { sid: t.getAttribute('data-scale-id'), dim: e, val: n, key: e + n } }; var u = function (t) { return t in i }; var l = function (t, e) { var n = s(t); if (u(n.key) === e) if (e) { var o = i[n.key]; delete i[n.key], t.classList.remove('disabled'), r._chart.removeFilter(o) } else { t.classList.add('disabled'); var l = a(n.dim, n.val); i[n.key] = r._chart.addFilter({ tag: 'legend', predicate: function (t) { return !l(t) } }) } }; var c = function (e) { return e === t }; var f = !!t && u(s(t).key); var d = function (t, e) { t.querySelector('.tau-chart__legend__guide').style.backgroundColor = e ? '' : 'transparent' }; if (e === 'reset')o.forEach(function (t) { l(t, !0), d(t, !0) }); else if (e === 'leave-others')o.forEach(function (t) { c(t) && l(t, f) }), d(t, f); else if (e === 'focus-single') { var h = !f && o.every(function (t) { return c(t) || u(s(t).key) }); o.forEach(function (t) { var e = c(t) || h; l(t, e) }), f && d(t, !0) } var p = o.filter(function (t) { return !u(s(t).key) }).map(function (t) { return JSON.parse(s(t).val) }); n.onSelect({ type: e, selectedCategories: p }), this._chart.refresh() }, _highlightToggle: function (t, e) { if (!t.matches('.disabled')) { var n = t.getAttribute('data-dim'); var r = t.getAttribute('data-value'); var i = e ? a(n, r) : function (t) { return null }; this._chart.select(function (t) { return !0 }).forEach(function (t) { t.fire('highlight', i) }) } }, _getScrollContainer: function () { return this._container.parentNode.parentNode }, _updateResetButtonPosition: function () { this._container.querySelector(Zt).style.top = this._getScrollContainer().scrollTop + 'px' }, _generateColorMap: function (t, e) { var n = e.length; return t.reduce(function (t, r, i) { return t[r] = e[i % n], t }, {}) }, _assignStaticBrewersOrEx: function () { var t = this; t._color.forEach(function (e) { var n = t._chart.getSpec().scales[e]; var r = t._chart.getDataSources({ excludeFilter: ['legend'] }); var i = t._chart.getScaleFactory(r).createScaleInfoByName(e).domain(); if (!n.brewer || Array.isArray(n.brewer)) { var a = n.brewer || Jt.range(20).map(function (t) { return 'color20-' + (1 + t) }); n.brewer = t._generateColorMap(i, a) }t._legendOrderState[e] = i.reduce(function (t, e, n) { return t[e] = n, t }, {}) }) } } }r.default.api.plugins.add('legend', ge); var me = r.default.api.utils; function ye (t) { var e = me.defaults(t || {}, { verbose: !1, forceBrush: {} }); var n = { init: function (t) { e.verbose && (this.panel = t.insertToRightSidebar(this.template())), t.traverseSpec(t.getSpec(), function (t) { t && t.type === 'COORDS.PARALLEL' && (t.guide = t.guide || {}, t.guide.enableBrushing = !0) }), n.forceBrush = e.forceBrush || {} }, onRender: function (t) { var r = t.getSpec().scales; var i = Object.keys(r).reduce(function (t, e) { var i = r[e].dim; return n.forceBrush[i] && (t[e] = n.forceBrush[i]), t }, {}); var a = t.select(function (t) { return t.config.type === 'PARALLEL/ELEMENT.LINE' }); a.forEach(function (t, r) { t.parentUnit.on('brush', function (i, a) { n.forceBrush = {}; var o = a.map(function (t) { var e = t.dim; var r = t.func; var i = t.args; n.forceBrush[e] = i; var a = function () { return !0 }; return r === 'between' && (a = function (t) { return t[e] >= i[0] && i[1] >= t[e] }), r === 'inset' && (a = function (t) { return i.indexOf(t[e]) >= 0 }), a }); var s = 0; if (t.fire('highlight', function (t) { var e = o.every(function (e) { return e(t) }); return s += e ? 1 : 0, e }), e.verbose) { var u = n.panel.getElementsByClassName('i-' + r); if (u.length === 0) { var l = document.createElement('div'); l.className = 'i-' + r, n.panel.appendChild(l), u[0] = l }u[0].innerHTML = a.reduce(function (t, e) { return t + '<div>' + e.dim + ': [' + e.args.join(',') + ']</div>' }, '<div>Matched: ' + s + '</div>') } }) }), a.forEach(function (t) { t.parentUnit.fire('force-brush', i) }) }, template: me.template('<div class="tau-chart__chart_brushing_panel"></div>') }; return n }r.default.api.plugins.add('parallel-brushing', ye); var ve = r.default.api.utils; function be (t) { ve.defaults(t || {}, {}); return { init: function (t) { this._cursor = null, this._chart = t, this._tooltip = t.addBalloon({ spacing: 3, auto: !0, effectClass: 'fade' }), this._tooltip.content(this.template), this._tooltip.getElement().addEventListener('click', function (t) { for (var e = t.target; e !== t.currentTarget && e !== null;)e.classList.contains('i-role-exclude') && n._exclude(), e = e.parentNode; n._tooltip.hide() }, !1); var e; var n = this; this.showTooltip = function (t) { clearTimeout(e), n._cursor = t.data; var r = n._tooltip.getElement().querySelectorAll('.i-role-content'); r[0] && (r[0].innerHTML = Object.keys(t.data).map(function (e) { return n.itemTemplate({ label: e, value: t.data[e] }) }).join('')), n._tooltip.show(t.event.pageX, t.event.pageY).updateSize() }, this.hideTooltip = function (t) { e = setTimeout(function () { n._tooltip.hide() }, 1e3) }, this._tooltip.getElement().addEventListener('mouseover', function (t) { clearTimeout(e) }, !1), this._tooltip.getElement().addEventListener('mouseleave', function (t) { n._tooltip.hide() }, !1) }, _exclude: function () { this._chart.addFilter({ tag: 'exclude', predicate: (function (t) { return function (e) { return JSON.stringify(e) !== JSON.stringify(t) } }(this._cursor)) }), this._chart.refresh() }, onRender: function (t) { var e = this; t.select(function (t) { return t.config.type === 'PARALLEL/ELEMENT.LINE' }).forEach(function (t) { t.on('mouseout', function (t, n) { e.hideTooltip(n) }), t.on('mouseover', function (t, n) { e.showTooltip(n) }) }) }, template: ['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">', '<div class="tau-chart__tooltip__button i-role-exclude">', '<div class="tau-chart__tooltip__button__wrap">', '<span class="tau-icon-close-gray"></span>', 'Exclude', '</div>', '</div>', '</div>', '<div class="i-role-content tau-chart__tooltip__content"></div>'].join(''), itemTemplate: ve.template(['<div class="tau-chart__tooltip__list__item">', '<div class="tau-chart__tooltip__list__elem"><%=label%></div>', '<div class="tau-chart__tooltip__list__elem"><%=value%></div>', '</div>'].join('')) } }r.default.api.plugins.add('parallel-tooltip', be); var xe = n(8); var _e = n(3); var we = n(7); var Ee = function () { return (Ee = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++) for (var i in e = arguments[n])Object.prototype.hasOwnProperty.call(e, i) && (t[i] = e[i]); return t }).apply(this, arguments) }; var Se = Ee({}, Ut, xe, _e, h, we); var Me = r.default.api.utils; var Te = 0; function Ce (t) { void 0 === t && (t = {}); return { init: function (e) { this._chart = e, this._currentFilters = {}, this._data = {}, this._bounds = {}, this._filter = {}, this._container = {}, this._layout = this._chart.getLayout().layout; var n = this; var r = this._chart.getSpec(); var i = r.sources['/']; var a = t.fields || t; this._fields = Array.isArray(a) && a.length > 0 ? a : Object.keys(i.dims), this._fieldBounds = t.fieldBounds || {}, this._applyImmediately = Boolean(t.applyImmediately); var o = n._chart.getChartModelData(); this._filtersContainer = n._chart.insertToRightSidebar(n._filtersContainer), this._filtersContainer.style.maxHeight = '0px', n._fields.filter(function (t) { var e = i.dims[t].type === 'measure'; return e || r.settings.log('The [' + t + "] isn't measure so Quick Filter plugin skipped it"), e }).forEach(function (t) { n._data[t] = o.map(function (e) { return e[t] }); var e = n._fieldBounds[t]; n._bounds[t] = e ? [e.min, e.max] : Se.extent(n._data[t]), n._filter[t] = n._bounds[t], n._filtersContainer.insertAdjacentHTML('beforeend', n._filterWrapper({ name: t })), n._container[t] = n._filtersContainer.lastChild, n._drawFilter(t) }) }, onRender: function () { this._filtersContainer.style.maxHeight = 'none' }, _filtersContainer: '<div class="tau-chart__filter"></div>', _filterWrapper: Me.template('<div class="tau-chart__filter__wrap"><div class="tau-chart__legend__title"><%=name%></div></div>'), _drawFilter: function (t) { var e = this._data[t]; var n = this._bounds[t]; var r = this._filter[t]; var i = Me.isDate(n[0]) || Me.isDate(n[1]); var a = this; var o = 0; var s = 24; var u = 21; var l = 12; var c = 180 - l - s; var f = 41 - o - u - 8; var d = Se.scaleLinear().domain(n).range([0, c]); var p = Se.brushX().extent([[0, 0], [c, 20]]).on('start', function () { a._layout.style['overflow-y'] = 'hidden' }).on('brush', this._applyImmediately ? E : w).on('end', function () { a._layout.style['overflow-y'] = '', E() }); var g = Se.select(this._container[t]).append('svg').attr('width', c + l + s).attr('height', f + o + u + 4).append('g').attr('transform', 'translate(' + l + ',' + o + ')'); var m = (g.append('g').selectAll('rect').data(e).enter().append('rect').attr('transform', function (t) { return 'translate(' + d(t) + ',' + (o + 4) + ')' }).attr('height', f).attr('width', 1), g.append('g').attr('class', 'brush').call(p)); m.append('g').attr('class', 'resize e').attr('cursor', 'ew-resize').attr('pointer-events', 'none'), m.append('g').attr('class', 'resize w').attr('cursor', 'ew-resize').attr('pointer-events', 'none'), m.selectAll('.resize').append('line').attr('transform', 'translate(0, 0)').attr('x1', 0).attr('x2', 0).attr('y1', 0).attr('y2', f + 8), m.selectAll('.resize').append('text').attr('x', 0).attr('y', 2 * (f + 4)), m.selectAll('rect').attr('height', f + 8); var y = g.append('text').attr('x', c / 2).attr('y', 2 * (f + 4)).attr('class', 'date-label'); var v = (function (t) { return Math.log(t) / Math.LN10 }(a._filter[t][1] - a._filter[t][0])); var b = Math.round(3 - v); var x = Math.pow(10, b); if (i) { var _ = (function (t) { var e = t.findIndex(function (t) { var e = Se.timeFormat(t); return e(new Date(n[0])) !== e(new Date(n[1])) }); return e = e < 0 ? t.length : e, { comm: t.slice(0, e), diff: t.slice(e) } }(['%y', '&thinsp;%b', '%d', '%H', ':%M', ':%S'])); _.comm.length < 3 ? (_.diff.splice(-3), _.diff.reverse(), _.comm.reverse()) : (_.comm.length < 5 && _.diff.pop(), _.diff = _.comm.splice(3, _.comm.length - 3).concat(_.diff), _.comm.reverse()) } function w () { var e = h.event; if (e && Array.isArray(e.selection)) { var n = e.selection.map(d.invert); r = n, a._filter[t] = n } else r = a._filter[t]; var o = i ? new Date(r[0]).getTime() : r[0]; var s = i ? new Date(r[1]).getTime() : r[1]; var u = Math.round(parseFloat(o) * x) / x; var l = Math.round(parseFloat(s) * x) / x; m.select('.handle--w'), m.select('.handle--e'); m.select('.resize.w').attr('transform', 'translate(' + d(r[0]) + ',0)'), m.select('.resize.e').attr('transform', 'translate(' + d(r[1]) + ',0)'); var c = m.selectAll('.w text'); var f = m.selectAll('.e text'); if (i) { var p = Se.timeFormat(_.comm.join('')); var g = Se.timeFormat(_.diff.join('')); y.html(g(new Date(u)) + '&thinsp;..&thinsp;' + g(new Date(l)) + ' <tspan class="common">' + p(new Date(l)) + '</tspan>') } else c.text(u), f.text(l) } function E () { w(), a._applyFilter(t) }E(), p.move(m, r.map(d)) }, destroy: function () { var t = this._currentFilters; var e = this._chart; Object.keys(t).forEach(function (n) { return e.removeFilter(t[n]) }); !(function (t) { t && t.parentElement && t.parentElement.removeChild(t) }(this._filtersContainer)) }, _applyFilter: function (t) { var e = this._currentFilters; var n = (function (t, e, n) { return function (r) { var i = r[t]; return i < e || i > n } }(t, this._filter[t][0], this._filter[t][1])); var r = e[t]; delete e[t], this._chart.removeFilter(r), e[t] = this._chart.addFilter({ tag: 'quick-filter', predicate: function (t) { return !n(t) } }), Te < 0 ? this._chart.refresh() : (this._refreshRequestId && clearTimeout(this._refreshRequestId), this._refreshRequestId = setTimeout(function () { this._refreshRequestId = null, this._chart.refresh() }.bind(this), Te)) } } }r.default.api.plugins.add('quick-filter', Ce); var ke = r.default.api.utils; function Ae (t) { var e = ke.defaults(t || {}, { show: !0, modes: ['normal', 'entire-view', 'fit-width', 'fit-height', 'minimal'] }); return { init: function (t) { e.show && (e.selectedMode = t.getSpec().settings.fitModel, t.insertToHeader(this.template({ modes: e.modes.map(function (t) { return '<option ' + (e.selectedMode === t ? 'selected' : '') + ' value="' + t + '">' + t + '</option>' }) })).addEventListener('change', function (n) { var r = n.target; r.classList.contains('i-role-fit-model') && (e.selectedMode = r.value, t.getSpec().settings.fitModel = e.selectedMode, t.refresh()) }, !1)) }, template: ke.template(['<div class="tau-chart__chartsettingspanel">', '    <div>', '        <span>View Mode:&nbsp;</span>', '        <select class="i-role-fit-model tau-chart__select">', '        <%= modes %> />', '        </select>', '    </div>', '</div>'].join('')) } }r.default.api.plugins.add('settings', Ae); function Oe (t) { return new X(t) }r.default.api.plugins.add('tooltip', Oe); var Pe = (function () { var t = { linear: function (t) { for (var e = [0, 0, 0, 0, 0], n = 0, r = []; n < t.length; n++)t[n][1] && (e[0] += t[n][0], e[1] += t[n][1], e[2] += t[n][0] * t[n][0], e[3] += t[n][0] * t[n][1], e[4] += t[n][1] * t[n][1]); var i = (n * e[3] - e[0] * e[1]) / (n * e[2] - e[0] * e[0]); i = isNaN(i) ? 0 : i; for (var a = e[1] / n - i * e[0] / n, o = 0, s = t.length; o < s; o++) { var u = [t[o][0], t[o][0] * i + a]; r.push(u) } return { equation: [i, a], points: r, string: 'y = ' + Math.round(100 * i) / 100 + 'x + ' + Math.round(100 * a) / 100 } }, exponential: function (t) { var e = [0, 0, 0, 0, 0, 0]; var n = 0; var r = []; for (u = t.length; n < u; n++)t[n][1] && (e[0] += t[n][0], e[1] += t[n][1], e[2] += t[n][0] * t[n][0] * t[n][1], e[3] += t[n][1] * Math.log(t[n][1]), e[4] += t[n][0] * t[n][1] * Math.log(t[n][1]), e[5] += t[n][0] * t[n][1]); for (var i = e[1] * e[2] - e[5] * e[5], a = Math.pow(Math.E, (e[2] * e[3] - e[5] * e[4]) / i), o = (e[1] * e[4] - e[5] * e[3]) / i, s = 0, u = t.length; s < u; s++) { var l = [t[s][0], a * Math.pow(Math.E, o * t[s][0])]; r.push(l) } return { equation: [a, o], points: r, string: 'y = ' + Math.round(100 * a) / 100 + 'e^(' + Math.round(100 * o) / 100 + 'x)' } }, logarithmic: function (t) { var e = [0, 0, 0, 0]; var n = 0; var r = []; for (s = t.length; n < s; n++)t[n][1] && (e[0] += Math.log(t[n][0]), e[1] += t[n][1] * Math.log(t[n][0]), e[2] += t[n][1], e[3] += Math.pow(Math.log(t[n][0]), 2)); for (var i = (n * e[1] - e[2] * e[0]) / (n * e[3] - e[0] * e[0]), a = (e[2] - i * e[0]) / n, o = 0, s = t.length; o < s; o++) { var u = [t[o][0], a + i * Math.log(t[o][0])]; r.push(u) } return { equation: [a, i], points: r, string: 'y = ' + Math.round(100 * a) / 100 + ' + ' + Math.round(100 * i) / 100 + ' ln(x)' } }, power: function (t) { var e = [0, 0, 0, 0]; var n = 0; var r = []; for (s = t.length; n < s; n++)t[n][1] && (e[0] += Math.log(t[n][0]), e[1] += Math.log(t[n][1]) * Math.log(t[n][0]), e[2] += Math.log(t[n][1]), e[3] += Math.pow(Math.log(t[n][0]), 2)); for (var i = (n * e[1] - e[2] * e[0]) / (n * e[3] - e[0] * e[0]), a = Math.pow(Math.E, (e[2] - i * e[0]) / n), o = 0, s = t.length; o < s; o++) { var u = [t[o][0], a * Math.pow(t[o][0], i)]; r.push(u) } return { equation: [a, i], points: r, string: 'y = ' + Math.round(100 * a) / 100 + 'x^' + Math.round(100 * i) / 100 } }, polynomial: function (t, e) { void 0 === e && (e = 2); for (var n = [], r = [], i = [], a = 0, o = 0, s = 0, u = e + 1; s < u; s++) { for (var l = 0, c = t.length; l < c; l++)t[l][1] && (a += Math.pow(t[l][0], s) * t[l][1]); n.push(a), a = 0; for (var f = [], d = 0; d < u; d++) { for (l = 0, c = t.length; l < c; l++)t[l][1] && (o += Math.pow(t[l][0], s + d)); f.push(o), o = 0 }r.push(f) }r.push(n); var h = (function (t, e) { var n = 0; var r = 0; var i = 0; var a = 0; var o = 0; var s = t.length - 1; var u = new Array(e); for (n = 0; n < s; n++) { for (a = n, r = n + 1; r < s; r++)Math.abs(t[n][r]) > Math.abs(t[n][a]) && (a = r); for (i = n; i < s + 1; i++)o = t[i][n], t[i][n] = t[i][a], t[i][a] = o; for (r = n + 1; r < s; r++) for (i = s; i >= n; i--)t[i][r] -= t[i][n] * t[n][r] / t[n][n] } for (r = s - 1; r >= 0; r--) { for (o = 0, i = r + 1; i < s; i++)o += t[i][r] * u[i]; u[r] = (t[s][r] - o) / t[r][r] } return u }(r, u)); for (s = 0, c = t.length; s < c; s++) { for (var p = 0, g = 0; g < h.length; g++)p += h[g] * Math.pow(t[s][0], g); i.push([t[s][0], p]) } var m = 'y = '; for (s = h.length - 1; s >= 0; s--)m += s > 1 ? Math.round(100 * h[s]) / 100 + 'x^' + s + ' + ' : s == 1 ? Math.round(100 * h[s]) / 100 + 'x + ' : Math.round(100 * h[s]) / 100; return { equation: h, points: i, string: m } }, lastvalue: function (t) { for (var e = [], n = null, r = 0; r < t.length; r++)t[r][1] ? (n = t[r][1], e.push([t[r][0], t[r][1]])) : e.push([t[r][0], n]); return { equation: [n], points: e, string: '' + n } }, loess: function (t) { return { equation: 'loess', points: (function (t, e) { var n = t.map(function (t) { return t[0] }); var r = (function (t, e, n) { function r (t) { var e = 1 - t * t * t; return e * e * e } for (var i = [], a = 0, o = Math.floor(n * t.length) - 1, s = 0; s < t.length; s++) { var u; var l = t[s]; s > 0 && o < t.length - 1 && t[o + 1] - t[s] < t[s] - t[a] && (a++, o++), u = t[s] - t[a] > t[o] - t[s] ? a : o; for (var c = Math.abs(1 / (t[u] - l)), f = 0, d = 0, h = 0, p = 0, g = 0, m = a; m <= o;) { var y = t[m]; var v = e[m]; var b = r((m < s ? l - y : y - l) * c); var x = y * b; f += b, d += x, h += y * x, p += v * b, g += v * x, m++ } var _; var w = d / f; var E = p / f; var S = g / f; var M = h / f; var T = E - (_ = M == w * w ? 0 : (S - w * E) / (M - w * w)) * w; i[s] = _ * l + T } return i }(n, t.map(function (t) { return t[1] }), e)); return n.map(function (t, e) { return [t, r[e]] }) }(t, 0.5)), string: 'loess' } } }; return function (e, n, r) { if (typeof e === 'string') return t[e](n, r) } }()); var Ne = r.default.api.utils; function Le (t) { var e = Ne.defaults(t || {}, { type: 'linear', hideError: !1, showPanel: !0, showTrend: !0, models: ['linear', 'exponential', 'logarithmic'] }); return { init: function (t) { if (this._chart = t, this._applicableElements = ['ELEMENT.POINT', 'ELEMENT.LINE', 'ELEMENT.AREA', 'ELEMENT.INTERVAL'], this._isApplicable = this.checkIfApplicable(t), e.showPanel) { this._container = t.insertToRightSidebar(this.containerTemplate); var n = 'applicable-true'; this._isApplicable || (n = 'applicable-false', this._error = ["Trend line can't be computed for categorical data.", 'Each axis should be either a measure or a date.'].join(' ')), this._container.classList.add(n), e.hideError && this._container.classList.add('hide-trendline-error'), this.uiChangeEventsDispatcher = function (t) { var n = t.target; var r = n.classList; r.contains('i-role-show-trend') && (e.showTrend = n.checked), r.contains('i-role-change-model') && (e.type = n.value), this._chart.refresh() }.bind(this), this._container.addEventListener('change', this.uiChangeEventsDispatcher, !1) } }, checkIfApplicable: function (t) { var e = this; var n = t.getSpec(); var r = !1; return t.traverseSpec(n, function (t, i) { e.predicateIsApplicable(n, t, i) && (r = !0) }), r }, predicateIsApplicable: function (t, e, n) { if (n && n.type !== 'COORDS.RECT') return !1; if (n && !n.units) return !1; if (this._applicableElements.indexOf(e.type) === -1 || e.stack || e.namespace !== 'chart') return !1; var r = t.scales[e.x]; var i = t.scales[e.y]; return !(r.type === 'ordinal' || i.type === 'ordinal') }, onSpecReady: function (t, n) { var i = this; if (e.showTrend) { var a = r.default.api.tickPeriod; var o = function (t) { var e = a.get(t, { utc: n.settings.utcTime }); return function (t) { return e.cast(new Date(t)) } }; n.transformations = n.transformations || {}, n.transformations.regression = function (t, e) { var n = e.x.dim; var r = e.y.dim; var i = e.g.dim; var a = Boolean(e.x.period); var s = Boolean(e.y.period); var u = a ? o(e.x.period) : function (t) { return t }; var l = s ? o(e.y.period) : function (t) { return t }; var c = t.map(function (t) { return [Ne.isDate(t[n]) ? t[n].getTime() : t[n], Ne.isDate(t[r]) ? t[r].getTime() : t[r], t[i]] }); var f = Ne.groupBy(c, function (t) { return t[2] }); return Object.keys(f).reduce(function (t, o) { var c = f[o]; var d = Pe(e.type, c).points.filter(function (t) { return t[0] !== null && t[1] !== null }).sort(function (t, e) { return t[0] - e[0] }).map(function (t) { var e = {}; return e[n] = u(t[0]), e[r] = l(t[1]), i && (e[i] = o), e }); return d.length > 1 && (a || s) && (d = [d[0], d[d.length - 1]]), t.concat(d.length > 1 ? d : []) }, []) }, t.traverseSpec(n, function (t, r) { if (i.predicateIsApplicable(n, t, r)) { var a = n.scales[t.x]; var o = n.scales[t.y]; var s = n.scales[t.color] || {}; var u = JSON.parse(JSON.stringify(t)); u.type = 'ELEMENT.LINE', u.size = 'size_null', u.namespace = 'trendline', u.transformation = u.transformation || [], u.transformation.push({ type: 'regression', args: { type: e.type, x: a, y: o, g: s } }); u.guide = Ne.defaults({}, u.guide || {}), u.guide.interpolate = 'linear', u.guide.showAnchors = 'never', u.guide.cssClass = 'tau-chart__trendline', u.guide.widthCssClass = 'tau-chart__line-width-1', u.guide.x = u.guide.x || {}, u.guide.x.fillGaps = !1, delete u.guide.label, delete u.label, r.units.push(u) } }) } }, containerTemplate: '<div class="tau-chart__trendlinepanel"></div>', template: Ne.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">', '<input type="checkbox" class="tau-chart__checkbox__input i-role-show-trend" <%= showTrend %> />', '<span class="tau-chart__checkbox__icon"></span>', '<span class="tau-chart__checkbox__text">', '<%= title %>', '</span>', '</label>', '<div>', '<select class="i-role-change-model tau-chart__select tau-chart__trendlinepanel__control">', '<%= models %>', '</select>', '</div>', '<div class="tau-chart__trendlinepanel__error-message"><%= error %></div>'].join('')), onRender: function (t) { if (this._container) { this._container.innerHTML = this.template({ title: 'Trend line', error: this._error, showTrend: e.showTrend && this._isApplicable ? 'checked' : '', models: e.models.map(function (t) { return '<option ' + (e.type === t ? 'selected' : '') + ' value="' + t + '">' + t + '</option>' }) }); var n = function (t) { return function () { h.select(this).classed({ active: t, 'tau-chart__line-width-1': !t, 'tau-chart__line-width-3': t }) } }; h.select(t.getSVG()).selectAll('.tau-chart__trendline').on('mouseenter', n(!0)).on('mouseleave', n(!1)) } } } }r.default.api.plugins.add('trendline', Le); var Re = { YlGn: { 3: ['#f7fcb9', '#addd8e', '#31a354'], 4: ['#ffffcc', '#c2e699', '#78c679', '#238443'], 5: ['#ffffcc', '#c2e699', '#78c679', '#31a354', '#006837'], 6: ['#ffffcc', '#d9f0a3', '#addd8e', '#78c679', '#31a354', '#006837'], 7: ['#ffffcc', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#005a32'], 8: ['#ffffe5', '#f7fcb9', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#005a32'], 9: ['#ffffe5', '#f7fcb9', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#006837', '#004529'] }, YlGnBu: { 3: ['#edf8b1', '#7fcdbb', '#2c7fb8'], 4: ['#ffffcc', '#a1dab4', '#41b6c4', '#225ea8'], 5: ['#ffffcc', '#a1dab4', '#41b6c4', '#2c7fb8', '#253494'], 6: ['#ffffcc', '#c7e9b4', '#7fcdbb', '#41b6c4', '#2c7fb8', '#253494'], 7: ['#ffffcc', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#0c2c84'], 8: ['#ffffd9', '#edf8b1', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#0c2c84'], 9: ['#ffffd9', '#edf8b1', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#253494', '#081d58'] }, GnBu: { 3: ['#e0f3db', '#a8ddb5', '#43a2ca'], 4: ['#f0f9e8', '#bae4bc', '#7bccc4', '#2b8cbe'], 5: ['#f0f9e8', '#bae4bc', '#7bccc4', '#43a2ca', '#0868ac'], 6: ['#f0f9e8', '#ccebc5', '#a8ddb5', '#7bccc4', '#43a2ca', '#0868ac'], 7: ['#f0f9e8', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#08589e'], 8: ['#f7fcf0', '#e0f3db', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#08589e'], 9: ['#f7fcf0', '#e0f3db', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#0868ac', '#084081'] }, BuGn: { 3: ['#e5f5f9', '#99d8c9', '#2ca25f'], 4: ['#edf8fb', '#b2e2e2', '#66c2a4', '#238b45'], 5: ['#edf8fb', '#b2e2e2', '#66c2a4', '#2ca25f', '#006d2c'], 6: ['#edf8fb', '#ccece6', '#99d8c9', '#66c2a4', '#2ca25f', '#006d2c'], 7: ['#edf8fb', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#005824'], 8: ['#f7fcfd', '#e5f5f9', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#005824'], 9: ['#f7fcfd', '#e5f5f9', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b'] }, PuBuGn: { 3: ['#ece2f0', '#a6bddb', '#1c9099'], 4: ['#f6eff7', '#bdc9e1', '#67a9cf', '#02818a'], 5: ['#f6eff7', '#bdc9e1', '#67a9cf', '#1c9099', '#016c59'], 6: ['#f6eff7', '#d0d1e6', '#a6bddb', '#67a9cf', '#1c9099', '#016c59'], 7: ['#f6eff7', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016450'], 8: ['#fff7fb', '#ece2f0', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016450'], 9: ['#fff7fb', '#ece2f0', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016c59', '#014636'] }, PuBu: { 3: ['#ece7f2', '#a6bddb', '#2b8cbe'], 4: ['#f1eef6', '#bdc9e1', '#74a9cf', '#0570b0'], 5: ['#f1eef6', '#bdc9e1', '#74a9cf', '#2b8cbe', '#045a8d'], 6: ['#f1eef6', '#d0d1e6', '#a6bddb', '#74a9cf', '#2b8cbe', '#045a8d'], 7: ['#f1eef6', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#034e7b'], 8: ['#fff7fb', '#ece7f2', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#034e7b'], 9: ['#fff7fb', '#ece7f2', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#045a8d', '#023858'] }, BuPu: { 3: ['#e0ecf4', '#9ebcda', '#8856a7'], 4: ['#edf8fb', '#b3cde3', '#8c96c6', '#88419d'], 5: ['#edf8fb', '#b3cde3', '#8c96c6', '#8856a7', '#810f7c'], 6: ['#edf8fb', '#bfd3e6', '#9ebcda', '#8c96c6', '#8856a7', '#810f7c'], 7: ['#edf8fb', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#6e016b'], 8: ['#f7fcfd', '#e0ecf4', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#6e016b'], 9: ['#f7fcfd', '#e0ecf4', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#810f7c', '#4d004b'] }, RdPu: { 3: ['#fde0dd', '#fa9fb5', '#c51b8a'], 4: ['#feebe2', '#fbb4b9', '#f768a1', '#ae017e'], 5: ['#feebe2', '#fbb4b9', '#f768a1', '#c51b8a', '#7a0177'], 6: ['#feebe2', '#fcc5c0', '#fa9fb5', '#f768a1', '#c51b8a', '#7a0177'], 7: ['#feebe2', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177'], 8: ['#fff7f3', '#fde0dd', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177'], 9: ['#fff7f3', '#fde0dd', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177', '#49006a'] }, PuRd: { 3: ['#e7e1ef', '#c994c7', '#dd1c77'], 4: ['#f1eef6', '#d7b5d8', '#df65b0', '#ce1256'], 5: ['#f1eef6', '#d7b5d8', '#df65b0', '#dd1c77', '#980043'], 6: ['#f1eef6', '#d4b9da', '#c994c7', '#df65b0', '#dd1c77', '#980043'], 7: ['#f1eef6', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#91003f'], 8: ['#f7f4f9', '#e7e1ef', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#91003f'], 9: ['#f7f4f9', '#e7e1ef', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#980043', '#67001f'] }, OrRd: { 3: ['#fee8c8', '#fdbb84', '#e34a33'], 4: ['#fef0d9', '#fdcc8a', '#fc8d59', '#d7301f'], 5: ['#fef0d9', '#fdcc8a', '#fc8d59', '#e34a33', '#b30000'], 6: ['#fef0d9', '#fdd49e', '#fdbb84', '#fc8d59', '#e34a33', '#b30000'], 7: ['#fef0d9', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#990000'], 8: ['#fff7ec', '#fee8c8', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#990000'], 9: ['#fff7ec', '#fee8c8', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#b30000', '#7f0000'] }, YlOrRd: { 3: ['#ffeda0', '#feb24c', '#f03b20'], 4: ['#ffffb2', '#fecc5c', '#fd8d3c', '#e31a1c'], 5: ['#ffffb2', '#fecc5c', '#fd8d3c', '#f03b20', '#bd0026'], 6: ['#ffffb2', '#fed976', '#feb24c', '#fd8d3c', '#f03b20', '#bd0026'], 7: ['#ffffb2', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#b10026'], 8: ['#ffffcc', '#ffeda0', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#b10026'], 9: ['#ffffcc', '#ffeda0', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#bd0026', '#800026'] }, YlOrBr: { 3: ['#fff7bc', '#fec44f', '#d95f0e'], 4: ['#ffffd4', '#fed98e', '#fe9929', '#cc4c02'], 5: ['#ffffd4', '#fed98e', '#fe9929', '#d95f0e', '#993404'], 6: ['#ffffd4', '#fee391', '#fec44f', '#fe9929', '#d95f0e', '#993404'], 7: ['#ffffd4', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#8c2d04'], 8: ['#ffffe5', '#fff7bc', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#8c2d04'], 9: ['#ffffe5', '#fff7bc', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#993404', '#662506'] }, Purples: { 3: ['#efedf5', '#bcbddc', '#756bb1'], 4: ['#f2f0f7', '#cbc9e2', '#9e9ac8', '#6a51a3'], 5: ['#f2f0f7', '#cbc9e2', '#9e9ac8', '#756bb1', '#54278f'], 6: ['#f2f0f7', '#dadaeb', '#bcbddc', '#9e9ac8', '#756bb1', '#54278f'], 7: ['#f2f0f7', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#4a1486'], 8: ['#fcfbfd', '#efedf5', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#4a1486'], 9: ['#fcfbfd', '#efedf5', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#54278f', '#3f007d'] }, Blues: { 3: ['#deebf7', '#9ecae1', '#3182bd'], 4: ['#eff3ff', '#bdd7e7', '#6baed6', '#2171b5'], 5: ['#eff3ff', '#bdd7e7', '#6baed6', '#3182bd', '#08519c'], 6: ['#eff3ff', '#c6dbef', '#9ecae1', '#6baed6', '#3182bd', '#08519c'], 7: ['#eff3ff', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#084594'], 8: ['#f7fbff', '#deebf7', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#084594'], 9: ['#f7fbff', '#deebf7', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#08519c', '#08306b'] }, Greens: { 3: ['#e5f5e0', '#a1d99b', '#31a354'], 4: ['#edf8e9', '#bae4b3', '#74c476', '#238b45'], 5: ['#edf8e9', '#bae4b3', '#74c476', '#31a354', '#006d2c'], 6: ['#edf8e9', '#c7e9c0', '#a1d99b', '#74c476', '#31a354', '#006d2c'], 7: ['#edf8e9', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#005a32'], 8: ['#f7fcf5', '#e5f5e0', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#005a32'], 9: ['#f7fcf5', '#e5f5e0', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#006d2c', '#00441b'] }, Oranges: { 3: ['#fee6ce', '#fdae6b', '#e6550d'], 4: ['#feedde', '#fdbe85', '#fd8d3c', '#d94701'], 5: ['#feedde', '#fdbe85', '#fd8d3c', '#e6550d', '#a63603'], 6: ['#feedde', '#fdd0a2', '#fdae6b', '#fd8d3c', '#e6550d', '#a63603'], 7: ['#feedde', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#8c2d04'], 8: ['#fff5eb', '#fee6ce', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#8c2d04'], 9: ['#fff5eb', '#fee6ce', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#a63603', '#7f2704'] }, Reds: { 3: ['#fee0d2', '#fc9272', '#de2d26'], 4: ['#fee5d9', '#fcae91', '#fb6a4a', '#cb181d'], 5: ['#fee5d9', '#fcae91', '#fb6a4a', '#de2d26', '#a50f15'], 6: ['#fee5d9', '#fcbba1', '#fc9272', '#fb6a4a', '#de2d26', '#a50f15'], 7: ['#fee5d9', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#99000d'], 8: ['#fff5f0', '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#99000d'], 9: ['#fff5f0', '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#a50f15', '#67000d'] }, Greys: { 3: ['#f0f0f0', '#bdbdbd', '#636363'], 4: ['#f7f7f7', '#cccccc', '#969696', '#525252'], 5: ['#f7f7f7', '#cccccc', '#969696', '#636363', '#252525'], 6: ['#f7f7f7', '#d9d9d9', '#bdbdbd', '#969696', '#636363', '#252525'], 7: ['#f7f7f7', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525'], 8: ['#ffffff', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525'], 9: ['#ffffff', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525', '#000000'] }, PuOr: { 3: ['#f1a340', '#f7f7f7', '#998ec3'], 4: ['#e66101', '#fdb863', '#b2abd2', '#5e3c99'], 5: ['#e66101', '#fdb863', '#f7f7f7', '#b2abd2', '#5e3c99'], 6: ['#b35806', '#f1a340', '#fee0b6', '#d8daeb', '#998ec3', '#542788'], 7: ['#b35806', '#f1a340', '#fee0b6', '#f7f7f7', '#d8daeb', '#998ec3', '#542788'], 8: ['#b35806', '#e08214', '#fdb863', '#fee0b6', '#d8daeb', '#b2abd2', '#8073ac', '#542788'], 9: ['#b35806', '#e08214', '#fdb863', '#fee0b6', '#f7f7f7', '#d8daeb', '#b2abd2', '#8073ac', '#542788'], 10: ['#7f3b08', '#b35806', '#e08214', '#fdb863', '#fee0b6', '#d8daeb', '#b2abd2', '#8073ac', '#542788', '#2d004b'], 11: ['#7f3b08', '#b35806', '#e08214', '#fdb863', '#fee0b6', '#f7f7f7', '#d8daeb', '#b2abd2', '#8073ac', '#542788', '#2d004b'] }, BrBG: { 3: ['#d8b365', '#f5f5f5', '#5ab4ac'], 4: ['#a6611a', '#dfc27d', '#80cdc1', '#018571'], 5: ['#a6611a', '#dfc27d', '#f5f5f5', '#80cdc1', '#018571'], 6: ['#8c510a', '#d8b365', '#f6e8c3', '#c7eae5', '#5ab4ac', '#01665e'], 7: ['#8c510a', '#d8b365', '#f6e8c3', '#f5f5f5', '#c7eae5', '#5ab4ac', '#01665e'], 8: ['#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#c7eae5', '#80cdc1', '#35978f', '#01665e'], 9: ['#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#f5f5f5', '#c7eae5', '#80cdc1', '#35978f', '#01665e'], 10: ['#543005', '#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#c7eae5', '#80cdc1', '#35978f', '#01665e', '#003c30'], 11: ['#543005', '#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#f5f5f5', '#c7eae5', '#80cdc1', '#35978f', '#01665e', '#003c30'] }, PRGn: { 3: ['#af8dc3', '#f7f7f7', '#7fbf7b'], 4: ['#7b3294', '#c2a5cf', '#a6dba0', '#008837'], 5: ['#7b3294', '#c2a5cf', '#f7f7f7', '#a6dba0', '#008837'], 6: ['#762a83', '#af8dc3', '#e7d4e8', '#d9f0d3', '#7fbf7b', '#1b7837'], 7: ['#762a83', '#af8dc3', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#7fbf7b', '#1b7837'], 8: ['#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837'], 9: ['#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837'], 10: ['#40004b', '#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837', '#00441b'], 11: ['#40004b', '#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837', '#00441b'] }, PiYG: { 3: ['#e9a3c9', '#f7f7f7', '#a1d76a'], 4: ['#d01c8b', '#f1b6da', '#b8e186', '#4dac26'], 5: ['#d01c8b', '#f1b6da', '#f7f7f7', '#b8e186', '#4dac26'], 6: ['#c51b7d', '#e9a3c9', '#fde0ef', '#e6f5d0', '#a1d76a', '#4d9221'], 7: ['#c51b7d', '#e9a3c9', '#fde0ef', '#f7f7f7', '#e6f5d0', '#a1d76a', '#4d9221'], 8: ['#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221'], 9: ['#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#f7f7f7', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221'], 10: ['#8e0152', '#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221', '#276419'], 11: ['#8e0152', '#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#f7f7f7', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221', '#276419'] }, RdBu: { 3: ['#ef8a62', '#f7f7f7', '#67a9cf'], 4: ['#ca0020', '#f4a582', '#92c5de', '#0571b0'], 5: ['#ca0020', '#f4a582', '#f7f7f7', '#92c5de', '#0571b0'], 6: ['#b2182b', '#ef8a62', '#fddbc7', '#d1e5f0', '#67a9cf', '#2166ac'], 7: ['#b2182b', '#ef8a62', '#fddbc7', '#f7f7f7', '#d1e5f0', '#67a9cf', '#2166ac'], 8: ['#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac'], 9: ['#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#f7f7f7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac'], 10: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac', '#053061'], 11: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#f7f7f7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac', '#053061'] }, RdGy: { 3: ['#ef8a62', '#ffffff', '#999999'], 4: ['#ca0020', '#f4a582', '#bababa', '#404040'], 5: ['#ca0020', '#f4a582', '#ffffff', '#bababa', '#404040'], 6: ['#b2182b', '#ef8a62', '#fddbc7', '#e0e0e0', '#999999', '#4d4d4d'], 7: ['#b2182b', '#ef8a62', '#fddbc7', '#ffffff', '#e0e0e0', '#999999', '#4d4d4d'], 8: ['#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#e0e0e0', '#bababa', '#878787', '#4d4d4d'], 9: ['#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#ffffff', '#e0e0e0', '#bababa', '#878787', '#4d4d4d'], 10: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#e0e0e0', '#bababa', '#878787', '#4d4d4d', '#1a1a1a'], 11: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#ffffff', '#e0e0e0', '#bababa', '#878787', '#4d4d4d', '#1a1a1a'] }, RdYlBu: { 3: ['#fc8d59', '#ffffbf', '#91bfdb'], 4: ['#d7191c', '#fdae61', '#abd9e9', '#2c7bb6'], 5: ['#d7191c', '#fdae61', '#ffffbf', '#abd9e9', '#2c7bb6'], 6: ['#d73027', '#fc8d59', '#fee090', '#e0f3f8', '#91bfdb', '#4575b4'], 7: ['#d73027', '#fc8d59', '#fee090', '#ffffbf', '#e0f3f8', '#91bfdb', '#4575b4'], 8: ['#d73027', '#f46d43', '#fdae61', '#fee090', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4'], 9: ['#d73027', '#f46d43', '#fdae61', '#fee090', '#ffffbf', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4'], 10: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee090', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695'], 11: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee090', '#ffffbf', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695'] }, Spectral: { 3: ['#fc8d59', '#ffffbf', '#99d594'], 4: ['#d7191c', '#fdae61', '#abdda4', '#2b83ba'], 5: ['#d7191c', '#fdae61', '#ffffbf', '#abdda4', '#2b83ba'], 6: ['#d53e4f', '#fc8d59', '#fee08b', '#e6f598', '#99d594', '#3288bd'], 7: ['#d53e4f', '#fc8d59', '#fee08b', '#ffffbf', '#e6f598', '#99d594', '#3288bd'], 8: ['#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#e6f598', '#abdda4', '#66c2a5', '#3288bd'], 9: ['#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#e6f598', '#abdda4', '#66c2a5', '#3288bd'], 10: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#e6f598', '#abdda4', '#66c2a5', '#3288bd', '#5e4fa2'], 11: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#e6f598', '#abdda4', '#66c2a5', '#3288bd', '#5e4fa2'] }, RdYlGn: { 3: ['#fc8d59', '#ffffbf', '#91cf60'], 4: ['#d7191c', '#fdae61', '#a6d96a', '#1a9641'], 5: ['#d7191c', '#fdae61', '#ffffbf', '#a6d96a', '#1a9641'], 6: ['#d73027', '#fc8d59', '#fee08b', '#d9ef8b', '#91cf60', '#1a9850'], 7: ['#d73027', '#fc8d59', '#fee08b', '#ffffbf', '#d9ef8b', '#91cf60', '#1a9850'], 8: ['#d73027', '#f46d43', '#fdae61', '#fee08b', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850'], 9: ['#d73027', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850'], 10: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee08b', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850', '#006837'], 11: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850', '#006837'] }, Accent: { 3: ['#7fc97f', '#beaed4', '#fdc086'], 4: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99'], 5: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0'], 6: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f'], 7: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f', '#bf5b17'], 8: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f', '#bf5b17', '#666666'] }, Dark2: { 3: ['#1b9e77', '#d95f02', '#7570b3'], 4: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a'], 5: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e'], 6: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02'], 7: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02', '#a6761d'], 8: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02', '#a6761d', '#666666'] }, Paired: { 3: ['#a6cee3', '#1f78b4', '#b2df8a'], 4: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c'], 5: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99'], 6: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c'], 7: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f'], 8: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00'], 9: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6'], 10: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a'], 11: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99'], 12: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'] }, Pastel1: { 3: ['#fbb4ae', '#b3cde3', '#ccebc5'], 4: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4'], 5: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6'], 6: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc'], 7: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd'], 8: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd', '#fddaec'], 9: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd', '#fddaec', '#f2f2f2'] }, Pastel2: { 3: ['#b3e2cd', '#fdcdac', '#cbd5e8'], 4: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4'], 5: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9'], 6: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae'], 7: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae', '#f1e2cc'], 8: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae', '#f1e2cc', '#cccccc'] }, Set1: { 3: ['#e41a1c', '#377eb8', '#4daf4a'], 4: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3'], 5: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00'], 6: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33'], 7: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628'], 8: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf'], 9: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'] }, Set2: { 3: ['#66c2a5', '#fc8d62', '#8da0cb'], 4: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3'], 5: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854'], 6: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f'], 7: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494'], 8: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'] }, Set3: { 3: ['#8dd3c7', '#ffffb3', '#bebada'], 4: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072'], 5: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3'], 6: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462'], 7: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69'], 8: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5'], 9: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9'], 10: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd'], 11: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5'], 12: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5', '#ffed6f'] } }; var Fe = function (t, e) { return Re[t][e].map(function (n, r) { return t + ' q' + r + '-' + e }) }; r.default.api.colorBrewers.add('tauBrewer', Fe); n.d(e, 'GPL', function () { return De }), n.d(e, 'Plot', function () { return Ie }), n.d(e, 'Chart', function () { return je }), n.d(e, 'api', function () { return ze }), n.d(e, 'version', function () { return Be }); var De = r.default.GPL; var Ie = r.default.Plot; var je = r.default.Chart; var ze = r.default.api; var Be = r.default.version }]))
}))
