// WORK ON THIS
<!DOCTYPE html>
<head>
<link rel="stylesheet" href="../../../bootstrap/css/bootstrap.min.css">
<script src="../../js/jquery-3.2.1.min.js"></script>
<script src="../../js/popper.js"></script>
<script src="../../js/moment.min.js"></script>
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<title>WWSU Google Calendar Verifier</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>
<html>
<body>
<h1>WWSU Google Calendar Verifier</h1>
<p>Note 1: This page only checks events for the next week.</p>
<p>Note 2: If you recently made changes to the Google Calendar, the changes might not reflect on this page until up to one minute later.</p>
<table border="1" class="table table-hover" cellpadding="1" cellspacing="1" style="width: 100%;" id="results-table"> <tr>
</table>

<script type="text/javascript">

var theopts = {};

function escapeHTML(str) {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
}

function verifyEvents() {
var datePicker = document.getElementById('weekly-date-picker');
var tableData = document.getElementById('results-table');
    for(var i = tableData.rows.length; i > 0;i--)
        {
        tableData.deleteRow(i -1);
        }
        var events = <%- data %>;
        var header = tableData.createTHead();
        header.classList.add(`thead-dark`);
        var newRow = header.insertRow(0);
        var cell = newRow.insertCell(0);
        cell.innerHTML = 'Date/Time';
        var cell2 = newRow.insertCell(1);
        cell2.innerHTML = 'Event Name';
        var cell3 = newRow.insertCell(2);
        cell3.innerHTML = 'Status';
        var cell4 = newRow.insertCell(3);
        cell4.innerHTML = 'Information';
        events.forEach(function(dodo) {
            var newRow = tableData.insertRow(tableData.rows.length);
            var cell = newRow.insertCell(0);
            cell.innerHTML = `${moment(dodo.start).format("LLLL")} - ${moment(dodo.end).format("LLLL")}`;
            var cell2 = newRow.insertCell(1);
            cell2.innerHTML = dodo.title;
            var cell3 = newRow.insertCell(2);
            var cell4 = newRow.insertCell(3);
            cell4.innerHTML = dodo.message;
            if (dodo.type == 'Valid')
            {
                cell3.innerHTML = `<span class="badge badge-success">Valid</span>`;
            } else if (dodo.type == 'Invalid')
            {
                cell3.innerHTML = `<span class="badge badge-danger">Invalid</span>`;
            } else if (dodo.type == 'Check') 
            {
                cell3.innerHTML = `<span class="badge badge-warning">Check</span>`;
            } else {
                cell3.innerHTML = `<span class="badge badge-dark">Manual</span>`;
            }
        });
}

verifyEvents();
</script>
</body>
</html>
